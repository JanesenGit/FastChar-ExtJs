Ext.define("Ext.ux.DateTimePicker",{extend:"Ext.picker.Date",alias:"widget.datetimepicker",requires:["Ext.picker.Date","Ext.slider.Single","Ext.form.field.Time","Ext.form.Label"],todayText:"今天",hourText:"小时",minuteText:"分钟",initEvents:function(){var t=this,r=Ext.Date,o=r.DAY;Ext.apply(t.keyNavConfig,{up:function(e){e.ctrlKey?e.shiftKey?t.minuteSlider.setValue(t.minuteSlider.getValue()+1):t.showNextYear():e.shiftKey?t.hourSlider.setValue(t.hourSlider.getValue()+1):t.update(r.add(t.activeDate,o,-7))},down:function(e){e.ctrlKey?e.shiftKey?t.minuteSlider.setValue(t.minuteSlider.getValue()-1):t.showPrevYear():e.shiftKey?t.hourSlider.setValue(t.hourSlider.getValue()-1):t.update(r.add(t.activeDate,o,7))}}),t.callParent()},initComponent:function(){var e=this,t=e.value?new Date(e.value):new Date;t.setSeconds(0),e.timeFormat=~e.format.indexOf("h")?"h":"H",e.hourSlider=new Ext.slider.Single({fieldLabel:e.hourText,labelAlign:"top",labelSeparator:" ",padding:"0 0 10 17",focusable:!1,value:0,minValue:0,maxValue:23,vertical:!0,listeners:{change:e.changeTimeValue,scope:e}}),e.minuteSlider=new Ext.slider.Single({fieldLabel:e.minuteText,labelAlign:"top",labelSeparator:" ",padding:"0 10 10 0",focusable:!1,value:0,increment:1,minValue:0,maxValue:59,vertical:!0,listeners:{change:e.changeTimeValue,scope:e}}),e.callParent(),e.setValue(new Date(t))},afterRender:function(){var e=this;e.timePicker=Ext.create("Ext.panel.Panel",{layout:{type:"hbox",align:"stretch"},border:!1,defaults:{flex:1},width:80,floating:!0,alwaysOnTop:!0,dockedItems:[{xtype:"toolbar",dock:"top",ui:"footer",items:["->",{xtype:"label",text:"h"==e.timeFormat?"12:00 AM":"00:00"},"->"]}],items:[e.hourSlider,e.minuteSlider],onMouseDown:function(e){e.preventDefault()}}),e.callParent()},handleTabClick:function(e){this.handleDateClick(e,this.activeCell.firstChild,!0)},getSelectedDate:function(e){var t,r,o=Ext.Date.clearTime(e,!0).getTime(),i=this.cells,e=this.selectedCls,n=i.elements,l=n.length;for(i.removeCls(e),r=0;r<l;r++)if((t=n[r].firstChild).dateValue===o)return t;return null},changeTimeValue:function(e,t,r){var o,i,n=this,l=n.timePicker.down("label"),a=n.minuteSlider.getValue()<10?"0":"",s=n.hourSlider.getValue();"h"==n.timeFormat&&(i=n.hourSlider.getValue()<12?" AM":" PM",s=(s=n.hourSlider.getValue()<13?s:s-12)||"12"),l.setText((s<10?"0":"")+s+":"+a+n.minuteSlider.getValue()+(i||"")),n.pickerField&&(o=n.pickerField.getValue())&&(a=n.hourSlider.getValue(),i=n.minuteSlider.getValue(),i=new Date(o.setHours(a,i)),n.pickerField.setValue(i))},onShow:function(){this.showTimePicker(),this.callParent()},showTimePicker:function(){var r=this,o=r.el;Ext.defer(function(){var e=Ext.getBody().getViewSize().width<o.getX()+o.getWidth()+140?"tl":"tr",t="tl"==e?-135:5;r.timePicker.setHeight(o.getHeight()),r.timePicker.showBy(r,e,[t,0]),"transparent"==(t=r.timePicker.down("toolbar").getEl()).getStyle("background-color")&&t.setStyle("background-color",t.getStyle("border-color"))},1)},onHide:function(){this.timePicker.hide(),this.callParent()},beforeDestroy:function(){var e=this;e.rendered&&Ext.destroy(e.timePicker,e.minuteSlider,e.hourSlider),e.callParent()},setValue:function(e){return e.setSeconds(0),this.value=new Date(e),this.update(this.value)},selectToday:function(){var e=this,t=e.todayBtn,r=e.handler,o=new Date;return t&&!t.disabled&&(e.setValue(new Date(o.setSeconds(0))),e.fireEvent("select",e,e.value),r&&r.call(e.scope||e,e,e.value),e.onSelect()),e},handleDateClick:function(e,t,r){var o=this,i=o.handler,n=o.timePicker.items.items[0].getValue(),l=o.timePicker.items.items[1].getValue(),a=new Date(t.dateValue);!0!==r&&e.stopEvent(),o.disabled||!t.dateValue||Ext.fly(t.parentNode).hasCls(o.disabledCellCls)||(o.doCancelFocus=!1===o.focusOnSelect,a.setHours(n,l,0),o.setValue(new Date(a)),delete o.doCancelFocus,o.fireEvent("select",o,o.value),i&&i.call(o.scope||o,o,o.value),o.onSelect())},selectedUpdate:function(e){var t=this,e=Ext.Date.clearTime(e,!0),r=t.pickerField&&t.pickerField.getValue()||new Date;this.callParent([e]),r&&Ext.defer(function(){t.hourSlider.setValue(r.getHours()),t.minuteSlider.setValue(r.getMinutes())},10)},fullUpdate:function(e){var t=this,e=Ext.Date.clearTime(e,!0),r=t.pickerField&&t.pickerField.getValue()||new Date;this.callParent([e]),r&&Ext.defer(function(){t.hourSlider.setValue(r.getHours()),t.minuteSlider.setValue(r.getMinutes())},10)}}),Ext.define("Ext.ux.DateTimeField",{extend:"Ext.form.field.Date",alias:"widget.datetimefield",requires:["Ext.ux.DateTimePicker"],format:"m-d-Y H:i",altFormats:"m-d-Y H:i:s|c",width:200,mimicBlur:function(e){var t=this.picker;t&&(e.within(t.el,!1,!0)||e.within(t.timePicker.el,!1,!0))||this.callParent(arguments)},triggerBlur:function(){return!1},collapseIf:function(e){var t=this.picker;t.timePicker&&!e.within(t.timePicker.el,!1,!0)&&this.callParent([e])},createPicker:function(){var e=this.callParent(),e=Ext.merge(this.initialConfig,e.initialConfig);return e.renderTo&&delete e.renderTo,Ext.create("Ext.ux.DateTimePicker",e)},getErrors:function(e){e=0<arguments.length?e:this.formatDate(this.processRawValue(this.getRawValue()));var t,r,o=this,i=Ext.String.format,n=o.superclass.superclass.getErrors.apply(this,arguments),l=o.disabledDays,a=o.disabledDatesRE,s=o.minValue,c=o.maxValue,d=l?l.length:0,u=0;if(null===e||e.length<1)return n;if(!(e=o.parseDate(r=e)))return n.push(i(o.invalidText,r,Ext.Date.unescapeFormat(o.format))),n;if(r=e.getTime(),s&&r<s.getTime()&&n.push(i(o.minText,o.formatDate(s))),c&&r>c.getTime()&&n.push(i(o.maxText,o.formatDate(c))),l)for(t=e.getDay();u<d;u++)if(t===l[u]){n.push(o.disabledDaysText);break}return c=o.formatDate(e),a&&a.test(c)&&n.push(i(o.disabledDatesText,c)),n},getRefItems:function(){var e=this.callParent();return this.picker&&this.picker.timePicker&&e.push(this.picker.timePicker),e}}),Ext.define("Ext.ux.BoxReorderer",{requires:["Ext.dd.DD"],mixins:{observable:"Ext.util.Observable"},itemSelector:".x-box-item",animate:100,constructor:function(){this.mixins.observable.constructor.apply(this,arguments)},init:function(e){var t=this;t.container=e,t.animatePolicy={},t.animatePolicy[e.getLayout().names.x]=!0,t.container.on({scope:t,boxready:t.onBoxReady,beforedestroy:t.onContainerDestroy})},onContainerDestroy:function(){var e=this.dd;e&&(e.unreg(),this.dd=null)},onBoxReady:function(){var e=this,t=e.container.getLayout(),r=t.names,t=e.dd=new Ext.dd.DD(t.innerCt,e.container.id+"-reorderer");Ext.apply(t,{animate:e.animate,reorderer:e,container:e.container,getDragCmp:e.getDragCmp,clickValidator:Ext.Function.createInterceptor(t.clickValidator,e.clickValidator,e,!1),onMouseDown:e.onMouseDown,startDrag:e.startDrag,onDrag:e.onDrag,endDrag:e.endDrag,getNewIndex:e.getNewIndex,doSwap:e.doSwap,findReorderable:e.findReorderable}),t.dim=r.width,t.startAttr=r.beforeX,t.endAttr=r.afterX},getDragCmp:function(e){return this.container.getChildByElement(e.getTarget(this.itemSelector,10))},clickValidator:function(e){e=this.getDragCmp(e);return!(!e||!1===e.reorderable)},onMouseDown:function(e){var t,r=this,o=r.container;r.dragCmp=r.getDragCmp(e),r.dragCmp&&(t=r.dragCmp.getEl(),r.startIndex=r.curIndex=o.items.indexOf(r.dragCmp),t=t.getBox(),r.lastPos=t[r.startAttr],o=o.el.getBox(),"width"===r.dim?(r.minX=o.left,r.maxX=o.right-t.width,r.minY=r.maxY=t.top,r.deltaX=e.getX()-t.left):(r.minY=o.top,r.maxY=o.bottom-t.height,r.minX=r.maxX=t.left,r.deltaY=e.getY()-t.top),r.constrainY=r.constrainX=!0)},startDrag:function(){var e=this,t=e.dragCmp;t?(t.setPosition=Ext.emptyFn,t.animate=!1,e.animate&&(e.container.getLayout().animatePolicy=e.reorderer.animatePolicy),e.dragElId=t.getEl().id,e.reorderer.fireEvent("StartDrag",e,e.container,t,e.curIndex),t.suspendEvents(),t.disabled=!0,t.el.setStyle("zIndex",100)):e.dragElId=null},findReorderable:function(e){var t,r=this.container.items;if(!1===r.getAt(e).reorderable)if(t=r.getAt(e),e>this.startIndex)for(;t&&!1===t.reorderable;)t=r.getAt(++e);else for(;t&&!1===t.reorderable;)t=r.getAt(--e);return e=Math.min(Math.max(e,0),r.getCount()-1),!1===r.getAt(e).reorderable?-1:e},doSwap:function(e){var t,r,o,i=this,n=i.container.items,l=i.container,a=i.container._isLayoutRoot;-1!==(e=i.findReorderable(e))&&(i.reorderer.fireEvent("ChangeIndex",i,l,i.dragCmp,i.startIndex,e),t=n.getAt(i.curIndex),r=n.getAt(e),n.remove(t),o=Math.min(Math.max(e,0),n.getCount()-1),n.insert(o,t),n.remove(r),n.insert(i.curIndex,r),l._isLayoutRoot=!0,l.updateLayout(),l._isLayoutRoot=a,i.curIndex=e)},onDrag:function(e){var t=this,e=t.getNewIndex(e.getPoint());void 0!==e&&(t.reorderer.fireEvent("Drag",t,t.container,t.dragCmp,t.startIndex,t.curIndex),t.doSwap(e))},endDrag:function(e){e&&e.stopEvent();var t=this,r=t.container.getLayout();t.dragCmp&&(delete t.dragElId,delete t.dragCmp.setPosition,t.dragCmp.animate=!0,t.dragCmp.lastBox[r.names.x]=t.dragCmp.getPosition(!0)[r.names.widthIndex],t.container._isLayoutRoot=!0,t.container.updateLayout(),t.container._isLayoutRoot=void 0,(e=Ext.fx.Manager.getFxQueue(t.dragCmp.el.id)[0])?e.on({afteranimate:t.reorderer.afterBoxReflow,scope:t}):Ext.Function.defer(t.reorderer.afterBoxReflow,1,t),t.animate&&delete r.animatePolicy,t.reorderer.fireEvent("drop",t,t.container,t.dragCmp,t.startIndex,t.curIndex))},afterBoxReflow:function(){this.dragCmp.el.setStyle("zIndex",""),this.dragCmp.disabled=!1,this.dragCmp.resumeEvents()},getNewIndex:function(e){var t,r=this,o=r.getDragEl(),i=Ext.fly(o).getBox(),n=0,l=r.container.items.items,a=l.length,s=r.lastPos;for(r.lastPos=i[r.startAttr];n<a;n++)if((t=l[n].getEl()).is(r.reorderer.itemSelector))if(t=(t=t.getBox())[r.startAttr]+(t[r.dim]>>1),n<r.curIndex){if(i[r.startAttr]<s&&i[r.startAttr]<t-5)return n}else if(n>r.curIndex&&i[r.startAttr]>s&&i[r.endAttr]>t+5)return n}}),Ext.define("Ext.ux.TabReorderer",{extend:"Ext.ux.BoxReorderer",alias:"plugin.tabreorderer",itemSelector:"."+Ext.baseCSSPrefix+"tab",init:function(e){this.callParent([e.getTabBar()]),e.onAdd=Ext.Function.createSequence(e.onAdd,this.onAdd)},onBoxReady:function(){var e,t,r,o=0;for(this.callParent(arguments),t=(e=this.container.items.items).length;o<t;o++)(r=e[o]).card&&(r.reorderable=r.card.reorderable)},onAdd:function(e,t){e.tab.reorderable=e.reorderable},afterBoxReflow:function(){var e=this;Ext.ux.BoxReorderer.prototype.afterBoxReflow.apply(e,arguments),e.dragCmp&&(e.container.tabPanel.setActiveTab(e.dragCmp.card),e.container.tabPanel.move(e.dragCmp.card,e.curIndex))}}),Ext.ns("Ext.ux"),Ext.define("Ext.ux.TabScrollerMenu",{alias:"plugin.tabscrollermenu",requires:["Ext.menu.Menu"],pageSize:10,maxText:15,menuPrefixText:"Items",constructor:function(e){Ext.apply(this,e)},init:function(e){var t=this;(t.tabPanel=e).on({render:function(){t.tabBar=e.tabBar,t.layout=t.tabBar.layout,t.layout.overflowHandler.handleOverflow=Ext.Function.bind(t.showButton,t),t.layout.overflowHandler.clearOverflow=Ext.Function.createSequence(t.layout.overflowHandler.clearOverflow,t.hideButton,t)},destroy:t.destroy,scope:t,single:!0})},showButton:function(){var e=this,t=Ext.getClass(e.layout.overflowHandler).prototype.handleOverflow.apply(e.layout.overflowHandler,arguments),r=e.menuButton;return 1<e.tabPanel.items.getCount()?(r||((r=e.menuButton=e.tabBar.body.createChild({cls:Ext.baseCSSPrefix+"tab-tabmenu-right"},e.tabBar.body.child("."+Ext.baseCSSPrefix+"box-scroller-right"))).addClsOnOver(Ext.baseCSSPrefix+"tab-tabmenu-over"),r.on("click",e.showTabsMenu,e)),r.setVisibilityMode(Ext.dom.Element.DISPLAY),r.show(),t.reservedSpace+=r.getWidth()):e.hideButton(),t},hideButton:function(){this.menuButton&&this.menuButton.hide()},getPageSize:function(){return this.pageSize},setPageSize:function(e){this.pageSize=e},getMaxText:function(){return this.maxText},setMaxText:function(e){this.maxText=e},getMenuPrefixText:function(){return this.menuPrefixText},setMenuPrefixText:function(e){this.menuPrefixText=e},showTabsMenu:function(e){var t=this;t.tabsMenu?t.tabsMenu.removeAll():t.tabsMenu=new Ext.menu.Menu,t.generateTabMenuItems();e=Ext.get(e.getTarget()).getXY();e[1]+=24,t.tabsMenu.showAt(e)},generateTabMenuItems:function(){var e,t,r,o,i,n,l,a=this,s=a.tabPanel,c=s.getActiveTab(),d=s.items.getRange(),u=a.getPageSize(),g=a.tabsMenu;if(g.suspendLayouts(),e=(d=Ext.Array.filter(d,function(e){return e.id!=c.id&&(!e.hidden||!!e.hiddenByLayout)})).length,t=Math.floor(e/u),s=e%u,u<e){for(r=0;r<t;r++){for(o=(r+1)*u,i=[],n=0;n<u;n++)l=d[n+o-u],i.push(a.autoGenMenuItem(l));g.add({text:a.getMenuPrefixText()+" "+(o-u+1)+" - "+o,menu:i})}if(0<s){for(i=[],r=s=t*u;r<e;r++)l=d[r],i.push(a.autoGenMenuItem(l));a.tabsMenu.add({text:a.menuPrefixText+" "+(1+s)+" - "+(s+i.length),menu:i})}}else for(r=0;r<e;++r)g.add(a.autoGenMenuItem(d[r]));g.resumeLayouts(!0)},autoGenMenuItem:function(e){var t=this.getMaxText();return{text:Ext.util.Format.ellipsis(e.title,t),handler:this.showTabFromMenu,scope:this,disabled:e.disabled,tabToShow:e,iconCls:e.iconCls}},showTabFromMenu:function(e){this.tabPanel.setActiveTab(e.tabToShow)},destroy:function(){Ext.destroy(this.tabsMenu,this.menuButton),this.callParent()}}),Ext.define("Ext.ux.TabCloseMenu",{extend:"Ext.plugin.Abstract",alias:"plugin.tabclosemenu",mixins:{observable:"Ext.util.Observable"},closeTabText:"关闭当前",showCloseOthers:!0,closeOthersTabsText:"关闭其他",showCloseAll:!0,closeAllTabsText:"关闭所有",extraItemsHead:null,extraItemsTail:null,constructor:function(e){this.callParent([e]),this.mixins.observable.constructor.call(this,e)},init:function(e){this.tabPanel=e,this.tabBar=e.down("tabbar"),this.mon(this.tabPanel,{scope:this,afterlayout:this.onAfterLayout,single:!0})},onAfterLayout:function(){this.mon(this.tabBar.el,{scope:this,contextmenu:this.onContextMenu,delegate:".x-tab"})},destroy:function(){this.callParent(),Ext.destroy(this.menu)},onContextMenu:function(e,t){var r=this,o=r.createMenu(),i=!0,n=!0,t=r.tabBar.getChildByElement(t),t=r.tabBar.items.indexOf(t);r.item=r.tabPanel.getComponent(t),o.child("#anchorLeftMenu").setDisabled(!r.item.closable),o.child("#close").setDisabled(!r.item.closable),o.child("#copyTab").setDisabled(!r.item.closable),o.child("#openInWindowTab").setDisabled(!r.item.closable),o.child("#copyUrlTab").setDisabled(!r.item.closable),r.item.justFixed?o.child("#fixedTab").hide():(o.child("#fixedTab").show(),r.item.closable?(o.child("#fixedTab").setText("固定标签"),o.child("#fixedTab").setIconCls("extIcon extFixed")):(o.child("#fixedTab").setText("取消固定"),o.child("#fixedTab").setIconCls("extIcon extUnFixed"))),(r.showCloseAll||r.showCloseOthers)&&(r.tabPanel.items.each(function(e){return!e.closable||(i=!1,e===r.item)||(n=!1)}),r.showCloseAll&&o.child("#closeAll").setDisabled(i),r.showCloseOthers&&o.child("#closeOthers").setDisabled(n)),o.child("#closeRightOthers").setDisabled(this.tabPanel.items.indexOf(this.item)===this.tabPanel.items.getCount()-1),e.preventDefault(),r.fireEvent("beforemenu",o,r.item,r),o.showAt(e.getXY())},createMenu:function(){var e,t=this;return t.menu||((e=[]).push({itemId:"anchorLeftMenu",text:"定位左侧菜单",scope:t,iconCls:"extIcon extLastPoint",handler:function(){t.item.anchorLeftMenu()}}),e.push({itemId:"copyUrlTab",text:"复制地址",scope:t,iconCls:"extIcon extCopy",handler:function(){t.item.doCopyUrl()}}),e.push({itemId:"fixedTab",text:"固定标签",scope:t,iconCls:"extIcon extFixed",handler:function(){t.item.doFixed()}}),e.push({itemId:"copyTab",text:"复制标签",scope:t,iconCls:"extIcon extCopy",handler:function(){system.showTab(t.item.method,"CopyTab"+Ext.now(),"复制-"+t.item.title,t.item.icon)}}),e.push({itemId:"openInWindowTab",text:"在窗口中打开",scope:t,iconCls:"extIcon extWindow",handler:function(){t.item.openInWindow()}}),e.push("-"),e.push({itemId:"close",text:t.closeTabText,scope:t,iconCls:"extIcon extClose",handler:t.onClose}),(t.showCloseAll||t.showCloseOthers)&&e.push("-"),t.showCloseOthers&&e.push({itemId:"closeOthers",text:t.closeOthersTabsText,scope:t,iconCls:"extIcon extCloseOther",handler:t.onCloseOthers}),e.push({itemId:"closeRightOthers",text:"关闭右侧标签",scope:t,iconCls:"extIcon extCloseOther",handler:t.onRightCloseOthers}),t.showCloseAll&&e.push({itemId:"closeAll",text:t.closeAllTabsText,scope:t,iconCls:"extIcon extCloseAll",handler:t.onCloseAll}),t.extraItemsHead&&(e=t.extraItemsHead.concat(e)),t.extraItemsTail&&(e=e.concat(t.extraItemsTail)),t.menu=Ext.create("Ext.menu.Menu",{items:e,listeners:{hide:t.onHideMenu,click:t.onItemClick,scope:t}})),t.menu},onHideMenu:function(){this.fireEvent("aftermenu",this.menu,this)},onItemClick:function(e,t,r,o){this.fireEvent("itemclick",e,t,r,o)},onClose:function(){this.tabPanel.remove(this.item)},onCloseOthers:function(){this.doClose(!0)},onRightCloseOthers:function(){this.doClose(!0,!0)},onCloseAll:function(){this.doClose(!1)},doClose:function(r,e){var o=[],i=-1;e&&(i=this.tabPanel.items.indexOf(this.item)),this.tabPanel.items.each(function(e,t){e.closable&&i<t&&(r&&e===this.item||o.push(e))},this),Ext.suspendLayouts(),Ext.Array.forEach(o,function(e){this.tabPanel.remove(e)},this),Ext.resumeLayouts(!0),this.fireEvent("closedone",this.menu,this)}}),Ext.define("Ext.ux.ProgressBarPager",{requires:["Ext.ProgressBar"],width:225,defaultText:"Loading...",defaultAnimCfg:{duration:1e3,easing:"bounceOut"},constructor:function(e){e&&Ext.apply(this,e)},init:function(e){var t;e.displayInfo&&((t=(this.parent=e).child("#displayItem"))&&e.remove(t,!0),this.progressBar=Ext.create("Ext.ProgressBar",{text:this.defaultText,width:this.width,animate:this.defaultAnimCfg,style:{cursor:"pointer"},listeners:{el:{scope:this,click:this.handleProgressBarClick}}}),e.displayItem=this.progressBar,e.add(e.displayItem),Ext.apply(e,this.parentOverrides))},handleProgressBarClick:function(e){var t=this.parent,r=t.displayItem,o=this.progressBar.getBox(),e=e.getXY()[0]-o.x,o=Math.ceil(t.store.getTotalCount()/t.pageSize),o=Math.max(Math.ceil(e/(r.width/o)),1);t.store.loadPage(o)},parentOverrides:{updateInfo:function(){var e,t;this.displayItem&&(e=this.store.getCount(),t=this.getPageData(),e=0===e?this.emptyMsg:Ext.String.format(this.displayMsg,t.fromRecord,t.toRecord,this.store.getTotalCount()),t=0<t.pageCount?t.currentPage/t.pageCount:0,this.displayItem.updateProgress(t,e,this.animate||this.defaultAnimConfig))}}}),Ext.define("Ext.ux.colorpick.Selection",{mixinId:"colorselection",config:{format:"hex6",value:"FF0000",color:null,previousColor:null},applyColor:function(e){var t=e;return t=Ext.isString(t)?Ext.ux.colorpick.ColorUtils.parseColor(e):t},applyValue:function(e){e=Ext.ux.colorpick.ColorUtils.parseColor(e);return this.formatColor(e)},formatColor:function(e){return Ext.ux.colorpick.ColorUtils.formats[this.getFormat()](e)},updateColor:function(e){var t=this;t.syncing||(t.syncing=!0,t.setValue(t.formatColor(e)),t.syncing=!1)},updateValue:function(e,t){var r=this;r.syncing||(r.syncing=!0,r.setColor(e),r.syncing=!1),this.fireEvent("change",r,e,t)}}),Ext.define("Ext.ux.colorpick.ColorUtils",function(o){var e=Ext.isIE&&Ext.ieVersion<10;return{singleton:!0,constructor:function(){o=this},backgroundTpl:e?"filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0, startColorstr='#{alpha}{hex}', endColorstr='#{alpha}{hex}');":"background: {rgba};",setBackground:e?function(e,t){var r;e&&(r=Ext.XTemplate.getTpl(o,"backgroundTpl"),t={hex:o.rgb2hex(t.r,t.g,t.b),alpha:Math.floor(255*t.a).toString(16)},t=r.apply(t),e.applyStyles(t))}:function(e,t){var r;e&&(r=Ext.XTemplate.getTpl(o,"backgroundTpl"),t={rgba:o.getRGBAString(t)},t=r.apply(t),e.applyStyles(t))},formats:{HEX6:function(e){return o.rgb2hex(e.r,e.g,e.b)},HEX8:function(e){var t=o.rgb2hex(e.r,e.g,e.b),e=Math.round(255*e.a).toString(16);return e.length<2&&(t+="0"),t+=e.toUpperCase()}},hexRe:/#?([0-9a-f]{3,8})/i,rgbaAltRe:/rgba\(\s*([\w#\d]+)\s*,\s*([\d\.]+)\s*\)/,rgbaRe:/rgba\(\s*([\d\.]+)\s*,\s*([\d\.]+)\s*,\s*([\d\.]+)\s*,\s*([\d\.]+)\s*\)/,rgbRe:/rgb\(\s*([\d\.]+)\s*,\s*([\d\.]+)\s*,\s*([\d\.]+)\s*\)/,parseColor:function(e){if(!e)return null;var t,r,o=this,i=o.colorMap[e];if(i)r={r:i[0],g:i[1],b:i[2],a:1};else if("transparent"===e)r={r:0,g:0,b:0,a:0};else if(t=o.hexRe.exec(e))switch((t=t[1]).length){default:return null;case 3:r={r:parseInt(t[0]+t[0],16),g:parseInt(t[1]+t[1],16),b:parseInt(t[2]+t[2],16),a:1};break;case 6:case 8:r={r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:parseInt(t.substr(4,2),16),a:parseInt(t.substr(6,2)||"ff",16)/255}}else if(t=o.rgbaRe.exec(e))r={r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])};else{if(t=o.rgbaAltRe.exec(e))return(r=o.parseColor(t[1])).a=parseFloat(t[2]),r;if(!(t=o.rgbRe.exec(e)))return null;r={r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:1}}return e=this.rgb2hsv(r.r,r.g,r.b),Ext.apply(r,e)},getRGBAString:function(e){return"rgba("+e.r+","+e.g+","+e.b+","+e.a+")"},getRGBString:function(e){return"rgb("+e.r+","+e.g+","+e.b+")"},hsv2rgb:function(e,t,r){var o=r*t,i=(e=360===(e*=360)?0:e)/60,n=o*(1-Math.abs(i%2-1)),l=[0,0,0];switch(Math.floor(i)){case 0:l=[o,n,0];break;case 1:l=[n,o,0];break;case 2:l=[0,o,n];break;case 3:l=[0,n,o];break;case 4:l=[n,0,o];break;case 5:l=[o,0,n];break;default:console.error("unknown color "+e+" "+t+" "+r)}i=r-o;return l[0]+=i,l[1]+=i,l[2]+=i,l[0]=Math.round(255*l[0]),l[1]=Math.round(255*l[1]),l[2]=Math.round(255*l[2]),{r:l[0],g:l[1],b:l[2]}},rgb2hsv:function(e,t,r){e/=255,t/=255,r/=255;var o=Math.max(e,t,r),i=o-Math.min(e,t,r),n=0;0!=i&&(o===e?n=(t-r)/i%6:o===t?n=(r-e)/i+2:o===r&&(n=(e-t)/i+4));n*=60;return 360===n&&(n=0),(n/=360)<0&&(n+=1),{h:n,s:0!=i?i/o:0,v:o}},rgb2hex:function(e,t,r){return e=e.toString(16),t=t.toString(16),r=r.toString(16),((e=e.length<2?"0"+e:e)+(t=t.length<2?"0"+t:t)+(r=r.length<2?"0"+r:r)).toUpperCase()},colorMap:{aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]}}},function(e){var t=e.formats,r={};t["#HEX6"]=function(e){return"#"+t.HEX6(e)},t["#HEX8"]=function(e){return"#"+t.HEX8(e)},Ext.Object.each(t,function(e,t){r[e.toLowerCase()]=function(e){return t(e).toLowerCase()}}),Ext.apply(t,r)}),Ext.define("Ext.ux.colorpick.ColorMapController",{extend:"Ext.app.ViewController",alias:"controller.colorpickercolormapcontroller",requires:["Ext.ux.colorpick.ColorUtils"],onFirstBoxReady:function(){var e=this,t=e.getView(),r=t.down("#dragHandle").dd;r.constrain=!0,r.constrainTo=t.getEl(),r.initialConstrainTo=r.constrainTo,r.on("drag",Ext.bind(e.onHandleDrag,e)),e.mon(t.getEl(),{mousedown:e.onMouseDown,dragstart:e.onDragStart,scope:e})},onHandleDrag:function(e,t){var r=this.getView(),o=r.down("#dragHandle"),i=o.getX()-r.getX(),n=o.getY()-r.getY(),o=r.getEl(),i=i/o.getWidth(),o=n/o.getHeight();r.fireEvent("handledrag",i=.99<i?1:i,o=.99<o?1:o)},onMouseDown:function(e){var t=this.getView().down("#dragHandle");t.setY(e.getY()),t.setX(e.getX()),this.onHandleDrag(),t.dd.onMouseDown(e,t.dd.el)},onDragStart:function(e){var t=this.getView().down("#dragHandle");t.dd.onDragStart(e,t.dd.el)},onMapClick:function(e){var t=this.getView(),r=t.down("#dragHandle"),o=t.getXY(),t=e.getXY(),e=t[0]-o[0],o=t[1]-o[1];r.getEl().setStyle({left:e+"px",top:o+"px"}),this.onHandleDrag()},onColorBindingChanged:function(e){var t=this.getViewModel().get("selectedColor"),r=this.getView(),o=r.down("#dragHandle"),i=r.getEl(),r=i.getWidth(),i=i.getHeight(),t=Ext.ux.colorpick.ColorUtils.rgb2hsv(t.r,t.g,t.b),r=r*t.s,t=i*(1-t.v);o.getEl().setStyle({left:r+"px",top:t+"px"})},onHueBindingChanged:function(e){this.getViewModel();var e=Ext.ux.colorpick.ColorUtils.hsv2rgb(e,1,1),e=Ext.ux.colorpick.ColorUtils.rgb2hex(e.r,e.g,e.b);this.getView().getEl().applyStyles({"background-color":"#"+e})}}),Ext.define("Ext.ux.colorpick.ColorMap",{extend:"Ext.container.Container",alias:"widget.colorpickercolormap",controller:"colorpickercolormapcontroller",requires:["Ext.ux.colorpick.ColorMapController"],cls:Ext.baseCSSPrefix+"colorpicker-colormap",items:[{xtype:"component",cls:Ext.baseCSSPrefix+"colorpicker-colormap-draghandle-container",itemId:"dragHandle",width:1,height:1,draggable:!0,html:'<div class="'+Ext.baseCSSPrefix+'colorpicker-colormap-draghandle"></div>'}],listeners:{boxready:{single:!0,fn:"onFirstBoxReady",scope:"controller"},colorbindingchanged:{fn:"onColorBindingChanged",scope:"controller"},huebindingchanged:{fn:"onHueBindingChanged",scope:"controller"}},afterRender:function(){var e=this.mapGradientUrl,t=this.el;this.callParent(),e||(0===(e=(e=t.getStyle("background-image")).substring(4,e.length-1)).indexOf('"')&&(e=e.substring(1,e.length-1)),Ext.ux.colorpick.ColorMap.prototype.mapGradientUrl=e),t.setStyle("background-image","none"),(t=this.layout.getElementTarget()).createChild({tag:"img",cls:Ext.baseCSSPrefix+"colorpicker-colormap-blender",src:e})},setPosition:function(e){var t=this.down("#dragHandle");t.dd&&t.dd.constrain&&(void 0!==t.dd.dragEnded&&!t.dd.dragEnded||this.fireEvent("colorbindingchanged",e))},setHue:function(e){this.getEl()&&this.fireEvent("huebindingchanged",e)}}),Ext.define("Ext.ux.colorpick.ColorPreview",{extend:"Ext.Component",alias:"widget.colorpickercolorpreview",requires:["Ext.util.Format"],style:"position: relative",html:'<div class="filter" style="height:100%; width:100%; position: absolute;"></div><a class="btn" style="height:100%; width:100%; position: absolute;"></a>',cls:"x-colorpreview",height:256,onRender:function(){var e=this;e.callParent(arguments),e.mon(e.el.down(".btn"),"click",e.onClick,e)},onClick:function(){this.fireEvent("click",this,this.color)},setColor:function(e){this.getEl()&&(this.color=e,this.applyBgStyle(e))},bgStyleTpl:Ext.create("Ext.XTemplate",Ext.isIE&&Ext.ieVersion<10?"filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0, startColorstr='#{hexAlpha}{hex}', endColorstr='#{hexAlpha}{hex}');":"background: {rgba};"),applyBgStyle:function(e){var t=Ext.ux.colorpick.ColorUtils,r=this.getEl().down(".filter"),o=t.rgb2hex(e.r,e.g,e.b),i=Ext.util.Format.hex(Math.floor(255*e.a),2),e=t.getRGBAString(e),e=this.bgStyleTpl.apply({hex:o,hexAlpha:i,rgba:e});r.applyStyles(e)}}),Ext.define("Ext.ux.colorpick.SliderController",{extend:"Ext.app.ViewController",alias:"controller.colorpick-slidercontroller",boxReady:function(e){var t=this.getDragContainer(),r=this.getDragHandle().dd;r.constrain=!0,r.constrainTo=t.getEl(),r.initialConstrainTo=r.constrainTo,r.on("drag",this.onHandleDrag,this)},getDragHandle:function(){return this.view.lookupReference("dragHandle")},getDragContainer:function(){return this.view.lookupReference("dragHandleContainer")},onHandleDrag:function(e){var t=this.getView(),r=this.getDragContainer(),r=(this.getDragHandle().getY()-r.getY())/r.getEl().getHeight();t.fireEvent("handledrag",r=.99<r?1:r)},onMouseDown:function(e){var t=this.getDragHandle(),r=e.getY();t.setY(r),this.onHandleDrag(),t.el.repaint(),t.dd.onMouseDown(e,t.dd.el)},onDragStart:function(e){var t=this.getDragHandle();t.dd.onDragStart(e,t.dd.el)},onMouseUp:function(){this.getDragHandle().dd.dragEnded=!0}}),Ext.define("Ext.ux.colorpick.Slider",{extend:"Ext.container.Container",xtype:"colorpickerslider",controller:"colorpick-slidercontroller",baseCls:Ext.baseCSSPrefix+"colorpicker-slider",layout:"center",requires:["Ext.layout.container.Center","Ext.ux.colorpick.SliderController"],referenceHolder:!0,listeners:{element:"el",mousedown:"onMouseDown",mouseup:"onMouseUp",dragstart:"onDragStart"},items:{xtype:"container",cls:Ext.baseCSSPrefix+"colorpicker-draghandle-container",reference:"dragHandleContainer",height:"100%",items:{xtype:"component",cls:Ext.baseCSSPrefix+"colorpicker-draghandle-outer",reference:"dragHandle",width:"100%",height:1,draggable:!0,html:'<div class="'+Ext.baseCSSPrefix+'colorpicker-draghandle"></div>'}},setHue:function(){Ext.raise("Must implement setHue() in a child class!")},getDragHandle:function(){return this.lookupReference("dragHandle")},getDragContainer:function(){return this.lookupReference("dragHandleContainer")}}),Ext.define("Ext.ux.colorpick.SliderAlpha",{extend:"Ext.ux.colorpick.Slider",alias:"widget.colorpickerslideralpha",cls:Ext.baseCSSPrefix+"colorpicker-alpha",requires:["Ext.XTemplate"],gradientStyleTpl:Ext.create("Ext.XTemplate",Ext.isIE&&Ext.ieVersion<10?"filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0, startColorstr='#FF{hex}', endColorstr='#00{hex}');":"background: -mox-linear-gradient(top, rgba({r}, {g}, {b}, 1) 0%, rgba({r}, {g}, {b}, 0) 100%);background: -webkit-linear-gradient(top,rgba({r}, {g}, {b}, 1) 0%, rgba({r}, {g}, {b}, 0) 100%);background: -o-linear-gradient(top, rgba({r}, {g}, {b}, 1) 0%, rgba({r}, {g}, {b}, 0) 100%);background: -ms-linear-gradient(top, rgba({r}, {g}, {b}, 1) 0%, rgba({r}, {g}, {b}, 0) 100%);background: linear-gradient(to bottom, rgba({r}, {g}, {b}, 1) 0%, rgba({r}, {g}, {b}, 0) 100%);"),setAlpha:function(e){var t=this.getDragContainer(),r=this.getDragHandle(),t=t.getEl().getHeight();r.dd&&r.dd.constrain&&(void 0!==r.dd.dragEnded&&!r.dd.dragEnded||(e=t*(1-e/100),r.getEl().setStyle({top:e})))},setColor:function(e){var t,r=this.getDragContainer();this.getEl()&&(t=Ext.ux.colorpick.ColorUtils.rgb2hex(e.r,e.g,e.b),r.getEl().down(".x-autocontainer-innerCt").applyStyles(this.gradientStyleTpl.apply({hex:t,r:e.r,g:e.g,b:e.b})))}}),Ext.define("Ext.ux.colorpick.SliderSaturation",{extend:"Ext.ux.colorpick.Slider",alias:"widget.colorpickerslidersaturation",cls:Ext.baseCSSPrefix+"colorpicker-saturation",gradientStyleTpl:Ext.create("Ext.XTemplate",Ext.isIE&&Ext.ieVersion<10?"filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0, startColorstr='#{hex}', endColorstr='#ffffff');":"background: -mox-linear-gradient(top, #{hex} 0%, #ffffff 100%);background: -webkit-linear-gradient(top, #{hex} 0%,#ffffff 100%);background: -o-linear-gradient(top, #{hex} 0%,#ffffff 100%);background: -ms-linear-gradient(top, #{hex} 0%,#ffffff 100%);background: linear-gradient(to bottom, #{hex} 0%,#ffffff 100%);"),setSaturation:function(e){var t=this.getDragContainer(),r=this.getDragHandle(),t=t.getEl().getHeight();r.dd&&r.dd.constrain&&(void 0!==r.dd.dragEnded&&!r.dd.dragEnded||(e=t*(1-e/100),r.getEl().setStyle({top:e+"px"})))},setHue:function(e){var t=this.getDragContainer();this.getEl()&&(e=Ext.ux.colorpick.ColorUtils.hsv2rgb(e,1,1),e=Ext.ux.colorpick.ColorUtils.rgb2hex(e.r,e.g,e.b),t.getEl().applyStyles(this.gradientStyleTpl.apply({hex:e})))}}),Ext.define("Ext.ux.colorpick.SliderValue",{extend:"Ext.ux.colorpick.Slider",alias:"widget.colorpickerslidervalue",cls:Ext.baseCSSPrefix+"colorpicker-value",requires:["Ext.XTemplate"],gradientStyleTpl:Ext.create("Ext.XTemplate",Ext.isIE&&Ext.ieVersion<10?"filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0, startColorstr='#{hex}', endColorstr='#000000');":"background: -mox-linear-gradient(top, #{hex} 0%, #000000 100%);background: -webkit-linear-gradient(top, #{hex} 0%,#000000 100%);background: -o-linear-gradient(top, #{hex} 0%,#000000 100%);background: -ms-linear-gradient(top, #{hex} 0%,#000000 100%);background: linear-gradient(to bottom, #{hex} 0%,#000000 100%);"),setValue:function(e){var t=this.getDragContainer(),r=this.getDragHandle(),t=t.getEl().getHeight();r.dd&&r.dd.constrain&&(void 0!==r.dd.dragEnded&&!r.dd.dragEnded||(e=t*(1-e/100),r.getEl().setStyle({top:e+"px"})))},setHue:function(e){var t=this.getDragContainer();this.getEl()&&(e=Ext.ux.colorpick.ColorUtils.hsv2rgb(e,1,1),e=Ext.ux.colorpick.ColorUtils.rgb2hex(e.r,e.g,e.b),t.getEl().applyStyles(this.gradientStyleTpl.apply({hex:e})))}}),Ext.define("Ext.ux.colorpick.SliderHue",{extend:"Ext.ux.colorpick.Slider",alias:"widget.colorpickersliderhue",cls:Ext.baseCSSPrefix+"colorpicker-hue",afterRender:function(){var e=this.gradientUrl,t=this.el;this.callParent(),e||(0===(e=(e=t.getStyle("background-image")).substring(4,e.length-1)).indexOf('"')&&(e=e.substring(1,e.length-1)),Ext.ux.colorpick.SliderHue.prototype.gradientUrl=e),t.setStyle("background-image","none"),(t=this.getDragContainer().layout.getElementTarget()).createChild({tag:"img",cls:Ext.baseCSSPrefix+"colorpicker-hue-gradient",src:e})},setHue:function(e){var t=this.getDragContainer(),r=this.getDragHandle(),t=t.getEl().getHeight();r.dd&&r.dd.constrain&&(void 0!==r.dd.dragEnded&&!r.dd.dragEnded||(e=t*(360-e)/360,r.getEl().setStyle({top:e+"px"})))}}),Ext.define("Ext.ux.colorpick.SelectorModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.colorpick-selectormodel",requires:["Ext.ux.colorpick.ColorUtils"],data:{selectedColor:{r:255,g:255,b:255,h:0,s:1,v:1,a:1},previousColor:{r:0,g:0,b:0,h:0,s:1,v:1,a:1}},formulas:{hex:{get:function(e){var t=e("selectedColor.r").toString(16),r=e("selectedColor.g").toString(16),e=e("selectedColor.b").toString(16);return"#"+Ext.ux.colorpick.ColorUtils.rgb2hex(t,r,e)},set:function(e){e=Ext.ux.colorpick.ColorUtils.hex2rgb(e);this.changeRGB(e)}},red:{get:function(e){return e("selectedColor.r")},set:function(e){this.changeRGB({r:e})}},green:{get:function(e){return e("selectedColor.g")},set:function(e){this.changeRGB({g:e})}},blue:{get:function(e){return e("selectedColor.b")},set:function(e){this.changeRGB({b:e})}},hue:{get:function(e){return 360*e("selectedColor.h")},set:function(e){this.changeHSV({h:e/360})}},saturation:{get:function(e){return 100*e("selectedColor.s")},set:function(e){this.changeHSV({s:e/100})}},value:{get:function(e){return 100*e("selectedColor.v")},set:function(e){this.changeHSV({v:e/100})}},alpha:{get:function(e){return 100*e("selectedColor.a")},set:function(e){this.set("selectedColor",Ext.applyIf({a:e/100},this.data.selectedColor))}}},changeHSV:function(e){Ext.applyIf(e,this.data.selectedColor);var t=Ext.ux.colorpick.ColorUtils.hsv2rgb(e.h,e.s,e.v);e.r=t.r,e.g=t.g,e.b=t.b,this.set("selectedColor",e)},changeRGB:function(e){Ext.applyIf(e,this.data.selectedColor);var t=Ext.ux.colorpick.ColorUtils.rgb2hsv(e.r,e.g,e.b);e.h=t.h,e.s=t.s,e.v=t.v,this.set("selectedColor",e)}}),Ext.define("Ext.ux.colorpick.SelectorController",{extend:"Ext.app.ViewController",alias:"controller.colorpick-selectorcontroller",requires:["Ext.ux.colorpick.ColorUtils"],initViewModel:function(){var t=this.getView();t.childViewModel.bind("{selectedColor}",function(e){t.setColor(e)})},destroy:function(){var e=this.getView(),t=e.childViewModel;t&&(t.destroy(),e.childViewModel=null),this.callParent()},changeHSV:function(e){var t=this.getView(),r=t.getColor();Ext.applyIf(e,r),r=Ext.ux.colorpick.ColorUtils.hsv2rgb(e.h,e.s,e.v),Ext.apply(e,r),t.setColor(e)},onColorMapHandleDrag:function(e,t){this.changeHSV({s:e,v:1-t})},onValueSliderHandleDrag:function(e){this.changeHSV({v:1-e})},onSaturationSliderHandleDrag:function(e){this.changeHSV({s:1-e})},onHueSliderHandleDrag:function(e){this.changeHSV({h:1-e})},onAlphaSliderHandleDrag:function(e){var t=this.getView(),r=t.getColor(),r=Ext.applyIf({a:1-e},r);t.setColor(r),t.el.repaint()},onPreviousColorSelected:function(e,t){this.getView().setColor(t)},onOK:function(){var e=this.getView();e.fireEvent("ok",e,e.getValue())},onCancel:function(){this.fireViewEvent("cancel",this.getView())},onResize:function(){var e,t,r,o,i=this.getView().childViewModel,n=this.getReferences();this.hasResizedOnce?(e=i.get("hue"),t=i.get("saturation"),r=i.get("value"),o=i.get("alpha"),console.log("h="+e),n.colorMap.setPosition(i.getData()),n.hueSlider.setHue(e),n.satSlider.setSaturation(t),n.valueSlider.setValue(r),n.alphaSlider.setAlpha(o)):this.hasResizedOnce=!0}}),Ext.define("Ext.ux.colorpick.Selector",{extend:"Ext.container.Container",xtype:"colorselector",mixins:["Ext.ux.colorpick.Selection"],controller:"colorpick-selectorcontroller",requires:["Ext.layout.container.HBox","Ext.form.field.Text","Ext.form.field.Number","Ext.ux.colorpick.ColorMap","Ext.ux.colorpick.SelectorModel","Ext.ux.colorpick.SelectorController","Ext.ux.colorpick.ColorPreview","Ext.ux.colorpick.Slider","Ext.ux.colorpick.SliderAlpha","Ext.ux.colorpick.SliderSaturation","Ext.ux.colorpick.SliderValue","Ext.ux.colorpick.SliderHue"],width:580,height:337,cls:Ext.baseCSSPrefix+"colorpicker",padding:10,layout:{type:"hbox",align:"stretch"},defaultBindProperty:"value",twoWayBindable:["value"],fieldWidth:50,fieldPad:5,showPreviousColor:!1,showOkCancelButtons:!1,listeners:{resize:"onResize"},constructor:function(e){var t=this,r=Ext.Factory.viewModel("colorpick-selectormodel");t.childViewModel=r,t.items=[t.getMapAndHexRGBFields(r),t.getSliderAndHField(r),t.getSliderAndSField(r),t.getSliderAndVField(r),t.getSliderAndAField(r),t.getPreviewAndButtons(r,e)],t.callParent(arguments)},updateColor:function(e){this.mixins.colorselection.updateColor.call(this,e),this.childViewModel.set("selectedColor",e)},updatePreviousColor:function(e){this.childViewModel.set("previousColor",e)},getMapAndHexRGBFields:function(e){var t={top:0,right:this.fieldPad,bottom:0,left:0},r=this.fieldWidth;return{xtype:"container",viewModel:e,cls:Ext.baseCSSPrefix+"colorpicker-escape-overflow",flex:1,layout:{type:"vbox",align:"stretch"},margin:"0 10 0 0",items:[{xtype:"colorpickercolormap",reference:"colorMap",flex:1,bind:{position:{bindTo:"{selectedColor}",deep:!0},hue:"{selectedColor.h}"},listeners:{handledrag:"onColorMapHandleDrag"}},{xtype:"container",layout:"hbox",defaults:{labelAlign:"top",labelSeparator:"",allowBlank:!1,onChange:function(){this.isValid()&&Ext.form.field.Base.prototype.onChange.apply(this,arguments)}},items:[{xtype:"textfield",fieldLabel:"HEX",flex:1,bind:"{hex}",margin:t,readOnly:!0},{xtype:"numberfield",fieldLabel:"R",bind:"{red}",width:r,hideTrigger:!0,maxValue:255,minValue:0,margin:t},{xtype:"numberfield",fieldLabel:"G",bind:"{green}",width:r,hideTrigger:!0,maxValue:255,minValue:0,margin:t},{xtype:"numberfield",fieldLabel:"B",bind:"{blue}",width:r,hideTrigger:!0,maxValue:255,minValue:0,margin:0}]}]}},getSliderAndHField:function(e){return{xtype:"container",viewModel:e,cls:Ext.baseCSSPrefix+"colorpicker-escape-overflow",width:this.fieldWidth,layout:{type:"vbox",align:"stretch"},items:[{xtype:"colorpickersliderhue",reference:"hueSlider",flex:1,bind:{hue:"{selectedColor.h}"},listeners:{handledrag:"onHueSliderHandleDrag"}},{xtype:"numberfield",fieldLabel:"H",labelAlign:"top",width:this.fieldWidth,labelSeparator:"",bind:"{hue}",hideTrigger:!0,maxValue:360,minValue:0,allowBlank:!1,margin:0}]}},getSliderAndSField:function(e){return{xtype:"container",viewModel:e,cls:Ext.baseCSSPrefix+"colorpicker-escape-overflow",width:this.fieldWidth,layout:{type:"vbox",align:"stretch"},margin:{right:this.fieldPad,left:this.fieldPad},items:[{xtype:"colorpickerslidersaturation",reference:"satSlider",flex:1,bind:{saturation:"{saturation}",hue:"{selectedColor.h}"},listeners:{handledrag:"onSaturationSliderHandleDrag"}},{xtype:"numberfield",fieldLabel:"S",labelAlign:"top",labelSeparator:"",bind:"{saturation}",hideTrigger:!0,maxValue:100,minValue:0,allowBlank:!1,margin:0}]}},getSliderAndVField:function(e){return{xtype:"container",viewModel:e,cls:Ext.baseCSSPrefix+"colorpicker-escape-overflow",width:this.fieldWidth,layout:{type:"vbox",align:"stretch"},items:[{xtype:"colorpickerslidervalue",reference:"valueSlider",flex:1,bind:{value:"{value}",hue:"{selectedColor.h}"},listeners:{handledrag:"onValueSliderHandleDrag"}},{xtype:"numberfield",fieldLabel:"V",labelAlign:"top",labelSeparator:"",bind:"{value}",hideTrigger:!0,maxValue:100,minValue:0,allowBlank:!1,margin:0}]}},getSliderAndAField:function(e){return{xtype:"container",viewModel:e,cls:Ext.baseCSSPrefix+"colorpicker-escape-overflow",width:this.fieldWidth,layout:{type:"vbox",align:"stretch"},margin:{left:this.fieldPad},items:[{xtype:"colorpickerslideralpha",reference:"alphaSlider",flex:1,bind:{alpha:"{alpha}",color:{bindTo:"{selectedColor}",deep:!0}},listeners:{handledrag:"onAlphaSliderHandleDrag"}},{xtype:"numberfield",fieldLabel:"A",labelAlign:"top",labelSeparator:"",bind:"{alpha}",hideTrigger:!0,maxValue:100,minValue:0,allowBlank:!1,margin:0}]}},getPreviewAndButtons:function(e,t){var r=[{xtype:"colorpickercolorpreview",flex:1,bind:{color:{bindTo:"{selectedColor}",deep:!0}}}];return t.showPreviousColor&&r.push({xtype:"colorpickercolorpreview",flex:1,bind:{color:{bindTo:"{previousColor}",deep:!0}},listeners:{click:"onPreviousColorSelected"}}),t.showOkCancelButtons&&r.push({xtype:"button",text:"确定",margin:"10 0 0 0",handler:"onOK"},{xtype:"button",text:"取消",margin:"10 0 0 0",handler:"onCancel"}),{xtype:"container",viewModel:e,width:70,margin:"0 0 0 10",items:r,layout:{type:"vbox",align:"stretch"}}}}),Ext.define("Ext.ux.colorpick.ButtonController",{extend:"Ext.app.ViewController",alias:"controller.colorpick-buttoncontroller",requires:["Ext.window.Window","Ext.layout.container.Fit","Ext.ux.colorpick.Selector","Ext.ux.colorpick.ColorUtils"],afterRender:function(e){e.updateColor(e.getColor())},destroy:function(){var e=this.getView(),t=e.colorPickerWindow;t&&(t.destroy(),e.colorPickerWindow=e.colorPicker=null),this.callParent()},getPopup:function(){var e,t=this.getView(),r=t.colorPickerWindow;return r||(r=Ext.create(t.getPopup()),(t.colorPickerWindow=r).colorPicker=t.colorPicker=e=r.lookupReference("selector"),e.setFormat(t.getFormat()),e.on({ok:"onColorPickerOK",cancel:"onColorPickerCancel",scope:this}),r.on({close:"onColorPickerCancel",scope:this})),r},onClick:function(){var e=this.getView(),t=e.getColor(),r=this.getPopup(),o=r.colorPicker;o.setColor(t),o.setPreviousColor(t),r.showBy(e,"tl-br?")},onColorPickerOK:function(e){var t=this.getView(),e=e.getColor();t.colorPickerWindow.hide(),t.setColor(e)},onColorPickerCancel:function(){this.getView().colorPickerWindow.hide()},syncColor:function(e){var t=this.getView();Ext.ux.colorpick.ColorUtils.setBackground(t.filterEl,e)}}),Ext.define("Ext.ux.colorpick.Button",{extend:"Ext.Component",xtype:"colorbutton",controller:"colorpick-buttoncontroller",mixins:["Ext.ux.colorpick.Selection"],requires:["Ext.ux.colorpick.ButtonController"],baseCls:Ext.baseCSSPrefix+"colorpicker-button",width:20,height:20,childEls:["btnEl","filterEl"],config:{popup:{lazy:!0,$value:{xtype:"window",closeAction:"hide",referenceHolder:!0,minWidth:540,minHeight:200,layout:"fit",header:!1,resizable:!0,items:{xtype:"colorselector",reference:"selector",showPreviousColor:!0,showOkCancelButtons:!0}}}},defaultBindProperty:"value",twoWayBindable:"value",renderTpl:'<div id="{id}-filterEl" data-ref="filterEl" style="height:100%; width:100%; position: absolute;"></div><a id="{id}-btnEl" data-ref="btnEl" style="height:100%; width:100%; position: absolute;"></a>',listeners:{click:"onClick",element:"btnEl"},updateColor:function(e){var t=this.colorPicker;this.mixins.colorselection.updateColor.call(this,e),Ext.ux.colorpick.ColorUtils.setBackground(this.filterEl,e),t&&t.setColor(e)},updateFormat:function(e){var t=this.colorPicker;t&&t.setFormat(e)}}),Ext.define("Ext.ux.colorpick.Field",{extend:"Ext.form.field.Picker",xtype:"colorfield",mixins:["Ext.ux.colorpick.Selection"],requires:["Ext.window.Window","Ext.ux.colorpick.Selector","Ext.ux.colorpick.ColorUtils","Ext.layout.container.Fit"],editable:!1,matchFieldWidth:!1,beforeBodyEl:['<div class="'+Ext.baseCSSPrefix+'colorpicker-field-swatch"><div id="{id}-swatchEl" data-ref="swatchEl" class="'+Ext.baseCSSPrefix+'colorpicker-field-swatch-inner"></div></div>'],cls:Ext.baseCSSPrefix+"colorpicker-field",childEls:["swatchEl"],config:{popup:{lazy:!0,$value:{xtype:"window",closeAction:"hide",referenceHolder:!0,minWidth:600,minHeight:200,width:540,height:200,layout:"fit",header:!1,resizable:!0,items:{xtype:"colorselector",reference:"selector",showPreviousColor:!0,showOkCancelButtons:!0}}}},afterRender:function(){this.callParent(),this.updateValue(this.value)},createPicker:function(){var e,t=this,r=t.getPopup();return t.colorPickerWindow=r=Ext.create(r),t.colorPicker=e=r.lookupReference("selector"),e.setFormat(t.getFormat()),e.setColor(t.getColor()),e.on({ok:"onColorPickerOK",cancel:"onColorPickerCancel",scope:t}),r.on({close:"onColorPickerCancel",scope:t}),t.colorPickerWindow},onColorPickerOK:function(e){this.setColor(e.getColor()),this.collapse()},onColorPickerCancel:function(){this.collapse()},onExpand:function(){var e=this.getColor();this.colorPicker.setPreviousColor(e)},setValue:function(e){e=this.applyValue(e);this.callParent([e]),this.updateValue(e)},updateFormat:function(e){var t=this.colorPicker;t&&t.setFormat(e)},updateValue:function(e){var t=this;t.syncing||(t.syncing=!0,t.setColor(e),t.syncing=!1),e=t.getColor(),Ext.ux.colorpick.ColorUtils.setBackground(t.swatchEl,e),t.colorPicker&&t.colorPicker.setColor(e)}});