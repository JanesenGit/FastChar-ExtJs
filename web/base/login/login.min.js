function showLogin(e){var t=$("title").text();let l=getExt("login-background").href;var i=toColor(getExt("theme-color").value),o=getExt("login-logo").value;let a="normal"===getExt("login-type").value;var n=getExt("copyright").value;let r=getExt("copyright").href,d=getExt("indexUrl").value;var g=getExt("version").desc,s=(new Date).getFullYear();-1===l.indexOf("?")&&(l+="?1=1"),-1===l.indexOf("bg=")&&(l=l+"&bg="+i),-1===l.indexOf("dot=")&&(l=l+"&dot="+i);let c=Ext.create("Ext.panel.Panel",{layout:"fit",border:0,html:"<iframe name='loginFrame'  src='"+l+"' width='100%' height='100%' style='border: 0px; overflow-x: hidden;background-color: "+i+"'/>"}),x="<div align='center' class='headPanel' style='color:"+i+";'><img class='loginLogo'  width='50px' height='50px;' src='"+o+"' /><h2>"+t+"</h2></div>";o&&0!==o.length||(x="<div align='center' class='headPanel' style='color:"+i+";'><h2>"+t+"</h2></div>");var h=Ext.create("Ext.panel.Panel",{region:"north",layout:"fit",bodyCls:"bgNull",width:"100%",bodyStyle:{},border:0,height:"auto",html:x}),o=$.cookie("loginName"),i=$.cookie("loginPassword");let m=$.cookie("loginMember");m=m||0;t=3*getNumberValue(fontSize)+8;let f=Ext.create("Ext.form.FormPanel",{url:server.loginUrl(),method:"POST",fileUpload:!0,bodyCls:"bgNull",border:0,width:"100%",layout:"anchor",region:"center",bodyStyle:{},padding:"10 10 10 10",items:[{xtype:"fieldset",title:"",layout:"anchor",padding:"10 10 0 10",items:[{xtype:"textfield",fieldLabel:"登录名",labelAlign:"right",labelWidth:t,margin:"10 10 0 0",name:"loginName",allowBlank:!1,blankText:"请输入登录名",emptyText:"请输入登录名",value:o,anchor:"100%"},{xtype:"textfield",fieldLabel:"密码",labelAlign:"right",labelWidth:t,inputType:"password",margin:"10 10 0 0",allowBlank:!1,blankText:"请输入登录密码",emptyText:"请输入登录密码",value:i,submitValue:!1,name:"loginPassword",anchor:"100%"},{xtype:"fieldcontainer",labelWidth:0,anchor:"100%",layout:{type:"hbox",align:"stretch"},hidden:a,items:[{xtype:"textfield",fieldLabel:"验证码",labelAlign:"right",labelWidth:t,margin:"10 10 0 0",allowBlank:a,flex:1,name:"validateCode",emptyText:"请输入验证码",blankText:"请输入验证码"},{xtype:"image",margin:"10 10 0 0",width:70,cls:"validCodeImg",id:"imgCode",height:32}]},{name:"loginMember",fieldLabel:"记住",xtype:"combo",labelAlign:"right",labelWidth:t,margin:"10 10 0 0",displayField:"text",valueField:"id",editable:!1,anchor:"100%",value:m,submitValue:!1,allowBlank:!1,store:Ext.create("Ext.data.Store",{data:[{id:"0",text:"用户名"},{id:"1",text:"用户名和密码"}]})},{xtype:"fieldcontainer",labelWidth:0,anchor:"100%",layout:{type:"hbox",align:"stretch"},items:[{xtype:"button",text:"重置",iconCls:"extIcon extReset",flex:1,tipText:"重置数据",margin:"10 5 10 10",handler:function(){f.form.reset()}},{xtype:"button",text:"登录",id:"btnLogin",tipText:"登录系统",margin:"10 10 10 5",iconCls:"extIcon extOk",flex:1,handler:function(){b()}}]}]}],listeners:{render:function(e){try{new Ext.util.KeyMap({target:e.getEl(),key:13,fn:b,scope:Ext.getBody()})}catch(e){console.error(e)}}}}),u=function(){try{f.form.findField("validateCode").reset(),Ext.getCmp("imgCode").setSrc("showCaptcha?t="+Math.random())}catch(e){}},b=function(){let t=f.form;if(t.isValid()){let e=window.onBeforeLogin;e?e(t.getValues(),function(){y()}):y()}},y=function(){let t=f.form;if(t.isValid()){var l=f.form.findField("loginPassword").getValue(),i=f.form.findField("loginName").getValue(),o=f.form.findField("loginMember").getValue();let e=new Date;e.setTime(e.getTime()+2592e6),$.cookie("loginName",i,{expires:e}),$.cookie("loginMember",o,{expires:e}),1===parseInt(o)?$.cookie("loginPassword",l,{expires:e}):$.removeCookie("loginPassword"),t.submit({params:{loginPassword:$.md5(l)},waitMsg:"正在为您登录……",success:function(e,t){addScript({src:d+"?v="+getExt("version").value})},failure:function(e,t){u(),-2===t.result.code&&f.form.findField("loginPassword").reset(),Ext.Msg.alert("登录失败",t.result.message,function(){-3===t.result.code&&f.form.findField("validateCode").focus()})}})}},p="_blank";r.startWith("javascript:")&&(p="_self");g=Ext.create("Ext.panel.Panel",{region:"south",layout:"fit",width:"100%",height:50,bodyCls:"bgNull",border:0,html:"<div align='center'><a href='"+r+"' target='"+p+"' style='font-size: xx-small;color:#aaa;text-decoration:none;'>"+n+"</a></div><div align='center' style='font-size: xx-small;color:#aaa;margin-top: 5px;'>Copyright © "+s+" "+g+"</div>"});let v=Ext.create("Ext.window.Window",{title:"管理员登录",iconCls:"extIcon extLogin",width:420,resizable:!1,layout:"vbox",bodyCls:"bgImage",closable:!1,toFrontOnShow:!0,constrain:!0,items:[h,f,g]});v.show(null,function(){Ext.getCmp("btnLogin").focus();try{a||(u(),Ext.get("imgCode").on({click:function(){u()}}))}catch(e){}}),c.add(v),e.add(c)}Ext.onReady(function(){if(removeLoading(),checkBrowserVersion()){let e=getBodyContainer();e.removeAll(),showLogin(e)}});