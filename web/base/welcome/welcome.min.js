function getWelcomePanel(){let e=[systemOperate(),systemWaitNotice()];system.isSuperRole()&&e.push(systemBugReport());var t=Ext.create("Ext.panel.Panel",{layout:{type:"accordion"},region:"center",border:0,flex:.6,items:e});let o=[];system.isSuperRole()&&(o.push(systemVersion()),o.push(systemConfig()),o.push(systemMonitor()));var a=Ext.create("Ext.panel.Panel",{layout:"accordion",region:"east",border:0,flex:.4,collapsed:!1,split:!0,subtitle:"系统右侧面板",items:o});let i=[t];return 0<o.length&&i.push(a),window.initWelcomeItems&&window.initWelcomeItems(i),isPower()||checkSystemWait(!0),Ext.create("Ext.panel.Panel",{layout:"border",region:"center",border:0,items:i})}function systemOperate(){let a=Ext.create("Ext.data.Store",{autoLoad:!1,fields:[],id:"SystemLogStore",idProperty:"operateId",pageSize:50,proxy:{type:"ajax",url:"entity/list",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},reader:{type:"json",root:"list",totalProperty:"totalRow"}}}),e=Ext.create("Ext.toolbar.Paging",{store:a,dock:"bottom",border:0,overflowHandler:"scroller",displayInfo:!0}),i=Ext.create("Ext.grid.Panel",{region:"center",border:0,power:!0,multiColumnSort:!0,iconCls:"extIcon extLog",columnLines:!0,title:"系统操作日志",hideHeaders:!0,store:a,columns:[{header:"操作类型",dataIndex:"systemLogType",align:"center",width:120},{header:"操作介绍",dataIndex:"systemLogContent",align:"center",flex:1},{header:"操作时间",dataIndex:"systemLogDateTime",width:160,align:"center"},{header:"操作",dataIndex:"systemLogId",width:100,align:"center",renderer:function(e){return'<a href="javascript:showSystemLogDetails('+e+');">查看详情</a>'}}],dockedItems:[e],viewConfig:{enableTextSelection:!0,loadMask:{msg:"正在为您在加载数据…"}}});return e.insert(e.items.getCount()-2,{xtype:"button",iconCls:"extIcon extSearch",tooltip:"搜索日志",handler:function(){i.add(searchSysOperate(i,this))}}),e.insert(e.items.getCount()-3,"-"),a.on("beforeload",function(e,t){let o={};null!=i.searchForm&&(o=i.searchForm.getValues()),Ext.apply(e.proxy.extraParams,o),Ext.apply(e.proxy.extraParams,{entityCode:"ExtSystemLogEntity",limit:a.pageSize})}),a.loadPage(1),i}function showSystemLogDetails(e){let t=Ext.getStore("SystemLogStore"),o=t.findRecord("systemLogId",e,0,!1,!1,!0);e=createDetailsGrid(function(e){let t=[];var o,a={a__managerName:"管理员",systemLogType:"操作类型",systemLogContent:"操作详情",systemLogIp:"来自IP",systemLogClient:"浏览器信息",systemSendData:"提交的数据",systemResultData:"返回的数据",systemLogDateTime:"操作时间"};for(o in a)t.push({name:a[o],key:o,value:e[o]});return t}(o.getData()),{region:"center",power:!1,hideHeaders:!0},{width:100,flex:0},{align:"left",renderer:function(e,t,o){return t.style="overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space:normal !important;line-height:20px;word-break:break-word; ","systemLogIp"===o.get("key")?"<a href='https://www.baidu.com/s?wd="+e+"' target='_blank'>"+e+"</a>":e},listeners:{dblclick:function(e,t,o,a,i,n,r){let l=e.getStore().getAt(o);o=l.get("key");"systemSendData"!==o&&"systemResultData"!==o||showFormatJson(t,l.get("value"))}}});let a=Ext.create("Ext.window.Window",{title:"日志详情",height:500,iconCls:"extIcon extDetails",width:500,layout:"border",resizable:!0,maximizable:!0,items:[e],modal:!0,constrain:!0});a.show()}function searchSysOperate(t,o){if(!t.searchForm){t.searchForm=Ext.create("Ext.form.FormPanel",{bodyPadding:5,region:"center",autoScroll:!0,layout:"column",defaults:{labelWidth:100,margin:"5 5 5 5",labelAlign:"right",emptyText:"可输入…"},listeners:{render:function(e,t){try{new Ext.util.KeyMap({target:e.getEl(),key:13,fn:function(){dataGrid.getStore().loadPage(1)},scope:this})}catch(e){console.error(e)}}},items:[{fieldLabel:"关键字",columnWidth:1,name:"where['^search']",xtype:"textfield"},{fieldLabel:"开始时间",columnWidth:.5,name:"where['systemLogDateTime>=']",xtype:"datefield",format:"Y-m-d"},{fieldLabel:"结束时间",columnWidth:.5,name:"where['systemLogDateTime<=']",xtype:"datefield",format:"Y-m-d"},{fieldLabel:"操作用户",columnWidth:.5,name:"where['a__managerName%?%']",xtype:"textfield"},{fieldLabel:"操作类型",columnWidth:.5,name:"where['systemLogType%?%']",xtype:"textfield"}]});let e=o.text;Ext.isEmpty(e)&&(e="搜索系统日志"),t.searchWin=Ext.create("Ext.window.Window",{title:e,closeAction:"hide",width:500,minWidth:500,minHeight:110,height:230,layout:"border",constrain:!0,iconCls:"extIcon extSearch",resizable:!0,collapsible:!0,animateTarget:o,items:[t.searchForm],buttons:[{text:"重置",iconCls:"extIcon extReset",handler:function(){t.searchForm.reset(),t.getStore().loadPage(1)}},{text:"搜索",iconCls:"extIcon extSearch",handler:function(){t.getStore().loadPage(1)}}]})}return t.searchWin.show(),t.searchWin}function systemLive(){let t=Ext.create("Ext.data.Store",{autoLoad:!1,fields:[],proxy:{type:"ajax",url:"live",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},reader:{type:"json",root:"data"}}});var e=Ext.create("Ext.grid.Panel",{border:0,columnWidth:1,power:!0,multiColumnSort:!0,columnLines:!0,hideHeaders:!0,store:t,columns:[{header:"路由名称",dataIndex:"routeName",align:"center",width:100},{header:"路由类名",dataIndex:"routeClass",align:"center",flex:1},{header:"进入时间",dataIndex:"routeInTime",width:200,align:"center"}],viewConfig:{enableTextSelection:!0,loadMask:{msg:"正在为您在加载数据…"}}});return t.loadPage(1),Ext.create("Ext.panel.Panel",{layout:"column",region:"center",power:!1,border:0,bodyPadding:5,title:"系统进行中的路由",iconCls:"extIcon extLog",closable:!1,autoScroll:!0,items:[e,{xtype:"button",text:"刷新信息",columnWidth:1,margin:"5 5 5 5",handler:function(e){t.loadPage(1)}}]})}function systemVersion(){var e=[{name:"项目名称",value:system.title.value},{name:"项目版本",value:system.version.desc},{name:"项目位置",value:system.root.value},{name:"操作文档",value:"<a href='"+system["doc-extjs"].href+"' target='_blank' >"+system["doc-extjs"].value+"</a>"},{name:"本机IP地址",value:system.host.value},{name:"系统环境",value:system.os.value},{name:"数据库",value:system.db.value},{name:"运行服务器",value:system.server.value},{name:"服务器位置",value:system.catalina.value},{name:"核心框架",value:"<a href='http://www.fastchar.com' target='_blank' >"+system.fastchar.value+"</a>"},{name:"开发语言",value:system.java.value+"+ExtJs6.2.0+HTML5+CSS3"},{name:"开发服务商",value:"<a href='"+system.developer.href+"' target='_blank'>"+system.developer.value+"</a>"},{name:"版权归属",value:"<a href='"+getExt("copyright").href+"' target='_blank'>"+getExt("copyright").value+"</a>"}];return createDetailsGrid(e,{title:"系统基本信息",iconCls:"extIcon extVersion",power:!1,hideHeaders:!0},{},{align:"center"})}function systemConfig(){let o=Ext.create("Ext.form.FormPanel",{url:"ext/config/saveSystemConfig",bodyPadding:5,method:"POST",region:"center",power:!1,border:0,title:"系统全局设置",iconCls:"extIcon extSet",autoScroll:!0,defaults:{labelWidth:100,margin:"5 5 5 5",labelAlign:"right",emptyText:"请填写"},viewModel:{data:null},layout:"column",items:[{xtype:"fieldset",title:"基本设置",columnWidth:1,defaults:{anchor:"100%"},items:[{name:"theme-color",xtype:"colorfield",fieldLabel:"系统主题颜色",columnWidth:1,bind:"{theme-color}"},{name:"front-color",xtype:"colorfield",fieldLabel:"系统前景颜色",columnWidth:1,bind:"{front-color}"},{name:"theme",fieldLabel:"系统主题风格",columnWidth:1,xtype:"combo",displayField:"text",valueField:"id",editable:!1,value:1,bind:"{theme}",store:getThemeDataStore()},{name:"window-anim",fieldLabel:"系统窗体动画",columnWidth:1,xtype:"combo",displayField:"text",valueField:"id",editable:!1,value:1,bind:"{window-anim}",store:getYesOrNoDataStore()},{name:"tab-record",fieldLabel:"标签记忆功能",columnWidth:1,xtype:"combo",displayField:"text",valueField:"id",editable:!1,value:1,bind:"{tab-record}",store:getYesOrNoDataStore()},{name:"font-size",fieldLabel:"系统字体大小",columnWidth:1,xtype:"combo",displayField:"text",valueField:"id",editable:!1,value:1,bind:"{font-size}",store:getFontSizeDataStore()}]},{xtype:"button",text:"恢复默认",margin:"5 0 0 5",columnWidth:.5,handler:function(){Ext.Msg.confirm("系统提醒","您确定恢复系统默认的配置吗？",function(e,t){"yes"===e&&(showWait("请稍后……"),o.getForm().reset(),server.deleteSystemConfig(function(e,t){hideWait(),e?location.reload():showAlert("系统提醒",t)}))})}},{xtype:"button",text:"保存配置",columnWidth:.5,margin:"5 5 0 5",handler:function(){o.doSubmit()}}],doSubmit:function(){let e=o.form;e.isValid()&&e.submit({waitMsg:"正在保存配置中……",success:function(e,t){Ext.Msg.alert("系统设置","设置保存成功！",function(e){"ok"===e&&location.reload()}),win.close()},failure:function(e,t){Ext.Msg.alert("保存失败",t.result.message)}})}});return server.showSystemConfig(function(e,t){e&&o.getViewModel().setData(t)}),o}function systemMonitor(){var e=Ext.create("Ext.panel.Panel",{layout:"column",region:"north",power:!1,border:0,bodyPadding:5,title:"系统监控信息",iconCls:"extIcon extMonitor",closable:!1,autoScroll:!0});let o=function(c){server.loadMonitor(function(e,t){c.removeAll();var a=t.desc,i=t.data;let n=0;for(let o=0;o<a.length;o++){var r,l,s=a[o];let e=[];for(r in s)"title"!==r&&(l={xtype:"textfield",fieldLabel:s[r],bind:"{"+r+"}"},e.push(l));var d=i[o];let t=s.title;d.alert&&(n++,t="<b style='color: #c21904;'>"+t+"【预警】</b>");d={xtype:"fieldset",title:t,columnWidth:1,collapsible:!0,viewModel:{data:d},defaults:{anchor:"100%",labelAlign:"right",labelWidth:80,columnWidth:1,disabled:!0,disabledCls:".x-item-disabled-normal"},items:e};c.add(d)}c.add({xtype:"button",text:"刷新信息",columnWidth:1,margin:"5 5 5 5",handler:function(e){e.setText("正在刷新"),e.setDisabled(!0),o(c)}}),0<n&&c.setTitle("<b style='color: #c21904;' >系统监控信息（"+n+"个预警）</b>")})};return o(e),e}function systemBugReport(){let e=new ExtBugReportEntity;e.menu={text:"系统问题上报"};let a=Ext.create("Ext.data.Store",{autoLoad:!1,fields:[],id:"SystemBugReportStore",pageSize:50,entity:e,proxy:{type:"ajax",url:"entity/list",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},reader:{type:"json",root:"list",totalProperty:"totalRow"}}}),t=Ext.create("Ext.toolbar.Paging",{store:a,dock:"bottom",border:0,overflowHandler:"scroller",displayInfo:!0}),n=Ext.create("Ext.grid.Panel",{region:"center",border:0,power:!0,multiColumnSort:!0,iconCls:"extIcon extBug",columnLines:!0,title:"系统问题上报",hideHeaders:!0,store:a,refreshCount:function(){let o=this;server.countReport(function(e,t){0<t?o.setTitle("系统问题上报 <span style='color: red;font-size: small;'>待处理（"+t+"）</span>"):o.setTitle("系统问题上报")})},columns:[{header:"功能类型",dataIndex:"funcTypeStr",align:"center",width:100},{header:"问题反馈",dataIndex:"bugContent",align:"center",flex:1,renderer:renders.text()},{header:"反馈状态",dataIndex:"reportStateStr",width:65,align:"center"},{header:"上报时间",dataIndex:"reportDateTime",width:120,align:"center"},{header:"操作",dataIndex:"reportId",width:100,align:"center",renderer:function(e){return'<a href="javascript:showBugReportDetails('+e+');">查看详情</a>'}}],dockedItems:[t],viewConfig:{enableTextSelection:!0,loadMask:{msg:"正在为您在加载数据…"}}});return t.insert(t.items.getCount()-2,"-"),t.insert(t.items.getCount()-2,{xtype:"button",iconCls:"extIcon extSearch",tooltip:"搜索问题",handler:function(){n.add(searchBugReport(n,this))}}),t.insert(t.items.getCount()-2,"-"),t.insert(t.items.getCount()-2,{xtype:"button",iconCls:"extIcon extAdd grayColor",tooltip:"添加问题",handler:function(){e.showAdd(this).then(function(){a.loadPage(1)})}}),a.on("beforeload",function(e,t){let o={};null!=n.searchForm&&(o=n.searchForm.getValues()),Ext.apply(e.proxy.extraParams,o),Ext.apply(e.proxy.extraParams,{entityCode:"ExtBugReportEntity",limit:a.pageSize})}),a.on("load",function(e,t,o,a,i){n.refreshCount()}),a.loadPage(1),n}function showBugReportDetails(e){let o=Ext.getStore("SystemBugReportStore"),a=o.findRecord("reportId",e,0,!1,!1,!0),t=function(e){let t=[];var o,a={a__managerName:"上报用户",funcTypeStr:"功能类型",funcName:"功能名称",bugContent:"问题描述",bugFlow:"操作步骤",bugImagesHtml:"问题截图",fixInfo:"修改意见",reportStateStr:"上报状态",reportDateTime:"上报时间"};for(o in a)t.push({name:a[o],value:e[o]});return t},i=createDetailsGrid(t(a.getData()),{region:"center",power:!1,hideHeaders:!0},{width:100,flex:0},{align:"left"}),n=Ext.create("Ext.window.Window",{title:"问题详情",height:500,iconCls:"extIcon extDetails",width:500,layout:"border",resizable:!0,maximizable:!0,items:[i],modal:!0,constrain:!0,buttons:["->",{text:"删除问题",iconCls:"extIcon extDelete whiteColor",handler:function(){Ext.Msg.show({title:"系统提醒",icon:Ext.Msg.QUESTION,message:"您确定这条问题吗？",buttons:Ext.Msg.YESNO,defaultFocus:"no",callback:function(e,t){"yes"===e&&commitStoreDelete(o,[a]).then(function(){n.close()})}})}},{text:"反馈修改意见",iconCls:"extIcon extEdit",handler:function(){editorText(this,"提交修改意见",function(e){a.set("fixInfo",e),a.set("reportState",1),a.set("reportStateStr","已处理"),commitStoreUpdate(o),i.updateData(t(a.getData()))})}}]});n.show()}function searchBugReport(t,o){if(!t.searchForm){t.searchForm=Ext.create("Ext.form.FormPanel",{bodyPadding:5,region:"center",autoScroll:!0,layout:"column",defaults:{labelWidth:100,margin:"5 5 5 5",labelAlign:"right",emptyText:"可输入…"},listeners:{render:function(e,t){try{new Ext.util.KeyMap({target:e.getEl(),key:13,fn:function(){dataGrid.getStore().loadPage(1)},scope:this})}catch(e){console.error(e)}}},items:[{name:"where['funcType']",xtype:"enumcombo",fieldLabel:"功能类型",columnWidth:.5,enumName:"ExtBugFuncTypeEnum"},{name:"where['reportState']",xtype:"enumcombo",fieldLabel:"上报状态",columnWidth:.5,enumName:"ExtBugReportStateEnum"},{fieldLabel:"开始时间",columnWidth:.5,name:"where['reportDateTime>=']",xtype:"datefield",format:"Y-m-d"},{fieldLabel:"结束时间",columnWidth:.5,name:"where['reportDateTime<=']",xtype:"datefield",format:"Y-m-d"},{fieldLabel:"操作用户",columnWidth:.5,name:"where['a__managerName%?%']",xtype:"textfield"},{fieldLabel:"关键字",columnWidth:.5,name:"where['systemLogContent%?%']",xtype:"textfield"}]});let e=o.text;Ext.isEmpty(e)&&(e="搜索问题上报"),t.searchWin=Ext.create("Ext.window.Window",{title:e,closeAction:"hide",width:550,minWidth:500,minHeight:110,height:250,layout:"border",constrain:!0,iconCls:"extIcon extSearch",resizable:!0,collapsible:!0,animateTarget:o,items:[t.searchForm],buttons:[{text:"重置",iconCls:"extIcon extReset",handler:function(){t.searchForm.reset(),t.getStore().loadPage(1)}},{text:"搜索",iconCls:"extIcon extSearch",handler:function(){t.getStore().loadPage(1)}}]})}return t.searchWin.show(),t.searchWin}function systemWaitNotice(){let e=new ExtSystemNoticeEntity;e.menu={text:"系统问题上报"};let a=Ext.create("Ext.data.Store",{autoLoad:!1,fields:[],id:"SystemWaitNoticeStore",entity:e,pageSize:50,proxy:{type:"ajax",url:"entity/list",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},reader:{type:"json",root:"list",totalProperty:"totalRow"}}});var t=Ext.create("Ext.toolbar.Paging",{store:a,dock:"bottom",border:0,overflowHandler:"scroller",displayInfo:!0});let i=Ext.create("Ext.grid.Panel",{region:"center",border:0,power:!0,multiColumnSort:!0,iconCls:"extIcon extTip",columnLines:!0,title:"系统待办事项",hideHeaders:!0,store:a,columns:[{header:"待办标题",dataIndex:"noticeTitle",align:"center",width:200},{header:"处理人",dataIndex:"a__managerName",align:"center",flex:1},{header:"待办内容",dataIndex:"noticeStateStr",align:"center",width:120},{header:"录入时间",dataIndex:"noticeDateTime",width:200,align:"center"}],plugins:[{ptype:"rowexpander",rowBodyTpl:new Ext.XTemplate("<p>【{noticeTitle}】{noticeContent}</p>","<p><tpl if='noticeState==0' ><a id='aNoticeAction{noticeId}' href='javascript:doneSystemWait({noticeId});'>标记为已读</a>&nbsp;&nbsp;&nbsp;&nbsp;</tpl><tpl if='noticeAction' ><a href=\"javascript:{noticeAction};\">立即前往</a></tpl></p>")}],dockedItems:[t],viewConfig:{enableTextSelection:!0,loadMask:{msg:"正在为您在加载数据…"}}});return a.on("beforeload",function(e,t){let o={};null!=i.searchForm&&(o=i.searchForm.getValues()),Ext.apply(e.proxy.extraParams,o),Ext.apply(e.proxy.extraParams,{entityCode:"ExtSystemNoticeEntity",limit:a.pageSize})}),a.loadPage(1),i}function doneSystemWait(o){showWait("正在标记中，请稍后……"),server.doneWaitNotice(o,function(e,t){if(hideWait(),e){if(toast(t),$("#aNoticeAction"+o).remove(),Ext.getCmp("bNoticeAction"+o)){Ext.getCmp("bNoticeAction"+o).destroy();let e=Ext.getCmp("NoticeAlertWindow");e&&0===$("[type='bNoticeAction']").length&&e.close()}}else showAlert("系统提醒",t)})}function checkSystemWait(l){window.clearTimeout(server.checkWaitNoticeTimer);let s={};if(!l){var t=$("[type='bNoticeAction']");for(let e=0;e<t.length;e++)s["noticeId_"+e]=$(t[e]).attr("data-id")}server.checkWaitNotice(s,function(e,i){try{if(e){let o=Ext.getCmp("NoticeAlertWindow");if(i.length<=0&&0===Object.keys(s).length)return void(o&&o.close());let t=[],a=!1;for(let e=0;e<i.length;e++){var n=i[e],r={xtype:"fieldset",margin:"10",id:"bNoticeAction"+n.noticeId,style:{background:"#ffffff"},columnWidth:1,viewModel:{data:n},defaults:{anchor:"100%",height:"auto",margin:"0",labelAlign:"right",labelWidth:0,columnWidth:1,disabled:!0,disabledCls:".x-item-disabled-normal"},items:[{xtype:"displayfield",bind:"{noticeContent}",renderer:function(e,t){t=t.ownerCt.viewModel.data;let o="<b style='display: block;font-size: 16px;margin-bottom: 10px;'>"+t.noticeTitle+"</b>";return o+="<div>"+e+"</div>",o+="<div style='margin-top: 10px;display: flex;' ><a type='bNoticeAction' data-id='"+t.noticeId+"' href='javascript:doneSystemWait("+t.noticeId+");'>标记为已读</a>",Ext.isEmpty(t.noticeAction)||(o+='&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:'+t.noticeAction+';">立即前往</a>'),o+="<span style='flex: 1;text-align: right;'>"+t.noticeDateTime+"</span></div>",o+="<div style='font-size: smaller;color: #a0a0a0;margin-top: 10px;'>注：如果已处理请标记为已读！</div>",o}}]};t.push(r),0===$("#bNoticeAction"+n.noticeId).length&&(a=!0)}if(!a&&!l)return;o||(o=Ext.create("Ext.window.Window",{title:"系统待办事项",id:"NoticeAlertWindow",width:400,height:400,layout:"column",closable:!1,constrain:!0,iconCls:"extIcon extTip",resizable:!1,scrollable:!0,tools:[{type:"refresh",callback:function(){Ext.getStore("SystemWaitNoticeStore").loadPage(1),checkSystemWait(!0)}},{type:"close",callback:function(){showWait("正在清除中，请稍后……"),server.clearWaitNotice(function(e,t){hideWait(),e?o.close():showAlert("系统提醒",t)})}}],collapsible:!0}),o.showAt(5*$(window).width(),5*$(window).width())),l?(o.removeAll(),o.add(t)):(o.insert(0,t),o.setScrollY(0,!0)),window.onSystemNoticeShow&&window.onSystemNoticeShow()}}finally{server.checkWaitNoticeTimer=setTimeout(function(){checkSystemWait()},3e3)}})}