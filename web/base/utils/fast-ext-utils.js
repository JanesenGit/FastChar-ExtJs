let globalConfig=function(){$.ajaxSetup({data:{fromOS:getOS()}}),Ext.Ajax.on("beforerequest",function(e,t,n){try{e.setExtraParams({fromOS:getOS()})}catch(e){}})};globalConfig();let MemoryCache={},progressLine;function toBool(e,t){if(Ext.isEmpty(t)&&(t=!1),Ext.isEmpty(e))return t;if(Ext.isString(e)){if("0"===e)return!1;if("1"===e)return!0}if(Ext.isNumber(e)){if(0===e)return!1;if(1===e)return!0}return Ext.isBoolean(e)?e:Boolean(e)}function toColor(e,t){if(Ext.isEmpty(t)&&(t="#FFFFFF"),Ext.isEmpty(e))return t;if(e.toString().startWith("#"))return e.toString();try{var n=Ext.ux.colorpick.ColorUtils.parseColor(e);return"#"+Ext.ux.colorpick.ColorUtils.formats.HEX8(n)}catch(e){}return"#"+e}function jsonToObject(e){try{return Ext.decode(e)}catch(e){}return null}function objectToJson(e){try{return Ext.encode(e)}catch(e){}return null}function copyToBoard(e){let t=document.createElement("input");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("Copy"),t.style.display="none",$(t).remove()}function copy(e){let t={};if(e instanceof Array)t=e.concat();else if(e instanceof Function)t=e;else for(var n in e)t[n]=e[n];return t}function isSystem(){try{if(system&&system.init)return!0}catch(e){}return!1}function checkBrowserVersion(){if(Ext.isIE&&Ext.ieVersion<11){let e=Ext.create("Ext.window.Window",{title:"系统提醒",width:250,height:100,layout:"fit",icon:"icons/icon_error.svg",resizable:!1,closable:!1,html:"<div style='background:#eeeeee; padding:10px;'>您当前的IE版本太低，至少在11.0以上的IE才能使用本系统！</div>",modal:!0});return e.show(),!1}return!0}function getBodyContainer(){let e=Ext.getCmp("bodyContainer");return e||(Ext.getDoc().on("contextmenu",function(e){e.stopEvent()}),Ext.tip.QuickTipManager.init(),Ext.QuickTips.init(),e=Ext.create("Ext.container.Viewport",{id:"bodyContainer",layout:"fit",border:0,renderTo:Ext.getBody()})),e}String.prototype.endWith=function(e){return!(!e||""===e||0===this.length||e.length>this.length)&&this.substring(this.length-e.length)===e},String.prototype.startWith=function(e){return!(!e||""===e||0===this.length||e.length>this.length)&&this.substr(0,e.length)===e},String.prototype.firstUpperCase=function(){return this.replace(/^\S/,function(e){return e.toUpperCase()})},String.prototype.truthLength=function(){return this.replace(/[\u0391-\uFFE5]/g,"aa").length},String.prototype.trimAllSymbol=function(){return this.replace(/[\ |\~|\`|\!|\@|\#|\$|\%|\^|\&|\*|\(|\)|\-|\_|\+|\=|\||\\|\[|\]|\{|\}|\;|\:|\"|\'|\,|\<|\.|\>|\/|\?/\，/\。/\；/\：/\“/\”/\》/\《/\|/\{/\}/\、/\!/\~/\`]/g,"")},String.prototype.replaceAll=function(e,t){return this.replace(new RegExp(e,"g"),t)},Array.prototype.exists=function(t){for(let e=0;e<this.length;e++)if(this[e]===t)return!0;return!1};let setCache=function(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(e){}},getCache=function(e){try{return JSON.parse(localStorage.getItem(e))}catch(e){}return null},removeCache=function(e){localStorage.removeItem(e)};function getProgressLine(e){return Ext.isEmpty(e)&&(e="#f8c633"),progressLine=progressLine||new ProgressBar.Line("#progress",{color:e,duration:1e3,easing:"easeInOut",from:{color:"#9c58b6"},to:{color:e},step:function(e,t,n){t.path.setAttribute("stroke",e.color)}}),progressLine}function shakeComment(a,t,s){s=s||1080;try{let e,i=0,o=function(){clearInterval(e),a.setX(r),a.setY(l),Ext.isFunction(t)&&t()},r=a.getX(),l=a.getY();e=setInterval(function(){try{var e=i/180*Math.PI,t=3*Math.sin(e),n=3*Math.cos(e);a.setX(r+t),a.setY(l+n),(i+=90)>s&&o()}catch(e){o()}},30)}catch(e){}}function mergeJson(e,t){let n={};if(!Ext.isEmpty(e))for(var i in e)n[i]=e[i];if(!Ext.isEmpty(t))for(var o in t)n[o]=t[o];return n}function buildForm(e,t){let n=$("<form></form>");for(var i in n.attr("action",e),n.attr("method","post"),t){let e=$("<input type='text' name='"+i+"' />");e.attr("value",t[i]),n.append(e)}return $(document.body).append(n),n}function loadFunction(functionStr){if(functionStr.toString().trim().startsWith("function")){let functionKey="do"+$.md5(functionStr);if(Ext.isEmpty(MemoryCache[functionKey])){let myScript=document.createElement("script");myScript.type="text/javascript";let code="let "+functionKey+"="+functionStr;try{myScript.appendChild(document.createTextNode(code))}catch(ex){myScript.text=code}document.body.appendChild(myScript),MemoryCache[functionKey]=!0}return eval(functionKey)}return null}function download(e){var t=e.split("?")[0].substring(e.lastIndexOf("/"));let n=document.createElement("a");var i=new MouseEvent("click");n.download="file"+t,n.href=e,n.dispatchEvent(i)}function openUrl(e,t){Ext.isEmpty(t)&&(t="_blank");let n=document.createElement("a");n.click?(n.setAttribute("href",e),n.setAttribute("target",t),n.style.display="none",document.body.appendChild(n),n.click()):window.location=e}function runCallBack(e,t){if(Ext.isFunction(e)&&!e.callBacked){let t=[];for(let e=1;e<arguments.length;e++)t[e-1]=arguments[e];e.apply(this,t),e.callBacked=!0}}function setRecordValue(e,t,n,i){var o;n.dataIndex=t,Ext.isFunction(n.setRecordValue)?n.setRecordValue(e,!1):(o=n.getValue(),Ext.isDate(n.getValue())?e.set(t,Ext.Date.format(o,n.format)):e.set(t,o)),toBool(n.autoUpdate,!1)&&commitStoreUpdate(e.store)}function buildOnlyCode(e){e+=Ext.now();return $.md5(e)}function getOS(){try{let e=navigator.userAgent;var t="Win32"===navigator.platform||"Windows"===navigator.platform,n="Mac68K"===navigator.platform||"MacPPC"===navigator.platform||"Macintosh"===navigator.platform||"MacIntel"===navigator.platform;if(n)return"Mac";if("X11"===navigator.platform&&!t&&!n)return"Unix";if(-1<String(navigator.platform).indexOf("Linux"))return"Linux";if(t)return-1<e.indexOf("Windows NT 5.0")||-1<e.indexOf("Windows 2000")?"Windows 2000":-1<e.indexOf("Windows NT 5.1")||-1<e.indexOf("Windows XP")?"Windows XP":-1<e.indexOf("Windows NT 5.2")||-1<e.indexOf("Windows 2003")?"Windows 2003":-1<e.indexOf("Windows NT 6.0")||-1<e.indexOf("Windows Vista")?"Windows Vista":-1<e.indexOf("Windows NT 6.1")||-1<e.indexOf("Windows 7")?"Windows 7":-1<e.indexOf("Windows NT 8.0")||-1<e.indexOf("Windows 8")?"Windows 8":-1<e.indexOf("Windows NT 10.0")||-1<e.indexOf("Windows 10")?"Windows 10":"Windows"}catch(e){}return"Other"}function getNumberValue(e){return parseFloat(e.replace(/[^0-9]/gi,""))}function prefixInteger(e,t){return(Array(t).join("0")+e).slice(-t)}function getSVGIcon(e){return'<svg class="svgIcon" aria-hidden="true"><use xlink:href="#'+e+'"></use></svg>'}function getSVGClassName(e){let t="extFile";return(e=e.toString().toLowerCase()).endWith(".doc")||e.endWith(".docx")||"application/msword"===e||"application/vnd.openxmlformats-officedocument.wordprocessingml.document"===e?t="extFileWord":e.endWith(".xls")||e.endWith(".xlsx")||"application/vnd.ms-excel"===e||"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===e?t="extFileExcel":e.endWith(".zip")||e.endWith(".rar")||"application/zip"===e||"application/rar"===e?t="extFileZIP":e.endWith(".apk")||"application/vnd.android.package-archive"===e?t="extFileAPK":e.endWith(".jpg")||e.endWith(".jpeg")||"image/jpeg"===e?t="extFileJPG":e.endWith(".png")||"image/png"===e?t="extFilePNG":e.endWith(".psd")||"image/vnd.adobe.photoshop"===e?t="extFilePSD":e.endWith(".html")||e.endWith(".shtml")||e.endWith(".htm")||"text/html"===e?t="extFileHTMl":!e.endWith(".txt")&&"text/plain"!==e||(t="extFileTXT"),t}function guessDateFormat(e){if(!e||Ext.isDate(e))return"";e=e.toString().trim();let t=new RegExp("[0-9]{4}-[0-9]{2}-[0-9]{2} [0-9]{2}:[0-9]{2}:[0-9]{2}");return t.test(e)?"Y-m-d H:i:s":(t=new RegExp("[0-9]{4}-[0-9]{2}-[0-9]{2} [0-9]{2}:[0-9]{2}"),t.test(e)?"Y-m-d H:i":(t=new RegExp("[0-9]{4}-[0-9]{2}-[0-9]{2} [0-9]{2}"),t.test(e)?"Y-m-d H":(t=new RegExp("[0-9]{4}-[0-9]{2}-[0-9]{2}"),t.test(e)?"Y-m-d":(t=new RegExp("[0-9]{4}/[0-9]{2}/[0-9]{2} [0-9]{2}:[0-9]{2}:[0-9]{2}"),t.test(e)?"Y/m/d H:i:s":(t=new RegExp("[0-9]{4}/[0-9]{2}/[0-9]{2} [0-9]{2}:[0-9]{2}"),t.test(e)?"Y/m/d H:i":(t=new RegExp("[0-9]{4}/[0-9]{2}/[0-9]{2} [0-9]{2}"),t.test(e)?"Y/m/d H":(t=new RegExp("[0-9]{4}/[0-9]{2}/[0-9]{2}"),t.test(e)?"Y/m/d":"")))))))}function getUrlContentType(e,i){if(e&&i){let n=$.md5(e.toString());var t=getCache(n);t?i(t):$.ajax({type:"HEAD",url:e,complete:function(e,t){setCache(n,e.getResponseHeader("content-type")),i(e.getResponseHeader("content-type"))},error:function(){setCache(n,"un-know"),i("un-know")}})}}function inputFocusEnd(t){try{t.focus();var n=t.value.length;if(document.selection){let e=t.createTextRange();e.moveStart("character",n),e.collapse(),e.select()}else"number"==typeof t.selectionStart&&"number"==typeof t.selectionEnd&&(t.selectionStart=t.selectionEnd=n)}catch(e){console.error(e)}}function randomInt(e,t){return e===t?e:Math.floor(Math.random()*(t-e+1)+e)}function loadCssCode(e,t){let n=document.getElementsByTagName("head").item(0),i=document.createElement("style");i.type="text/css",i.styleSheet?i.styleSheet.cssText=e:i.innerHTML=e,null!=t&&t(),n.appendChild(i)}function dispatchTargetEvent(e,t,n){if(e.createEvent){const i=e.createEvent("MouseEvents");i.initEvent(n,!0,!1),t.dispatchEvent(i)}else e.createEventObject&&t.fireEvent("on"+n)}function buildUUID4(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function buildUUID8(){return(4294967296*(1+Math.random())|0).toString(16).substring(1)}function buildUUID12(){return buildUUID4()+buildUUID8()}function buildUUID16(){return buildUUID8()+buildUUID8()}const power={types:["gridcolumn","button","menuitem"],config:!1,menuShowing:!1,powers:{},defaultPower:{show:!0,edit:!0},hasPower:function(e,t){return!e.managerPower||!e.managerPower.hasOwnProperty(t)||e.managerPower[t]},checkPower:function(e){var t=this;t.powers[e]||(t.powers[e]=copy(t.defaultPower));let n=t.powers[e];if(!Ext.isEmpty(n))for(var i in t.defaultPower)n.hasOwnProperty(i)||(n[i]=t.defaultPower[i]);return n},checkManagerPower:function(e){if(!system.manager)return null;if(!system.managerPowers&&(Ext.isEmpty(system.manager.managerExtPower)||0===system.manager.role.roleType))return null;system.managerPowers||(system.managerPowers=jsonToObject(system.manager.managerExtPower)),system.managerPowers||(system.managerPowers={});let t=system.managerPowers[e.code];for(var n in t=t||copy(power.defaultPower),power.defaultPower)t.hasOwnProperty(n)||(t[n]=power.defaultPower[n]);return t},pushPower:function(e,t){this.powers[e]=t},setPower:function(e,t){this.powers[e]||(this.powers[e]=t)},savePower:function(){var e=this.powers;return Ext.encode(e)}};function getPowerCode(n){if(null!=n){let t=null;if(Ext.isFunction(n.up)){let e=n.up("window");e&&(t=e.getTitle())}if(n.name&&(t+=n.name),n.title&&(t+=n.title),n.text&&(t+=n.text),n.subtext&&(t+=n.subtext),n.dataIndex&&(t+=n.dataIndex),Ext.isFunction(n.getFieldLabel)&&Ext.isEmpty(n.getFieldLabel())&&(t+=n.getFieldLabel()),t)return $.md5(t)}return null}function showPowerConfig(r,t){if(isSystem()){let o=power.checkPower(r.code);power.menuShowing=!0;var n=Ext.create("Ext.panel.Panel",{layout:{type:"vbox",pack:"center"},border:0,defaults:{height:20,power:!1},items:[{xtype:"checkbox",name:"updateAlert",checked:!0,boxLabel:"允许显示",value:o.show,listeners:{change:function(e,t,n,i){o.show=t,setPowerStyle(r)}}},{xtype:"checkbox",name:"updateAlert",checked:!0,boxLabel:"允许编辑",hidden:!isColumnType(r),value:o.edit,listeners:{change:function(e,t,n,i){o.edit=t,setPowerStyle(r)}}}]});let e=new Ext.menu.Menu({padding:"0 0 0 10",powerMenu:!0,style:{background:"#ffffff"},items:[n],listeners:{beforehide:function(e,t){power.menuShowing=!1,power.pushPower(r.code,o)}}});e.showAt(t.getXY())}}function setPowerStyle(i){var e=Ext.all("[code="+i.code+"]");Ext.each(e,function(e,t){var n=power.checkPower(i.code);n&&(n.show?(e.removeCls("no-show-power"),n.edit?e.removeCls("no-edit-power"):e.addCls("no-edit-power")):e.addCls("no-show-power"))})}function buttonToMenuItem(e){if(e.hidden)return null;let t={icon:e.icon,iconCls:e.iconCls,text:e.text,subtext:e.subtext,handler:e.handler,disabled:e.disabled};if(null!=e.getMenu()){let n=[];e.getMenu().items.each(function(e,t){e=buttonToMenuItem(e);e&&n.push(e)}),t.menu=n}return t}function buttonToBind(n,e){e.checkSelect&&(n.selectButtons||(n.selectButtons=[]),e.setDisabled(!0),n.selectButtons.push(e)),e.checkUpdate&&(n.updateButtons||(n.updateButtons=[]),e.setDisabled(!0),n.updateButtons.push(e)),null!=e.getMenu()&&e.getMenu().items.each(function(e,t){buttonToBind(n,e)})}function showFastDatePicker(x,p,y){return new Ext.Promise(function(r,e){let l=(new Date).getTime();Ext.isEmpty(y)&&(y="Y-m-d H:i:s");let t=[];for(let e=0;e<24;e++){var n=prefixInteger(e,2);t.push({text:n})}let i=[];for(let e=0;e<60;e++){var o=prefixInteger(e,2);i.push({text:o})}let a;Ext.isEmpty(p)||(a=Ext.Date.parse(p,y)),a=a||new Date;var s=Ext.Date.format(a,"H"),c=Ext.Date.format(a,"i"),d=Ext.Date.format(a,"s");let u=0;var m=-1!==y.indexOf("H"),g=-1!==y.indexOf("i"),h=-1!==y.indexOf("s");m&&u++,g&&u++,h&&u++;let f=Ext.create("Ext.menu.Menu",{showSeparator:!1,layout:"border",padding:"0 0 0 0",style:{background:"#ffffff"},alwaysOnTop:!0,width:350,height:400,listeners:{hide:function(e,t){runCallBack(r)}},items:[{xtype:"datepicker",id:"dateValue"+l,region:"center",showToday:!1,margin:"0 0 0 0",border:0,value:a},{xtype:"panel",layout:"column",margin:"0 0 0 0",region:"south",border:0,items:[{xtype:"panel",columnWidth:1,layout:"column",border:0,items:[{id:"hourValue"+l,columnWidth:1/u,emptyText:"时",minValue:0,margin:"0 0 0 5",maxValue:23,displayField:"text",valueField:"text",editable:!1,hidden:!m,value:s,store:Ext.create("Ext.data.Store",{autoLoad:!0,data:t}),xtype:"combo"},{xtype:"displayfield",width:30,hidden:!m,value:"<div align='center'>时</div>"},{id:"minuteValue"+l,columnWidth:1/u,emptyText:"分",minValue:0,maxValue:59,displayField:"text",valueField:"text",editable:!1,value:c,hidden:!g,store:Ext.create("Ext.data.Store",{autoLoad:!0,data:i}),xtype:"combo"},{xtype:"displayfield",width:30,hidden:!g,value:"<div align='center'>分</div>"},{id:"secondsValue"+l,columnWidth:1/u,emptyText:"秒",minValue:0,maxValue:59,displayField:"text",valueField:"text",editable:!1,value:d,hidden:!h,store:Ext.create("Ext.data.Store",{autoLoad:!0,data:i}),xtype:"combo"},{xtype:"displayfield",width:30,hidden:!h,value:"<div align='center'>秒</div>"}]},{xtype:"button",columnWidth:1,margin:"5 5 5 5",text:"确定",handler:function(){let e=Ext.getCmp("dateValue"+l),t=Ext.getCmp("hourValue"+l),n=Ext.getCmp("minuteValue"+l),i=Ext.getCmp("secondsValue"+l),o=e.getValue();o.setHours(parseInt(t.getValue())),o.setMinutes(parseInt(n.getValue())),o.setSeconds(parseInt(i.getValue())),runCallBack(r,Ext.Date.format(o,y)),f.close()}}]}]});f.showBy(x)})}function showFastColorPicker(i,o,r){return Ext.isEmpty(o)&&(o="#42445a"),new Ext.Promise(function(n,e){window.onColorPickerLoadDone=function(e){e.on("change",function(e,t,n){Ext.isFunction(r)&&r(e,t,n)})};let t=Ext.create("Ext.menu.Menu",{showSeparator:!1,layout:"border",padding:"0 0 0 0",style:{background:"#ffffff"},alwaysOnTop:!0,width:250,height:320,listeners:{hide:function(e,t){runCallBack(n)},mouseleave:function(e){var t=colorPickerFrame.window.document.getElementsByTagName("body")[0];dispatchTargetEvent(colorPickerFrame.window.document,t,"mouseup")}},items:[{xtype:"panel",region:"center",margin:"0 0 0 0",border:0,listeners:{afterrender:function(){var e=system.formatUrlVersion("base/colorpicker/index.html",{color:o.replace("#","")});this.update("<iframe name='colorPickerFrame'  src='"+e+"' width='100%' height='100%' frameborder='0' scrolling='no' />")}}}]});t.showBy(i)})}Ext.override(Ext.Component,{afterRender:Ext.Function.createSequence(Ext.Component.prototype.afterRender,function(){if(isSystem()){let i=this;i.power=toBool(i.power,!0),i.power&&(i.up("[power=false]")||i.power&&(0<i.getXTypes().indexOf("field/")||Ext.Array.contains(power.types,i.getXType()))&&(i.code=getPowerCode(i),i.code&&(i.managerPower=power.checkManagerPower(i),power.setPower(i.code,copy(i.managerPower)),power.hasPower(i,"show")?power.hasPower(i,"edit")||(i.editable=!1,Ext.isFunction(i.setReadOnly)&&i.setReadOnly(!0)):(i.hideable=!1,i.setHidden(!0),i.setDisabled(!0),i.clearListeners(),Ext.isFunction(i.collapse)&&i.collapse()),power.config&&(i.powerConfig=power.checkPower(i.code),setPowerStyle(i),i.getEl().on("contextmenu",function(e,t,n){e.stopEvent(),showPowerConfig(i,e)})))))}})}),Ext.override(Ext.Component,{setDisabled:function(e){return power.config?this.enable():this[e?"disable":"enable"]()}}),Ext.override(Ext.form.field.Base,{markInvalid:function(o){if(!power.config){let e=this,t=e.ariaEl.dom,n=e.getActiveError(),i;e.setActiveErrors(Ext.Array.from(o)),n!==(i=e.getActiveError())&&(e.setError(i),!e.ariaStaticRoles[e.ariaRole]&&t&&t.setAttribute("aria-invalid",!0))}}}),Ext.override(Ext.button.Button,{afterRender:Ext.Function.createSequence(Ext.button.Button.prototype.afterRender,function(){try{var e=this;e.tipText&&(e.tip=new Ext.ToolTip({target:e.el,trackMouse:!0,renderTo:Ext.getBody(),dismissDelay:0,html:e.tipText}));var t=e.up("grid,treepanel");t&&(Ext.isEmpty(e.text)||addGridContextMenu(t,buttonToMenuItem(e)),buttonToBind(t,e))}catch(e){console.error(e)}})}),Ext.override(Ext.Component,{initComponent:Ext.Function.createSequence(Ext.Component.prototype.initComponent,function(){var e=this;try{if(e.validateOnBlur=!1,e.validateOnChange=!1,e.closeToolText="关闭",e.collapseToolText="关闭",e.expandToolText="展开",("window"===e.getXType()||"panel"===e.getXType())&&(!Ext.isEmpty(e.getTitle())||!Ext.isEmpty(e.subtitle))&&(e.resizable||e.split)){let o=$.md5(e.getTitle()+e.subtitle+$("title").text());try{o=$.md5(o+e.width+e.height)}catch(e){}var t=getCache(o+"Width"),n=getCache(o+"Height"),i=toBool(getCache(o+"Collapse"),!1);null!=t&&(e.setWidth(t),e.setFlex(0)),null!=n&&(e.setHeight(n),e.setFlex(0)),e.collapsed=i,e.setCollapsed(i),e.on("resize",function(e,t,n,i){t!==Ext.getBody().getWidth()&&setCache(o+"Width",t),n!==Ext.getBody().getHeight()&&setCache(o+"Height",n)}),e.on("collapse",function(e,t,n,i){setCache(o+"Collapse",!0)}),e.on("expand",function(e,t,n,i){setCache(o+"Collapse",!1)})}"menuitem"===e.getXType()&&(e.on("focus",function(n,e,t){if(!n.isDisabled()){var i=n.icon;let t=/([^/]*.svg)/;if(i&&t.test(i)){i=server.getIcon(t.exec(i)[1].trim(),"#ffffff");let e=Ext.get(n.getId()+"-iconEl");e&&e.setStyle("background-image","url("+i+")")}}}),e.on("blur",function(t,e,n){if(!t.isDisabled()){var i=t.icon;if(i&&/([^/]*.svg)/.test(i)){let e=Ext.get(t.getId()+"-iconEl");e&&e.setStyle("background-image","url("+i+")")}}}))}catch(e){console.error(e)}})}),Ext.override(Ext.Component,{show:function(){try{if(isSystem()&&("window"===this.getXType()||"messagebox"===this.getXType())&&!toBool(this.sessionWin,!1)&&system.sessionOutAlert)return this.hide(),null;let e=this,t=e.rendered;return e.hierarchicallyHidden||e.floating&&!t&&e.isHierarchicallyHidden()?(t||e.initHierarchyEvents(),1<arguments.length?(arguments[0]=null,e.pendingShow=arguments):e.pendingShow=!0):t&&e.isVisible()?e.floating&&e.onFloatShow():!1!==e.fireEvent("beforeshow",e)?(e.hidden=!1,delete this.getInherited().hidden,Ext.suspendLayouts(),t||!e.autoRender&&!e.floating||(e.doAutoRender(),t=e.rendered),t?(e.beforeShow(),Ext.resumeLayouts(),e.onShow.apply(e,arguments),e.afterShow.apply(e,arguments)):Ext.resumeLayouts(!0)):e.onShowVeto(),e}catch(e){console.error(e)}return this}}),Ext.override(Ext.grid.CellContext,{setRow:function(n){try{let e=this,t=e.view.dataSource;return n&&("number"==typeof n?(e.rowIdx=Math.max(Math.min(n,t.getCount()-1),0),e.record=t.getAt(n)):n.isModel?(e.record=n,e.rowIdx=t.indexOf(n)):(n.tagName||n.isElement)&&(e.record=e.view.getRecord(n),e.rowIdx=t.indexOf(e.record))),e}catch(e){console.error(e)}return this}}),Ext.override(Ext.layout.container.Accordion,{nextCmp:function(e){let t=e.next();return t&&t.isHidden()?this.nextCmp(t):t},prevCmp:function(e){let t=e.prev();return t&&t.isHidden()?this.prevCmp(t):t},onBeforeComponentCollapse:function(o){try{let e=this,t=e.owner,n,i;if(1===e.owner.items.getCount())return!1;if(!e.processing){if(e.processing=!0,i=t.deferLayouts,t.deferLayouts=!0,n=e.nextCmp(o)||e.prevCmp(o),n.isHidden())return t.deferLayouts=i,e.processing=!1,void e.onBeforeComponentCollapse(n);if(e.multi)return t.deferLayouts=i,void(e.processing=!1);n&&n.expand(),t.deferLayouts=i,e.processing=!1}}catch(e){console.error(e)}}}),Ext.override(Ext.dom.Element,{syncContent:function(g){try{let e=(g=Ext.getDom(g)).childNodes,t=e.length,n=this.dom,i=n.childNodes,o=i.length,r,l,a,s,c,d,u,m=n._extData;if(Ext.isIE9m&&n.mergeAttributes)n.mergeAttributes(g,!0),n.src=g.src;else for(c=g.attributes,d=c.length,r=0;r<d;r++)"id"!==(u=c[r].name)&&n.setAttribute(u,c[r].value);if(m&&(m.isSynchronized=!1),t!==o)return void(n.innerHTML=g.innerHTML);for(r=0;r<t;r++){if(a=e[r],l=i[r],(s=a.nodeType)!==l.nodeType||1===s&&a.tagName!==l.tagName)return void(n.innerHTML=g.innerHTML);if(3===s)l.data=a.data;else try{a.id&&l.id!==a.id&&(l.id=a.id),l.style.cssText=a.style.cssText,l.className=a.className,Ext.fly(l,"_syncContent").syncContent(a)}catch(e){}}}catch(e){console.error(e)}}}),Ext.override(Ext.Component,{onRender:Ext.Function.createSequence(Ext.Component.prototype.onRender,function(){let i=this;try{if(isPower())return;if(i.help){let n=i.bodyEl;n=n||i.el,n.on("mouseleave",function(){i.helpTip&&i.helpTip.close()}),n.on("contextmenu",function(){try{if(!window.getHelpContent)return;if(i.helpTip)return void i.helpTip.close();let e=i.helpAnchor;e=e||"left";let t=(i.getWidth()-20)/2;"left"!==e&&"right"!==e||(t=(i.getHeight()-20)/2),280<=t&&(t=0),i.helpTip=Ext.create("Ext.tip.ToolTip",{target:n,resizable:!0,anchor:e,anchorOffset:t,autoHide:!1,maxWidth:400,closeAction:"destroy",html:window.getHelpContent(i.help),showDelay:0,autoShow:!0,listeners:{beforedestroy:function(){i.helpTip=null},hide:function(){this.close()}}})}catch(e){console.error(e)}})}}catch(e){console.error(e)}})}),Ext.override(Ext,{getScrollbarSize:function(e){Ext.isDomReady||Ext.raise("getScrollbarSize called before DomReady");let n=Ext._scrollbarSize;if(e||!n){let e=document.body,t=document.createElement("div");t.style.width=t.style.height="100px",t.style.overflow="scroll",t.style.position="absolute",e.appendChild(t),Ext._scrollbarSize=n={width:t.offsetWidth-t.clientWidth,height:t.offsetHeight-t.clientHeight},e.removeChild(t)}return n.width<=0&&(n.width=15),n.height<=0&&(n.height=15),n}}),Ext.override(Ext.Component,{onAlignToScroll:function(){},adjustPosition:function(e,t){var n,i,o,r=this;r.isContainedFloater()&&(e+=(n=r.floatParent.getTargetEl().getViewRegion()).left,t+=n.top);try{r.pickerField&&(i=document.body.clientWidth,o=document.body.clientHeight,"datefield"===r.pickerField.xtype?(e=Math.min(r.pickerField.getX()+r.pickerField.getWidth(),i-r.getWidth()),t=Math.min(r.pickerField.getY(),o-r.getHeight())):-1!==r.pickerField.xtype.indexOf("combo")&&(e=Math.min(r.pickerField.bodyEl.getX(),i-r.getWidth()),t=Math.min(r.pickerField.getY()+r.pickerField.getHeight(),o-r.getHeight())))}catch(e){console.error(e)}return{x:e,y:t}}}),Ext.override(Ext.toolbar.Paging,{updateInfo:function(){let e=this,t=e.child("#displayItem"),n=e.store,i=e.getPageData(),o,r;if(t){if(o=n.getCount(),r=0===o?e.emptyMsg:Ext.String.format(e.displayMsg,i.fromRecord,i.toRecord,i.total),n.grid){let e;e=n.grid.getSelectionModel&&n.grid.getSelectionModel().selected&&!Ext.isEmpty(n.grid.getSelectionModel().selected.rangeEnd)&&!Ext.isEmpty(n.grid.getSelectionModel().selected.rangeStart)?Math.abs(parseInt(n.grid.getSelectionModel().selected.rangeEnd)-parseInt(n.grid.getSelectionModel().selected.rangeStart))+1:n.grid.getSelection().length,0<e&&(r="选中"+e+"行数据，"+r),n.grid.selectCount=e,Ext.isFunction(n.grid.refreshSelect)&&n.grid.refreshSelect(),Ext.isFunction(n.grid.refreshDetailsPanel())&&n.grid.refreshDetailsPanel()}t.setText(r)}}}),Ext.override(Ext.util.Grouper,{sortFn:function(e,t){return 0}}),Ext.override(Ext.resizer.Splitter,{onRender:function(){var e=this;e.collapseOnDblClick=!1,e.callParent(arguments),e.getEl()&&(e.getEl().on("mousedown",function(){let t=Ext.ComponentQuery.query("panel[iframePanel=true]");for(let e=0;e<t.length;e++)t[e].setDisabled(!0)}),e.getEl().on("mouseup",function(){let t=Ext.ComponentQuery.query("panel[iframePanel=true]");for(let e=0;e<t.length;e++)t[e].setDisabled(!1)}),e.on("move",function(){let t=Ext.ComponentQuery.query("panel[iframePanel=true]");for(let e=0;e<t.length;e++)t[e].setDisabled(!1)}))}}),Ext.override(Ext.form.field.File,{onRender:Ext.Function.createSequence(Ext.form.field.File.prototype.onRender,function(){this.multiple&&this.fileInputEl.dom.setAttribute("multiple","multiple")})});const files={formatLength:function(e){return e<1024?e+"B":e<1048576?(e/1024).toFixed(2)+"KB":(e/1024/1024).toFixed(2)+"M"},validate:function(e,t){return Ext.isEmpty(e)?(showAlert("系统提醒","参数"+t+"必传！"),!1):Ext.isArray(e)?0!==e||(showAlert("系统提醒","参数"+t+"集合不可为空！"),!1):(showAlert("系统提醒","参数"+t+"必需Array格式！"),!1)},file:function(){return{reg:/\.*$/i,tipMsg:"文件",type:"file",renderer:renders.file()}},image:function(e,t){return{width:e=Ext.isEmpty(e)?-1:e,height:t=Ext.isEmpty(t)?-1:t,reg:/\.(jpg|png|gif|jpeg|svg|bmp)$/i,tipMsg:"图片",type:"images",renderer:renders.image(24)}},mp4:function(e){return{reg:/\.(mp4)$/i,tipMsg:"mp4",type:"videos",maxDuration:e,onFileSelect:function(o){let r=this;return new Ext.Promise(function(n,e){if(Ext.isEmpty(r.maxDuration))n();else{var i=o.fileInputEl.dom.files[0],i=URL.createObjectURL(i);let t=new Audio(i);t.addEventListener("loadedmetadata",function(e){1e3*t.duration>parseInt(r.maxDuration)&&n("视频最大时长不得超过"+r.maxDuration/1e3+"秒！")})}})},renderer:renders.file()}},word:function(){return{reg:/\.(doc|docx)$/i,tipMsg:"word文档",type:"words",renderer:renders.file()}},excel:function(){return{reg:/\.(xls|xlsx)$/i,tipMsg:"excel文档",type:"excels",renderer:renders.file()}},ppt:function(){return{reg:/\.(ppt|pptx)$/i,tipMsg:"ppt文档",type:"ppt",renderer:renders.file()}},pdf:function(){return{reg:/\.(pdf)$/i,tipMsg:"pdf文档",type:"pdf",renderer:renders.file()}},zip:function(){return{reg:/\.(zip|rar)$/i,tipMsg:"zip压缩包",type:"zip",renderer:renders.file()}},text:function(){return{reg:/\.(txt)$/i,tipMsg:"txt文档",type:"excels",renderer:renders.file()}}};function uploadFile(d,u,m,g){return new Ext.Promise(function(l,e){let t="上传文件",i="files",a=-1,s=-1,c="file";if(files.validate(u,"fileModules")){1===u.length&&(t="上传"+u[0].tipMsg,i=u[0].type,a=u[0].width,s=u[0].height),Ext.isEmpty(g)&&(g=!0),d&&(d.name&&(c=d.name),d.dataIndex&&(c=d.dataIndex));let o=Ext.create("Ext.form.FormPanel",{url:"upload",method:"POST",margin:"5",fileUpload:!0,width:400,callBacked:!1,border:0,layout:"column",items:[{xtype:"filefield",fieldLabel:t,labelWidth:60,labelAlign:"right",buttonText:"选择文件",allowBlank:!1,name:c,multiple:m,columnWidth:1,listeners:{change:function(e,i,t){if(null!=i&&0!==i.length){let n="";for(let t=0;t<u.length;t++){let e=u[t];if(e.reg.test(i))return void o.doSubmit();n=n+"或"+e.tipMsg}o.form.reset(),Ext.Msg.alert("系统提醒","请上传有效的"+n.substring(1))}}}},{xtype:"hiddenfield",name:"type",value:i},{xtype:"hiddenfield",name:"file.width",value:a},{xtype:"hiddenfield",name:"file.height",value:s}],doSubmit:function(){let e=o.form;if(e.isValid()){let n=new Ext.LoadMask({msg:"正在上传附件中…",target:r});n.show();let i=function(t){if(t>=u.length)e.submit({success:function(e,t){toast("文件上传成功！"),l.called||(l.called=!0,l(t.result.data)),r.close()},failure:function(e,t){n.destroy(),Ext.Msg.alert("系统提醒","上传失败！"+t.result.message)}});else{let e=u[t];Ext.isFunction(e.onFileSelect)?e.onFileSelect(o.getForm().findField(c)).then(function(e){Ext.isEmpty(e)?i(t+1):(n.destroy(),o.form.reset(),Ext.Msg.alert("系统提醒",e))}):i(t+1)}};i(0)}},listeners:{render:function(e){try{new Ext.util.KeyMap({target:e.getEl(),key:13,fn:o.doSubmit,scope:Ext.getBody()})}catch(e){console.error(e)}}}}),n="btnSubmit"+(new Date).getTime(),r=Ext.create("Ext.window.Window",{title:t,layout:"fit",resizable:!1,scrollable:!1,width:500,items:o,modal:!0,iconCls:"extIcon extUpload",animateTarget:d,constrain:!0,buttons:[{text:"使用地址",iconCls:"extIcon extEdit",hidden:!g,handler:function(){Ext.Msg.prompt("使用自定义的文件地址","填写自定义的文件路径（http）：",function(e,t){"ok"===e&&(Ext.isEmpty(t)||(l.called||(l.called=!0,l({url:t})),r.close()))})}},{text:"网络同步",iconCls:"extIcon extLink",handler:function(){Ext.Msg.prompt("从网络中下载文件","填写网络文件路径（http）：",function(e,t){"ok"===e&&(showWait("正在同步中，请稍后……"),$.post("upload",{url:t,__accept:"application/json"},function(e){hideWait(),e.success?(toast("文件上传成功！"),l.called||(l.called=!0,l(e.data)),r.close()):Ext.Msg.alert("系统提醒","上传失败！"+e.message)}))})}},"->",{text:"重置",width:88,iconCls:"extIcon extReset",handler:function(){o.form.reset()}},{text:"上传",width:88,id:n,iconCls:"extIcon extOk",handler:function(){o.doSubmit()}}],listeners:{show:function(e,t){o.getForm().findField(c).fileInputEl.dom.click(),Ext.getCmp(n).focus()},close:function(e,t){l.called||(l.called=!0,l())}}});r.show()}})}function showFiles(s,c,i,d,u){if(files.validate(i,"fileModules")){s&&s.blur();let l=[],e=renders.file();if(u=u||"文件管理",!Ext.isEmpty(d)){let r=d;Ext.isString(d)&&(r=Ext.JSON.decode(d));for(let o=0;o<r.length;o++){let e=r[o];var m=e.split("@");let t=m[0],n=t.substring(t.lastIndexOf("/")+1),i=-1;1<m.length&&(n=m[1]),2<m.length&&(i=m[2]),l.push({url:t,name:n,length:i})}}1===i.length&&(e=i[0].renderer,u=i[0].tipMsg+"管理");let t=[{header:"文件",dataIndex:"url",flex:1,align:"center",renderer:e}];s.showFileName&&(t.push({header:"文件名",dataIndex:"name",width:150,align:"center",field:{xtype:"textfield",listeners:{change:function(){o.modify=!0}}},renderer:renders.normal()}),s.showFileLength&&t.push({header:"大小",dataIndex:"length",width:100,align:"center",renderer:renders.fileSize()}));let n=Ext.now(),o=Ext.create("Ext.data.Store",{autoLoad:!0,data:l}),r=Ext.create("Ext.grid.Panel",{selModel:getGridSelModel(),store:o,columnLines:!0,cellTip:!0,columns:t,plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:2})],selType:"cellmodel",tbar:[{xtype:"button",border:1,text:"删除",id:"btnDeleteFile"+n,iconCls:"extIcon extDelete",disabled:!0,handler:function(){let i=r.getSelectionModel().getSelection();0===i.length?toast("请您选择需要删除的文件！"):Ext.Msg.confirm("系统提醒","您确定立即删除选中的附件吗？",function(e,t){if("yes"===e){let n={};Ext.Array.each(i,function(e,t){n["path["+t+"]"]=e.get("url")}),showWait("正在删除中……"),server.deleteAttach(n,function(e,t){hideWait(),e?(r.getSelectionModel().deselectAll(),showAlert("系统提醒","删除成功！"),Ext.Array.each(i,function(e,t){o.remove(e),o.modify=!0})):showAlert("系统提醒",t)})}})}},{xtype:"button",border:1,text:"上传",iconCls:"extIcon extUpload",handler:function(){uploadFile(this,i,!0).then(function(t){if(t){if(Ext.isArray(t))for(let e=0;e<t.length;e++)o.add(t[e]);else o.add(t);o.modify=!0}})}}],listeners:{selectionchange:function(){var e=this.getSelectionModel().getSelection();Ext.getCmp("btnDeleteFile"+n).setDisabled(!(0<e.length))}}}),a=Ext.create("Ext.window.Window",{title:u,height:300,width:400,minWidth:400,minHeight:300,layout:"fit",resizable:!0,modal:!0,constrain:!0,iconCls:"extIcon extFolder",animateTarget:s,items:[r],buttons:[{text:"确定",iconCls:"extIcon extOk",handler:function(){let i=[];o.each(function(e,t){let n=e.get("url");s.showFileName&&(n=n+"@"+e.get("name"),s.showFileLength&&(n=n+"@"+e.get("length"))),i.push(n)}),null!=c&&c(Ext.encode(i)),a.close()}}],listeners:{close:function(){o.modify}}});a.show()}}function importExcel(t,l,a,s){return new Ext.Promise(function(i,e){a=a?Ext.Array.clone(a):[],s=s||"entity/importData",a.push({xtype:"filefield",fieldLabel:"Excel文件",buttonText:"选择文件",allowBlank:!1,name:"file",columnWidth:1,listeners:{change:function(e,t,n){null!=t&&0!=t.length&&(files.excel().reg.test(t)||(o.form.reset(),Ext.Msg.alert("系统提醒","请上传有效的Excel文档！")))}}});let o=Ext.create("Ext.form.FormPanel",{url:s,method:"POST",margin:"5",fileUpload:!0,width:400,callBacked:!1,border:0,layout:"column",defaults:{labelWidth:80,margin:"5 5 5 5",labelAlign:"right",emptyText:"请填写"},items:a,doSubmit:function(){let e=o.form;if(e.isValid()){let n=new Ext.LoadMask({msg:"正在导入中…",target:r});n.show(),e.submit({params:l,success:function(e,t){n.destroy(),Ext.Msg.alert("系统提醒",t.result.message,function(){runCallBack(i,t.result),r.close()})},failure:function(e,t){n.destroy(),Ext.Msg.alert("系统提醒","导入失败！"+t.result.message)}})}},listeners:{render:function(e){try{new Ext.util.KeyMap({target:e.getEl(),key:13,fn:o.doSubmit,scope:Ext.getBody()})}catch(e){console.error(e)}}}}),n="btnSubmit"+(new Date).getTime(),r=Ext.create("Ext.window.Window",{title:"导入Excel数据",layout:"fit",resizable:!1,scrollable:!1,items:[o],modal:!0,iconCls:"extIcon extUpload",animateTarget:t,constrain:!0,buttons:[{text:"重置",width:88,iconCls:"extIcon extReset",handler:function(){o.form.reset()}},{text:"上传",width:88,id:n,iconCls:"extIcon extOk",handler:function(){o.doSubmit()}}],listeners:{show:function(e,t){1===a.length&&(o.getForm().findField("file").fileInputEl.dom.click(),Ext.getCmp(n).focus())}}});r.show()})}function isDateField(e){return!!e&&("datefield"===e||"datefield"===e.xtype)}function isNumberField(e){return!!e&&("numberfield"===e||"numberfield"===e.xtype)}function isTextField(e){return!!e&&("textfield"===e||"textfield"===e.xtype)}function isComboField(e){return!!e&&("combobox"===e||"combo"===e.xtype)}function isFileField(e){return!!e&&("fastfile"===e||"fastfile"===e.xtype||"fastfilefield"===e||"fastfilefield"===e.xtype)}function isFilesField(e){return!!e&&("fastfiles"===e||"fastfiles"===e.xtype||"fastfilesfield"===e||"fastfilesfield"===e.xtype)}function isEnumField(e){return!!e&&("enumcombo"===e||"enumcombobox"===e||"enumcombo"===e.xtype||"enumcombobox"===e.xtype)}function isContentField(e){return!!e&&("contentfield"===e||"content"===e||"contentfield"===e.xtype||"content"===e.xtype)}function isHtmlContentField(e){return!!e&&("htmlcontentfield"===e||"htmlcontent"===e||"htmlcontentfield"===e.xtype||"htmlcontent"===e.xtype)}function isLinkField(e){return!!e&&("linkfield"===e||"link"===e||"linkfield"===e.xtype||"link"===e.xtype)}function isTargetField(e){return!!e&&("targetfield"===e||"target"===e||"targetfield"===e.xtype||"target"===e.xtype)}function isPCAField(e){return!!e&&("pcafield"===e||"pca"===e||"pcafield"===e.xtype||"pca"===e.xtype)}function isMapField(e){return!!e&&("mapfield"===e||"map"===e||"mapfield"===e.xtype||"map"===e.xtype)}function onGridInitComponent(){var e=this;e.bufferedRenderer=!1,e.entityList&&(e.getStore()&&(e.getStore().grid=e).getStore().where&&(e.fromRecycle=e.getStore().where["^fromRecycle"]),configGridContextMenu(e),configDefaultToolBar(e),configGridListeners(e))}function onGridAfterRender(){let e=this;e.entityList&&(e.up("[tabContainer=true]")&&(e.tabPanelList=!0),e.updateButtons&&0!==e.updateButtons.length?e.updateEnable=!0:e.updateEnable=!1,configGridLayout(e).then(function(){configGridTip(e),e.setLoading(!1),(e.getStore().grid=e).getStore().isLoaded()||e.getStore().loadPage(1)}))}function addGridContextMenu(t,e,n){if(t.contextMenu&&e){if(!Ext.isFunction(t.contextMenu.getXType)){let e=new Ext.menu.Menu({items:[]});Ext.isArray(t.contextMenu)&&e.add(t.contextMenu),t.contextMenu=e}Ext.isEmpty(n)?t.contextMenu.add(e):t.contextMenu.insert(n,e)}}function configGridContextMenu(l){var e=0;addGridContextMenu(l,{iconCls:"extIcon extDetails editColor",text:"查看详情",handler:function(e,t){let n="";l.getStore().entity.menu&&(n="【"+l.getStore().entity.menu.text+"】");var i=parseInt((.3*document.body.clientWidth).toFixed(0)),o=parseInt((.6*document.body.clientHeight).toFixed(0));let r=Ext.create("Ext.window.Window",{title:"查看详情"+n,subtitle:n,height:o,width:i,minHeight:450,minWidth:400,iconCls:"extIcon extDetails",layout:"border",resizable:!0,collapsible:!0,constrain:!0,maximizable:!0,animateTarget:e,listeners:{close:function(e,t){e.items.get(0).changeListener.destroy()},show:function(e){e.focus()}},items:[getDetailsPanel(l,!0)]});r.show()}},e++),addGridContextMenu(l,{iconCls:"extIcon extCopy2",text:"复制数据",menu:[{text:"复制单元格",iconCls:"extIcon extCopy2",handler:function(){var e=l.contextMenu;copyToBoard($(e.cellTd).text()),toast("复制成功！")}},{text:"复制整行",iconCls:"extIcon extCopy2",handler:function(){var e=l.contextMenu;let t="";$(e.tr).find("td").each(function(){t+=$(this).text()+"\t"}),copyToBoard(t),toast("复制成功！")}},{text:"复制数据",iconCls:"extIcon extCopy2",handler:function(){var e=l.contextMenu;let t=e.record;e=e.cellContext.column.dataIndex;Ext.isArray(t.get(e))?copyToBoard(Ext.encode(t.get(e))):copyToBoard(t.get(e)),toast("复制成功！")}}]},e++),addGridContextMenu(l,{iconCls:"extIcon extEdit editColor",text:"编辑数据",onBeforeShow:function(){let e=this.ownerCt;!Ext.isEmpty(e.cellContext.column.dataIndex)&&1===l.getSelection().length&&toBool(e.cellContext.column.editable,!0)?(this.show(),e.cellContext.column.field||e.cellContext.column.hasListener("dblclick")||this.hide()):this.hide()},handler:function(){let e=this.ownerCt;e.cellContext.column.field?(l.doEdit=!0,l.findPlugin("cellediting").startEditByPosition(e.cellContext)):e.cellContext.column.fireEvent("dblclick",l,this,e.rowIndex)}},e++),l.getStore().entity&&(addGridContextMenu(l,{iconCls:"extIcon extLink",text:"搜索链",onBeforeShow:function(){this.show();var e=this.ownerCt;if(Ext.isObject(e.cellContext.column.searchLink)&&1===l.getSelection().length){let t=new Ext.menu.Menu({items:[]}),n=e.record;var i=e.cellContext.column.dataIndex,o=e.cellContext.column.searchLink.columns;for(let e=0;e<o.length;e++){var r=o[e],r={icon:r.parent.icon,text:r.parent.text+"【"+r.text+"】",column:r,value:n.get(i),handler:function(){let e={};e[this.column.dataIndex]=this.value,system.showTab(this.column.parent.method,$.md5(this.column.id+this.value),"搜索："+this.text,this.icon,!0,!1,e)}};t.add(r)}this.setMenu(t)}else this.hide()},menu:[]},e++),addGridContextMenu(l,{iconCls:"extIcon extSearch searchColor",text:"查找此数据",onBeforeShow:function(){var e=this.ownerCt;Ext.isEmpty(e.cellContext.column.dataIndex)||isFileColumn(e.cellContext.column)||isFilesColumn(e.cellContext.column)||1!==l.getSelection().length?this.hide():this.show()},handler:function(){let e=this.ownerCt,t=e.record;var n=e.cellContext.column.dataIndex;e.cellContext.column.searchValue(t.get(n))}},+e),addGridContextMenu(l,{iconCls:"extIcon extClear",text:"清空此数据",onBeforeShow:function(){var e=this.ownerCt;Ext.isEmpty(e.cellContext.column.dataIndex)||1!==l.getSelection().length?this.hide():this.show()},handler:function(){let r=this;Ext.Msg.confirm("系统提醒","您确定清空选中的单元格数据吗？",function(i,e){if("yes"===i){i=r.ownerCt;let t=i.record,e=i.cellContext.column.dataIndex;Ext.isObject(i.cellContext.column.field)&&(Ext.isEmpty(i.cellContext.column.field.name)||(e=i.cellContext.column.field.name));let n={entityCode:l.getStore().entity.entityCode};for(let e=0;e<l.getStore().entity.idProperty.length;e++){var o=l.getStore().entity.idProperty[e];n["data."+o]=t.get(o)}l.getStore().entity.menu&&(n.menu=getStoreMenuText(l.getStore())),n["data."+e]="<null>",showWait("正在清空中……"),server.updateEntity(n,function(e,t){hideWait(),e?(toast("清除成功！"),l.getStore().reload()):Ext.Msg.alert("系统提醒",t)})}})}},5))}function configDefaultToolBar(t){if(t){let e=t.down("toolbar[dock='top']");var n;e&&(toBool(t.fromRecycle,!1)?e.setHidden(!0):toBool(t.defaultToolBar,!0)&&t.operate&&(n={xtype:"button",text:"更多操作",iconCls:"extIcon extMore",menu:[{text:"导出Excel",iconCls:"extIcon extExcel",hidden:!toBool(t.operate.excelOut,!0),handler:function(){exportGrid(t)}},{text:"导入Excel",iconCls:"extIcon extExcel",hidden:!toBool(t.operate.excelIn,!0),menu:[{text:"下载模板",iconCls:"extIcon extExcelModule searchColor",handler:function(){showWait("正在生成中……");let i={entityCode:t.getStore().entity.entityCode};t.getStore().entity.menu&&(i.title=t.getStore().entity.menu.text),Ext.each(t.getColumns(),function(t,n){if(!isFileColumn(t)&&!isFilesColumn(t)&&toBool(t.excelHeader,!0)&&!t.isHidden()&&!Ext.isEmpty(t.dataIndex)){let e=n<10?"0"+n:n;i["column["+e+"].width"]=t.width,i["column["+e+"].text"]=t.configText,i["column["+e+"].groupHeaderText"]=t.groupHeaderText,i["column["+e+"].enum"]=getEnumName(t),i["column["+e+"].type"]=getColumnFieldType(t),i["column["+e+"].dataIndex"]=t.dataIndex,isLinkColumn(t)&&(i["column["+e+"].dataIndex"]=t.field.name)}}),server.excelModule(i,function(e,t,n){hideWait(),e?(toast("生成成功！"),location.href="attach/"+t):Ext.Msg.alert("系统提醒","生成失败！"+n)})}},{text:"导入数据",iconCls:"extIcon extExcelImport searchColor",handler:function(){importExcel(this,{entityCode:t.getStore().entity.entityCode},t.importExcelItems).then(function(e){e&&t.getStore().loadPage(1)})}}]},{iconCls:"extIcon extSet",text:"操作设置",handler:function(){setGrid(this,t)}}]},e.add("->"),e.add(n)))}}function configGridTip(o){var e;!o||(e=o.getView())&&(o.tip=new Ext.ToolTip({target:e.el,delegate:".x-grid-cell-inner",trackMouse:!0,renderTo:Ext.getBody(),listeners:{beforeshow:function(e){if(o.operate&&!o.operate.hoverTip)return!1;var t=e.triggerElement.innerHTML;if(Ext.isEmpty(t)||"&nbsp;"===t)return!1;var n=t;let i=e.triggerElement.firstChild;if(null!=i&&1===i.nodeType){if("x-grid-row-checker"===i.getAttribute("class"))return!1;t=i.getAttribute("details-id");if(window[t])return e.update(window[t]),!0}e.update(n)}}}))}function configGridListeners(s){s&&!s.configListener&&(s.configListener=!0,s.onTabActivate=function(e){this.operate.refreshData&&this.getStore().reload()},s.refreshSelect=function(){let o=this;o.selectButtons&&Ext.each(o.selectButtons,function(e,t){let n=o.getSelection().length;o.selectCount&&(n=o.selectCount);var i=e.checkSelect;"multiple"===i||"m"===i||1<i?e.setDisabled(!(0<n)):"radio"!==i&&"r"!==i&&"single"!==i&&"s"!==i&&1!==i||e.setDisabled(!(1===n))})},s.refreshDetailsPanel=function(){var n=this;if(n.detailsPanels&&0!==n.detailsPanels.length)for(let t=0;t<n.detailsPanels.length;t++){let e=n.detailsPanels[t];e&&(e.fromWindow||n.operate&&n.operate.autoDetails?e.setRecord(n):e.close())}},s.on("viewready",function(e,t){e.getHeaderContainer().sortOnClick=!1}),s.on("beforedestroy",function(e,t){saveGridColumn(e)}),s.on("columnmove",function(e,t,n,i,o){t.isSubHeader?t.groupHeaderText=t.ownerCt.text:t.groupHeaderText=null}),s.on("headertriggerclick",function(e,t,n,i,o){Ext.isEmpty(t.dataIndex)||s.fromRecycle||(e.sortOnClick=!1,e.triggerColumn=t)}),s.on("headercontextmenu",function(e,t,n,i,o){Ext.isEmpty(t.dataIndex)||s.fromRecycle||(e.sortOnClick=!1,e.onHeaderTriggerClick(t,n,t.triggerEl))}),s.on("headermenucreate",function(e,t,n,i){s.columnHeadMenu=t,configGridHeadMenu(s)}),s.on("headerclick",function(e,t,n,i,o){Ext.isEmpty(t.dataIndex)||(e.sortOnClick=!1,showColumnSearchMenu(t)||e.onHeaderTriggerClick(t,n,t.triggerEl))}),s.on("sortchange",function(e,t,n,i){Ext.isEmpty(t.dataIndex)||(t.sortDirection=n,refreshColumnStyle(t))}),s.on("columnresize",function(e,t,n,i){e.sortOnClick=!1}),s.on("columnschanged",function(e,t){e.sortOnClick=!1}),s.on("cellcontextmenu",function(e,t,n,i,o,r,l,a){Ext.isEmpty(l.position.column.dataIndex)||s.fromRecycle||Ext.isObject(s.contextMenu)&&0<s.contextMenu.items.length&&(s.contextMenu.cellIndex=n,s.contextMenu.record=i,s.contextMenu.rowIndex=r,s.contextMenu.cellTd=t,s.contextMenu.tr=o,s.contextMenu.cellContext=l.position,s.contextMenu.on("show",function(e,t){var n;e.cellTd&&(n=toColor(getExt("front-color-dark").value),$(e.cellTd).css("background",n))}),s.contextMenu.on("hide",function(e,t){e.cellTd&&$(e.cellTd).css("background","transparent")}),e.getSelectionModel().select(i),e.fireEvent("selectionchange",e,i,a),fireMenuEvent(s.contextMenu,"onBeforeShow"),s.contextMenu.showAt(l.getXY()))}),s.getStore().on("endupdate",function(e){try{if(!s.getStore())return!0;if(s.getStore().holdUpdate)return!0;let n=s.getStore().getUpdatedRecords();Ext.each(s.updateButtons,function(e,t){e.setDisabled(0===n.length)}),s.operate&&s.operate.autoUpdate&&commitStoreUpdate(s.getStore())}catch(e){showException(e,"endupdate")}}),s.on("celldblclick",function(e,t,n,i,o,r,l,a){s.doEdit=!0}),s.on("beforeedit",function(e,t,n){if(!s.updateEnable)return!1;if(!s.doEdit)return!1;if(s.fromRecycle)return!1;if(s.doEdit=!1,!toBool(t.column.editable,!0))return!1;if(t.column.hasListener("beforeedit")&&!t.column.fireEvent("beforeedit",t))return!1;let i=t.column.field,o=Ext.get(t.cell);return i.labelTitle=t.column.text,Ext.isFunction(i.setValue)&&!toBool(t.column.password,!1)&&(Ext.isObject(t.value)||Ext.isArray(t.value)?i.setValue(JSON.stringify(t.value),t.record):i.setValue(t.value,t.record)),Ext.isFunction(i.showWindow)?i.showWindow(o,function(e){Ext.isEmpty(t.value)&&Ext.isEmpty(e.getValue())||setRecordValue(t.record,t.field,e)}):(t.column.editMenu||(t.column.editMenu=Ext.create("Ext.menu.Menu",{modal:!0,layout:"fit",showSeparator:!1,items:[{xtype:"panel",layout:"fit",width:o.getWidth(),height:o.getHeight(),style:{background:"#ffffff",borderWidth:1,borderColor:"#ffffff",color:"#eeeee"},border:0,items:[i]}],listeners:{show:function(n,e){let t=n.items.get(0).items.get(0);t.focus();try{new Ext.util.KeyMap({target:n.getEl(),key:13,fn:function(e,t){n.hide()},scope:this})}catch(e){console.error(e)}},beforehide:function(t,e){let n=t.items.get(0).items.get(0);if(n.isValid())return!0;{let e=n.getErrors();return 0===e.length&&(e=[n.invalidText]),Ext.isEmpty(e[0])&&(e[0]="数据错误！"),toast(e[0]),shakeComment(t,function(){t.holdShow=!1}),!(t.holdShow=!0)}},hide:function(t,e){if(t.context){let e=t.items.get(0).items.get(0);e&&((Ext.isEmpty(t.context.value)||toBool(t.context.column.password,!1))&&Ext.isEmpty(e.getValue())||(setRecordValue(t.context.record,t.context.field,e),e.setValue(null)))}}}})),t.column.editMenu.setWidth(t.column.getWidth()),(t.column.editMenu.context=t).column.editMenu.showBy(o,"tl")),!1}),s.on("selectionchange",function(e,t,n){try{s.refreshSelect();let e=s.child("#pagingToolBar");e&&e.updateInfo()}catch(e){showException(e,"按钮选中检测！[selectionchange]")}}))}function configGridLayout(n){return new Ext.Promise(function(e,t){n&&(n.setLoading("初始化配置中……"),restoreGridOperate(n).then(function(){restoreGridColumn(n).then(function(){e(!0)})}))})}function configGridHeadMenu(n){if(toBool(n.columnContextMenu,!0)&&n.columnHeadMenu&&(n.columnMenu||(n.columnMenu={}),n.columnMenu)){let i=n.columnHeadMenu;i.on("beforeshow",function(t){if(hasColumnField(i.activeHeader)||(t.activeHeader.batchUpdate=!1,t.activeHeader.operation=!1,t.activeHeader.searchLink=!1,t.activeHeader.batchRandom=!1),(isFilesColumn(t.activeHeader)||isFileColumn(t.activeHeader)||isLinkColumn(i.activeHeader)||isMapColumn(i.activeHeader)||isTargetColumn(i.activeHeader)||isPCAColumn(i.activeHeader))&&(t.activeHeader.batchRandom=!1),isContentColumn(t.activeHeader)&&(t.activeHeader.searchLink=!1),!t.configHeadMenu){t.configHeadMenu=!0;let e=[];toBool(n.columnMenu.lookField,!0)&&e.push({text:"查看字段",iconCls:"extIcon extField",onBeforeShow:function(){toBool(i.activeHeader.lookField,!0)?this.show():this.hide()},handler:function(){Ext.Msg.alert("查看字段",i.activeHeader.dataIndex)}}),e.push({text:"清除无效数据",iconCls:"extIcon extClear grayColor",onBeforeShow:function(){toBool(i.activeHeader.batchClear,!0)?this.show():this.hide()},handler:function(){var e={title:"清除无效数据",icon:Ext.Msg.QUESTION,message:"将清除属性【"+i.activeHeader.text+"】在【当前当前条件】下为空的所有无效数据！请您确定操作！",buttons:Ext.Msg.YESNO,defaultFocus:"no",callback:function(t,e){if("yes"===t){showWait("正在清除数据中……");let e=getColumnGrid(i.activeHeader);var n=e.getStore().proxy.extraParams,t={entityCode:e.getStore().entity.entityCode,field:i.activeHeader.dataIndex,menu:getStoreMenuText(e.getStore())};server.clearEntity(mergeJson(t,n),function(e,t){hideWait(),e&&getColumnGrid(i.activeHeader).getStore().loadPage(1),showAlert("清理结果",t)})}}};Ext.Msg.confirm(e)}}),n.getStore().entity&&(toBool(n.columnMenu.searchLink,!0)&&e.push({text:"配置搜索链",iconCls:"extIcon extLink",onBeforeShow:function(){!getColumnGrid(i.activeHeader).fromRecycle&&toBool(i.activeHeader.searchLink,!0)?this.show():this.hide()},handler:function(){configColumnSearchLink(i.activeHeader)}}),toBool(n.columnMenu.operation,!0)&&e.push({text:"计算数据",iconCls:"extIcon extMath",onBeforeShow:function(){!getColumnGrid(i.activeHeader).fromRecycle&&toBool(i.activeHeader.operation,!1)?this.show():this.hide()},menu:[{text:"计算总和",iconCls:"extIcon extMath",handler:function(){showCompute(n,i.activeHeader,"sum")}},{text:"计算平均值",iconCls:"extIcon extMath",handler:function(){showCompute(n,i.activeHeader,"avg")}},{text:"计算最大值",iconCls:"extIcon extMath",handler:function(){showCompute(n,i.activeHeader,"max")}},{text:"计算最小值",iconCls:"extIcon extMath",handler:function(){showCompute(n,i.activeHeader,"min")}}]})),toBool(n.columnMenu.batchUpdate,!0)&&e.push({text:"批量修改数据",iconCls:"extIcon extEdit",onBeforeShow:function(){!getColumnGrid(i.activeHeader).fromRecycle&&toBool(i.activeHeader.editable,!0)&&toBool(i.activeHeader.batchUpdate,!0)?this.show():this.hide()},handler:function(){batchEditColumn(i.activeHeader)}}),toBool(n.columnMenu.batchRandom,!0)&&e.push({text:"批量随机数据",iconCls:"extIcon extRandom",onBeforeShow:function(){!getColumnGrid(i.activeHeader).fromRecycle&&toBool(i.activeHeader.editable,!0)&&toBool(i.activeHeader.batchRandom,!0)?this.show():this.hide()},handler:function(){batchEditColumnRandom(i.activeHeader)}}),toBool(n.columnMenu.cancelSort,!0)&&e.push({text:"取消排序",iconCls:"extIcon extCancelOrder",onBeforeShow:function(){!getColumnGrid(i.activeHeader).fromRecycle&&toBool(i.activeHeader.cancelSort,!0)?this.show():this.hide()},handler:function(){try{let e=n.getStore().getSorters();if(0===e.count())return;e.removeByKey(i.activeHeader.dataIndex),n.getStore().loadPage(1),i.activeHeader.sortDirection=null,refreshColumnStyle(i.activeHeader)}catch(e){showException(e)}}}),t.insert(0,e)}fireMenuEvent(t,"onBeforeShow")})}}function getGridSelModel(){return Ext.create("Ext.grid.selection.SpreadsheetModel",{pruneRemoved:!1,checkboxSelect:!0,hasLockedHeader:!0,cellSelect:!1,rowNumbererHeaderWidth:0,listeners:{focuschange:function(t,e,n,i){if(t.store&&t.store.grid){let e=t.store.grid.child("#pagingToolBar");e&&e.updateInfo()}}}})}function getPageToolBar(r){let l=!1;r.entity&&toBool(r.entity.recycle,!1)&&(l=!0);let e=!1;r.where&&toBool(r.where["^fromRecycle"],!1)&&(e=!0);var t=getStoreMenuText(r);let n=Ext.create("Ext.toolbar.Paging",{store:r,dock:"bottom",itemId:"pagingToolBar",pageSize:r.pageSize,displayInfo:!0,inputItemWidth:70,overflowHandler:"scroller"});var i={xtype:"combo",pageTool:!0,displayField:"text",valueField:"id",editable:!1,width:100,value:r.pageSize,store:getPageDataStore(),listeners:{change:function(e,t,n){if(null!=t&&0!=t){if(!e.getStore().getById(t))return e.totalCount=t,void e.setValue(-1);-1===t?(this.ownerCt.pageSize=r.getTotalCount(),r.pageSize=r.getTotalCount(),Ext.isEmpty(e.totalCount)||(this.ownerCt.pageSize=e.totalCount,r.pageSize=e.totalCount)):(this.ownerCt.pageSize=t,r.pageSize=t),r.loadPage(1)}}}},o={xtype:"button",tooltip:"拷贝数据",subtext:"拷贝数据@"+t,checkSelect:2,iconCls:"extIcon extCopy2 grayColor",handler:function(){var e=r.grid.getSelection();0!==e.length?Ext.Msg.confirm("系统提醒","您确定复制选中的"+e.length+"条数据吗？",function(e,t){"yes"===e&&(showWait("正在复制数据中……"),commitStoreCopy(r.grid.getStore(),r.grid.getSelection()).then(function(e){e&&(r.grid.getSelectionModel().deselectAll(),r.grid.getStore().isGrouped()&&r.grid.getView().getFeature("group").collapseAll(),hideWait())}))}):showAlert("系统提醒","请选择需要复制的数据！")}};let a={xtype:"button",tooltip:"清空数据",subtext:"清空数据@"+t,iconCls:"extIcon extClear grayColor",handler:function(){let n=getStoreMenuText(r.grid.getStore());let e="<div style='line-height: 170%;'>";e+="<b style='color: red;font-size: 18px;'>请您谨慎操作！</b><br/>",n&&(e+="<b style='color: red;font-size: 16px;'>当前页面【"+n+"】</b><br/>"),e+="<b style='font-size: 16px;'>您确定清空当前条件下的所有数据吗？！<br/>当前共"+r.getTotalCount()+"条数据！</b>",l&&(e+="<br/><b style='color: red;font-size: 14px;line-height: 18px;'>此操作将跳过回收站！</b>"),e+="</div>";var t={title:"系统提醒",icon:Ext.Msg.WARNING,message:e,buttons:Ext.Msg.YESNO,defaultFocus:"no",cls:"redAlert",callback:function(e,t){"yes"===e&&system.validOperate("清空【"+n+"】数据",function(){showWait("正在清空数据中……");var e=r.grid.getStore().proxy.extraParams;let t={entityCode:r.entity.entityCode,all:!0};r.grid.getStore().entity.menu&&(t.menu=getStoreMenuText(r.grid.getStore())),server.deleteEntity(mergeJson(t,e),function(e,t){hideWait(),e&&r.loadPage(1),showAlert("系统提醒",t)})})}};Ext.Msg.on("hide",function(){clearTimeout(Ext.Msg.timeout);let e=Ext.Msg.msgButtons.yes;e.setText("是"),e.enable()},this,{single:!0});t=Ext.Msg.show(t);let i=function(e){let t=Ext.Msg.msgButtons.yes;if(e<=0)return t.setText("立即清空"),void t.enable();t.setText(e+"秒后可操作"),t.disable(),Ext.Msg.timeout=setTimeout(function(){i(e-1)},1e3)},o=Ext.Msg.msgButtons.yes;o.disable(),shakeComment(t,function(){let e=5;50<r.getTotalCount()&&(e=15),5e3<r.getTotalCount()&&(e=20),1e4<r.getTotalCount()&&(e=30),i(e)},3e3)}};e&&(a.tooltip="清空回收站");var s={xtype:"button",tooltip:"回收站",iconCls:"extIcon extRecycle grayColor",handler:function(){showRecycleGrid(this,r)}},c={xtype:"button",toolType:"searchBtn",tooltip:"搜索数据",iconCls:"extIcon extSearch grayColor",handler:function(){showColumnSearchWin(this,r.grid)}},d={xtype:"button",toolType:"sortBtn",tooltip:"排序数据",iconCls:"extIcon extSort grayColor",handler:function(){showColumnSortWin(this,r.grid)}},t={xtype:"button",toolType:"timerBtn",tooltip:"定时刷新",iconCls:"extIcon extAlarm grayColor",handler:function(){showTimerRefreshGrid(this,r.grid)}};n.insert(0,i),n.insert(0,{xtype:"label",text:"每页",margin:"0 10 0 10"});i=n.child("#refresh");let u=n.items.indexOf(i);return n.insert(++u,t),n.insert(++u,"-"),n.insert(++u,c),n.insert(++u,d),e&&(d={xtype:"button",tooltip:"还原数据",checkSelect:2,iconCls:"extIcon extReback grayColor",handler:function(){rebackGridData(r.grid)}},n.insert(++u,"-"),n.insert(++u,d)),n.insert(++u,"-"),e||n.insert(++u,o),n.insert(++u,a),!e&&l&&(n.insert(++u,"-"),n.insert(++u,s)),n}function deleteGridData(o){return new Ext.Promise(function(t,e){if(o.getStore().entity)if(0!==o.getSelection().length){var i=o.getSelection().length;let n=function(){showWait("正在删除数据中……"),commitStoreDelete(o.getStore(),o.getSelection()).then(function(e){e&&(o.getSelectionModel().deselectAll(),o.getStore().isGrouped()&&o.getView().getFeature("group").collapseAll(),hideWait()),t(e)})};o.operate&&o.operate.alertDelete?(i={title:"系统提醒",icon:Ext.Msg.QUESTION,message:"您确定删除选中的"+i+"条数据吗？",buttons:Ext.Msg.YESNO,defaultFocus:"no",callback:function(e,t){"yes"===e&&n()}},Ext.Msg.show(i)):n()}else toast("请您先选择需要删除的数据！");else Ext.Msg.alert("系统提醒","删除失败！Grid的DataStore未绑定Entity!")})}function rebackGridData(i){return new Ext.Promise(function(n,e){if(i.getStore().entity)if(0!==i.getSelection().length){var t=i.getSelection().length;t={title:"系统提醒",icon:Ext.Msg.QUESTION,message:"您确定还原选中的"+t+"条数据吗？",buttons:Ext.Msg.YESNO,defaultFocus:"no",callback:function(e,t){"yes"===e&&(showWait("正在还原数据中……"),commitStoreReback(i.getStore(),i.getSelection()).then(function(e,t){e&&(i.getSelectionModel().deselectAll(),i.getStore().isGrouped()&&i.getView().getFeature("group").collapseAll(),hideWait(),Ext.Msg.alert("系统提醒","还原成功！")),n(e)}))}};Ext.Msg.show(t)}else toast("请您先选择需要还原的数据！");else Ext.Msg.alert("系统提醒","还原失败！Grid的DataStore未绑定Entity!")})}function updateGridData(i){return new Ext.Promise(function(n,e){i.getStore().entity?0!==i.getStore().getUpdatedRecords().length?i.operate&&i.operate.alertUpdate?Ext.Msg.confirm("系统提醒","您确定提交被修改的数据吗？",function(e,t){"yes"===e&&(showWait("正在修改数据中……"),commitStoreUpdate(i.getStore()).then(function(e){n(e),e&&hideWait()}))}):(showWait("正在修改数据中……"),commitStoreUpdate(i.getStore()).then(function(e){n(e),e&&hideWait()})):toast("当前暂无数据被修改！"):Ext.Msg.alert("系统提醒","修改失败！Grid的DataStore未绑定Entity!")})}function saveGridColumn(r){if(!Ext.isEmpty(r.code))return new Ext.Promise(function(n,t){try{let o={};Ext.each(r.getColumns(),function(i,e){if(!Ext.isEmpty(i.dataIndex)&&(system.isSuperRole()||i.hideable||!i.hidden)){let e={column:!0};e.width=i.width,e.hidden=i.isHidden(),e.locked=i.isLocked(),e.text=i.configText,e.dataIndex=i.dataIndex,e.groupHeaderText=i.groupHeaderText,r.getStore().entity&&(e.entityCode=r.getStore().entityCode);let t=r.getStore().getSorters().getByKey(i.dataIndex);t&&(e.sortDirection=t.getDirection()),e.searchLink=i.searchLink,e.index=i.getIndex();let n=i.renderer.toString();n="function "+n.substring(n.indexOf("(")),e.renderer=n,e.rendererFunction=i.rendererFunction,o[i.code]=e}});var i={pageSize:r.getStore().pageSize,column:!1};o.PageTool=i;let e={};r.getStore().entity&&r.getStore().entity.menu&&(e.menuId=r.getStore().entity.menu.id,toBool(r.tabPanelList,!1)&&(e.entityCode=r.getStore().entity.entityCode)),server.saveExtConfig(r.code,"GridColumn",Ext.encode(o),function(e,t){n(e)},e)}catch(e){t(e)}})}function restoreGridOperate(i){return new Ext.Promise(function(n,t){try{if(Ext.isEmpty(i.code))return void t("Grid编号[code]不可为空！");server.showExtConfig(i.code,"GridOperate",function(e,t){e?i.operate=Ext.decode(t):Ext.isEmpty(i.operate)&&(i.operate={alertDelete:!0,alertUpdate:!0,autoUpdate:!1,autoDetails:!0,hoverTip:!1,refreshData:!1}),n()})}catch(e){t(e)}})}function restoreGridColumn(f){return new Ext.Promise(function(h,t){try{if(Ext.isEmpty(f.code))return void t("Grid编号[code]不可为空！");server.showExtConfig(f.code,"GridColumn",function(e,t){let n={};e&&(n=Ext.decode(t));let i=[],o={},r=[];var l,a,s=f.getColumns();for(let e=0;e<s.length;e++){let t=s[e];if(!Ext.isEmpty(t.dataIndex)&&(!toBool(f.power,!0)||t.hideable||!t.hidden)){let e=t.cloneConfig();if(e.groupHeaderText=t.groupHeaderText,n.hasOwnProperty(t.code)){var c,d=n[t.code];for(c in d)"renderer"!==c&&"rendererFunction"!==c&&(e[c]=d[c])}e.sortDirection&&r.push({property:e.dataIndex,direction:e.sortDirection}),Ext.isEmpty(e.groupHeaderText)||(l=e.groupHeaderText,o.hasOwnProperty(l)||(o[l]=[]),o[l].push(i.length)),i.push(e)}}let u=[];for(a in o){var m=o[a];if(!(m.length<2)){let t=999999,n=[];for(let e=0;e<m.length;e++){var g=m[e];t=Math.min(t,g);g=i[g];n.push(g)}n.sort(function(e,t){return e.index-t.index}),i[t]={index:t,text:a,menuDisabled:!0,columns:n},u=u.concat(n)}}for(let e=0;e<u.length;e++)i=Ext.Array.remove(i,u[e]);if(i.sort(function(e,t){return e.index-t.index}),n.hasOwnProperty("PageTool")){t=n.PageTool;f.getStore().pageSize=t.pageSize;let e=f.down("combo[pageTool=true]");e&&e.setValue(t.pageSize)}f.getStore().sort(r),f.reconfigure(i),h()})}catch(e){t(e)}})}function builderDetailsGrid(){return Ext.create("Ext.grid.Panel",{border:0,scrollable:"y",region:"center",store:Ext.create("Ext.data.Store",{groupField:"groupHeaderText",autoLoad:!1,fields:[]}),hideHeaders:!0,deferRowRender:!1,superGrid:null,features:[{ftype:"grouping",collapsible:!1,hideGroupedHeader:!0,expandTip:null,collapseTip:null,groupHeaderTpl:["<b>{name:this.formatName}</b>",{formatName:function(e){return e.toString().startsWith("BASE")?"基本属性":e}}]}],setRecord:function(e,i){var o=(this.superGrid=e).getColumns();let r=[],l="BASE-"+(new Date).getTime();for(let n=0;n<o.length;n++){let t=o[n];if(!Ext.isEmpty(t.dataIndex)&&toBool(t.hideable,!0)){let e={text:t.configText,value:i.get(t.dataIndex),dataIndex:t.dataIndex,groupHeaderText:t.groupHeaderText,renderer:t.renderer,index:t.getIndex(),record:i};e.groupHeaderText?l="BASE-"+n+"-"+(new Date).getTime():e.groupHeaderText=l,r.push(e)}}r.sort(function(e,t){return e.index-t.index}),this.getStore().loadData(r)},columns:[{header:"名称",dataIndex:"text",align:"right",flex:.3,tdCls:"tdVTop",renderer:function(e,t,n){return Ext.isEmpty(e)?"":(t.style="color:#000000;overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space:normal !important;line-height:20px;word-break:break-word; ","<b>"+e+"：</b>")}},{header:"值",dataIndex:"value",flex:.7,align:"left",renderer:function(t,n,i){try{n.style="overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space:normal !important;line-height:20px;word-break:break-word; ";let e=i.get("renderer");if(Ext.isFunction(e)){var o=e(t,n,i.get("record"),-1,-1,null,null,!0);return Ext.isEmpty(o)?"<font color='#ccc'>无</font>":o}return t}catch(e){return t}}}],tbar:{flex:1,emptyText:"查找属性（轻敲回车键）",margin:"5",xtype:"textfield",doSearch:function(){let e=this.ownerCt,t=e.getStore(),o=0,r=t.getAt(0).get("dataIndex"),l=null,a=this.getValue(),s=null;Ext.isEmpty(a)||t.each(function(e,t){let n=e.get("text").toString(),i=e.get("value");return 0<=n.indexOf(a)?(o=t,r=e.get("dataIndex"),l=n,void(s=e)):!Ext.isEmpty(i)&&0<=i.toString().indexOf(a)?(o=t,r=e.get("dataIndex"),l=n,s=e,!1):void 0}),scrollToColumn(e.superGrid,r,l),e.getSelectionModel().select(o),e.view.focusRow(o)},triggers:{search:{cls:"text-search",handler:function(){this.doSearch()}}},listeners:{render:function(e,t){try{new Ext.util.KeyMap({target:e.getEl(),key:13,fn:function(e,t){this.doSearch()},scope:this})}catch(e){console.error(e)}}}},bbar:{xtype:"label",style:{background:"#ffffff"},text:"小技巧：双击属性可快速定位左侧表格对应的列！",padding:"10"},viewConfig:{enableTextSelection:!0},listeners:{itemdblclick:function(){try{let e=this.getSelectionModel().getSelection();scrollToColumn(this.superGrid,e[0].get("dataIndex"),e[0].get("text"))}catch(e){showException(e,"details:itemdblclick")}}}})}function getDetailsPanel(e,t){let n="";e.getStore().entity.menu&&(n=e.getStore().entity.menu.text),e.detailsPanels||(e.detailsPanels=[]);let i={subtitle:n,layout:"border",border:0,autoScroll:!1,scrollable:!1,closeAction:"hide",dataId:-1,currIsClosed:!1,closeTimer:null,isWindow:t,setRecord:function(t){try{let e=this;if(!e.items)return!1;var n;window.clearTimeout(e.closeTimer),null!=t?1===(n=t.getSelectionModel().getSelection()).length?(e.record=n[0],e.items.get(0).setRecord(t,n[0]),e.show()):e.isVisible()&&!this.isWindow&&(e.closeTimer=setTimeout(function(){e.close(),setTimeout(function(){var e=t.view.getEl().getScrollLeft();t.view.getEl().scrollTo("left",e-1,!1)},100)},80)):e.close()}catch(e){showException(e)}return!0},listeners:{afterrender:function(){this.isWindow&&this.setRecord(e)},collapse:function(e,t){this.down("#close").hide()},beforeexpand:function(e,t){this.down("#close").show()}},items:[builderDetailsGrid()]};t?i.region="center":(i.title="数据详情",i.iconCls="extIcon extDetails",i.collapsed=!1,i.split=!0,i.hidden=!0,i.region="east",i.maxWidth=parseInt((document.body.clientWidth/2).toFixed(0)),i.width=parseInt((.3*document.body.clientWidth).toFixed(0)),i.minWidth=200,i.tools=[{type:"gear",callback:function(){setGrid(this,e)}},{type:"close",itemId:"close",callback:function(){o.collapse()}}]);let o=Ext.create("Ext.panel.Panel",i);return o.fromWindow=t,o.changeListener=e.on({scope:e,selectionchange:function(t,e,n){try{let e=t;t.getStore().grid&&(e=t.getStore().grid),e.refreshDetailsPanel()}catch(e){showException(e)}},destroyable:!0}),e.detailsPanels.push(o),o}function exportGrid(l){if(l.getStore().entity){let e="您确定导出当前条件下的所有数据吗？",r=l.getSelection();0<r.length&&(e="您确定导出选中的"+r.length+"条数据吗？"),Ext.Msg.confirm("系统提醒",e,function(e,t){if("yes"===e){e=l.getStore().proxy.extraParams;let n={};if(l.getStore().entity.menu&&(n.title=l.getStore().entity.menu.text),0<r.length)for(let e=0;e<r.length;e++){let t=r[e];for(let e=0;e<l.getStore().entity.idProperty.length;e++){var i=l.getStore().entity.idProperty[e],o="where['"+i+"#']";n[o]||(n[o]=[]),n[o].push(t.get(i))}}Ext.each(l.getColumns(),function(e,t){e.isHidden()||Ext.isEmpty(e.dataIndex)||(n["column["+t+"].width"]=e.width,n["column["+t+"].text"]=e.configText,n["column["+t+"].groupHeaderText"]=e.groupHeaderText,n["column["+t+"].enum"]=getEnumName(e),n["column["+t+"].dataIndex"]=e.dataIndex,n["column["+t+"].file"]=isFileColumn(e),n["column["+t+"].files"]=isFilesColumn(e))}),showWait("正在导出中……"),server.exportExcel(mergeJson(n,e),function(e,t,n){hideWait(),e?(toast(n),location.href="attach/"+t):Ext.Msg.alert("系统提醒","导出失败！"+n)})}})}else Ext.Msg.alert("系统提醒","导出失败！Grid的DataStore未绑定Entity!")}function setGrid(e,n){let i=Ext.create("Ext.form.Panel",{bodyPadding:5,region:"center",autoScroll:!0,viewModel:{data:n.operate},defaults:{labelWidth:4*getNumberValue(fontSize)+8},items:[{xtype:"checkboxfield",fieldLabel:"删除提醒",labelAlign:"right",name:"alertDelete",columnWidth:1,bind:"{alertDelete}",uncheckedValue:!1,boxLabel:"删除数据时，系统会弹出确认删除框，避免误操作删除！"},{xtype:"checkboxfield",fieldLabel:"修改提醒",labelAlign:"right",columnWidth:1,name:"alertUpdate",bind:"{alertUpdate}",hidden:!n.updateEnable,uncheckedValue:!1,boxLabel:"修改数据时，系统会弹出确认修改框，避免误操作修改！"},{xtype:"checkboxfield",fieldLabel:"自动提交",labelAlign:"right",columnWidth:1,name:"autoUpdate",bind:"{autoUpdate}",hidden:!n.updateEnable,uncheckedValue:!1,boxLabel:"双击编辑修改数据后，系统自动提交被修改的数据！"},{xtype:"checkboxfield",fieldLabel:"弹出详情",labelAlign:"right",columnWidth:1,name:"autoDetails",bind:"{autoDetails}",uncheckedValue:!1,boxLabel:"点击数据时，右侧自动弹出此数据的详情窗体！"},{xtype:"checkboxfield",fieldLabel:"悬浮阅览",labelAlign:"right",columnWidth:1,name:"hoverTip",bind:"{hoverTip}",uncheckedValue:!1,boxLabel:"当鼠标悬浮在数据超过2秒后，会在鼠标右下方弹出此数据的阅览！"},{xtype:"checkboxfield",fieldLabel:"数据刷新",labelAlign:"right",columnWidth:1,name:"refreshData",bind:"{refreshData}",uncheckedValue:!1,boxLabel:"离开此标签页后，再次返回此标签页时将刷新当前标签页的列表数据！"}]}),t="操作设置";n.getStore().entity&&n.getStore().entity.menu&&(t=getStoreMenuText(n.getStore())+"-"+t);var o=parseInt((.3*document.body.clientWidth).toFixed(0)),r=parseInt((.4*document.body.clientHeight).toFixed(0));let l=Ext.create("Ext.window.Window",{title:t,iconCls:"extIcon extSet",height:r,width:o,minHeight:370,minWidth:300,layout:"border",resizable:!1,animateTarget:e,items:[i],modal:!0,constrain:!0,buttons:["->",{text:"保存配置",iconCls:"extIcon extSave whiteColor",handler:function(){showWait("正在保存中…"),server.saveExtConfig(n.code,"GridOperate",Ext.encode(i.getForm().getValues()),function(e,t){hideWait(),e?(n.operate=i.getForm().getValues(),toast("操作设置成功！"),l.close()):Ext.Msg.alert("系统提醒",t)})}},{text:"取消",iconCls:"extIcon extClose",handler:function(){l.close()}}]});l.show()}function showDetailsWindow(obj,title,entity,record){server.showColumns(entity.entityCode,function(success,value,message){if(success){let columnInfos=Ext.decode(value),data=[],lastGroupNon=1;for(var key in columnInfos)if(columnInfos.hasOwnProperty(key)){let column=columnInfos[key];if(!Ext.isEmpty(column.dataIndex)){let d={value:record.get(column.dataIndex),groupHeaderText:column.groupHeaderText,record:record};for(var c in column)column.hasOwnProperty(c)&&(d[c]=column[c]);d.groupHeaderText?lastGroupNon++:d.groupHeaderText=lastGroupNon,data.push(d)}}data.sort(function(e,t){return e.index-t.index});let detailsStore=Ext.create("Ext.data.Store",{autoLoad:!1,groupField:"groupHeaderText",fields:[]});detailsStore.loadData(data),detailsStore.sort("index","ASC");let detailsGrid=Ext.create("Ext.grid.Panel",{border:0,scrollable:"y",region:"center",store:detailsStore,hideHeaders:!0,features:[{ftype:"grouping",collapsible:!1,hideGroupedHeader:!0,expandTip:null,collapseTip:null,groupHeaderTpl:["<b>{name:this.formatName}</b>",{formatName:function(e){return Ext.isNumeric(e)?"基本属性":e}}]}],columns:[{header:"名称",power:!1,dataIndex:"text",flex:.3,tdCls:"tdVTop",align:"right",renderer:function(e,t,n){return t.style="overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space:normal !important;line-height:20px;word-break:break-word; ","<b>"+e+"：</b>"}},{header:"值",dataIndex:"value",power:!1,flex:.7,align:"left",renderer:function(val,m,r){try{m.style="overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space:normal !important;line-height:20px;word-break:break-word; ";let fun=null,rendererFunction=r.get("rendererFunction");if(rendererFunction)fun=eval(rendererFunction);else{let renderer=r.get("renderer");fun=loadFunction(renderer)}return Ext.isEmpty(fun)||(val=fun(val,m,r.get("record"),-1,-1,null,null,!0)),Ext.isEmpty(val)||"null"===val?"<font color='#ccc'>无</font>":val}catch(e){return val}}}],viewConfig:{loadMask:{msg:"正在为您在加载数据…"},enableTextSelection:!0}}),winWidth=parseInt((.3*document.body.clientWidth).toFixed(0)),winHeight=parseInt((.6*document.body.clientHeight).toFixed(0)),win=Ext.create("Ext.window.Window",{title:title,height:winHeight,width:winWidth,minHeight:450,iconCls:"extIcon extDetails",minWidth:400,layout:"border",resizable:!0,constrain:!0,maximizable:!0,animateTarget:obj,listeners:{destroy:function(e,t){},show:function(e){e.focus()}},items:[detailsGrid]});win.show()}else showAlert("系统提醒",message)})}function hasSearchColumn(e){let n=!1;return Ext.each(e.getColumns(),function(e,t){if(!Ext.isEmpty(e.dataIndex)&&e.where&&0<e.where.length)return!(n=!0)}),n}function createDetailsGrid(e,t,n,i){let o=Ext.create("Ext.data.Store",{autoLoad:!1,fields:[],data:e});e={header:"值",dataIndex:"value",flex:.7,align:"left",renderer:function(t,n,i){try{n.style="overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space:normal !important;line-height:20px;word-break:break-word; ";let e=i.get("renderer");if(Ext.isFunction(e)){var o=e(t,n,i.get("record"),-1,-1,null,null,!0);return Ext.isEmpty(o)?"<font color='#ccc'>无</font>":o}return t}catch(e){return t}},listeners:{dblclick:function(e,t,n,i,o,r,l){}}},i={region:"center",border:0,columnLines:!0,store:o,viewConfig:{enableTextSelection:!0},updateData:function(e){o.setData(e)},columns:[mergeJson({header:"名称",dataIndex:"name",flex:.3,align:"right",renderer:function(e,t,n){return t.style="color:#000000;overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space:normal !important;line-height:20px;word-break:break-word; ","<b>"+e+"：</b>"},listeners:{dblclick:function(e,t,n,i,o,r,l){}}},n),mergeJson(e,i)]};return Ext.create("Ext.grid.Panel",mergeJson(i,t))}function showRecycleGrid(obj,dataStore){if(dataStore){let title="回收站";dataStore.entity.menu&&(title=dataStore.entity.menu.text+"-回收站");let entityObj=eval("new "+dataStore.entity.entityCode+"()");entityObj.menu={id:$.md5(title),text:title};let where={"^fromRecycle":!0},gridPanel=entityObj.getList(mergeJson(where,dataStore.where)),entityOwner=gridPanel.down("[entityList=true]");entityOwner.code=$.md5(dataStore.entity.entityCode+"回收站");let winWidth=parseInt((.7*document.body.clientWidth).toFixed(0)),winHeight=parseInt((.8*document.body.clientHeight).toFixed(0)),win=Ext.create("Ext.window.Window",{title:title,iconCls:"extIcon extRecycle",layout:"fit",height:winHeight,width:winWidth,minHeight:500,minWidth:600,constrain:!0,resizable:!0,modal:!0,maximizable:!0,animateTarget:obj,maximized:!1,items:[gridPanel]});win.show()}}function showTimerRefreshGrid(n,i){if(!n.timerWin){i.timerConfig||(i.timerConfig={state:0,value:30});let t=Ext.create("Ext.form.FormPanel",{margin:"5",border:0,layout:"column",width:400,scrollable:!0,defaults:{labelWidth:120,margin:"5 5 5 5",labelAlign:"right",emptyText:"请填写"},viewModel:{data:i.timerConfig},items:[{xtype:"combo",name:"state",displayField:"text",valueField:"id",fieldLabel:"是否启动",editable:!1,flex:1,columnWidth:1,value:0,allowBlank:!1,bind:"{state}",store:getYesOrNoDataStore()},{xtype:"numberfield",name:"value",bind:"{value}",fieldLabel:"时间间隔（秒）",columnWidth:1,minValue:1,value:30,decimalPrecision:0,allowBlank:!1}]});n.timerWin=Ext.create("Ext.window.Window",{title:"定时刷新数据",layout:"fit",constrain:!0,iconCls:"extIcon extAlarm",resizable:!0,minHeight:200,minWidth:400,height:200,animateTarget:n,items:[t],listeners:{close:function(e,t){n.timerWin=null}},buttons:[{text:"确定",iconCls:"extIcon extOk",handler:function(){let e=t.getForm();e.isValid()&&(i.timerConfig=t.getValues(),i.timerRefresh=function(){i.timerTimeout&&clearTimeout(i.timerTimeout);let t=i.child("#pagingToolBar");if(t){let e=t.down("button[toolType=timerBtn]");e&&(1===parseInt(i.timerConfig.state)?e.setIconCls("extIcon extTimer redColor"):e.setIconCls("extIcon extTimer grayColor"))}0!==parseInt(i.timerConfig.state)&&(i.timerTimeout=setTimeout(function(){i.getStore().reload(),i.timerRefresh()},1e3*parseInt(i.timerConfig.value)))},i.timerRefresh(),0===parseInt(i.timerConfig.state)?toast("已关闭定时器！"):toast("已启动定时器！"),n.timerWin.close())}}]}),i.ownerCt.add(n.timerWin)}n.timerWin.show()}function isColumnType(e){return"gridcolumn"===e||"gridcolumn"===e.xtype}function getColumnFieldType(e){return Ext.isObject(e.field)?e.field.xtype:e.field}function getColumnGrid(e){return e.grid||(e.grid=e.up("treepanel,grid")),e.grid.ownerGrid||null}function configColumnProperty(e){try{e.configText=e.text,e.toSearchKey=function(e,t){return"where['"+this.getIndex()+t+this.dataIndex+e.compare+"']"},e.searchValue=function(e){this.where||(this.where=[]),this.where.push({compare:"=",value:e}),this.doSearch()},e.clearSearch=function(){var t=this;let n=getColumnGrid(t).getStore().proxy.extraParams;if(t.where)for(let e=0;e<t.where.length;e++){var i=t.toSearchKey(t.where[e],e);n.hasOwnProperty(i)&&delete n[i]}t.where=[],t.searchMenu=null,t.searching=!1,refreshColumnStyle(t)},e.doSearch=function(e){var i=this;let o=getColumnGrid(i).getStore().proxy.extraParams;if(i.where){for(let n=0;n<i.where.length;n++){let e=i.where[n];var r=i.toSearchKey(e,n);let t=e.value;0<=e.compare.indexOf("?")&&(t="%"+e.value+"%"),o[r]=t}toBool(e,!0)&&getColumnGrid(i).getStore().loadPage(1),i.searching=0!==i.where.length,refreshColumnStyle(i)}},e.where&&0<e.where.length&&e.doSearch(!1),e.isSubHeader?e.groupHeaderText=e.ownerCt.text:e.groupHeaderText=null}catch(e){console.error(e)}}function refreshColumnStyle(t){try{if(!Ext.isEmpty(t.dataIndex)){let e=t.sortDirection;e=Ext.isEmpty(e)?"<font size='1'></font>":"ASC"===e?"<font color='red' size='1'>&nbsp;&nbsp;[正序]</font>":"<font color='red' size='1'>&nbsp;&nbsp;[倒序]</font>",Ext.isEmpty(t.sumText)&&(t.sumText="<font size='1'></font>"),t.searching?(t.setText(getSVGIcon("extSearch")+"&nbsp;"+t.configText+t.sumText+e+"&nbsp;"),t.setStyle("color","red")):(t.setText("&nbsp;"+t.configText+t.sumText+e+"&nbsp;"),t.setStyle("color","#444444")),checkColumnSort(getColumnGrid(t))}}catch(e){console.error(e)}}function checkColumnSearch(e){try{let t=!1;Ext.each(e.getColumns(),function(e){if(e.where&&0<e.where.length)return!(t=!0)});let n=e.child("#pagingToolBar");if(n){let e=n.down("button[toolType=searchBtn]");e&&(t?e.setIconCls("extIcon extSearch redColor"):e.setIconCls("extIcon extSearch grayColor"))}}catch(e){console.error(e)}}function checkColumnSort(e){try{var n=0<e.getStore().getSorters().length;let t=e.child("#pagingToolBar");if(t){let e=t.down("button[toolType=sortBtn]");n?e.setIconCls("extIcon extSort redColor"):e.setIconCls("extIcon extSort grayColor")}}catch(e){console.error(e)}}function showColumnSearchMenu(n){try{if(!toBool(getColumnGrid(n).columnSearch,!0))return!1;if(isFilesColumn(n)||isFileColumn(n))return!1;if(!toBool(n.search,!0))return!1;if(toBool(n.encrypt,!1))return!1;if(n.searchMenu||(n.searchMenu=new Ext.menu.Menu({padding:"0 0 0 0",power:!1,showSeparator:!1,style:{background:"#ffffff"},addSearchItem:function(e){var t=this.items.length-1;5<=t||this.insert(t,buildSearchItem(n,e))},doSearch:function(){let i=[];this.items.each(function(t,n){if(t.searchItem){let e=t.toParam();if(!e)return i=null,!1;Ext.isEmpty(e.value)||(e.index=n,i.push(e))}}),i&&(n.clearSearch(),n.where=i,n.doSearch(),this.hide())},items:[{xtype:"panel",layout:"hbox",margin:"2",border:0,items:[{xtype:"button",text:"搜索",flex:1,iconCls:"extIcon extSearch",margin:"0 2 0 0",handler:function(){this.ownerCt.ownerCt.doSearch()}},{xtype:"button",iconCls:"extIcon extPlus fontSize14",width:35,handler:function(){this.ownerCt.ownerCt.addSearchItem()}}]}],listeners:{show:function(n,e){1===n.items.length&&n.addSearchItem();try{new Ext.util.KeyMap({target:n.getEl(),key:13,fn:function(e,t){n.doSearch()},scope:n})}catch(e){console.error(e)}}}})),n.where)for(let t=0;t<n.where.length;t++){let e=n.where[t];Ext.isEmpty(e.index)&&(e.index=t),e.index<n.searchMenu.items.length-1?n.searchMenu.items.getAt(e.index).setParam(e):n.searchMenu.addSearchItem(e)}return n.searchMenu.setWidth(Math.max(n.width,200)),n.searchMenu.showBy(n,"tl-bl?"),!0}catch(e){console.error(e)}return!1}function buildSearchItem(t,n){try{let e=getColumnSimpleEditor(t,!0);return e?(e.flex=1,e.margin="2 2 0 0",e.repeatTriggerClick=!1,e.onClearValue=function(){Ext.isFunction(this.ownerCt.removeSearch)?this.ownerCt.removeSearch():this.ownerCt.destroy()},e.triggers={close:{cls:"text-clear",handler:function(){this.onClearValue()}}},isEnumField(e)?e.editable=!1:e.editable=!0,e.emptyText="请输入条件值",n||(n={compare:"=",value:""},isTextField(e)?n.compare="?":isDateField(e)&&(n.compare=">")),e.value=n.value,e.submitValue=!1,e.name="value",{xtype:"panel",margin:"0",searchItem:!0,border:0,flex:1,region:"center",layout:"hbox",toParam:function(){let t={};return this.items.each(function(e){if(Ext.isFunction(e.getValue)){if(!e.isValid())return shakeComment(e),toast(e.getErrors()[0]),t=null,!1;Ext.isDate(e.getValue())?t[e.getName()]=Ext.Date.format(e.getValue(),e.format):t[e.getName()]=e.getValue()}}),t},setParam:function(t){this.items.each(function(e){Ext.isFunction(e.getValue)&&("compare"===e.getName()?e.setValue(t.compare):e.setValue(t.value))})},items:[{xtype:"combo",name:"compare",value:n.compare,margin:"2 2 0 2",width:35,valueField:"text",editable:!1,hideTrigger:!0,tpl:Ext.create("Ext.XTemplate",'<ul class="x-list-plain"><tpl for=".">','<li role="option" class="x-boundlist-item" style="font-size: 12px;">{desc}</li>',"</tpl></ul>"),listeners:{afterrender:function(e,t){e.getPicker().setMinWidth(100)}},store:getCompareDataStore()},e]}):void 0}catch(e){console.error(e)}return null}function showCompute(e,o,r){try{if(!o)return void Ext.Msg.alert("系统提醒","计算失败!计算列无效！");if(!e.getStore().entity)return void Ext.Msg.alert("系统提醒","计算失败！Grid的DataStore未绑定Entity!");var l=e.getSelection();if(0<l.length){let n=null,i="";for(let t=0;t<l.length;t++){let e=l[t];var a=parseFloat(e.get(o.dataIndex));"sum"===r?(i=o.configText+"总和：",n=n||0,n+=a):"avg"===r?(i=o.configText+"平均值：",n=n||0,n+=a):"min"===r?(i=o.configText+"最小值：",n=n||a,n=Math.min(a,n)):"max"===r&&(i=o.configText+"最大值：",n=n||a,n=Math.max(a,n))}"avg"===r&&(n/=l.length);try{Ext.isFunction(o.renderer)?Ext.Msg.alert("系统提醒","当前选中的数据，"+i+o.renderer(n)):Ext.Msg.alert("系统提醒","当前选中的数据，"+i+n)}catch(e){Ext.Msg.alert("系统提醒","当前选中的数据，"+i+n)}return}var t=e.getStore().proxy.extraParams,n={entityCode:e.getStore().entity.entityCode,field:o.dataIndex,type:r};showWait("正在计算中……"),$.post("entity/compute",mergeJson(n,t),function(t){hideWait();let n="";"sum"===r?n=o.configText+"总和：":"avg"===r?n=o.configText+"平均值：":"min"===r?n=o.configText+"最小值：":"max"===r&&(n=o.configText+"最大值：");try{Ext.isFunction(o.renderer)?Ext.Msg.alert("系统提醒",n+o.renderer(t.data)):Ext.Msg.alert("系统提醒",n+t.data)}catch(e){Ext.Msg.alert("系统提醒",n+t.data)}})}catch(e){console.error(e)}}function getColumnSimpleEditor(t,n){try{let e={};return Ext.isObject(t.field)?e.xtype=t.field.xtype:e.xtype=t.field,Ext.isObject(t.config.field)&&(e=n?copy(t.config.field):t.config.field),n&&(isContentField(t.field)||isHtmlContentField(t.field)||isTargetField(t.field)||isPCAField(t.field))&&(e.xtype="textfield"),Ext.isEmpty(e.xtype)&&(e.xtype="textfield"),e.dataIndex=t.dataIndex,e}catch(e){console.error(e)}return null}function hasColumnField(e){try{return Ext.isObject(e.field)?!0:!Ext.isEmpty(e.field)}catch(e){console.error(e)}return!1}function isDateColumn(e){return!!e&&isDateField(e.field)}function isNumberColumn(e){return!!e&&isNumberField(e.field)}function isComboColumn(e){return!!e&&isComboField(e.field)}function isFileColumn(e){return!!e&&isFileField(e.field)}function isContentColumn(e){return!!e&&(isHtmlContentField(e.field)||isContentField(e.field))}function isFilesColumn(e){return!!e&&isFilesField(e.field)}function isEnumColumn(e){return!!e&&isEnumField(e.field)}function isLinkColumn(e){return!!e&&isLinkField(e.field)}function isMapColumn(e){return!!e&&isMapField(e.field)}function isPCAColumn(e){return!!e&&isPCAField(e.field)}function isTargetColumn(e){return!!e&&isTargetField(e.field)}function getEnumName(e){return isEnumColumn(e)&&Ext.isObject(e.field)?e.field.enumName:null}function getColumn(e,t,n){var i=e.getColumns();for(let e=0;e<i.length;e++){var o=i[e];if(o.dataIndex===t)return n&&o.text,o}return null}function blinkColumn(i){if(!i.blinking){i.blinking=!0;let e=i.getEl().getStyle("color"),t=i.getEl().getStyle("background"),n="#e41f00";0<t.indexOf("linear-gradient")&&(n="linear-gradient(0deg, #e41f00, #fefefe)"),i.setStyle({color:"white",background:n}),setTimeout(function(){i.setStyle({color:e,background:t}),i.blinking=!1},1e3)}}function scrollToColumn(e,t,n){let i=getColumn(e,t,n);blinkColumn(i);let o=i.getLocalX();i.isSubHeader&&(o+=i.ownerCt.getLocalX()),e.view.getEl().scrollTo("left",o,!0)}function batchEditColumn(i){let e=i.batchField;if(!e){if(e=getColumnSimpleEditor(i),!e)return;e.flex=1,e.emptyText="请输入",e=i.batchField=Ext.create(e)}let o=function(n){var e;Ext.isEmpty(n.getValue())||getColumnGrid(i).getStore()&&(getColumnGrid(i).getStore().holdUpdate=!0,0<(e=getColumnGrid(i).getSelectionModel().getSelection()).length?Ext.each(e,function(e,t){setRecordValue(e,i.dataIndex,n,append)}):getColumnGrid(i).getStore().each(function(e,t){setRecordValue(e,i.dataIndex,n,append)}),getColumnGrid(i).getStore().holdUpdate=!1,getColumnGrid(i).getStore().fireEvent("endupdate"))},t="批量修改当前页的【"+i.text+"】数据";0<getColumnGrid(i).getSelection().length&&(t="批量修改选择的"+getColumnGrid(i).getSelection().length+"条【"+i.text+"】数据"),Ext.isFunction(e.setEmptyText)&&e.setEmptyText(t),Ext.isFunction(e.showWindow)?e.showWindow(i,function(e){o(e)},t):(i.batchEditMenu||(i.batchEditMenu=Ext.create("Ext.menu.Menu",{showSeparator:!1,layout:"fit",doUpdate:function(){let e=this.down("button[name='confirm']");e.setText("稍等"),e.setDisabled(!0);let i=this;new Ext.Promise(function(e,t){let n=i.items.get(0).items.get(0);o(n),n.setValue(null),e()}).then(function(){e.setText("确定"),e.setDisabled(!1),i.hide()})},items:[{xtype:"panel",layout:"hbox",style:{background:"#ffffff",borderWidth:1,borderColor:"#ffffff",color:"#eeeee"},border:0,items:[e,{xtype:"button",text:"确定",name:"confirm",width:60,margin:"0 0 0 2",handler:function(){i.batchEditMenu.doUpdate()}}]}],listeners:{show:function(e,t){let n=e.items.get(0).items.get(0);n.focus()},beforehide:function(e,t){let n=e.items.get(0).items.get(0);return n.isValid()||(shakeComment(e),toast(n.getErrors()[0])),n.isValid()}}})),i.batchEditMenu.setWidth(i.getWidth()),i.batchEditMenu.showBy(i,"tl"))}function configColumnSearchLink(t){let e="";t.searchLink&&(e=t.searchLink.checked),system.showMenuColumns(t,e).then(function(e){0<e.columns.length?(t.searchLink=e,toast("配置成功！")):(t.searchLink=null,toast("已清空搜索链！"))})}function showColumnSearchWin(n,a){if(!n.searchWin){let i=getGridColumnStore(a,!0),o=function(e,t){let n=buildSearchItem(getColumn(a,e.get("id"),e.get("text")),t);return n.removeSearch=function(){this.ownerCt.destroy()},{xtype:"panel",flex:1,columnWidth:1,layout:"hbox",margin:"0",border:0,toParam:function(){let e={},t=this.items.get(0),n=t.getStore().findRecord("id",t.getValue(),0,!1,!1,!0);e.text=n.get("text"),e.dataIndex=n.get("id");let i=this.items.get(1);return e=mergeJson(e,i.toParam()),e},items:[{xtype:"combo",region:"west",valueField:"id",displayField:"text",flex:.4,margin:"2 0 0 2",value:e.get("id"),editable:!1,listeners:{change:function(e,t,n,i){let o=this.up("panel");o.remove(o.items.get(1),!0);let r=e.getStore().findRecord("id",t,0,!1,!1,!0),l=buildSearchItem(getColumn(a,r.get("id"),r.get("text")));l.removeSearch=function(){this.ownerCt.destroy()},o.insert(1,l)}},store:i},n]}},e=a.searchItems;e=e||[];let r=Ext.create("Ext.form.FormPanel",{margin:"5",border:0,layout:"column",width:400,scrollable:!0,defaults:{labelWidth:80,margin:"5 5 5 5",labelAlign:"right",emptyText:"请填写"},items:e});Ext.each(a.getColumns(),function(t){if(t.where){var n=i.findRecord("id",t.dataIndex,0,!1,!1,!0);for(let e=0;e<t.where.length;e++)r.add(o(n,t.where[e]))}}),0===r.items.length&&r.add(o(i.getAt(0))),n.searchWin=Ext.create("Ext.window.Window",{title:"搜索数据",layout:"fit",constrain:!0,iconCls:"extIcon extSearch",resizable:!0,minHeight:200,minWidth:400,height:200,animateTarget:n,items:[r],listeners:{close:function(e,t){n.searchWin=null}},buttons:[{text:"添加条件",iconCls:"extIcon extPlus",handler:function(){r.add(o(i.getAt(0)));var e=50+35*r.items.length+55;r.scrollTo(0,e,!1)}},{text:"确定",iconCls:"extIcon extOk",handler:function(){Ext.each(a.getColumns(),function(e){e.clearSearch()});let i=[];r.items.each(function(t){if(!t.toParam){let e={};return e["where['"+t.name+"']"]=t.getValue(),void Ext.apply(a.getStore().proxy.extraParams,e)}let n=t.toParam();if(n&&!Ext.isEmpty(n.value)){let e=getColumn(a,n.dataIndex,n.text);if(!e)return!1;e.where||(e.where=[]),delete n.dataIndex,delete n.text,e.where.push(n),i.push(e)}}),Ext.each(i,function(e){e.doSearch(!1)}),a.getStore().loadPage(1)}}]}),a.ownerCt.add(n.searchWin)}n.searchWin.show()}function showColumnSortWin(r,l){if(!r.sortWin){let n=getGridColumnStore(l),i=function(e,t){return t=t||"ASC",{xtype:"panel",flex:1,columnWidth:1,layout:"hbox",margin:"0",border:0,toParam:function(){let e={},t=this.items.get(0);e.property=t.getValue();let n=this.items.get(1);return e.direction=n.getValue(),e},items:[{xtype:"combo",region:"west",valueField:"id",flex:.4,margin:"2 0 0 2",value:e.get("id"),displayField:"text",editable:!1,store:n},{xtype:"combo",flex:1,valueField:"value",editable:!1,margin:"2 2 0 2",value:t,triggers:{close:{cls:"text-clear",handler:function(){this.ownerCt.destroy()}}},store:Ext.create("Ext.data.Store",{fields:["id","text"],data:[{text:"无",value:"NONE"},{text:"正序",value:"ASC"},{text:"倒序",value:"DESC"}]})}]}},o=Ext.create("Ext.form.FormPanel",{margin:"5",border:0,layout:"column",width:400,scrollable:!0,defaults:{labelWidth:80,margin:"5 5 5 5",labelAlign:"right",emptyText:"请填写"},items:[]});l.getStore().getSorters().each(function(e){var t=n.findRecord("id",e.getProperty(),0,!1,!1,!0);o.add(i(t,e.getDirection()))}),0===o.items.length&&o.add(i(n.getAt(0),"NONE")),r.sortWin=Ext.create("Ext.window.Window",{title:"排序数据",layout:"fit",constrain:!0,iconCls:"extIcon extSort",resizable:!0,minHeight:200,minWidth:400,height:200,animateTarget:r,items:[o],listeners:{close:function(e,t){r.sortWin=null}},buttons:[{text:"添加条件",iconCls:"extIcon extPlus",handler:function(){o.add(i(n.getAt(0)));var e=50+35*o.items.length+55;o.scrollTo(0,e,!1)}},{text:"确定",iconCls:"extIcon extOk",handler:function(){let e=l.getStore().getSorters();e.clear(),Ext.each(l.getColumns(),function(e){e.sortDirection=null,refreshColumnStyle(e)});let n=[];o.items.each(function(e){e=e.toParam();n.push(e);let t=getColumn(l,e.property);t.sortDirection=e.direction,refreshColumnStyle(t)}),0<n.length?l.getStore().sort(n):l.getStore().loadPage(1),checkColumnSort(l)}}]}),l.ownerCt.add(r.sortWin)}r.sortWin.show()}function showMap(d,u,m,g){return new Ext.Promise(function(o,e){let t="";Ext.isEmpty(u)||Ext.isEmpty(m)||0===parseFloat(u)||0===parseFloat(m)||(t=u+","+m);let n=Ext.create("Ext.panel.Panel",{layout:"border",region:"center",border:0}),i=Ext.create("Ext.form.FormPanel",{url:"addData",method:"POST",region:"north",fileUpload:!0,autoScroll:!1,height:50,layout:"column",defaults:{margin:"5 5 5 5"},items:[{name:"map.taskTitle",fieldLabel:"位置搜索",labelWidth:60,labelAlign:"right",id:"txtSearch",columnWidth:1,allowBlank:!1,emptyText:"输入地址",xtype:"textfield"},{xtype:"button",width:100,text:"搜索",handler:function(){let e=i.getForm();e.isValid()&&r()}}],listeners:{render:function(e){try{new Ext.util.KeyMap({target:e.getEl(),key:13,fn:r,scope:Ext.getBody()})}catch(e){console.error(e)}}}}),r=function(){mapFrame.window.searchAddress(Ext.getCmp("txtSearch").getValue())};var l=Ext.create("Ext.panel.Panel",{layout:"column",region:"south",border:0,height:42,defaults:{margin:"5 5 5 5"},items:[{xtype:"textfield",id:"lblAddress",fieldLabel:"选择位置",labelWidth:60,value:g,labelAlign:"right",columnWidth:.8},{xtype:"textfield",id:"lblLngLat",readOnly:!0,width:160,value:t},{xtype:"button",columnWidth:.2,text:"确定",handler:function(){let e=Ext.getCmp("lblLngLat"),t=e.getValue();var n=t.split(",")[0],i=t.split(",")[1];runCallBack(o,{lng:n,lat:i,addr:Ext.getCmp("lblAddress").getValue(),pro:e.province,city:e.city,area:e.area}),c.close()}}]});let a=Ext.create("Ext.panel.Panel",{layout:"border",border:0,items:[i,n,l]});var s=parseInt((.4*document.body.clientWidth).toFixed(0)),l=parseInt((.6*document.body.clientHeight).toFixed(0));let c=Ext.create("Ext.window.Window",{title:"选择位置",height:l,width:s,minHeight:500,minWidth:600,iconCls:"extIcon extMap",layout:"fit",resizable:!0,maximizable:!0,animateTarget:d,constrain:!0,items:[a],modal:!0,listeners:{show:function(){var e=system.formatUrlVersion("base/map/select.html",{mapVersion:getExt("amap-version").value,mapKey:getExt("amap-key").value});n.update("<iframe name='mapFrame'  src='"+e+"' width='100%' height='100%' frameborder='0' scrolling='no' />")},close:function(e){runCallBack(o)}}});c.show(),a.setLoading("正在定位中，请稍后……"),window.onMapLoadDone=function(){Ext.isEmpty(t)?mapFrame.window.startLocation():mapFrame.window.setLngLatAddress(t)},window.closeMapMask=function(){a.setLoading(!1)},window.showMapMask=function(e){e?a.setLoading(e):a.setLoading(!0)},window.alert=function(e){showAlert("系统提醒",e)},window.setMarkCurrPos=function(e,t,n,i,o){Ext.getCmp("lblAddress").setValue(t);let r=Ext.getCmp("lblLngLat");r.setValue(e),r.province=n,r.city=i,r.area=o}})}function showAddressInMap(e,i,o){let t=Ext.create("Ext.panel.Panel",{layout:"border",region:"center",border:0,listeners:{afterrender:function(e,t){var n={lnglat:i,mapVersion:getExt("amap-version").value,mapKey:getExt("amap-key").value,mapTitle:o};e.update("<iframe name='mapFrame'  src='"+system.formatUrlVersion("base/map/show.html",n)+"' width='100%' height='100%' frameborder='0' scrolling='no' />")}}});var n=parseInt((.4*document.body.clientWidth).toFixed(0)),r=parseInt((.6*document.body.clientHeight).toFixed(0));let l=Ext.create("Ext.window.Window",{title:"查看位置",height:r,width:n,minHeight:500,minWidth:600,iconCls:"extIcon extMap",layout:"border",resizable:!0,maximizable:!0,animateTarget:e,constrain:!0,items:[t],modal:!0});l.show(),t.setLoading("正在请求地址信息……"),window.closeMapMask=function(){t.setLoading(!1)}}function showRectangle(s,c,d,u,m){return new Ext.Promise(function(o,e){let t=Ext.create("Ext.panel.Panel",{layout:"border",region:"center",border:0});var n=Ext.create("Ext.form.FormPanel",{method:"POST",region:"north",fileUpload:!0,autoScroll:!0,height:50,layout:"column",defaults:{margin:"5 5 5 5"},items:[{name:"map.taskTitle",fieldLabel:"位置搜索",labelWidth:60,labelAlign:"right",id:"txtSearch",columnWidth:1,emptyText:"输入地址",xtype:"textfield"},{xtype:"button",width:100,text:"搜索",handler:function(){i()}},{xtype:"button",width:100,text:"选取",handler:function(){mapRectangleFrame.window.selectRectangle()}},{xtype:"button",width:100,text:"锚点管理",handler:function(){showMapAnchorPoints(this,mapRectangleFrame)}}],listeners:{render:function(e){try{new Ext.util.KeyMap({target:e.getEl(),key:13,fn:i,scope:Ext.getBody()})}catch(e){console.error(e)}}}});let i=function(){mapRectangleFrame.window.searchAddress(Ext.getCmp("txtSearch").getValue())};var r=Ext.create("Ext.panel.Panel",{layout:"column",region:"south",border:0,height:42,defaults:{margin:"5 5 5 5"},items:[{xtype:"textfield",id:"lblSouthWestLngLat",fieldLabel:"西南角(左下)",labelAlign:"right",readOnly:!0,columnWidth:.35},{xtype:"textfield",id:"lblNorthEastLngLat",fieldLabel:"东北角(右上)",readOnly:!0,columnWidth:.35},{xtype:"textfield",id:"lblRectangleSize",labelWidth:60,fieldLabel:"矩形宽高",readOnly:!0,columnWidth:.3},{xtype:"button",width:100,text:"确定",handler:function(){let e=Ext.getCmp("lblSouthWestLngLat"),t=e.getValue(),n=Ext.getCmp("lblNorthEastLngLat"),i=n.getValue();runCallBack(o,{southWestLngLat:t,southWestLng:t.split(",")[0],southWestLat:t.split(",")[1],northEastLngLat:i,northEastLng:i.split(",")[0],northEastLat:i.split(",")[1],anchors:mapRectangleFrame.pointDataArray}),a.close()}}]});let l=Ext.create("Ext.panel.Panel",{layout:"border",border:0,items:[n,t,r]});n=parseInt((.4*document.body.clientWidth).toFixed(0)),r=parseInt((.6*document.body.clientHeight).toFixed(0));let a=Ext.create("Ext.window.Window",{title:"选择图层位置",height:r,width:n,minHeight:500,minWidth:600,iconCls:"extIcon extMap",layout:"fit",resizable:!0,maximizable:!0,animateTarget:s,constrain:!0,items:[l],modal:!0,listeners:{show:function(){var e=system.formatUrlVersion("base/map/rectangle.html",{mapVersion:getExt("amap-version").value,mapKey:getExt("amap-key").value});t.update("<iframe name='mapRectangleFrame'  src='"+e+"' width='100%' height='100%' frameborder='0' scrolling='no' />")},close:function(e){runCallBack(o)}}});a.show(),window.onMapLoadDone=function(){if(mapRectangleFrame.pointDataArray=m,mapRectangleFrame.window.setImgLayerUrl(u),c&&d&&(l.setLoading(!1),mapRectangleFrame.window.selectRectangle(c,d,u)),mapRectangleFrame.pointDataArray){let t=[];for(let e=0;e<mapRectangleFrame.pointDataArray.length;e++)t.push(mapRectangleFrame.pointDataArray[e].gdPoint);mapRectangleFrame.window.setAnchorPoints(t,!1)}},window.closeMapMask=function(){l.setLoading(!1)},window.showMapMask=function(e){e?l.setLoading(e):l.setLoading(!0)},window.alert=function(e){showAlert("系统提醒",e)},window.setSelectBounds=function(e,t,n){let i=Ext.getCmp("lblSouthWestLngLat");i.setValue(e);let o=Ext.getCmp("lblNorthEastLngLat");o.setValue(t);let r=Ext.getCmp("lblRectangleSize");r.setValue(n.width+"px - "+n.height+"px")}})}function showMapAnchorPoints(e,o){e&&e.blur(),o.pointDataArray||(o.pointDataArray=[]);let r=Ext.create("Ext.data.Store",{autoLoad:!0,data:o.pointDataArray}),t=function(e,n){Ext.Msg.prompt(e,"请输入坐标经纬度(lng,lat)",function(e,t){"ok"===e&&(t=t.toString().replaceAll(" ",""),o&&(n?o.window.AMap.convertFrom([t.split(",")],n,function(e,t){let n=t.locations[0];r.findRecord("gdPoint",n.toString(),0,!1,!1,!0)?toast("坐标已存在！"):(t={gdPoint:n.toString()},r.add(t))}):r.findRecord("gdPoint",t,0,!1,!1,!0)?toast("坐标已存在！"):(t={gdPoint:t},r.add(t))))})},i=Ext.create("Ext.grid.Panel",{selModel:getGridSelModel(),store:r,columnLines:!0,cellTip:!0,columns:[{header:"高德坐标",dataIndex:"gdPoint",align:"center",flex:1,field:{xtype:"textfield"},renderer:renders.normal()}],selType:"cellmodel",tbar:[{xtype:"button",border:1,text:"删除",iconCls:"extIcon extDelete",handler:function(){let n=i.getSelectionModel().getSelection();0===n.length?toast("请您选择需要删除的坐标！"):Ext.Msg.confirm("系统提醒","您确定立即删除选中的坐标吗？",function(e,t){"yes"===e&&(Ext.Array.each(n,function(e){r.remove(e)}),i.getSelectionModel().deselectAll(),toast("删除成功！"))})}},{xtype:"button",border:1,text:"添加高德坐标",iconCls:"extIcon extAdd",handler:function(){t("添加高德坐标")}},{xtype:"button",border:1,text:"添加GPS坐标",iconCls:"extIcon extAdd",handler:function(){t("添加GPS坐标","gps")}}],listeners:{selectionchange:function(){}}}),l=Ext.create("Ext.window.Window",{title:"图层锚点管理",height:300,width:400,minWidth:400,minHeight:300,layout:"fit",resizable:!0,modal:!0,constrain:!0,iconCls:"extIcon extFolder",animateTarget:e,items:[i],buttons:[{text:"确定",iconCls:"extIcon extOk",handler:function(){let n=[],i=[];r.each(function(e,t){e=e.get("gdPoint");n.push(e),i.push({gdPoint:e})}),o&&(o.pointDataArray=i,o.window.setAnchorPoints(n,!0)),l.close()}}],listeners:{close:function(){}}});l.show()}function showImgLayer(l,a,s,c){return new Ext.Promise(function(t,e){let n=Ext.create("Ext.panel.Panel",{layout:"border",region:"center",border:0});var i=parseInt((.4*document.body.clientWidth).toFixed(0)),o=parseInt((.6*document.body.clientHeight).toFixed(0));let r=Ext.create("Ext.window.Window",{title:"查看图层位置",height:o,width:i,minHeight:500,minWidth:600,iconCls:"extIcon extMap",layout:"fit",resizable:!0,maximizable:!0,animateTarget:l,constrain:!0,items:[n],modal:!0,listeners:{show:function(){var e=system.formatUrlVersion("base/map/showRectangle.html",{mapVersion:getExt("amap-version").value,mapKey:getExt("amap-key").value});n.update("<iframe name='mapFrame'  src='"+e+"' width='100%' height='100%' frameborder='0' scrolling='no' />")},close:function(e){t.called||(t.called=!0,t())}}});r.show(),window.onMapLoadDone=function(){mapFrame.window.showImgLayerInMap(a,s,c)},window.alert=function(e){showAlert("系统提醒",e)}})}function copyMenu(e){let i=[];return e.items.each(function(e,t){let n={icon:e.icon,text:e.text,handler:e.handler};null!=e.getMenu()&&(n.menu=copyMenu(e.getMenu())),i.push(n)}),i}function fireMenuEvent(e,n){e&&e.items.each(function(e,t){e.hasOwnProperty(n)&&Ext.isFunction(e[n])&&e[n](),Ext.isFunction(e.getMenu)&&fireMenuEvent(e.getMenu(),n)})}Ext.override(Ext.form.Basic,{submit:function(e){let t;return(e=e||{}).submitEmptyText=!1,t=e.standardSubmit||this.standardSubmit?"standardsubmit":this.api?"directsubmit":"submit",this.doAction(t,e)},isValid:function(){try{var e;Ext.suspendLayouts();let n="",i=0,o="请正确填写数据！";e=this.getFields().filterBy(function(e){var t=!e.validate();return t&&0===i&&(n=e.getFieldLabel(),o=e.getErrors()[0],i++),t}),Ext.resumeLayouts(!0);var t=e.length<1;return t||(Ext.isEmpty(n)?toast("请将数据填写完整！"):Ext.isEmpty(o)?toast("【"+n+"】错误！"):toast("【"+n+"】错误："+o),shakeComment(this.owner.ownerCt)),t}catch(e){showException(e)}}}),Ext.override(Ext.form.field.Date,{parseDate:function(e){if(!e||Ext.isDate(e))return e;var t=guessDateFormat(e);t&&(this.format=t);let n=this,i=n.safeParse(e,n.format),o=n.altFormats,r=n.altFormatsArray,l=0,a;if(!i&&o)for(a=(r=r||o.split("|")).length;l<a&&!i;++l)i=n.safeParse(e,r[l]);return i},initComponent:Ext.Function.createSequence(Ext.form.field.Date.prototype.initComponent,function(){isSystem()&&(this.format||(this.format=system.dateFormat),"y-m-d"===this.format&&(this.format=system.dateFormat),this.pickerAlign="tl-tr?")})}),Ext.override(Ext.form.field.Time,{initComponent:Ext.Function.createSequence(Ext.form.field.Time.prototype.initComponent,function(){this.invalidText="无效的时间格式!"})}),Ext.override(Ext.form.field.Text,{initComponent:Ext.Function.createSequence(Ext.form.field.Text.prototype.initComponent,function(){let t=this;"password"===t.inputType&&t.setTriggers({eayOpen:{cls:"extIcon extEye editColor",hidden:!0,handler:function(){t.up("menu")&&(t.up("menu").holdShow=!0),this.getTrigger("eayOpen").hide(),this.getTrigger("eayClose").show();let e=document.getElementById(this.getInputId());e.blur(),e.setAttribute("type","password"),setTimeout(function(){inputFocusEnd(e),t.up("menu")&&(t.up("menu").holdShow=!1)},100)}},eayClose:{cls:"extIcon extEye",handler:function(){t.up("menu")&&(t.up("menu").holdShow=!0),this.getTrigger("eayOpen").show(),this.getTrigger("eayClose").hide();let e=document.getElementById(this.getInputId());e.blur(),e.setAttribute("type","text"),setTimeout(function(){inputFocusEnd(e),t.up("menu")&&(t.up("menu").holdShow=!1)},100)}}})})}),Ext.form.FormPanel.prototype.setFieldValue=function(e,t){this.getForm().findField(e).setValue(t)},Ext.form.FormPanel.prototype.getFieldValue=function(e){return this.getForm().findField(e).getValue()},Ext.form.FormPanel.prototype.getField=function(e){return this.getForm().findField(e)},Ext.form.field.Base.prototype.blur=function(){try{this.inputEl&&this.inputEl.blur()}catch(e){console.error(e)}},Ext.form.FormPanel.prototype.submitForm=function(o,r,l){let a=this;return r=r||{},l=l||"正在提交中……",a.submiting?new Ext.Promise(function(e,t){t({success:!1,message:"数据正在提交中，不可重复提交！"})}):new Ext.Promise(function(n,i){let e={submitEmptyText:!1,waitMsg:l,params:r,success:function(e,t){a.submiting=!1,Ext.Msg.alert("系统提醒",t.result.message,function(e){"ok"===e&&n(t.result)})},failure:function(e,t){a.submiting=!1,Ext.Msg.alert("系统提醒",t.result.message),i(t.result)}};o&&(e.params.entityCode=o.entityCode,o.menu&&(e.params.menu=getStoreMenuText({entity:o})));let t=a.getForm();t.isValid()?(a.submiting=!0,t.submit(e)):(a.submiting=!1,i({success:!1,message:"表单填写不完整！"}))})},Ext.form.FormPanel.prototype.saveCache=function(e){Ext.isEmpty(e)&&(e=this.cacheKey);let n={};this.getForm().getFields().each(function(e,t){Ext.isDate(e.getValue())?n[e.getName()]=Ext.Date.format(e.getValue(),e.format):n[e.getName()]=e.getValue()});e={configKey:e,configType:"FormPanelCache",configValue:Ext.encode(n)};showWait("暂存数据中……"),$.post("ext/config/saveExtConfig",e,function(e){hideWait(),e.success?toast("暂存成功！"):showAlert("系统提醒",e.message)})},Ext.form.FormPanel.prototype.restoreCache=function(e){Ext.isEmpty(e)&&(e=this.cacheKey);let t=this;$.post("ext/config/showExtConfig",{configKey:e,configType:"FormPanelCache"},function(e){if(e.success){let n=Ext.decode(e.data.configValue);t.getForm().getFields().each(function(e,t){n.hasOwnProperty(e.getName())&&e.setValue(n[e.getName()])})}})},Ext.form.FormPanel.prototype.deleteCache=function(e){Ext.isEmpty(e)&&(e=this.cacheKey),$.post("ext/config/deleteExtConfig",{configKey:e,configType:"FormPanelCache"},function(e){})},Ext.override(Ext.grid.Panel,{initComponent:Ext.Function.createSequence(Ext.grid.Panel.prototype.initComponent,onGridInitComponent)}),Ext.override(Ext.tree.Panel,{initComponent:Ext.Function.createSequence(Ext.tree.Panel.prototype.initComponent,onGridInitComponent)}),Ext.override(Ext.grid.Panel,{afterRender:Ext.Function.createSequence(Ext.grid.Panel.prototype.afterRender,onGridAfterRender)}),Ext.override(Ext.tree.Panel,{afterRender:Ext.Function.createSequence(Ext.tree.Panel.prototype.afterRender,onGridAfterRender)}),Ext.override(Ext.grid.column.Column,{afterRender:Ext.Function.createSequence(Ext.grid.column.Column.prototype.afterRender,function(){try{let me=this;me.code=getPowerCode(me),me.renderer||(me.renderer=renders.normal()),me.rendererFunction&&(me.renderer=eval(me.rendererFunction)),configColumnProperty(me)}catch(e){console.error(e)}})}),Ext.override(Ext.menu.Menu,{hide:function(){if(!Ext.isEmpty(system)){var e=this;if((e.powerMenu||!power.menuShowing)&&!e.holdShow)return e.pendingShow&&(e.pendingShow=!1),e.rendered&&!e.isVisible()||e.hasListeners.beforehide&&!1===e.fireEvent("beforehide",e)&&!e.hierarchicallyHidden||(e.getInherited().hidden=e.hidden=!0,e.fireHierarchyEvent("beforehide"),e.rendered&&e.onHide.apply(e,arguments)),e}}}),Ext.define("Fast.ext.EnumComboBox",{alias:["widget.enumcombobox","widget.enumcombo"],extend:"Ext.form.field.ComboBox",enumName:"NONE",enumValue:"id",enumText:"text",exclude:[],include:[],params:{},firstData:null,lastData:null,editable:!1,useCache:!0,initComponent:function(){let t=this;t.displayField=t.enumText,t.valueField=t.enumValue,t.store=getEnumDataStore(t.enumName,t.firstData,t.lastData,t.params,t.useCache),t.exclude||(t.exclude=[]),t.include||(t.include=[]),t.store.filterBy(function(e){return!t.exclude.exists(e.get(t.enumValue))&&(!(0<t.include.length)||!!t.include.exists(e.get(t.enumValue)))}),t.callParent()}}),Ext.define("Fast.ext.FastFile",{extend:"Ext.form.field.Text",alias:["widget.fastfile","widget.fastfilefield"],fileModules:[],editable:!1,getMenu:function(){return this.up("menu")},onFileChange:function(e){},listeners:{change:function(e,t,n,i){Ext.isEmpty(t)?(e.getTrigger("help").hide(),e.getTrigger("close").hide()):(e.getTrigger("help").show(),e.getTrigger("close").show())},afterrender:function(e){let t=this;this.editable||e.inputEl.on("click",function(){t.selectData()})}},initComponent:function(){let t="";for(let e=0;e<this.fileModules.length;e++){var n=this.fileModules[e];t=t+"或"+n.tipMsg}this.emptyText="请上传"+t.substring(1),this.editable=!1,this.callParent(arguments)},triggers:{help:{cls:"extIcon extEye",hidden:!0,handler:function(){let e=this;if(1===e.fileModules.length){if("images"===e.fileModules[0].type)return e.getMenu()&&(e.getMenu().holdShow=!0),e.blur(),void showImage(e,e.getValue(),function(){e.getMenu()&&(e.getMenu().holdShow=!1)},!0);if("videos"===e.fileModules[0].type)return void showVideo(this,e.getValue())}if(e.fileObj){var t=e.fileObj.name;if(files.image().reg.test(t))return void showImage(e,e.getValue(),null,!0);if(files.mp4().reg.test(t))return void showVideo(this,e.getValue());if(files.pdf().reg.test(t)||files.word().reg.test(t)||files.excel().reg.test(t)||files.ppt().reg.test(t))return void openUrl("https://view.officeapps.live.com/op/view.aspx?src="+e.getValue())}location.href=e.getValue()}},search:{cls:"extIcon extUpload",handler:function(){this.selectData()}},close:{cls:"text-clear",hidden:!0,handler:function(){this.clearData()}}},selectData:function(){let t=this;t.getMenu()&&(t.getMenu().holdShow=!0),uploadFile(t,t.fileModules).then(function(e){t.getMenu()&&(t.getMenu().holdShow=!1),e&&(t.fileObj=e,t.setValue(e.url),t.onFileChange(e))})},clearData:function(){this.setValue(null)}}),Ext.define("Fast.ext.FastFiles",{alias:["widget.fastfiles","widget.fastfilesfield"],extend:"Ext.form.field.Text",editable:!1,fileModules:[],allowBlank:!0,autoUpdate:!1,showFileName:!1,showFileLength:!1,submitArray:!1,getMenu:function(){return this.up("menu")},listeners:{afterrender:function(e){let t=this;this.editable||e.inputEl.on("click",function(){t.showWindow(t)})}},initComponent:function(){let t="";for(let e=0;e<this.fileModules.length;e++){var n=this.fileModules[e];t=t+"或"+n.tipMsg}if(this.emptyText="请上传"+t.substring(1),this.editable=!1,this.submitArray){let e=this.up("form");e&&e.add({xtype:"hiddenfield",name:this.name+"@JsonArray",value:!0})}this.callParent(arguments)},triggers:{search:{cls:"text-search",handler:function(){this.showWindow(this)}}},showWindow:function(e,t,n){let i=this;showFiles(this,function(e){i.setValue(e),Ext.isFunction(t)&&t(i)},i.fileModules,i.getValue(),n)}}),Ext.define("Fast.ext.Content",{alias:["widget.content","widget.contentfield"],extend:"Ext.form.field.TextArea",height:220,emptyText:"请填写……",allowBlank:!0,getCode:function(){return $.md5(this.getName()+this.dataIndex+this.getFieldLabel())},showWindow:function(e,t,n){Ext.isEmpty(n)&&(n="编辑内容");let i=this;var o,r;i.oldValue=i.getValue(),i.editorWin||(o=parseInt((.4*document.body.clientWidth).toFixed(0)),r=parseInt((.6*document.body.clientHeight).toFixed(0)),i.editorWin=Ext.create("Ext.window.Window",{title:n,iconCls:"extIcon extEdit",resizable:!0,maximizable:!0,height:r,width:o,minHeight:500,minWidth:600,layout:"fit",animateTarget:e,items:[i],modal:!0,constrain:!0,closeAction:"hide",listeners:{show:function(e){server.showExtConfig(i.getCode(),"TextEditorCache",function(e,t){e&&(i.setValue(t),toast("已恢复暂存的数据！"))})}},buttons:[{text:"清除暂存",iconCls:"extIcon extDelete whiteColor",handler:function(){showWait("正在清除中，请稍后……"),server.deleteExtConfig(i.getCode(),"TextEditorCache",function(e){hideWait(),e&&toast("清除成功！")})}},"->",{text:"暂存",iconCls:"extIcon extSave whiteColor",handler:function(){showWait("暂存中，请稍后……"),server.saveExtConfig(i.getCode(),"TextEditorCache",i.getValue(),function(e,t){hideWait(),e?toast("暂存成功！"):showAlert("系统提醒",t)})}},{text:"重置",iconCls:"extIcon extReset",handler:function(){i.setValue(i.oldValue),server.deleteExtConfig(i.getCode(),"TextEditorCache")}},{text:"确定",iconCls:"extIcon extOk",handler:function(){showWait("请稍后……"),server.deleteExtConfig(i.getCode(),"TextEditorCache",function(e){hideWait(),Ext.isFunction(i.editorWin.callBack)&&i.editorWin.callBack(i),i.editorWin.close()})}}]})),i.editorWin.setTitle(n),i.editorWin.callBack=t,i.editorWin.animateTarget=e,i.editorWin.show()}}),Ext.define("Fast.ext.HtmlContent",{alias:["widget.htmlcontent","widget.htmlcontentfield"],extend:"Ext.form.FieldContainer",height:400,getName:function(){return this.name},autoShowEditor:!0,allowBlank:!0,showEditor:function(){let e=this;var t="EditorFrame"+Ext.now();window["editorLoadDone"+t]=function(){e.setValue(e.value),e.setPostImageUrl(system.formatUrl("upload?type=editor"))},e.editorFrameId=t;var n=system.formatUrlVersion("base/editor/index.html?id="+t);e.update("<iframe id='"+t+"'  src='"+n+"' width='100%' height='100%' frameborder='0' scrolling='no' style='border: 1px solid #d0d0d0;'/>")},listeners:{afterrender:function(e){e.autoShowEditor&&e.showEditor()}},getCode:function(){return $.md5(this.getName()+this.dataIndex+this.getFieldLabel())},isValid:function(){return!0},getValue:function(){let e=this.down("[realValue=true]");return e?e.getValue():this.value},setValue:function(e){let t=this.down("[realValue=true]");t&&t.setValue(e),this.value=e},setHtml:function(e){this.setValue(e)},setPostImageUrl:function(t){if(this.editorFrameId){let e=document.getElementById(this.editorFrameId);e&&Ext.isFunction(e.contentWindow.getHtmlValue)&&e.contentWindow.setPostImageUrl(t)}},initComponent:function(){let n=this;n.items=[{xtype:"textfield",name:n.name,hidden:!0,realValue:!0,fieldLabel:n.fieldLabel,allowBlank:n.allowBlank,validation:"请输入"+n.fieldLabel,isValid:function(){return!(!this.allowBlank&&Ext.isEmpty($(this.getRawValue()).text()))},getRawValue:function(){if(n.editorFrameId){let e=document.getElementById(n.editorFrameId);if(e&&Ext.isFunction(e.contentWindow.getHtmlValue))return e.contentWindow.getHtmlValue()}return null},setValue:function(t){if(n.value=t,n.editorFrameId){let e=document.getElementById(n.editorFrameId);e&&Ext.isFunction(e.contentWindow.setHtmlValue)&&e.contentWindow.setHtmlValue(t)}}}],n.callParent(arguments)},showWindow:function(e,t,n){Ext.isEmpty(n)&&(n="编辑内容");let i=this;var o,r;i.autoShowEditor=!1,i.oldValue=i.value,i.editorWin||(o=parseInt((.4*document.body.clientWidth).toFixed(0)),r=parseInt((.6*document.body.clientHeight).toFixed(0)),i.editorWin=Ext.create("Ext.window.Window",{title:n,iconCls:"extIcon extEdit",resizable:!0,maximizable:!0,height:r,width:o,minHeight:500,minWidth:600,layout:"fit",animateTarget:e,items:[i],modal:!0,constrain:!0,closeAction:"hide",listeners:{show:function(e){i.showEditor(),server.showExtConfig(i.getCode(),"HtmlEditorCache",function(e,t){e&&(i.setValue(t),toast("已恢复暂存的数据！"))})}},buttons:[{text:"清除暂存",iconCls:"extIcon extDelete whiteColor",handler:function(){showWait("正在清除中，请稍后……"),server.deleteExtConfig(i.getCode(),"HtmlEditorCache",function(e){hideWait(),e&&toast("清除成功！")})}},"->",{text:"暂存",iconCls:"extIcon extSave whiteColor",handler:function(){showWait("暂存中，请稍后……"),server.saveExtConfig(i.getCode(),"HtmlEditorCache",i.getValue(),function(e,t){hideWait(),e?toast("暂存成功！"):showAlert("系统提醒",t)})}},{text:"重置",iconCls:"extIcon extReset",handler:function(){i.setValue(i.oldValue),server.deleteExtConfig(i.getCode(),"HtmlEditorCache")}},{text:"确定",iconCls:"extIcon extOk",handler:function(){i.getCode();showWait("请稍后……"),server.deleteExtConfig(i.getCode(),"HtmlEditorCache",function(e){hideWait(),Ext.isFunction(i.editorWin.callBack)&&i.editorWin.callBack(i),i.editorWin.close()})}}]})),i.editorWin.setTitle(n),i.editorWin.callBack=t,i.editorWin.animateTarget=e,i.editorWin.show()}}),Ext.define("Fast.ext.Link",{alias:["widget.link","widget.linkfield"],extend:"Ext.form.FieldContainer",entityId:null,entityText:null,entityCode:null,linkValue:{},editable:!1,allowBlank:!0,layout:"fit",multiSelect:!1,autoDisabled:!0,submitValue:!0,onBeforeSelect:null,onAfterSelect:null,onClearSelect:null,binds:[],isValid:function(){let e=this.down("[name="+this.name+"Display]");return e.allowBlank=this.allowBlank,e.isValid()},getName:function(){return this.name},getValue:function(){if(this.submitValue){let e=this.down("[name="+this.name+"]");return e.getValue()}return this.getText()},getText:function(){let e=this.down("[name="+this.name+"Display]");return e.getValue()},setRecordValue:function(n){var i=this;if(n&&(!Ext.isEmpty(i.getText())||!Ext.isEmpty(n.get(i.dataIndex)))){if(n.store&&(n.store.holdUpdate=!0),n.set(i.name,i.getValue()),n.set(i.dataIndex,i.getText()),i.record)for(let t=0;t<i.binds.length;t++){let e=i.binds[t];var o=e.toString().split("@");if(1<o.length){var r=o[0],l=i.record.get(r);for(let e=1;e<o.length;e++)n.set(o[e],l)}}n.store&&(n.store.holdUpdate=!1,n.store.fireEvent("endupdate"))}},setValue:function(e,t){var n=this;let i=n.down("[name="+n.name+"Display]");if(i.setValue(e),t&&n.setRawValue(t.get(n.name)),!e){n.setRawValue(-1);let e=n.down("[name="+n.name+"MoreFields]");e.removeAll(!0)}},setHtml:function(e){this.setValue(e)},setRawValue:function(e,n){var i=this;let t=i.down("[name="+i.name+"]");t&&t.setValue(e);let o=i.down("[name="+i.name+"MoreFields]");if(o.removeAll(!0),n)for(let t=0;t<n.length;t++){let e=Ext.create({xtype:"hiddenfield",name:i.name});e.setValue(n[t]),o.add(e)}if(i.record)for(let t=0;t<i.binds.length;t++){let e=i.binds[t];var r=e.toString().split("@");if(1<r.length){var l=r[0],a=i.record.get(l);for(let t=1;t<r.length;t++){let e=Ext.create({xtype:"hiddenfield",name:r[t]});e.setValue(a),o.add(e)}}}},getRawValue:function(){let e=this.down("[name="+this.name+"]");return e?e.getValue():null},getMenu:function(){return this.up("menu")},selectData:function(callback){let me=this;if(!Ext.isFunction(me.onBeforeSelect)||me.onBeforeSelect(me))if(me.getMenu()&&(me.getMenu().holdShow=!0),me.entityCode)if(me.entityId)if(me.entityText){let entity=system.getEntity(me.entityCode);if(entity)if(entity.js){let entityObj=eval("new "+me.entityCode+"()");if(Ext.isFunction(entityObj.showSelect)){let display=me.down("[name="+me.name+"Display]");display.blur();let selectTitle=entity.shortName;me.fieldLabel&&(selectTitle=me.fieldLabel),me.labelTitle&&(selectTitle=me.labelTitle),entityObj.showSelect(this,"选择"+selectTitle,me.linkValue.where,me.multiSelect).then(function(o){if(o){if(Ext.isFunction(callback))return void callback(o);if(1===o.length){let e=o[0];me.record=e,me.setValue(e.get(me.entityText)),me.setRawValue(e.get(me.entityId))}else if(1<o.length){me.record=o[0],me.records=o;let n="",i=[];for(let t=0;t<o.length;t++){let e=o[t].get(me.entityText);Ext.isEmpty(e)&&(e="无"),n+="#"+e,i.push(o[t].get(me.entityId))}me.setRawValue(i[0],i.slice(1)),me.setValue(n.substring(1))}Ext.isFunction(me.onAfterSelect)&&me.onAfterSelect(me)}me.getMenu()&&(me.getMenu().holdShow=!1)})}else showAlert("系统提醒","'"+me.entityCode+"' JS对象不存在函数showSelect(obj,callBack)！").then(function(){me.getMenu()&&(me.getMenu().holdShow=!1)})}else showAlert("系统提醒","未获取到 '"+me.entityCode+"' JS对象！",function(){me.getMenu()&&(me.getMenu().holdShow=!1)});else showAlert("系统提醒","未获取到 '"+me.entityCode+"' 实体类！",function(){me.getMenu()&&(me.getMenu().holdShow=!1)})}else showAlert("系统提醒","请配置组件的entityText属性值！",function(){me.getMenu()&&(me.getMenu().holdShow=!1)});else showAlert("系统提醒","请配置组件的entityId属性值！",function(){me.getMenu()&&(me.getMenu().holdShow=!1)});else showAlert("系统提醒","请配置组件的entityCode属性值！",function(){me.getMenu()&&(me.getMenu().holdShow=!1)})},clearData:function(){var e=this;e.setValue(null),e.setRawValue(-1);let t=e.down("[name="+e.name+"MoreFields]");t.removeAll(!0),Ext.isFunction(e.onClearSelect)&&e.onClearSelect(e)},initComponent:function(){let n=this;var e;!window.getLinkFieldDefaultValue||(e=window.getLinkFieldDefaultValue(n))&&(n.linkValue?n.linkValue=mergeJson(n.linkValue,e):n.linkValue=e),n.linkValue||(n.linkValue={},n.linkValue[n.entityId]=-1,n.linkValue[n.entityText]=null),n.linkValue.hasOwnProperty(n.entityId)||(n.linkValue[n.entityId]=-1),Ext.isEmpty(n.linkValue[n.entityId])&&(n.linkValue[n.entityId]=-1),Ext.isEmpty(n.name)&&(n.name="LinkField"+Ext.now());let t=n.linkValue[n.entityText];t=t||n.value;let i=[];for(let t=0;t<n.binds.length;t++){let e=n.binds[t];var o=e.toString().split("@");if(1<o.length){var r=o[0],l=n.linkValue[r];for(let e=1;e<o.length;e++)i.push({xtype:"hiddenfield",name:o[e],value:l})}}n.items=[{xtype:"hiddenfield",name:n.name,value:n.linkValue[n.entityId]},{xtype:"fieldcontainer",name:n.name+"MoreFields",hidden:!0,items:i},{xtype:"textfield",name:n.name+"Display",editable:n.editable,value:t,disabled:null!=n.linkValue[n.entityText]&&n.autoDisabled,hideLabel:!0,fieldLabel:n.fieldLabel,allowBlank:n.allowBlank,emptyText:"请选择",listeners:{afterrender:function(e){this.editable||e.inputEl.on("click",function(){n.selectData()})}},triggers:{close:{cls:"text-clear",handler:function(){n.clearData(),Ext.isFunction(n.onClearValue)&&n.onClearValue()}},search:{cls:"text-search",handler:function(){n.selectData(),this.inputEl.blur()}}}}],n.callParent(arguments)}}),Ext.define("Fast.ext.Target",{alias:["widget.target","widget.targetfield"],extend:"Ext.form.FieldContainer",layout:"column",labelWidth:null,targetType:null,targetTypeReadOnly:!1,targetTypeEnum:null,targetId:null,targetValue:{},targetFunction:"getTargetEntity",include:[],exclude:[],getValue:function(){let e=this.down("[name="+this.targetId+"]");return e.getText()},setValue:function(e,t){var n=this;let i=n.down("[name="+n.targetId+"]");i.setValue(e),t&&(n.targetValue={},n.targetValue[n.targetType]=t.get(n.targetType),n.targetValue[n.targetId]=t.get(n.targetId),n.holdIdValue=n.getTargetTypeValue()!=t.get(n.targetType),n.setTargetIdValue(t.get(n.targetId)),n.setTargetTypeValue(t.get(n.targetType)))},setHtml:function(e){this.setValue(e)},getSearchField:function(){},setRecordValue:function(e){var t=this;e&&(e.store&&(e.store.holdUpdate=!0),t.targetId&&e.set(t.targetId,t.getTargetIdValue()),t.targetType&&e.set(t.targetType,t.getTargetTypeValue()),t.targetText&&t.targetText!=t.dataIndex&&e.set(t.targetText,t.getValue()),e.set(t.dataIndex,t.getValue()),e.store&&(e.store.holdUpdate=!1,e.store.fireEvent("endupdate")))},setTargetTypeValue:function(e){let t=this.down("[name="+this.targetType+"]");t&&t.setValue(e)},getTargetTypeValue:function(){let e=this.down("[name="+this.targetType+"]");return e?e.getValue():0},setTargetIdValue:function(e){let t=this.down("[name="+this.targetId+"]");t&&t.setRawValue(e)},getTargetIdValue:function(){let e=this.down("[name="+this.targetId+"]");return e?e.getRawValue():-1},getTargetEntity:function(e){var t=window[this.targetFunction](e,this.targetType);return t||(showAlert("目标组件错误","未获取到TargetType为："+e+"的实体配置！"),null)},showWindow:function(e,t,n){Ext.isEmpty(n)&&(n="编辑目标数据");let i=this;i.editorWin||(i.editorWin=Ext.create("Ext.window.Window",{title:n,height:220,width:400,minWidth:400,minHeight:220,layout:"fit",resizable:!0,modal:!0,constrain:!0,closeAction:"hide",iconCls:"extIcon extLink",items:[i],buttons:[{text:"取消",iconCls:"extIcon extClose",handler:function(){i.editorWin.close()}},{text:"确定",iconCls:"extIcon extOk",handler:function(){i.editorWin.close(),Ext.isFunction(i.editorWin.callBack)&&i.editorWin.callBack(i)}}]})),i.editorWin.setTitle(n),i.editorWin.callBack=t,i.editorWin.animateTarget=e,i.editorWin.show()},initComponent:function(){let i=this,e=i.fieldLabel;Ext.isEmpty(e)&&(e="目标类型"),i.fieldLabel="",i.labelWidth||(i.labelWidth=60),i.labelAlign="right",i.emptyText||(i.emptyText="请填写"),i.margin||(i.margin="5 5 5 5");let t={};if(!Ext.isFunction(window[i.targetFunction]))return showAlert("目标组件错误","未检测到方法"+i.targetFunction+"!"),void i.callParent(arguments);i.targetValue||(i.targetValue={},i.targetValue[i.targetType]=0,i.targetValue[i.targetId]=-1),i.targetValue[i.targetType]||(i.targetValue[i.targetType]=0),i.targetValue[i.targetId]||(i.targetValue[i.targetId]=-1),i.targetEnum&&(i.targetTypeEnum=i.targetEnum),i.targetTypeEnum||(i.targetTypeEnum=i.targetType.replace(i.targetType[0],i.targetType[0].toUpperCase())+"Enum");var n=i.targetValue[i.targetType],o=i.getTargetEntity(n);o&&(t[o.entityId]=i.targetValue[i.targetId],t[o.entityText]=i.targetValue.targetText,n={name:i.targetType,xtype:"enumcombo",fieldLabel:e,columnWidth:1,value:n,labelWidth:i.labelWidth,labelAlign:i.labelAlign,emptyText:"请选择"+e,margin:i.margin,allowBlank:!1,readOnly:i.targetTypeReadOnly,enumName:i.targetTypeEnum,exclude:i.exclude,include:i.include,listeners:{change:function(e,t,n){t=i.getTargetEntity(t);if(t){let e=i.down("[name="+i.targetId+"]");e.entityCode=t.entityCode,e.entityId=t.entityId,e.entityText=t.entityText,i.holdIdValue?i.holdIdValue=!1:e.setValue(null)}}}},o={name:i.targetId,xtype:"linkfield",fieldLabel:"目标数据",columnWidth:1,margin:i.margin,labelWidth:i.labelWidth,labelAlign:i.labelAlign,entityCode:o.entityCode,entityId:o.entityId,entityText:o.entityText,linkValue:t,multiSelect:i.multiSelect},i.items=[n,o],i.callParent(arguments))}}),Ext.define("Fast.ext.Map",{alias:["widget.map","widget.mapfield"],extend:"Ext.form.FieldContainer",lngName:"lnt",latName:"lat",proName:null,cityName:null,areaName:null,editable:!1,emptyText:"请选择",allowBlank:!0,layout:"fit",submitValue:!0,isValid:function(){let e=this.down("[name="+this.name+"]");return e.isValid()},getName:function(){return this.name},getValue:function(){let e=this.down("[name="+this.name+"]");return e.getValue()},setValue:function(e,t){var n=this;let i=n.down("[name="+n.name+"]");i.setValue(e),t&&(n.latName&&n.setLatValue(t.get(n.latName)),n.lngName&&n.setLngValue(t.get(n.lngName)),n.proName&&n.setProValue(t.get(n.proName)),n.cityName&&n.setCityValue(t.get(n.cityName)),n.areaName&&n.setAreaValue(t.get(n.areaName)))},setRecordValue:function(e){var t=this;e&&(e.store&&(e.store.holdUpdate=!0),t.latName&&e.set(t.latName,t.getLatValue()),t.lngName&&e.set(t.lngName,t.getLngValue()),t.proName&&e.set(t.proName,t.getProValue()),t.cityName&&e.set(t.cityName,t.getCityValue()),t.areaName&&e.set(t.areaName,t.getAreaValue()),e.set(t.name,t.getValue()),e.store&&(e.store.holdUpdate=!1,e.store.fireEvent("endupdate")))},setLatValue:function(e){let t=this.down("[name="+this.latName+"]");t&&t.setValue(e)},setLngValue:function(e){let t=this.down("[name="+this.lngName+"]");t&&t.setValue(e)},setProValue:function(e){let t=this.down("[name="+this.proName+"]");t&&t.setValue(e)},setCityValue:function(e){let t=this.down("[name="+this.cityName+"]");t&&t.setValue(e)},setAreaValue:function(e){let t=this.down("[name="+this.areaName+"]");t&&t.setValue(e)},getLatValue:function(){let e=this.down("[name="+this.latName+"]");return e?e.getValue():0},getLngValue:function(){let e=this.down("[name="+this.lngName+"]");return e?e.getValue():0},getProValue:function(){let e=this.down("[name="+this.proName+"]");return e?e.getValue():null},getCityValue:function(){let e=this.down("[name="+this.cityName+"]");return e?e.getValue():null},getAreaValue:function(){let e=this.down("[name="+this.areaName+"]");return e?e.getValue():null},getMenu:function(){return this.up("menu")},selectData:function(){let t=this;t.getMenu()&&(t.getMenu().holdShow=!0);let e=t.down("[name="+t.name+"]");e.blur(),showMap(t,t.getLngValue(),t.getLatValue(),t.getValue()).then(function(e){e&&(t.setLatValue(e.lat),t.setLngValue(e.lng),t.setProValue(e.pro),t.setAreaValue(e.area),t.setCityValue(e.city),t.setValue(e.addr)),t.getMenu()&&(t.getMenu().holdShow=!1)})},clearData:function(){this.setValue(null),this.setLatValue(0),this.setLngValue(0)},initComponent:function(){let t=this;t.name||(t.name=t.dataIndex),Ext.isEmpty(t.name)&&(t.name="MapField"+Ext.now()),t.items=[{xtype:"hiddenfield",name:t.lngName,value:0},{xtype:"hiddenfield",name:t.latName,value:0},{xtype:"hiddenfield",name:t.proName},{xtype:"hiddenfield",name:t.cityName},{xtype:"hiddenfield",name:t.areaName},{xtype:"textfield",name:t.name,editable:t.editable,fieldLabel:t.fieldLabel,hideLabel:!0,allowBlank:t.allowBlank,emptyText:t.emptyText,listeners:{afterrender:function(e){this.editable||e.inputEl.on("click",function(){t.selectData()})}},triggers:{close:{cls:"text-clear",handler:function(){t.clearData(),Ext.isFunction(t.onClearValue)&&t.onClearValue()}},search:{cls:"text-search",handler:function(){t.selectData(),this.inputEl.blur()}}}}],t.callParent(arguments)}}),Ext.define("Fast.ext.PCA",{alias:["widget.pca","widget.pcafield"],extend:"Ext.form.field.Text",proName:null,cityName:null,areaName:null,onAfterSelect:null,level:null,selectType:0,setRecordValue:function(e,t){var n=this;t=toBool(t,!0),e&&(e.store&&(e.store.holdUpdate=!0),n.proName&&n.name!==n.proName&&n.province&&e.set(n.proName,n.province.provinceName),n.cityName&&n.name!==n.cityName&&n.city&&e.set(n.cityName,n.city.cityName),n.areaName&&n.name!==n.areaName&&n.area&&e.set(n.areaName,n.area.areaName),e.set(n.name,n.getValue()),e.store&&(e.store.holdUpdate=!1,e.store.fireEvent("endupdate"))),t&&n.clearData()},getMenu:function(){return this.up("menu")},selectData:function(){let r=this;r.getMenu()&&(r.getMenu().holdShow=!0),Ext.isFunction(window.selectPCA)?(r.blur(),window.selectPCA(r,function(e,n,i,o){if(toBool(e,!1)){r.province=n,r.area=o,r.city=i;let e=r.up("form");e&&(n&&r.proName&&e.setFieldValue(r.proName,n.provinceName),i&&r.cityName&&e.setFieldValue(r.cityName,i.cityName),o&&r.areaName&&e.setFieldValue(r.areaName,o.areaName));let t="";n&&(t=n.provinceName,r.name===r.proName&&(r.setValue(n.provinceName),t=null)),i&&(t&&(0===r.selectType?t+=" "+i.cityName:t=i.cityName),r.name===r.cityName&&(r.setValue(i.cityName),t=null)),o&&(t&&(0===r.selectType?t+=" "+o.areaName:t=o.areaName),r.name===r.areaName&&(r.setValue(o.areaName),t=null)),t&&r.setValue(t),r.getMenu()&&(r.getMenu().holdShow=!1),Ext.isFunction(r.onAfterSelect)&&r.onAfterSelect(r)}else r.getMenu()&&(r.getMenu().holdShow=!1)},r.level)):showAlert("系统提醒","未检测到函数selectPCA！请导入FastChar-Location插件！",function(){r.getMenu()&&(r.getMenu().holdShow=!1)})},clearData:function(){this.setValue(null),this.province=null,this.area=null,this.city=null},triggers:{close:{cls:"text-clear",handler:function(){this.clearData(),Ext.isFunction(this.onClearValue)&&this.onClearValue()}},search:{cls:"text-search",handler:function(){this.selectData(),this.inputEl.blur()}}},listeners:{afterrender:function(e){let t=this;this.editable||e.inputEl.on("click",function(){t.selectData()})}},initComponent:function(){this.emptyText="请选择省市区",this.editable=!1,this.province=null,this.area=null,this.city=null,this.callParent(arguments)}}),Ext.define("Fast.ext.DateRange",{alias:["widget.daterange","widget.daterangefield"],extend:"Ext.form.field.Text",beginDate:null,endDate:null,editable:!0,allowBlank:!0,maxRangeDate:-1,maxRangeMonth:-1,maxRangeYear:-1,layout:"column",format:"Y-m-d",submitValue:!0,onAfterSelect:null,onClearValue:null,getMenu:function(){return this.up("menu")},selectData:function(){let o=this;o.getMenu()&&(o.getMenu().holdShow=!0);let r=Ext.now(),l=Ext.create("Ext.menu.Menu",{floating:!0,items:[{xtype:"panel",padding:"10 10 10 10",layout:"column",style:{background:"#ffffff",borderWidth:1,borderColor:"#ffffff",color:"#eeeee"},border:0,items:[{xtype:"combo",fieldLabel:"快速选择",valueField:"value",labelWidth:60,margin:"5 5 5 5",editable:!1,columnWidth:1,triggers:{close:{cls:"text-clear",handler:function(){this.setValue(null),o.clearData()}}},listeners:{change:function(e,t,n,i){if(t){o.endDate=Ext.Date.format(new Date,o.format),6===t?o.beginDate=Ext.Date.format(new Date,o.format):1===t?o.beginDate=Ext.Date.format(Ext.Date.add(new Date,Ext.Date.DAY,-7),o.format):2===t?o.beginDate=Ext.Date.format(Ext.Date.add(new Date,Ext.Date.MONTH,-1),o.format):3===t?o.beginDate=Ext.Date.format(Ext.Date.add(new Date,Ext.Date.MONTH,-3),o.format):4===t?o.beginDate=Ext.Date.format(Ext.Date.add(new Date,Ext.Date.MONTH,-6),o.format):5===t&&(o.beginDate=Ext.Date.format(Ext.Date.add(new Date,Ext.Date.YEAR,-1),o.format));t=o.refreshValue();if(t)return toast(t),e.setValue(null),o.clearData(),void shakeComment(l);Ext.getCmp("beginDate"+r).setValue(o.beginDate),Ext.getCmp("endDate"+r).setValue(o.endDate)}}},store:Ext.create("Ext.data.Store",{data:[{text:"今天",value:6},{text:"近一周",value:1},{text:"近一个月",value:2},{text:"近三个月",value:3},{text:"近六个月",value:4},{text:"近一年",value:5}]})},{fieldLabel:"开始日期",margin:"5 5 5 5",xtype:"datefield",id:"beginDate"+r,columnWidth:1,labelWidth:60,format:o.format,value:o.beginDate,emptyText:"开始日期"},{fieldLabel:"结束日期",margin:"5 5 5 5",xtype:"datefield",id:"endDate"+r,columnWidth:1,labelWidth:60,format:o.format,value:o.endDate,emptyText:"结束日期"},{xtype:"panel",layout:"hbox",columnWidth:1,border:0,items:[{xtype:"button",text:"确定",margin:"5 5 5 5",flex:.42,handler:function(){var e=Ext.getCmp("beginDate"+r).getValue(),t=Ext.getCmp("endDate"+r).getValue();o.beginDate=Ext.util.Format.date(e,o.format),o.endDate=Ext.util.Format.date(t,o.format),Ext.isEmpty(o.beginDate)&&(o.beginDate=Ext.Date.format(new Date(0),o.format)),Ext.isEmpty(o.endDate)&&(o.endDate=Ext.Date.format(new Date,o.format));t=o.refreshValue();if(t)return toast(t),void shakeComment(l);Ext.isFunction(o.onAfterSelect)&&o.onAfterSelect(o),l.close()}}]}]}]});l.setWidth(Math.max(this.getWidth(),200)),l.showBy(this,"tl-bl?")},clearData:function(){this.setValue(null),this.beginDate=null,this.endDate=null},refreshValue:function(){var e=this;e.setValue(null);var t=Ext.Date.parse(e.beginDate,e.format),n=Ext.Date.parse(e.endDate,e.format);if(n<t)return e.clearData(),"开始日期必须小于等于结束日期！";if(0<e.maxRangeDate){var i=Ext.Date.add(t,Ext.Date.DAY,e.maxRangeDate);if(!Ext.Date.between(n,t,i))return e.clearData(),"日期范围区间必须在"+e.maxRangeDate+"天以内！"}if(0<e.maxRangeMonth){var o=Ext.Date.add(t,Ext.Date.MONTH,e.maxRangeMonth);if(!Ext.Date.between(n,t,o))return e.clearData(),"日期范围区间必须在"+e.maxRangeMonth+"个月以内！"}if(0<e.maxRangeYear){o=Ext.Date.add(t,Ext.Date.YEAR,e.maxRangeYear);if(!Ext.Date.between(n,t,o))return e.clearData(),"日期范围区间必须在"+e.maxRangeYear+"年以内！"}return e.setValue(e.beginDate+" 至 "+e.endDate),Ext.Date.isEqual(t,n)&&e.setValue("今天"),null},triggers:{close:{cls:"text-clear",handler:function(){this.clearData(),Ext.isFunction(this.onClearValue)&&this.onClearValue()}},search:{cls:"text-search",handler:function(){this.selectData(),this.inputEl.blur()}}},initComponent:function(){this.editable=!1,this.refreshValue(),this.callParent(arguments)}}),Ext.define("Fast.ext.Date",{alias:["widget.date","widget.datefield"],extend:"Ext.form.field.Text",format:"Y-m-d H:i:s",getMenu:function(){return this.up("menu")},isValid:function(){var e=this;if(e.callParent(arguments)){if(!Ext.isEmpty(e.getValue()))if(!Ext.Date.parse(e.getValue(),this.format))return e.invalidText="日期格式错误！格式必须为："+this.format,e.markInvalid(this.invalidText),!1;return!0}return!1},selectData:function(){let t=this;null!=t.getMenu()&&(t.getMenu().holdShow=!0),showFastDatePicker(t,t.getValue(),this.format).then(function(e){null!=t.getMenu()&&(t.getMenu().holdShow=!1),e&&t.setValue(e)})},triggers:{search:{cls:"x-form-date-trigger",handler:function(){this.selectData()}}},listeners:{afterrender:function(e){let t=this;this.editable||e.inputEl.on("click",function(){t.selectData()})}},initComponent:function(){this.callParent(arguments)}}),Ext.define("Fast.ext.ColorField",{extend:"Ext.form.field.Text",alias:["widget.colorfield"],editable:!1,getMenu:function(){return this.up("menu")},beforeBodyEl:['<div class="'+Ext.baseCSSPrefix+'colorpicker-field-swatch"><div id="{id}-swatchEl" data-ref="swatchEl" class="'+Ext.baseCSSPrefix+'colorpicker-field-swatch-inner"></div></div>'],cls:Ext.baseCSSPrefix+"colorpicker-field",childEls:["swatchEl"],setValue:function(e){e=toColor(e);let t=this,n=t.inputEl;return n&&t.emptyText&&!Ext.isEmpty(value)&&(n.removeCls(t.emptyUICls),t.valueContainsPlaceholder=!1),t.callParent(arguments),t.applyEmptyText(),Ext.ux.colorpick.ColorUtils.setBackground(t.swatchEl,Ext.ux.colorpick.ColorUtils.parseColor(e)),t},triggers:{search:{cls:"extIcon extSearch",handler:function(){this.selectData()}}},selectData:function(){let t=this;null!=t.getMenu()&&(t.getMenu().holdShow=!0),showFastColorPicker(t.inputEl,t.getValue(),function(e){t.setValue(e.toHEXA())}).then(function(e){null!=t.getMenu()&&(t.getMenu().holdShow=!1)})},clearData:function(){this.setValue(null)}});const renders={normal:function(s,c){return function(e,t,n,i,o,r,l,a){return Ext.isEmpty(e)?"<span style='color: #ccc;'>无</span>":(s=s||"",Ext.isEmpty(c)?e+=s:("left"!==c&&"l"!==c&&!toBool(c,!1)||(e=s+e),"right"!==c&&"r"!==c||(e+=s)),a?e.replace(new RegExp("\n","g"),"<br/>").replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;").replace(new RegExp(" ","g"),"&nbsp;"):e)}},money:function(){return function(e){return Ext.isEmpty(e)?"<span style='color: #ccc;'>无</span>":"￥"+e}},text:function(){return function(e){return Ext.isEmpty(e)?"<span style='color: #ccc;'>无</span>":"<span style='white-space: pre;'>"+(e=e.replace(/<\/?.+?>/g,""))+"</span>"}},file:function(l){return function(e,t,n){if(Ext.isEmpty(e)||"null"===e)return"<span style='color: #ccc;'>暂无文件</span>";var i=e.split("@");let o=i[0],r=o.substring(o.lastIndexOf("/")+1);if(1<i.length&&(r=i[1]),Ext.isEmpty(l)||(r=n.get(l)),files.image().reg.test(r))return renders.image()(e);if(files.mp4().reg.test(r))return renders.mp4()(e);if(files.pdf().reg.test(r)||files.word().reg.test(r)||files.excel().reg.test(r)||files.ppt().reg.test(r))return renders.office()(e);e=getSVGClassName(r);return'&nbsp;<a href="'+system.formatUrlVersion(o)+"\" target='_blank' ><span style='margin-right: 5px;'>"+getSVGIcon(e)+"</span>"+r+"</a>&nbsp;"}},files:function(){return function(e,t,n,i,o,r,l,a){try{if(Ext.isEmpty(e)||"null"===e)return"<span style='color: #ccc;'>暂无文件</span>";let t=e;if(Ext.isString(e)&&!Ext.isEmpty(e))try{t=Ext.decode(e)}catch(e){console.error(e)}if(0===t.length)return"<span style='color: #ccc;'>暂无文件</span>";var s=$.md5(JSON.stringify(t));let n="";for(let e=0;e<t.length;e++)n+="<div style='margin: 5px;'>"+renders.file()(t[e])+"</div>";if(a)return n;MemoryCache[s]=n;var c='&nbsp;<a href="javascript:'+("showAlert('查看文件',MemoryCache['"+s+"'],null,false)")+';">共有'+t.length+"个文件！</a>&nbsp;",d=$.md5(c);return window[d]=n,c}catch(e){return console.error(e),"<span style='color: #ccc;'>暂无文件</span>"}}},image:function(r,l){return function(n){try{let e="14px",t="auto";if(Ext.isEmpty(n)||"null"===n)return"<img style='object-fit: cover; border:1px solid #cccccc;height:"+e+";' src='images/default_img.png'   alt='' />";n.startWith("//")&&(n="http:"+n);try{r&&(e=r+"px"),l&&(t=l+"px")}catch(e){}var i=n.split("@")[0],o=$.md5(i);return window[o]="<img  alt='' style='object-fit: cover;border:1px solid #cccccc;width: 100px; min-height:14px;  '  width='100'  class='lazyload' onerror=\"javascript:this.src = 'images/default_img.png';\" src='"+i+"' />","<img class='lazyload'  alt='' details-id='"+o+"'  style='object-fit: cover;border:1px solid #cccccc;height:"+e+";width: "+t+"; min-width:14px; min-height:14px; ' width='"+t.replace("px","")+"' height='"+e.replace("px","")+"'  onclick=\"showImage(this,'"+i+"')\"   onerror=\"javascript:this.src = 'images/default_img.png';\" src='"+i+"'  />"}catch(e){return console.error(e),"<span style='color: #ccc;'>暂无图片</span>"}}},images:function(){return function(e,t,n,i,o,r,l,a){try{if(Ext.isEmpty(e)||"null"===e)return"<span style='color: #ccc;'>暂无图片</span>";let t=e;if(Ext.isString(e)&&!Ext.isEmpty(e))try{t=Ext.decode(e)}catch(e){console.error(e)}if(0===t.length)return"<span style='color: #ccc;'>暂无图片</span>";var s=$.md5(JSON.stringify(t));let n="",i=[];for(let e=0;e<t.length;e++)n+=renders.image(24)(t[e])+"&nbsp;&nbsp;",i.push({url:t[e]});if(a)return n;MemoryCache[s]=i;var c='<a href="javascript:'+("showImage(null,MemoryCache['"+s+"'])")+";\" details-id='"+s+"' style='color: #4279fa;'>共有"+t.length+"张图片！</a>";return window[s]=n,c}catch(e){return console.error(e),"<span style='color: #ccc;'>暂无图片</span>"}}},mp4:function(){return function(e,t,n){if(Ext.isEmpty(e)||"null"===e)return"<span style='color: #ccc;'>暂无文件</span>";e=e.split("@");let i=e[0],o=i.substring(i.lastIndexOf("/")+1);return 1<e.length&&(o=e[1]),"&nbsp;<a href=\"javascript:showVideo(this,'"+system.formatUrlVersion(i)+"');\" ><span style='margin-right: 5px;'>"+getSVGIcon("extFileMP4")+"</span>"+o+"</a>&nbsp;"}},office:function(){return function(e,t,n){if(Ext.isEmpty(e)||"null"===e)return"<span style='color: #ccc;'>暂无文件</span>";e=e.split("@");let i=e[0],o=i.substring(i.lastIndexOf("/")+1);1<e.length&&(o=e[1]);e=getSVGClassName(o);return'&nbsp;<a href="'+("https://view.officeapps.live.com/op/view.aspx?src="+system.formatUrlVersion(i))+"\" target='_blank' >在线预览</a>&nbsp;"+'&nbsp;<a href="'+system.formatUrlVersion(i)+"\" target='_blank' ><span style='margin-right: 5px;'>"+getSVGIcon(e)+"</span>"+o+"</a>&nbsp;"}},html:function(){return function(e,t,n,i,o,r,l,a){if(Ext.isEmpty(e)||"null"===e)return"<span style='color: #ccc;'>无</span>";var s=$.md5(e);return MemoryCache[s]=e,'&nbsp;<a href="javascript:'+("showEditorHtml(this,'查看内容',MemoryCache['"+s+"'])")+';">查看内容</a>&nbsp;'}},html2:function(){return function(e,t,n,i,o,r,l,a){return Ext.isEmpty(e)||"null"===e?"<span style='color: #ccc;'>无</span>":a?e:e=e.replace(/[&\|\\\*^%$'"#@\-]/g,"").replace(new RegExp("\n","g"),"").replace(new RegExp("\t","g"),"").replace(new RegExp(" ","g"),"").replace(/<\/?.+?>/g,"")}},link:function(o,r,l){return function(e,t,n){try{if(Ext.isEmpty(e)||"null"===e)return"<span style='color: #ccc;'>无</span>";var i=n.get(o);return'&nbsp;<a href="javascript:'+("new "+r+"().showDetails(null, {'t."+l+"':'"+i+"'})")+';" >'+e+"</a>&nbsp;"}catch(e){return console.error(e),"<span style='color: #ccc;'>无</span>"}}},target:function(l,a,s){return function(e,t,n){try{if(Ext.isEmpty(e)||"null"===e)return"<span style='color: #ccc;'>无</span>";if(s=s||"getTargetEntity",!Ext.isFunction(window[s]))return e;var i=n.get(a),o=n.get(l),r=window[s](i,a);return r?'&nbsp;<a href="javascript:'+("new "+r.entityCode+"().showDetails(null, {'t."+r.entityId+"':'"+o+"'})")+';" >'+e+"</a>&nbsp;":e}catch(e){return console.error(e),"<span style='color: #ccc;'>无</span>"}}},map:function(a,s,c){return function(t,e,n){try{if(Ext.isEmpty(t)||"null"===t)return"<span style='color: #ccc;'>无</span>";var i=n.get(a),o=n.get(s),r=n.get(c);if(i&&o){var l=i+","+o;let e=r?"showAddressInMap(null,'"+l+"','"+r+"')":"showAddressInMap(null,'"+l+"','')";return'&nbsp;<a href="javascript:'+e+';" >'+t+"</a>&nbsp;"}return t}catch(e){return"<span style='color: #ccc;'>无</span>"}}},mapImgLayer:function(l,a,s){return function(e,t,n){try{if(Ext.isEmpty(e)||"null"===e)return"<span style='color: #ccc;'>无</span>";var i=n.get(l),o=n.get(a),r=n.get(s);return i&&o&&r?'&nbsp;<a href="javascript:'+("showImgLayer(null,'"+i+"','"+o+"','"+r+"')")+';" >'+e+"</a>&nbsp;":e}catch(e){return"<span style='color: #ccc;'>无</span>"}}},password:function(){return function(e,t,n,i,o,r,l,a){return Ext.isEmpty(e)?"<span style='color: #ccc;'>无</span>":"<span>******</span>"}},href:function(){return function(e,t,n){return Ext.isEmpty(e)||"null"===e?"<span style='color: #ccc;'>无</span>":"&nbsp;<a href='"+e+"' target='_blank'>"+e+"</a>&nbsp;"}},fileSize:function(){return function(e,t,n){try{return Ext.isEmpty(e)||"null"===e?"<span style='color: #ccc;'>无</span>":1048576<=e?(e/1024/1024).toFixed(2)+"M":1024<=e?(e/1024).toFixed(2)+"KB":e+"B"}catch(e){return console.error(e),"<span style='color: #ccc;'>无</span>"}}},duration:function(){return function(e,t,n){try{if(Ext.isEmpty(e)||"null"===e)return"<span style='color: #ccc;'>无</span>";var i=parseInt(e)/1e3,o=parseInt((i/3600).toString()),r=parseInt((i/60%60).toString()),l=parseInt((i%60).toString());return 0<o?o+"时"+r+"分"+l+"秒":0<r?r+"分"+l+"秒":l+"秒"}catch(e){return console.error(e),"<span style='color: #ccc;'>无</span>"}}},dateFormat:function(o){return function(t,e,n){try{if(Ext.isEmpty(t)||"null"===t)return"<span style='color: #ccc;'>无</span>";Ext.isEmpty(o)&&(o="Y-m-d H:i:s");var i=guessDateFormat(t);return Ext.Date.format(Ext.Date.parse(t,i),o)}catch(e){return console.error(e),t}}}};function guessUrlType(n){let e=n.href;e=e||n.getAttribute("data-url"),getUrlContentType(e,function(e){try{var t=getSVGClassName(e);t&&(n.innerHTML="<span style='margin-right: 5px;'>"+getSVGIcon(t)+"</span>"+n.innerText)}catch(e){}})}renders.enum=function(o,r){return function(t){try{if(Ext.isEmpty(t))return"<span style='color: #ccc;'>无</span>";let e=getEnumRecord(o,t,r);if(!e)return"<span style='color: #ccc;'>"+t+"</span>";var n=e.get("text"),i=e.get("color");return Ext.isEmpty(n)?"<span style='color: #ccc;'>"+t+"</span>":"<span style='color: "+toColor(i,"#000000")+";'>"+n+"</span>"}catch(e){return"<span style='color: #ccc;'>"+t+"</span>"}}};const server={isSilenceRequest:function(){return toBool(server.silence,!1)},setSilence:function(e){server.silence=e},loginUrl:function(){return"controller/login"},validOperateUrl:function(){return"controller/valid"},showConfigUrl:function(){return"showConfig"},logout:function(){showWait("正在退出登录中……"),$.post("controller/logout",function(){location.reload()})},updateEntity:function(e,t){isPower()?t(!1,"当前正在进行界面权限配置，不可修改数据！"):$.post("entity/update",e,function(e){203!==e.code&&Ext.isFunction(t)&&(e.success?t(!0,e.message):t(!1,e.message))})},deleteAttach:function(e,t){isPower()?t(!1,"当前正在进行界面权限配置，不可删除数据！"):$.post("deleteAttach",e,function(e){203!==e.code&&Ext.isFunction(t)&&(e.success?t(!0,e.message):t(!1,e.message))})},deleteEntity:function(e,t){isPower()?t(!1,"当前正在进行界面权限配置，不可删除数据！"):$.post("entity/delete",e,function(e){203!==e.code&&Ext.isFunction(t)&&t(e.success,e.message)})},rebackEntity:function(e,t){isPower()?t(!1,"当前正在进行界面权限配置，不可还原数据！"):$.post("entity/reback",e,function(e){203!==e.code&&Ext.isFunction(t)&&t(e.success,e.message)})},copyEntity:function(e,t){isPower()?t(!1,"当前正在进行界面权限配置，不可复制数据！"):$.post("entity/copy",e,function(e){203!==e.code&&Ext.isFunction(t)&&(e.success?t(!0,e.message):t(!1,e.message))})},clearEntity:function(e,t){isPower()?t(!1,"当前正在进行界面权限配置，不可复制数据！"):$.post("entity/clear",e,function(e){203!==e.code&&Ext.isFunction(t)&&(e.success?t(!0,e.message):t(!1,e.message))})},showExtConfig:function(e,t,n){isPower()?n(!1):$.post("ext/config/showExtConfig",{configKey:e,configType:t},function(e){Ext.isFunction(n)&&(e.success?n(!0,e.data.configValue,e.message):n(!1,null,e.message))})},saveExtConfig:function(t,n,i,o,r){if(isPower())o(!1);else{let e={configKey:t,configType:n,configValue:i};Ext.isEmpty(r)||(e=mergeJson(e,r)),$.post("ext/config/saveExtConfig",e,function(e){Ext.isFunction(o)&&(e.success?o(!0,e.message):o(!1,e.message))})}},deleteExtConfig:function(e,t,n){isPower()?n(!1):$.post("ext/config/deleteExtConfig",{configKey:e,configType:t},function(e){Ext.isFunction(n)&&(e.success?n(!0,e.message):n(!1,e.message))})},exportExcel:function(e,t){isPower()?t(!1,"当前正在进行界面权限配置，不可导出数据！"):$.post("entity/export",e,function(e){203!==e.code&&Ext.isFunction(t)&&(e.success?t(!0,e.data,e.message):t(!1,null,e.message))})},excelModule:function(e,t){isPower()?t(!1,"当前正在进行界面权限配置，不可生成模板！"):$.post("entity/module",e,function(e){203!==e.code&&Ext.isFunction(t)&&(e.success?t(!0,e.data,e.message):t(!1,null,e.message))})},showColumns:function(e,t){$.post("ext/config/showEntityColumn?entityCode="+e,function(e){Ext.isFunction(t)&&(e.success?t(!0,e.data.configValue,e.message):t(!1,null,e.message))})},getIcon:function(e,t){e="icons/"+e;return Ext.isEmpty(t)?e:"icon?path="+e+"&color="+(t=t.startWith("#")?t.substring(1):t)},showSystemConfig:function(t){$.post("ext/config/showSystemConfig",function(e){Ext.isFunction(t)&&(e.success?t(!0,e.data,e.message):t(!1,null,e.message))})},deleteSystemConfig:function(t){$.post("ext/config/deleteSystemConfig",function(e){Ext.isFunction(t)&&t(e.success,e.message)})},loadMonitor:function(t){$.post("monitor",function(e){Ext.isFunction(t)&&t(e.success,e.data)})},countReport:function(t){$.post("countReport",function(e){Ext.isFunction(t)&&t(e.success,e.data)})},checkWaitNotice:function(e,t){server.setSilence(!0),$.post("controller/waitNotice",e,function(e){server.setSilence(!1),Ext.isFunction(t)&&t(e.success,e.data)})},doneWaitNotice:function(e,t){$.post("controller/doneNotice",{noticeId:e},function(e){Ext.isFunction(t)&&t(e.success,e.message,e.data)})},clearWaitNotice:function(t){$.post("controller/clearNotice",function(e){Ext.isFunction(t)&&t(e.success,e.message,e.data)})}};function getStoreMenuText(e,t){if(t){if(t.parent){var n=getStoreMenuText(null,t.parent);if(n)return n+">"+t.text}return t.text}return e&&e.entity?getStoreMenuText(null,e.entity.menu):null}function commitStoreUpdate(l){return new Ext.Promise(function(n,e){if(l&&l.entity&&!l.commiting){let e=l.getUpdatedRecords();var t=l.getNewRecords();if(e=e.concat(t),0!==e.length){l.commiting=!0;let i={entityCode:l.entity.entityCode};l.entity.menu&&(i.menu=getStoreMenuText(l));for(let n=0;n<e.length;n++){let t=e[n];for(let e=0;e<l.entity.idProperty.length;e++){var o=l.entity.idProperty[e];i["data["+n+"]."+o]=t.get(o)}for(var r in t.modified)i["data["+n+"]."+r]=t.get(r)}server.updateEntity(i,function(e,t){l.commiting=!1,n(e),e?(toast(t),l.commitChanges()):Ext.Msg.alert("系统提醒",t)})}else n(!0)}})}function commitStoreDelete(r,l){return new Ext.Promise(function(n,e){if(r.entity){let i={entityCode:r.entity.entityCode};r.entity.menu&&(i.menu=getStoreMenuText(r));for(let n=0;n<l.length;n++){let t=l[n];for(let e=0;e<r.entity.idProperty.length;e++){var o=r.entity.idProperty[e];i["data["+n+"]."+o]=t.get(o)}}server.deleteEntity(i,function(e,t){if(n(e),e){toast(t);let e=r.currentPage;r.count()-l.length<=0&&(e-=1),r.loadPage(Math.max(e,1))}else Ext.Msg.alert("系统提醒",t)})}})}function commitStoreReback(r,l){return new Ext.Promise(function(n,e){if(r.entity){let i={entityCode:r.entity.entityCode};r.entity.menu&&(i.menu=getStoreMenuText(r));for(let n=0;n<l.length;n++){let t=l[n];for(let e=0;e<r.entity.idProperty.length;e++){var o=r.entity.idProperty[e];i["data["+n+"]."+o]=t.get(o)}}server.rebackEntity(i,function(e,t){if(n(e),e){let e=r.currentPage;r.count()-l.length<=0&&(e-=1),r.loadPage(Math.max(e,1))}else Ext.Msg.alert("系统提醒",t)})}})}function commitStoreCopy(r,l){return new Ext.Promise(function(n,e){if(r.entity){let i={entityCode:r.entity.entityCode};r.entity.menu&&(i.menu=getStoreMenuText(r));for(let n=0;n<l.length;n++){let t=l[n];for(let e=0;e<r.entity.idProperty.length;e++){var o=r.entity.idProperty[e];i["data["+n+"]."+o]=t.get(o)}}server.copyEntity(i,function(e,t){if(n(e),e){toast(t);let e=r.currentPage;r.count()-l.length<=0&&(e-=1),r.loadPage(Math.max(e,1))}else Ext.Msg.alert("系统提醒",t)})}})}function isModified(e){for(var t in e.data)try{if(e.isModified(t))return!0}catch(e){}return!1}function getEntityDataStore(entity,where,tree){if(!Ext.isEmpty(entity)){let config={fields:[],pageSize:20,where:where,entity:entity,remoteSort:toBool(entity.remoteSort,!0),proxy:{type:"ajax",url:"entity/list",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},listeners:{exception:function(obj,request,operation,eOpts){try{let data=eval("("+request.responseText+")");data.success||Ext.Msg.alert("数据获取失败",data.message)}catch(e){Ext.Msg.alert("数据获取失败",request.responseText)}}},reader:{type:"json",root:"list",totalProperty:"totalRow"}},listeners:{beforeload:function(n,i,e){try{if(!n.entity||!n.entity.entityCode)return!1;var o=n.proxy.extraParams;let t={entityCode:n.entity.entityCode,limit:n.pageSize};if(n.where)for(var r in n.where)t["where['"+r+"']"]=n.where[r];if(tree){Ext.isEmpty(tree.parentIdValue)&&(tree.parentIdValue=-1),t.page=-1;let e=i.node.data[tree.idName];Ext.isEmpty(e)&&(e=tree.parentIdValue),n.grid&&hasSearchColumn(n.grid)?t["where['"+tree.parentIdName+"']"]=null:t["where['"+tree.parentIdName+"']"]=e}if(n.grid){if(t.power=toBool(n.grid.power,!0),0<n.grid.getSelection().length?n.grid.getSelectionModel().deselectAll():n.grid.fireEvent("selectionchange",n.grid),n.grid.where)for(var l in n.grid.where)t["where['"+l+"']"]=n.grid.where[l];n.getSorters().each(function(e){t["indexSort['"+e.getProperty()+"']"]=getColumn(n.grid,e.getProperty()).getIndex()}),checkColumnSearch(n.grid)}if(n.grid)if(Ext.isFunction(n.grid.onBeforeLoad))if(!toBool(n.grid.onBeforeLoad(n.grid,n,t),!0))return!1;return n.getProxy().setExtraParams(mergeJson(o,t)),!0}catch(e){showException(e,"store:beforeload")}}},autoLoad:!1},entityStore;return entityStore=tree?(config.root={expanded:!0},Ext.create("Ext.data.TreeStore",config)):Ext.create("Ext.data.Store",config),entityStore.on("load",function(e){setTimeout(function(){try{e.grid&&e.grid.syncRowHeights()}catch(e){}},300)}),entityStore}showAlert("系统提醒","参数entity不可为空！")}function getEnumDataStore(e,t,n,i,o){i=i||{},Ext.isEmpty(o)&&(o=!0);let r=$.md5(e+Ext.JSON.encode(i));o&&MemoryCache.hasOwnProperty(r)||Ext.Ajax.request({url:"showEnums?enumName="+e,async:!1,params:i,success:function(e,t){try{var n=Ext.decode(e.responseText);n.success?MemoryCache[r]=n.data:Ext.Msg.alert("枚举获取失败",n.message)}catch(e){showException(e,"获取枚举数据源！[getEnumDataStore]")}}});let l=Ext.clone(MemoryCache[r]);return t&&(l=Ext.Array.insert(l,0,t)),n&&(l=Ext.Array.push(l,n)),Ext.create("Ext.data.Store",{autoLoad:!1,enumName:e,data:l})}function getEnumText(e,t){let n=getEnumRecord(e,t);return n?n.get("text"):null}function getEnumRecord(e,t,n){return n=n||"id",getEnumDataStore(e).findRecord(n,t,0,!1,!1,!0)}function getPageDataStore(t,n){t&&0!==t.length||(t=100),n&&0!==n.length||(n=10);let i=[];for(let e=0;e<t/10;e++){var o=(e+1)*n+"条",r=(e+1)*n;i.push({text:o,id:r})}return Ext.create("Ext.data.Store",{id:"pageSizeDataStore",fields:["id","text"],data:i})}function getCompareDataStore(){return Ext.create("Ext.data.Store",{data:[{id:0,text:"=",desc:"等于"},{id:1,text:"!=",desc:"不等于"},{id:2,text:"?",desc:"包含"},{id:3,text:"!?",desc:"不包含"},{id:4,text:">",desc:"大于"},{id:6,text:">=",desc:"大等于"},{id:5,text:"<",desc:"小于"},{id:7,text:"<=",desc:"小等于"}]})}function getGridColumnStore(e,t){let n=[];var i=e.getColumns();for(let e=0;e<i.length;e++){var o=i[e];if(!Ext.isEmpty(o.dataIndex)){if(toBool(t,!1)){if(isFilesColumn(o)||isFileColumn(o))continue;if(!toBool(o.search,!0))continue;if(toBool(o.encrypt,!1))continue}n.push({text:o.configText,id:o.dataIndex,index:e})}}return Ext.create("Ext.data.Store",{fields:["id","text","index"],data:n})}function getYesOrNoDataStore(){return Ext.create("Ext.data.Store",{id:"yesOrNoDataStore",fields:["id","text"],data:[{text:"是",id:1},{text:"否",id:0}]})}function getThemeDataStore(){return Ext.create("Ext.data.Store",{id:"themeDataStore",fields:["id","text"],data:[{text:"圆润立体",id:"extjs/theme/fast-theme-wrap"},{text:"清爽扁平",id:"extjs/theme/fast-theme-flat"}]})}function getFontSizeDataStore(){return Ext.create("Ext.data.Store",{id:"fontSizeDataStore",fields:["id","text"],data:[{text:"14px",id:"14px"},{text:"16px",id:"16px"},{text:"18px",id:"18px"}]})}function showWait(e){Ext.MessageBox.show({alwaysOnTop:!0,modal:!0,title:"系统提醒",msg:e,progressText:"请耐心等待，即将完成操作",progress:!0,closable:!1});let t=0,n=function(){var e;Ext.MessageBox.isHidden()||(t+=.5,130===t&&(t=0),e=t/100,Ext.MessageBox.updateProgress(e,"请耐心等待，即将完成操作"),setTimeout(n,5))};setTimeout(n,5)}function hideWait(){Ext.MessageBox.isVisible()&&Ext.MessageBox.hide()}function toast(e){Ext.toast({html:e,closable:!0,align:"t",slideInDuration:200,slideBackDuration:200,minWidth:180,slideBackAnimation:"easeOut",iconCls:"extIcon extInfo",title:"消息提示"})}function showHtml(e,t,n){var i=parseInt((.4*document.body.clientWidth).toFixed(0)),o=parseInt((.6*document.body.clientHeight).toFixed(0));let r=Ext.create("Ext.window.Window",{title:t,layout:"fit",height:o,width:i,minHeight:500,minWidth:600,constrain:!0,resizable:!0,maximizable:!0,modal:!0,maximized:!1,iconCls:"extIcon extSee",draggable:!0,scrollable:!0,html:n,alwaysOnTop:!0,toFrontOnShow:!0});r.show()}function showLink(e,t,n,i){var o=parseInt((.4*document.body.clientWidth).toFixed(0)),r=parseInt((.6*document.body.clientHeight).toFixed(0));let l=Ext.create("Ext.panel.Panel",{layout:"border",region:"center",border:0,listeners:{afterrender:function(e,t){this.setLoading("正在努力加载中，请稍后……"),this.update("<iframe onload='iFrameLoadDone()' src='"+n+"'  width='100%' height='100%' frameborder='0'>")}}});o={title:t,layout:"fit",height:r,width:o,minHeight:500,minWidth:600,resizable:!0,maximizable:!0,modal:!0,constrain:!0,maximized:!(window.iFrameLoadDone=function(){l.setLoading(!1)}),iconCls:"extIcon extSee",draggable:!0,scrollable:!1,alwaysOnTop:!0,toFrontOnShow:!0,items:[l],listeners:{close:function(){window.iFrameLoadDone=null}}};let a=Ext.create("Ext.window.Window",mergeJson(o,i));a.show()}function showEditorHtml(e,t,n,i){var o=parseInt((.4*document.body.clientWidth).toFixed(0)),r=parseInt((.6*document.body.clientHeight).toFixed(0));let l=Ext.create("Ext.window.Window",{title:t,layout:"fit",height:r,width:o,minHeight:500,minWidth:600,resizable:!0,maximizable:!0,modal:!0,constrain:!0,maximized:!1,iconCls:"extIcon extSee",draggable:!0,scrollable:!1,alwaysOnTop:!0,toFrontOnShow:!0,listeners:{show:function(){var e=system.formatUrlVersion("base/editor/show.html");window.showEditorDone=function(){showEditorFrame.window.showContent(n)},this.update("<iframe name='showEditorFrame' src='"+e+"'  width='100%' height='100%' frameborder='0'>")}}});l.show()}function showText(e,t,n,i){var o=parseInt((.4*document.body.clientWidth).toFixed(0)),r=parseInt((.6*document.body.clientHeight).toFixed(0));let l=Ext.create("Ext.window.Window",{title:n,icon:t,iconCls:t,maximizable:!0,height:r,width:o,minHeight:500,minWidth:600,resizable:!0,layout:"fit",animateTarget:e,items:[{xtype:"textarea",value:i}],modal:!0,constrain:!0,alwaysOnTop:!0});l.show()}function showException(e,n){if(e){hideWait(),console.error(e);let t=e;if(e instanceof Error&&(t=e.stack,t=t.replace(/\n/g,"<br/>").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;").replace(/ /g,"&nbsp;&nbsp;")),null!=n?n+="，来自"+n:n="",getExt("debug").value){let e=Ext.create("Ext.window.Window",{title:"系统异常"+n,height:180,width:270,layout:"fit",resizable:!1,maximizable:!1,constrain:!0,fixed:!0,modal:!0,draggable:!1,iconCls:"extIcon extError",html:"<div  style='padding:15px;background: #fff;' align='center'>系统发生异常，请及时告知系统管理员！</div>",buttons:[{text:"下次再说",flex:1,handler:function(){e.close()}},{text:"查看错误",flex:1,handler:function(){showCode(this,t,!0)}}]});e.show()}}}function showAlert(e,t,n,i){Ext.isEmpty(i)&&(i=!0),Ext.MessageBox.show({title:e,message:t,modal:i,buttons:Ext.MessageBox.OK,fn:n,minWidth:250})}function showImage(e,i,t,n){Ext.isEmpty(n)&&(n=!1);let o=[];Ext.isArray(i)?o=i:o.push({url:i});let r=-1;if(null!=Ext.getStore("ImageViewStore")){let n=!1,e=Ext.getStore("ImageViewStore");return e.each(function(e,t){if(e.get("url")===i)return n=!0,Ext.getCmp("ImageViewGrid").getSelectionModel().select(t),!1}),void(n||(e.add(o),-1===r&&(r=e.count()-1),e.imgSelectIndex=r,Ext.getCmp("ImageViewGrid").getSelectionModel().select(r)))}-1===r&&(r=0);let l=Ext.create("Ext.data.Store",{fields:["url"],autoLoad:!1,imgSelectIndex:r,id:"ImageViewStore",data:o}),a=Ext.create("Ext.grid.Panel",{store:l,region:"west",hideHeaders:!0,id:"ImageViewGrid",width:125,disabled:!0,border:1,scrollable:"y",columns:[{header:"文件",dataIndex:"url",flex:1,align:"center",renderer:function(e){return Ext.isEmpty(e)?"<span style='color: #ccc;'>无</span>":"<img width='30px' onerror=\"javascript:this.src='images/default_img.png';\" src='"+e+"'/>"}}],tbar:[{xtype:"button",border:1,text:"打包下载",iconCls:"extIcon extDownload",handler:function(e){let n={};l.each(function(e,t){n["path"+t]=e.get("url")}),buildForm("zipFile",n).submit()}}],listeners:{selectionchange:function(){try{let e=0;1<this.getStore().getCount()?(this.setHidden(!1),e=120):this.setHidden(!0);let t=this.getSelectionModel().getSelection();setTimeout(function(){imgViewFrame.window.showImage(system.formatUrl(t[0].get("url")),system.http)},e)}catch(e){showException(e,"showImage")}}}});window.imageViewerLoadDone=function(){Ext.getCmp("ImageViewGrid").setDisabled(!1);try{var e=Ext.getStore("ImageViewStore").imgSelectIndex;Ext.getCmp("ImageViewGrid").getSelectionModel().select(e)}catch(e){showException(e,"showImage")}},window.imageViewerSize=function(e,t){Ext.getCmp("ImageViewWindow").setTitle("查看图片 "+e+"x"+t)};var s=Ext.create("Ext.panel.Panel",{layout:"fit",region:"center",border:0,height:"auto",html:'<div style="background: #000000;width: 100%;height: 100%;"></div>',listeners:{afterrender:function(e,t){l.getCount()<=1?a.setHidden(!0):a.setHidden(!1),e.update("<iframe style='background: #000000;width: 100%;height: 100%;' name='imgViewFrame'  src='"+system.formatUrlVersion("base/image-view/index.html")+"' width='100%' height='100%' frameborder='0' scrolling='no' />")}},bbar:{xtype:"toolbar",dock:"bottom",layout:{type:"hbox",align:"middle",pack:"center"},items:[{xtype:"button",iconCls:"extIcon extZoomOut",handler:function(){imgViewFrame.window.zoomOut()}},{xtype:"button",iconCls:"extIcon extZoomIn",handler:function(){imgViewFrame.window.zoomIn()}},{xtype:"button",iconCls:"extIcon extOneOne",handler:function(){imgViewFrame.window.oneOne()}},{xtype:"button",iconCls:"extIcon extAround",handler:function(){imgViewFrame.window.rotate()}},{xtype:"button",iconCls:"extIcon extLeftRight",handler:function(){imgViewFrame.window.flipA()}},{xtype:"button",iconCls:"extIcon extTopBottom",handler:function(){imgViewFrame.window.flipB()}},{xtype:"button",iconCls:"extIcon extDownload2",handler:function(){let e=a.getSelectionModel().getSelection();download(e[0].get("url"))}}]}}),c=parseInt((.4*document.body.clientWidth).toFixed(0)),d=parseInt((.6*document.body.clientHeight).toFixed(0));let u=Ext.create("Ext.window.Window",{title:"查看图片",height:d,width:c,minHeight:500,minWidth:600,id:"ImageViewWindow",layout:"border",iconCls:"extIcon extImage",resizable:!0,alwaysOnTop:!0,maximizable:!0,modal:n,constrain:!0,animateTarget:e,items:[a,s],listeners:{close:function(e){l.destroy(),Ext.isFunction(t)&&t()}}});u.show()}function showVideo(e,t){e&&e.blur();let n=Ext.create("Ext.window.Window",{title:"查看视频",layout:"fit",height:600,width:700,resizable:!1,constrain:!0,maximizable:!1,modal:!0,maximized:!1,iconCls:"extIcon extSee",draggable:!0,scrollable:!1,alwaysOnTop:!0,toFrontOnShow:!0,listeners:{show:function(){var e=system.formatUrlVersion("base/video/player.html");window.getVideoUrl=function(){return t},this.update("<iframe allowfullscreen='allowfullscreen' mozallowfullscreen='mozallowfullscreen' msallowfullscreen='msallowfullscreen' oallowfullscreen='oallowfullscreen' webkitallowfullscreen='webkitallowfullscreen' style='background-color: black;' name='showVideoFrame' src='"+e+"'  width='100%' height='100%' frameborder='0' scrolling='no' >")}}});n.show()}function editorText(e,t,n){e&&e.blur();let i="PublicTextArea"+(new Date).getTime();var o=parseInt((.4*document.body.clientWidth).toFixed(0)),r=parseInt((.6*document.body.clientHeight).toFixed(0));let l=Ext.create("Ext.window.Window",{title:t,iconCls:"extIcon extEdit",resizable:!0,maximizable:!0,height:r,width:o,minHeight:500,minWidth:600,layout:"fit",animateTarget:e,items:[{id:i,emptyText:"请输入内容……",xtype:"textarea"}],modal:!0,constrain:!0,closeAction:"hide",listeners:{show:function(e){server.showExtConfig("PublicEditor","TextEditorCache",function(e,t){e&&Ext.getCmp(i).setValue(t),Ext.getCmp(i).focus()})}},buttons:[{text:"暂存",iconCls:"extIcon extSave whiteColor",handler:function(){showWait("暂存中，请稍后……"),server.saveExtConfig("PublicEditor","TextEditorCache",Ext.getCmp(i).getValue(),function(e,t){hideWait(),e?toast("暂存成功！"):showAlert("系统提醒",t)})}},{text:"重置",iconCls:"extIcon extReset",handler:function(){Ext.getCmp(i).setValue(null),server.deleteExtConfig("PublicEditor","TextEditorCache")}},{text:"确定",iconCls:"extIcon extOk",handler:function(){showWait("请稍后……"),server.deleteExtConfig("PublicEditor","TextEditorCache",function(e){hideWait(),Ext.isFunction(n)&&n(Ext.getCmp(i).getValue()),l.close()})}}]});l.show()}function showJson(t,n,i){try{t&&t.blur();var o=parseInt((.4*document.body.clientWidth).toFixed(0)),r=parseInt((.6*document.body.clientHeight).toFixed(0));let e=Ext.create("Ext.window.Window",{title:n,height:r,width:o,minHeight:500,minWidth:600,animateTarget:t,resizable:!0,layout:"fit",maximizable:!0,iconCls:"extIcon extSee",autoScroll:!0,modal:!0,constrain:!0});var l=new JSONFormat(i,4).toString();e.update("<div style='padding: 20px;'>"+l+"</div>"),e.show()}catch(e){showText(t,null,n,i)}}function showFormatJson(t,n){try{t&&t.blur();var i=parseInt((.4*document.body.clientWidth).toFixed(0)),o=parseInt((.6*document.body.clientHeight).toFixed(0));let e=Ext.create("Ext.window.Window",{title:"查看数据",height:o,width:i,minHeight:500,minWidth:600,animateTarget:t,layout:"fit",resizable:!0,maximizable:!0,iconCls:"extIcon extSee",autoScroll:!0,modal:!0,constrain:!0});var r=new JSONFormat(n,4).toString();e.update("<div style='padding: 20px;'>"+r+"</div>"),e.show()}catch(e){showText(t,null,"查看数据",n)}}function showCode(t,n,i){try{t&&t.blur();var o=parseInt((.4*document.body.clientWidth).toFixed(0)),r=parseInt((.6*document.body.clientHeight).toFixed(0));let e=Ext.create("Ext.window.Window",{title:"查看内容",height:r,width:o,minHeight:500,minWidth:600,animateTarget:t,resizable:!0,layout:"fit",maximizable:!0,iconCls:"extIcon extSee",autoScroll:!0,modal:!0,constrain:!0,bodyStyle:{background:"#000000"},listeners:{show:function(e){PR.prettyPrint()}}});i?e.update("<pre class='prettyprint linenums windowpre'>"+n+"</pre>"):e.update("<pre class='prettyprint windowpre'>"+n+"</pre>"),e.show()}catch(e){showText(t,null,"查看内容",n)}}function batchEditColumnRandom(a){if(Ext.isFunction(window.showRandomData))window.showRandomData(a);else{let s="Random"+Ext.now(),t=1,o=!1,e,n="Y-m-d H:i:s",c=getColumnGrid(a).getStore().getTotalCount(),i="批量随机生成当前页的【"+a.text+"】列数据";if(0<getColumnGrid(a).getSelection().length&&(i="批量随机生成选择的"+getColumnGrid(a).getSelection().length+"条【"+a.text+"】列数据",c=getColumnGrid(a).getSelection().length),isNumberColumn(a))t=2,o=!0;else if(isDateColumn(a))t=3,Ext.isObject(a.field)&&(n=a.field.format),o=!0;else if(isEnumColumn(a)||isComboColumn(a)){t=5,o=!0;let n=[],i=Ext.create(a.field);i.getStore().each(function(e,t){n.push(e.get(i.valueField))}),e=n.join(",")}else isContentColumn(a)&&(t=4);var d={xtype:"fieldcontainer",layout:"column",columnWidth:1,id:s+"_1",defaults:{labelWidth:60,margin:"5 5 5 5",labelAlign:"right",columnWidth:1,emptyText:"请填写"},random:function(){let t=[];var n=Ext.getCmp(s+"_textPrefix").getValue(),i=Ext.getCmp(s+"_textStartNumber").getValue();for(let e=parseInt(i);e<Number.MAX_VALUE&&(t.push(n+e),t.length!==c);e++);return t},items:[{xtype:"fieldset",columnWidth:1,layout:"column",defaults:{labelWidth:60,margin:"5 5 5 5",labelAlign:"right",columnWidth:1,emptyText:"请填写"},title:"文字设置",items:[{fieldLabel:"文字前缀",id:s+"_textPrefix",allowBlank:!1,xtype:"textfield"},{fieldLabel:"开始序数",id:s+"_textStartNumber",value:1,allowBlank:!1,xtype:"numberfield"}]}]},u={xtype:"fieldcontainer",layout:"column",columnWidth:1,id:s+"_2",hidden:!0,disabled:!0,defaults:{labelWidth:60,margin:"5 5 5 5",labelAlign:"right",columnWidth:1,emptyText:"请填写"},random:function(){let t=[];var n=Ext.getCmp(s+"_dotNumber").getValue(),i=Ext.getCmp(s+"_minNumber").getValue(),o=Ext.getCmp(s+"_maxNumber").getValue();if(!(o<i)){for(let e=0;e<Number.MAX_VALUE;e++){let e=Math.random()*(o-i)+i;if(t.push(e.toFixed(n)),t.length===c)break}return t}showAlert("系统提醒","最大数字必须大于最小数字！")},items:[{xtype:"fieldset",columnWidth:1,layout:"column",defaults:{labelWidth:60,margin:"5 5 5 5",labelAlign:"right",columnWidth:1,emptyText:"请填写"},title:"数字设置",items:[{fieldLabel:"保留位数",id:s+"_dotNumber",value:0,allowBlank:!1,xtype:"numberfield"},{fieldLabel:"最小数字",id:s+"_minNumber",value:0,allowBlank:!1,xtype:"numberfield"},{fieldLabel:"最大数字",id:s+"_maxNumber",allowBlank:!1,xtype:"numberfield"}]}]},m={xtype:"fieldcontainer",layout:"column",columnWidth:1,id:s+"_3",hidden:!0,disabled:!0,defaults:{labelWidth:60,margin:"5 5 5 5",labelAlign:"right",columnWidth:1,emptyText:"请填写"},random:function(){let t=[],n=Ext.getCmp(s+"_minDate").getValue(),i=Ext.getCmp(s+"_maxDate").getValue();if(!(n.getTime()>i.getTime())){for(let e=0;e<Number.MAX_VALUE;e++){var o=i.getTime()-n.getTime(),o=Math.random()*o+n.getTime(),o=new Date(o);if(t.push(Ext.Date.format(o,Ext.getCmp(s+"_minDate").format)),t.length===c)break}return t}showAlert("系统提醒","最大日期必须大于最小日期！")},items:[{xtype:"fieldset",columnWidth:1,layout:"column",defaults:{labelWidth:60,margin:"5 5 5 5",labelAlign:"right",columnWidth:1,emptyText:"请填写"},title:"日期设置",items:[{fieldLabel:"最小日期",xtype:"datefield",id:s+"_minDate",allowBlank:!1,format:n},{fieldLabel:"最大日期",xtype:"datefield",id:s+"_maxDate",allowBlank:!1,format:n}]}]},g={xtype:"fieldcontainer",layout:"column",columnWidth:1,id:s+"_4",hidden:!0,disabled:!0,defaults:{labelWidth:60,margin:"5 5 5 5",labelAlign:"right",columnWidth:1,emptyText:"请填写"},random:function(){let n=[];var i=Ext.getCmp(s+"_minLength").getValue(),o=Ext.getCmp(s+"_maxLength").getValue();let e=Ext.getCmp(s+"_longTextList").getValue();if(!(o<i)){var r=e.toString().trimAllSymbol().split("");for(let e=0;e<Number.MAX_VALUE;e++){var l=randomInt(i,o);let t=[];for(let e=0;e<Number.MAX_VALUE;e++){var a=r[randomInt(0,r.length-1)];if(t.push(a),t.length===l)break}if(n.push(t.join("")),n.length===c)break}return n}showAlert("系统提醒","最大长度必须大于最小长度！")},items:[{xtype:"fieldset",columnWidth:1,layout:"column",defaults:{labelWidth:60,margin:"5 5 5 5",labelAlign:"right",columnWidth:1,emptyText:"请填写"},title:"文字设置",items:[{fieldLabel:"文字库",id:s+"_longTextList",allowBlank:!1,xtype:"textfield",listeners:{change:function(e,t,n,i){Ext.getCmp(s+"_maxLength").setValue(t.truthLength())}}},{fieldLabel:"最小长度",id:s+"_minLength",value:1,minValue:1,allowBlank:!1,xtype:"numberfield"},{fieldLabel:"最大长度",id:s+"_maxLength",allowBlank:!1,minValue:1,xtype:"numberfield"}]}]},h={xtype:"fieldcontainer",layout:"column",columnWidth:1,id:s+"_5",hidden:!0,disabled:!0,defaults:{labelWidth:60,margin:"5 5 5 5",labelAlign:"right",columnWidth:1,emptyText:"请填写"},random:function(){let t=[],e=Ext.getCmp(s+"_numberList").getValue();var n=e.toString().split(",");for(let e=0;e<Number.MAX_VALUE;e++){var i=n[randomInt(0,n.length-1)];if(!Ext.isEmpty(i)&&(t.push(i),t.length===c))break}return t},items:[{xtype:"fieldset",columnWidth:1,layout:"column",defaults:{labelWidth:60,margin:"5 5 5 5",labelAlign:"right",columnWidth:1,emptyText:"请填写"},title:"数字集合设置",items:[{fieldLabel:"数字集合",id:s+"_numberList",allowBlank:!1,value:e,xtype:"textfield"},{xtype:"displayfield",value:"以英文逗号（,）为分隔符！"}]}]};let r=Ext.create("Ext.form.Panel",{bodyPadding:5,region:"center",autoScroll:!0,layout:"column",defaults:{labelWidth:60,margin:"5 5 5 5",labelAlign:"right",columnWidth:1,emptyText:"请填写"},items:[{xtype:"combo",name:"autoType",fieldLabel:"随机类型",editable:!1,displayField:"text",valueField:"id",value:1,listeners:{change:function(e,t,n,i){Ext.getCmp(s+"_"+n).setHidden(!0),Ext.getCmp(s+"_"+n).setDisabled(!0),Ext.getCmp(s+"_"+t).setHidden(!1),Ext.getCmp(s+"_"+t).setDisabled(!1)}},store:Ext.create("Ext.data.Store",{fields:["id","text"],data:[{text:"文本",id:1},{text:"长文本",id:4},{text:"数字",id:2},{text:"数字集合",id:5},{text:"日期",id:3}]})},d,u,m,g,h]}),l=Ext.create("Ext.window.Window",{title:i,height:360,iconCls:"extIcon extRandom",width:450,layout:"border",items:[r],modal:!0,constrain:!0,listeners:{show:function(){let e=r.getField("autoType");e.setValue(t),e.setReadOnly(o)}},buttons:["->",{text:"取消",iconCls:"extIcon extClose",handler:function(){l.close()}},{text:"立即生成",iconCls:"extIcon extOk whiteColor",handler:function(){let e=r.getForm();var n,t;e.isValid()&&(t=r.getFieldValue("autoType"),(t=Ext.getCmp(s+"_"+t).random())&&0!==t.length&&(0!==(n=t).length&&getColumnGrid(a).getStore()&&(getColumnGrid(a).getStore().holdUpdate=!0,0<(t=getColumnGrid(a).getSelectionModel().getSelection()).length?Ext.each(t,function(e,t){Ext.isObject(n[t])?setRecordValue(e,a.dataIndex,n[t]):e.set(a.dataIndex,n[t])}):getColumnGrid(a).getStore().each(function(e,t){Ext.isObject(n[t])?setRecordValue(e,a.dataIndex,n[t]):e.set(a.dataIndex,n[t])}),getColumnGrid(a).getStore().holdUpdate=!1,getColumnGrid(a).getStore().fireEvent("endupdate")),l.close()))}}]});l.show()}}Ext.override(Ext.Window,{initComponent:Ext.Function.createSequence(Ext.Window.prototype.initComponent,function(){try{eval(getExt("window-anim").value)||(this.animateTarget=null);let regStr=/([^/]*.svg)/;this.icon&&regStr.test(this.icon)&&(this.icon=server.getIcon(regStr.exec(this.icon)[1].trim(),"#ffffff")),this.liveDrag=!0,this.on("show",function(e){e.toFront(!0),e.focus()})}catch(e){console.error(e)}})}),Ext.override(Ext.window.Window,{setIcon:Ext.Function.createSequence(Ext.window.Window.prototype.setIcon,function(e){let t=/([^/]*.svg)/;e&&t.test(e)&&(this.icon=server.getIcon(t.exec(e)[1].trim(),"#ffffff"))})});