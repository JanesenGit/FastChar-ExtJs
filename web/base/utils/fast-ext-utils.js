var FastExt,FastExt,FastExt,FastExt,FastExt,FastDefine,FastExt,FastEnum,FastExtend,FastExt,FastExt,FastExt,FastExt,FastExt,FastExt,FastExt,FastOverrider,FastExt,FastExt,FastExt,FastExt,FastExt;!function(FastExt){var Base=function(){function Base(){}return Base.getOS=function(){try{var e=navigator.userAgent,t="Win32"===navigator.platform||"Windows"===navigator.platform,n="Mac68K"===navigator.platform||"MacPPC"===navigator.platform||"Macintosh"===navigator.platform||"MacIntel"===navigator.platform;if(n)return"Mac";if("X11"===navigator.platform&&!t&&!n)return"Unix";if(-1<String(navigator.platform).indexOf("Linux"))return"Linux";if(t)return-1<e.indexOf("Windows NT 5.0")||-1<e.indexOf("Windows 2000")?"Windows 2000":-1<e.indexOf("Windows NT 5.1")||-1<e.indexOf("Windows XP")?"Windows XP":-1<e.indexOf("Windows NT 5.2")||-1<e.indexOf("Windows 2003")?"Windows 2003":-1<e.indexOf("Windows NT 6.0")||-1<e.indexOf("Windows Vista")?"Windows Vista":-1<e.indexOf("Windows NT 6.1")||-1<e.indexOf("Windows 7")?"Windows 7":-1<e.indexOf("Windows NT 8.0")||-1<e.indexOf("Windows 8")?"Windows 8":-1<e.indexOf("Windows NT 10.0")||-1<e.indexOf("Windows 10")?"Windows 10":"Windows"}catch(e){}return"Other"},Base.toBool=function(e,t){if(Ext.isEmpty(t)&&(t=!1),Ext.isEmpty(e))return t;if(Ext.isString(e)){if("0"===e)return!1;if("1"===e)return!0}if(Ext.isNumber(e)){if(0===e)return!1;if(1===e)return!0}return Ext.isBoolean(e)?e:Boolean(e)},Base.copyToBoard=function(e){var t=document.createElement("input");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("Copy"),t.style.display="none",$(t).remove()},Base.copy=function(e){var t={};if(e instanceof Array)t=e.concat();else if(e instanceof Function)t=e;else for(var n in e)t[n]=e[n];return t},Base.loadFunction=function(functionStr){if(functionStr.toString().trim().startsWith("function")){var functionKey="do"+$.md5(functionStr);if(Ext.isEmpty(FastExt.Cache.memory[functionKey])){var myScript=document.createElement("script");myScript.type="text/javascript";var code="let "+functionKey+"="+functionStr;try{myScript.appendChild(document.createTextNode(code))}catch(ex){myScript.text=code}document.body.appendChild(myScript),FastExt.Cache.memory[functionKey]=!0}return eval(functionKey)}return null},Base.download=function(e){var t=e.split("?")[0].substring(e.lastIndexOf("/")),n=document.createElement("a"),o=new MouseEvent("click");n.download="file"+t,n.href=e,n.dispatchEvent(o)},Base.openUrl=function(e,t){Ext.isEmpty(t)&&(t=FastEnum.Target._blank);var n=document.createElement("a");n.click?(n.setAttribute("href",e),n.setAttribute("target",t),n.style.display="none",document.body.appendChild(n),n.click()):window.location.href=e},Base.runCallBack=function(e,t){if(Ext.isFunction(e)&&!e.callBacked){for(var n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];e.apply(this,n),e.callBacked=!0}},Base.buildOnlyCode=function(e){e+=Ext.now();return $.md5(e)},Base.getNumberValue=function(e){return parseFloat(e.replace(/[^0-9]/gi,""))},Base.prefixInteger=function(e,t){return(Array(t).join("0")+e).slice(-t)},Base.getSVGIcon=function(e){return'<svg class="svgIcon" aria-hidden="true"><use xlink:href="#'+e+'"></use></svg>'},Base.getSVGClassName=function(e){var t="extFile";return(e=e.toString().toLowerCase()).endWith(".doc")||e.endWith(".docx")||"application/msword"===e||"application/vnd.openxmlformats-officedocument.wordprocessingml.document"===e?t="extFileWord":e.endWith(".xls")||e.endWith(".xlsx")||"application/vnd.ms-excel"===e||"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===e?t="extFileExcel":e.endWith(".zip")||e.endWith(".rar")||"application/zip"===e||"application/rar"===e?t="extFileZIP":e.endWith(".apk")||"application/vnd.android.package-archive"===e?t="extFileAPK":e.endWith(".jpg")||e.endWith(".jpeg")||"image/jpeg"===e?t="extFileJPG":e.endWith(".png")||"image/png"===e?t="extFilePNG":e.endWith(".psd")||"image/vnd.adobe.photoshop"===e?t="extFilePSD":e.endWith(".html")||e.endWith(".shtml")||e.endWith(".htm")||"text/html"===e?t="extFileHTMl":!e.endWith(".txt")&&"text/plain"!==e||(t="extFileTXT"),t},Base.guessDateFormat=function(e){if(!e||Ext.isDate(e))return"";e=e.toString().trim();var t=new RegExp("[0-9]{4}-[0-9]{2}-[0-9]{2} [0-9]{2}:[0-9]{2}:[0-9]{2}");return t.test(e)?"Y-m-d H:i:s":(t=new RegExp("[0-9]{4}-[0-9]{2}-[0-9]{2} [0-9]{2}:[0-9]{2}")).test(e)?"Y-m-d H:i":(t=new RegExp("[0-9]{4}-[0-9]{2}-[0-9]{2} [0-9]{2}")).test(e)?"Y-m-d H":(t=new RegExp("[0-9]{4}-[0-9]{2}-[0-9]{2}")).test(e)?"Y-m-d":(t=new RegExp("[0-9]{4}/[0-9]{2}/[0-9]{2} [0-9]{2}:[0-9]{2}:[0-9]{2}")).test(e)?"Y/m/d H:i:s":(t=new RegExp("[0-9]{4}/[0-9]{2}/[0-9]{2} [0-9]{2}:[0-9]{2}")).test(e)?"Y/m/d H:i":(t=new RegExp("[0-9]{4}/[0-9]{2}/[0-9]{2} [0-9]{2}")).test(e)?"Y/m/d H":(t=new RegExp("[0-9]{4}/[0-9]{2}/[0-9]{2}")).test(e)?"Y/m/d":""},Base.getUrlContentType=function(e,n){var o,t;e&&n&&(o=$.md5(e.toString()),(t=FastExt.Cache.getCache(o))?n(t):$.ajax({type:"HEAD",url:e,complete:function(e,t){FastExt.Cache.setCache(o,e.getResponseHeader("content-type")),n(e.getResponseHeader("content-type"))},error:function(){FastExt.Cache.setCache(o,"un-know"),n("un-know")}}))},Base.inputFocusEnd=function(e){try{e.focus();var t,n=e.value.length;document.selection?((t=e.createTextRange()).moveStart("character",n),t.collapse(),t.select()):"number"==typeof e.selectionStart&&"number"==typeof e.selectionEnd&&(e.selectionStart=e.selectionEnd=n)}catch(e){console.error(e)}},Base.randomInt=function(e,t){return e===t?e:Math.floor(Math.random()*(t-e+1)+e)},Base.loadCssCode=function(e,t){var n=document.getElementsByTagName("head").item(0),o=document.createElement("style");o.type="text/css",o.styleSheet?o.styleSheet.cssText=e:o.innerHTML=e,null!=t&&t(),n.appendChild(o)},Base.dispatchTargetEvent=function(e,t,n){var o;e.createEvent?((o=e.createEvent("MouseEvents")).initEvent(n,!0,!1),t.dispatchEvent(o)):e.createEventObject&&t.fireEvent("on"+n)},Base.buildUUID4=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},Base.buildUUID8=function(){return(4294967296*(1+Math.random())|0).toString(16).substring(1)},Base.buildUUID12=function(){return FastExt.Base.buildUUID4()+FastExt.Base.buildUUID8()},Base.buildUUID16=function(){return FastExt.Base.buildUUID8()+FastExt.Base.buildUUID8()},Base.getUrlParams=function(e,t){t=new RegExp(t+"=([^&]*)(?:&)?");return e.match(t)&&e.match(t)[1]},Base.toString=function(e,t){return Ext.isEmpty(t)&&(t=e),Ext.isEmpty(e)?t:e.toString()},Base}();FastExt.Base=Base}(FastExt=FastExt||{}),function(o){var e=(t.buttonToMenuItem=function(e){if(e.hidden)return null;var n,t={icon:e.icon,iconCls:e.iconCls,text:e.text,subtext:e.subtext,handler:e.handler,disabled:e.disabled};return null!=e.getMenu()&&(n=[],e.getMenu().items.each(function(e,t){e=o.Button.buttonToMenuItem(e);e&&n.push(e)}),t.menu=n),t},t.buttonToBind=function(n,e){e.checkSelect&&(n.selectButtons||(n.selectButtons=[]),e.setDisabled(!0),n.selectButtons.push(e)),e.checkUpdate&&(n.updateButtons||(n.updateButtons=[]),e.setDisabled(!0),n.updateButtons.push(e)),null!=e.getMenu()&&e.getMenu().items.each(function(e,t){o.Button.buttonToBind(n,e)})},t);function t(){}o.Button=e}(FastExt=FastExt||{}),function(e){var t=(n.setCache=function(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(e){}},n.getCache=function(e){try{return JSON.parse(localStorage.getItem(e))}catch(e){}return null},n.removeCache=function(e){localStorage.removeItem(e)},n.memory={},n);function n(){}e.Cache=t}(FastExt=FastExt||{}),function(e){var t=(n.toColor=function(e,t){if(Ext.isEmpty(t)&&(t="#FFFFFF"),Ext.isEmpty(e))return t;if(e.toString().startWith("#"))return e.toString();try{var n=Ext.ux.colorpick.ColorUtils.parseColor(e);return"#"+Ext.ux.colorpick.ColorUtils.formats.HEX8(n)}catch(e){}return"#"+e},n);function n(){}e.Color=t}(FastExt=FastExt||{}),function(e){var t=(n.shakeComment=function(o,e,i){i=i||1080;try{function a(){clearInterval(t),o.setX(l),o.setY(s),Ext.isFunction(e)&&e()}var r=0,l=o.getX(),s=o.getY(),t=setInterval(function(){try{var e=r/180*Math.PI,t=3*Math.sin(e),n=3*Math.cos(e);o.setX(l+t),o.setY(s+n),(r+=90)>i&&a()}catch(e){a()}},30)}catch(e){}},n);function n(){}e.Component=t}(FastExt=FastExt||{}),function(FastDefine){var EnumComboBox=function(){Ext.define("Fast.ext.EnumComboBox",{alias:["widget.enumcombobox","widget.enumcombo"],extend:"Ext.form.field.ComboBox",enumName:"NONE",enumValue:"id",enumText:"text",exclude:[],include:[],params:{},firstData:null,lastData:null,editable:!1,useCache:!0,initComponent:function(){var t=this;t.displayField=t.enumText,t.valueField=t.enumValue,t.store=FastExt.Store.getEnumDataStore(t.enumName,t.firstData,t.lastData,t.params,t.useCache),t.exclude||(t.exclude=[]),t.include||(t.include=[]),t.store.filterBy(function(e){return!t.exclude.exists(e.get(t.enumValue))&&(!(0<t.include.length)||!!t.include.exists(e.get(t.enumValue)))}),t.callParent()}})};FastDefine.EnumComboBox=EnumComboBox;var FastFileField=function(){Ext.define("Fast.ext.FastFile",{extend:"Ext.form.field.Text",alias:["widget.fastfile","widget.fastfilefield"],fileModules:[],editable:!1,getMenu:function(){return this.up("menu")},onFileChange:function(e){},listeners:{change:function(e,t,n,o){Ext.isEmpty(t)?(e.getTrigger("help").hide(),e.getTrigger("close").hide()):(e.getTrigger("help").show(),e.getTrigger("close").show())},afterrender:function(e){var t=this;this.editable||e.inputEl.on("click",function(){t.selectData()})}},initComponent:function(){for(var e="",t=0;t<this.fileModules.length;t++)e=e+"或"+this.fileModules[t].tipMsg;this.emptyText="请上传"+e.substring(1),this.editable=!1,this.callParent(arguments)},triggers:{help:{cls:"extIcon extEye",hidden:!0,handler:function(){var e=this;if(1===e.fileModules.length){if("images"===e.fileModules[0].type)return e.getMenu()&&(e.getMenu().holdShow=!0),e.blur(),void FastExt.Dialog.showImage(e,e.getValue(),function(){e.getMenu()&&(e.getMenu().holdShow=!1)},!0);if("videos"===e.fileModules[0].type)return void FastExt.Dialog.showVideo(this,e.getValue())}if(e.fileObj){var t=e.fileObj.name;if(FastExt.FileModule.image().reg.test(t))return void FastExt.Dialog.showImage(e,e.getValue(),null,!0);if(FastExt.FileModule.mp4().reg.test(t))return void FastExt.Dialog.showVideo(this,e.getValue());if(FastExt.FileModule.pdf().reg.test(t)||FastExt.FileModule.word().reg.test(t)||FastExt.FileModule.excel().reg.test(t)||FastExt.FileModule.ppt().reg.test(t)){t="https://view.officeapps.live.com/op/view.aspx?src="+e.getValue();return void FastExt.Base.openUrl(t)}}location.href=e.getValue()}},search:{cls:"extIcon extUpload",handler:function(){this.selectData()}},close:{cls:"text-clear",hidden:!0,handler:function(){this.clearData()}}},selectData:function(){var t=this;t.getMenu()&&(t.getMenu().holdShow=!0),FastExt.File.uploadFile(t,t.fileModules).then(function(e){t.getMenu()&&(t.getMenu().holdShow=!1),e&&(t.fileObj=e,t.setValue(e.url),t.onFileChange(e))})},clearData:function(){this.setValue(null)}})};FastDefine.FastFileField=FastFileField;var FastFilesField=function(){Ext.define("Fast.ext.FastFiles",{alias:["widget.fastfiles","widget.fastfilesfield"],extend:"Ext.form.field.Text",editable:!1,fileModules:[],allowBlank:!0,autoUpdate:!1,showFileName:!1,showFileLength:!1,submitArray:!1,getMenu:function(){return this.up("menu")},listeners:{afterrender:function(e){var t=this;this.editable||e.inputEl.on("click",function(){t.showWindow(t)})}},initComponent:function(){for(var e,t="",n=0;n<this.fileModules.length;n++)t=t+"或"+this.fileModules[n].tipMsg;this.emptyText="请上传"+t.substring(1),this.editable=!1,!this.submitArray||(e=this.up("form"))&&e.add({xtype:"hiddenfield",name:this.name+"@JsonArray",value:!0}),this.callParent(arguments)},triggers:{search:{cls:"text-search",handler:function(){this.showWindow(this)}}},showWindow:function(e,t,n){var o=this;FastExt.File.showFiles(this,function(e){o.setValue(e),Ext.isFunction(t)&&t(o)},o.fileModules,o.getValue(),n)}})};FastDefine.FastFilesField=FastFilesField;var ContentField=function(){Ext.define("Fast.ext.Content",{alias:["widget.content","widget.contentfield"],extend:"Ext.form.field.TextArea",height:220,emptyText:"请填写……",allowBlank:!0,getCode:function(){return $.md5(this.getName()+this.dataIndex+this.getFieldLabel())},showWindow:function(e,t,n){Ext.isEmpty(n)&&(n="编辑内容");var o,i,a=this;a.oldValue=a.getValue(),a.editorWin||(o=parseInt((.4*document.body.clientWidth).toFixed(0)),i=parseInt((.6*document.body.clientHeight).toFixed(0)),a.editorWin=Ext.create("Ext.window.Window",{title:n,iconCls:"extIcon extEdit",resizable:!0,maximizable:!0,height:i,width:o,minHeight:500,minWidth:600,layout:"fit",animateTarget:e,items:[a],modal:!0,constrain:!0,closeAction:"hide",listeners:{show:function(e){FastExt.Server.showExtConfig(a.getCode(),"TextEditorCache",function(e,t){e&&(a.setValue(t),FastExt.Dialog.toast("已恢复暂存的数据！"))})}},buttons:[{text:"清除暂存",iconCls:"extIcon extDelete whiteColor",handler:function(){FastExt.Dialog.showWait("正在清除中，请稍后……"),FastExt.Server.deleteExtConfig(a.getCode(),"TextEditorCache",function(e){FastExt.Dialog.hideWait(),e&&FastExt.Dialog.toast("清除成功！")})}},"->",{text:"暂存",iconCls:"extIcon extSave whiteColor",handler:function(){FastExt.Dialog.showWait("暂存中，请稍后……"),FastExt.Server.saveExtConfig(a.getCode(),"TextEditorCache",a.getValue(),function(e,t){FastExt.Dialog.hideWait(),e?FastExt.Dialog.toast("暂存成功！"):FastExt.Dialog.showAlert("系统提醒",t)})}},{text:"重置",iconCls:"extIcon extReset",handler:function(){a.setValue(a.oldValue),FastExt.Server.deleteExtConfig(a.getCode(),"TextEditorCache")}},{text:"确定",iconCls:"extIcon extOk",handler:function(){FastExt.Dialog.showWait("请稍后……"),FastExt.Server.deleteExtConfig(a.getCode(),"TextEditorCache",function(e){FastExt.Dialog.hideWait(),Ext.isFunction(a.editorWin.callBack)&&a.editorWin.callBack(a),a.editorWin.close()})}}]})),a.editorWin.setTitle(n),a.editorWin.callBack=t,a.editorWin.animateTarget=e,a.editorWin.show()}})};FastDefine.ContentField=ContentField;var HtmlContentField=function(){Ext.define("Fast.ext.HtmlContent",{alias:["widget.htmlcontent","widget.htmlcontentfield"],extend:"Ext.form.FieldContainer",height:400,getName:function(){return this.name},autoShowEditor:!0,allowBlank:!0,showEditor:function(){var e=this,t="EditorFrame"+Ext.now();window["editorLoadDone"+t]=function(){e.setValue(e.value),e.setPostImageUrl(FastExt.System.formatUrl("upload?type=editor"))},e.editorFrameId=t;var n=FastExt.System.formatUrlVersion("base/editor/index.html?id="+t);e.update("<iframe id='"+t+"'  src='"+n+"' width='100%' height='100%' frameborder='0' scrolling='no' style='border: 1px solid #d0d0d0;'/>")},listeners:{afterrender:function(e){e.autoShowEditor&&e.showEditor()}},getCode:function(){return $.md5(this.getName()+this.dataIndex+this.getFieldLabel())},isValid:function(){return!0},getValue:function(){var e=this.down("[realValue=true]");return e?e.getValue():this.value},setValue:function(e){var t=this.down("[realValue=true]");t&&t.setValue(e),this.value=e},setHtml:function(e){this.setValue(e)},setPostImageUrl:function(e){var t;!this.editorFrameId||(t=document.getElementById(this.editorFrameId))&&Ext.isFunction(t.contentWindow.getHtmlValue)&&t.contentWindow.setPostImageUrl(e)},initComponent:function(){var n=this;n.items=[{xtype:"textfield",name:n.name,hidden:!0,realValue:!0,fieldLabel:n.fieldLabel,allowBlank:n.allowBlank,validation:"请输入"+n.fieldLabel,isValid:function(){return!(!this.allowBlank&&Ext.isEmpty($(this.getRawValue()).text()))},getRawValue:function(){if(n.editorFrameId){var e=document.getElementById(n.editorFrameId);if(e&&Ext.isFunction(e.contentWindow.getHtmlValue))return e.contentWindow.getHtmlValue()}return null},setValue:function(e){var t;n.value=e,!n.editorFrameId||(t=document.getElementById(n.editorFrameId))&&Ext.isFunction(t.contentWindow.setHtmlValue)&&t.contentWindow.setHtmlValue(e)}}],n.callParent(arguments)},showWindow:function(e,t,n){Ext.isEmpty(n)&&(n="编辑内容");var o,i,a=this;a.autoShowEditor=!1,a.oldValue=a.value,a.editorWin||(o=parseInt((.4*document.body.clientWidth).toFixed(0)),i=parseInt((.6*document.body.clientHeight).toFixed(0)),a.editorWin=Ext.create("Ext.window.Window",{title:n,iconCls:"extIcon extEdit",resizable:!0,maximizable:!0,height:i,width:o,minHeight:500,minWidth:600,layout:"fit",animateTarget:e,items:[a],modal:!0,constrain:!0,closeAction:"hide",listeners:{show:function(e){a.showEditor(),FastExt.Server.showExtConfig(a.getCode(),"HtmlEditorCache",function(e,t){e&&(a.setValue(t),FastExt.Dialog.toast("已恢复暂存的数据！"))})}},buttons:[{text:"清除暂存",iconCls:"extIcon extDelete whiteColor",handler:function(){FastExt.Dialog.showWait("正在清除中，请稍后……"),FastExt.Server.deleteExtConfig(a.getCode(),"HtmlEditorCache",function(e){FastExt.Dialog.hideWait(),e&&FastExt.Dialog.toast("清除成功！")})}},"->",{text:"暂存",iconCls:"extIcon extSave whiteColor",handler:function(){FastExt.Dialog.showWait("暂存中，请稍后……"),FastExt.Server.saveExtConfig(a.getCode(),"HtmlEditorCache",a.getValue(),function(e,t){FastExt.Dialog.hideWait(),e?FastExt.Dialog.toast("暂存成功！"):FastExt.Dialog.showAlert("系统提醒",t)})}},{text:"重置",iconCls:"extIcon extReset",handler:function(){a.setValue(a.oldValue),FastExt.Server.deleteExtConfig(a.getCode(),"HtmlEditorCache")}},{text:"确定",iconCls:"extIcon extOk",handler:function(){a.getCode();FastExt.Dialog.showWait("请稍后……"),FastExt.Server.deleteExtConfig(a.getCode(),"HtmlEditorCache",function(e){FastExt.Dialog.hideWait(),Ext.isFunction(a.editorWin.callBack)&&a.editorWin.callBack(a),a.editorWin.close()})}}]})),a.editorWin.setTitle(n),a.editorWin.callBack=t,a.editorWin.animateTarget=e,a.editorWin.show()}})};FastDefine.HtmlContentField=HtmlContentField;var LinkField=function(){function LinkField(){Ext.define("Fast.ext.Link",{alias:["widget.link","widget.linkfield"],extend:"Ext.form.FieldContainer",entityId:null,entityIdDefaultValue:-1,entityText:null,entityCode:null,linkValue:{},editable:!1,allowBlank:!0,layout:"fit",multiSelect:!1,autoDisabled:!0,submitValue:!0,onBeforeSelect:null,onAfterSelect:null,onClearSelect:null,binds:[],isValid:function(){var e=this.down("[name="+this.name+"Display]");return e.allowBlank=this.allowBlank,e.isValid()},getName:function(){return this.name},getValue:function(){return this.submitValue?this.down("[name="+this.name+"]").getValue():this.getText()},getText:function(){return this.down("[name="+this.name+"Display]").getValue()},setRecordValue:function(e){var t=this;if(e&&(!Ext.isEmpty(t.getText())||!Ext.isEmpty(e.get(t.dataIndex)))){if(e.store&&(e.store.holdUpdate=!0),e.set(t.name,t.getValue()),e.set(t.dataIndex,t.getText()),t.record)for(var n=0;n<t.binds.length;n++){var o=t.binds[n].toString().split("@");if(1<o.length)for(var i=o[0],a=t.record.get(i),r=1;r<o.length;r++)e.set(o[r],a)}e.store&&(e.store.holdUpdate=!1,e.store.fireEvent("endupdate"))}},setValue:function(e,t){var n=this;n.down("[name="+n.name+"Display]").setValue(e),t&&n.setRawValue(t.get(n.name)),e||(n.setRawValue(-1),n.down("[name="+n.name+"MoreFields]").removeAll(!0))},setHtml:function(e){this.setValue(e)},setRawValue:function(e,t){var n=this,o=n.down("[name="+n.name+"]");o&&o.setValue(e);var i=n.down("[name="+n.name+"MoreFields]");if(i.removeAll(!0),t)for(var a=0;a<t.length;a++)(l=Ext.create({xtype:"hiddenfield",name:n.name})).setValue(t[a]),i.add(l);if(n.record)for(a=0;a<n.binds.length;a++){var r=n.binds[a].toString().split("@");if(1<r.length)for(var l,s=r[0],d=n.record.get(s),c=1;c<r.length;c++)(l=Ext.create({xtype:"hiddenfield",name:r[c]})).setValue(d),i.add(l)}},getRawValue:function(){var e=this.down("[name="+this.name+"]");return e?e.getValue():null},getMenu:function(){return this.up("menu")},selectData:function(callback){var me=this,entity,entityObj,display,selectTitle;Ext.isFunction(me.onBeforeSelect)&&!me.onBeforeSelect(me)||(me.getMenu()&&(me.getMenu().holdShow=!0),me.entityCode?me.entityId?me.entityText?(entity=FastExt.System.getEntity(me.entityCode),entity?entity.js?(entityObj=eval("new "+me.entityCode+"()"),Ext.isFunction(entityObj.showSelect)?(display=me.down("[name="+me.name+"Display]"),display.blur(),selectTitle=entity.shortName,me.fieldLabel&&(selectTitle=me.fieldLabel),me.labelTitle&&(selectTitle=me.labelTitle),entityObj.showSelect(this,"选择"+selectTitle,me.linkValue.where,me.multiSelect).then(function(e){if(e){if(Ext.isFunction(callback))return void callback(e);if(1===e.length){var t=e[0];me.record=t,me.setValue(t.get(me.entityText)),me.setRawValue(t.get(me.entityId))}else if(1<e.length){me.record=e[0],me.records=e;for(var n="",o=[],i=0;i<e.length;i++){var a=e[i].get(me.entityText);n+="#"+(a=Ext.isEmpty(a)?"无":a),o.push(e[i].get(me.entityId))}me.setRawValue(o[0],o.slice(1)),me.setValue(n.substring(1))}Ext.isFunction(me.onAfterSelect)&&me.onAfterSelect(me)}me.getMenu()&&(me.getMenu().holdShow=!1)})):FastExt.Dialog.showAlert("系统提醒","'"+me.entityCode+"' JS对象不存在函数showSelect(obj,callBack)！",function(){me.getMenu()&&(me.getMenu().holdShow=!1)})):FastExt.Dialog.showAlert("系统提醒","未获取到 '"+me.entityCode+"' JS对象！",function(){me.getMenu()&&(me.getMenu().holdShow=!1)}):FastExt.Dialog.showAlert("系统提醒","未获取到 '"+me.entityCode+"' 实体类！",function(){me.getMenu()&&(me.getMenu().holdShow=!1)})):FastExt.Dialog.showAlert("系统提醒","请配置组件的entityText属性值！",function(){me.getMenu()&&(me.getMenu().holdShow=!1)}):FastExt.Dialog.showAlert("系统提醒","请配置组件的entityId属性值！",function(){me.getMenu()&&(me.getMenu().holdShow=!1)}):FastExt.Dialog.showAlert("系统提醒","请配置组件的entityCode属性值！",function(){me.getMenu()&&(me.getMenu().holdShow=!1)}))},clearData:function(){var e=this;e.setValue(null),e.setRawValue(-1),e.down("[name="+e.name+"MoreFields]").removeAll(!0),Ext.isFunction(e.onClearSelect)&&e.onClearSelect(e)},initComponent:function(){var t=this;!window.getLinkFieldDefaultValue||(e=window.getLinkFieldDefaultValue(t))&&(t.linkValue?t.linkValue=FastExt.Json.mergeJson(t.linkValue,e):t.linkValue=e),t.linkValue||(t.linkValue={},t.linkValue[t.entityId]=t.entityIdDefaultValue,t.linkValue[t.entityText]=null),t.linkValue.hasOwnProperty(t.entityId)||(t.linkValue[t.entityId]=t.entityIdDefaultValue),Ext.isEmpty(t.linkValue[t.entityId])&&(t.linkValue[t.entityId]=t.entityIdDefaultValue),Ext.isEmpty(t.name)&&(t.name="LinkField"+Ext.now());for(var e=(e=t.linkValue[t.entityText])||t.value,n=[],o=0;o<t.binds.length;o++){var i=t.binds[o].toString().split("@");if(1<i.length)for(var a=i[0],r=t.linkValue[a],l=1;l<i.length;l++)n.push({xtype:"hiddenfield",name:i[l],value:r})}t.items=[{xtype:"hiddenfield",name:t.name,value:t.linkValue[t.entityId]},{xtype:"fieldcontainer",name:t.name+"MoreFields",hidden:!0,items:n},{xtype:"textfield",name:t.name+"Display",editable:t.editable,value:e,disabled:null!=t.linkValue[t.entityText]&&t.autoDisabled,hideLabel:!0,fieldLabel:t.fieldLabel,allowBlank:t.allowBlank,emptyText:"请选择",listeners:{afterrender:function(e){this.editable||e.inputEl.on("click",function(){t.selectData()})}},triggers:{close:{cls:"text-clear",handler:function(){t.clearData(),Ext.isFunction(t.onClearValue)&&t.onClearValue()}},search:{cls:"text-search",handler:function(){t.selectData(),this.inputEl.blur()}}}}],t.callParent(arguments)}})}return LinkField}();FastDefine.LinkField=LinkField;var TargetField=function(){Ext.define("Fast.ext.Target",{alias:["widget.target","widget.targetfield"],extend:"Ext.form.FieldContainer",layout:"column",labelWidth:null,targetType:null,targetTypeReadOnly:!1,targetTypeEnum:null,targetId:null,targetValue:{},targetFunction:"getTargetEntity",targetEnumValue:"id",targetEnumText:"text",include:[],exclude:[],getValue:function(){return this.down("[name="+this.targetId+"]").getText()},setValue:function(e,t){var n=this;n.down("[name="+n.targetId+"]").setValue(e),t&&(n.targetValue={},n.targetValue[n.targetType]=t.get(n.targetType),n.targetValue[n.targetId]=t.get(n.targetId),n.holdIdValue=n.getTargetTypeValue()!=t.get(n.targetType),n.setTargetIdValue(t.get(n.targetId)),n.setTargetTypeValue(t.get(n.targetType)))},setHtml:function(e){this.setValue(e)},getSearchField:function(){},setRecordValue:function(e){var t=this;e&&(e.store&&(e.store.holdUpdate=!0),t.targetId&&e.set(t.targetId,t.getTargetIdValue()),t.targetType&&e.set(t.targetType,t.getTargetTypeValue()),t.targetText&&t.targetText!=t.dataIndex&&e.set(t.targetText,t.getValue()),e.set(t.dataIndex,t.getValue()),e.store&&(e.store.holdUpdate=!1,e.store.fireEvent("endupdate")))},setTargetTypeValue:function(e){var t=this.down("[name="+this.targetType+"]");t&&t.setValue(e)},getTargetTypeValue:function(){var e=this.down("[name="+this.targetType+"]");return e?e.getValue():0},setTargetIdValue:function(e){var t=this.down("[name="+this.targetId+"]");t&&t.setRawValue(e)},getTargetIdValue:function(){var e=this.down("[name="+this.targetId+"]");return e?e.getRawValue():-1},getTargetEntity:function(e){var t=window[this.targetFunction](e,this.targetType);return t||(FastExt.Dialog.showAlert("目标组件错误","未获取到TargetType为："+e+"的实体配置！"),null)},showWindow:function(e,t,n){Ext.isEmpty(n)&&(n="编辑目标数据");var o=this;o.editorWin||(o.editorWin=Ext.create("Ext.window.Window",{title:n,height:220,width:400,minWidth:400,minHeight:220,layout:"fit",resizable:!0,modal:!0,constrain:!0,closeAction:"hide",iconCls:"extIcon extLink",items:[o],buttons:[{text:"取消",iconCls:"extIcon extClose",handler:function(){o.editorWin.close()}},{text:"确定",iconCls:"extIcon extOk",handler:function(){o.editorWin.close(),Ext.isFunction(o.editorWin.callBack)&&o.editorWin.callBack(o)}}]})),o.editorWin.setTitle(n),o.editorWin.callBack=t,o.editorWin.animateTarget=e,o.editorWin.show()},initComponent:function(){var i=this,e=i.fieldLabel;Ext.isEmpty(e)&&(e="目标类型"),i.fieldLabel="",i.labelWidth||(i.labelWidth=60),i.labelAlign="right",i.emptyText||(i.emptyText="请填写"),i.margin||(i.margin="5 5 5 5");var t={};if(!Ext.isFunction(window[i.targetFunction]))return FastExt.Dialog.showAlert("目标组件错误","未检测到方法"+i.targetFunction+"!"),void i.callParent(arguments);i.targetValue||(i.targetValue={},i.targetValue[i.targetType]=0,i.targetValue[i.targetId]=-1),i.targetValue[i.targetType]||(i.targetValue[i.targetType]=0),i.targetValue[i.targetId]||(i.targetValue[i.targetId]=-1),i.targetEnum&&(i.targetTypeEnum=i.targetEnum),i.targetTypeEnum||(i.targetTypeEnum=i.targetType.replace(i.targetType[0],i.targetType[0].toUpperCase())+"Enum");var n=i.targetValue[i.targetType],o=i.getTargetEntity(n);o&&(t[o.entityId]=i.targetValue[i.targetId],t[o.entityText]=i.targetValue.targetText,e={name:i.targetType,xtype:"enumcombo",fieldLabel:e,columnWidth:1,value:n,labelWidth:i.labelWidth,labelAlign:i.labelAlign,emptyText:"请选择"+e,margin:i.margin,allowBlank:!1,enumValue:i.targetEnumValue,enumText:i.targetEnumText,readOnly:i.targetTypeReadOnly,enumName:i.targetTypeEnum,exclude:i.exclude,include:i.include,listeners:{change:function(e,t,n){var o=i.getTargetEntity(t);o&&((t=i.down("[name="+i.targetId+"]")).entityCode=o.entityCode,t.entityId=o.entityId,t.entityText=o.entityText,i.holdIdValue?i.holdIdValue=!1:t.setValue(null))}}},t={name:i.targetId,xtype:"linkfield",fieldLabel:"目标数据",columnWidth:1,margin:i.margin,labelWidth:i.labelWidth,labelAlign:i.labelAlign,entityCode:o.entityCode,entityId:o.entityId,entityText:o.entityText,linkValue:t,multiSelect:i.multiSelect},i.items=[e,t],i.callParent(arguments))}})};FastDefine.TargetField=TargetField;var MapField=function(){Ext.define("Fast.ext.Map",{alias:["widget.map","widget.mapfield"],extend:"Ext.form.FieldContainer",lngName:"lnt",latName:"lat",proName:null,cityName:null,areaName:null,editable:!1,emptyText:"请选择",allowBlank:!0,layout:"fit",submitValue:!0,isValid:function(){return this.down("[name="+this.name+"]").isValid()},getName:function(){return this.name},getValue:function(){return this.down("[name="+this.name+"]").getValue()},setValue:function(e,t){var n=this;n.down("[name="+n.name+"]").setValue(e),t&&(n.latName&&n.setLatValue(t.get(n.latName)),n.lngName&&n.setLngValue(t.get(n.lngName)),n.proName&&n.setProValue(t.get(n.proName)),n.cityName&&n.setCityValue(t.get(n.cityName)),n.areaName&&n.setAreaValue(t.get(n.areaName)))},setRecordValue:function(e){var t=this;e&&(e.store&&(e.store.holdUpdate=!0),t.latName&&e.set(t.latName,t.getLatValue()),t.lngName&&e.set(t.lngName,t.getLngValue()),t.proName&&e.set(t.proName,t.getProValue()),t.cityName&&e.set(t.cityName,t.getCityValue()),t.areaName&&e.set(t.areaName,t.getAreaValue()),e.set(t.name,t.getValue()),e.store&&(e.store.holdUpdate=!1,e.store.fireEvent("endupdate")))},setLatValue:function(e){var t=this.down("[name="+this.latName+"]");t&&t.setValue(e)},setLngValue:function(e){var t=this.down("[name="+this.lngName+"]");t&&t.setValue(e)},setProValue:function(e){var t=this.down("[name="+this.proName+"]");t&&t.setValue(e)},setCityValue:function(e){var t=this.down("[name="+this.cityName+"]");t&&t.setValue(e)},setAreaValue:function(e){var t=this.down("[name="+this.areaName+"]");t&&t.setValue(e)},getLatValue:function(){var e=this.down("[name="+this.latName+"]");return e?e.getValue():0},getLngValue:function(){var e=this.down("[name="+this.lngName+"]");return e?e.getValue():0},getProValue:function(){var e=this.down("[name="+this.proName+"]");return e?e.getValue():null},getCityValue:function(){var e=this.down("[name="+this.cityName+"]");return e?e.getValue():null},getAreaValue:function(){var e=this.down("[name="+this.areaName+"]");return e?e.getValue():null},getMenu:function(){return this.up("menu")},selectData:function(){var t=this;t.getMenu()&&(t.getMenu().holdShow=!0),t.down("[name="+t.name+"]").blur(),FastExt.Map.selAddressInMap(t,t.getLngValue(),t.getLatValue(),t.getValue()).then(function(e){e&&(t.setLatValue(e.lat),t.setLngValue(e.lng),t.setProValue(e.pro),t.setAreaValue(e.area),t.setCityValue(e.city),t.setValue(e.addr)),t.getMenu()&&(t.getMenu().holdShow=!1)})},clearData:function(){this.setValue(null),this.setLatValue(0),this.setLngValue(0)},initComponent:function(){var t=this;t.name||(t.name=t.dataIndex),Ext.isEmpty(t.name)&&(t.name="MapField"+Ext.now()),t.items=[{xtype:"hiddenfield",name:t.lngName,value:0},{xtype:"hiddenfield",name:t.latName,value:0},{xtype:"hiddenfield",name:t.proName},{xtype:"hiddenfield",name:t.cityName},{xtype:"hiddenfield",name:t.areaName},{xtype:"textfield",name:t.name,editable:t.editable,fieldLabel:t.fieldLabel,hideLabel:!0,allowBlank:t.allowBlank,emptyText:t.emptyText,listeners:{afterrender:function(e){this.editable||e.inputEl.on("click",function(){t.selectData()})}},triggers:{close:{cls:"text-clear",handler:function(){t.clearData(),Ext.isFunction(t.onClearValue)&&t.onClearValue()}},search:{cls:"text-search",handler:function(){t.selectData(),this.inputEl.blur()}}}}],t.callParent(arguments)}})};FastDefine.MapField=MapField;var PCAField=function(){Ext.define("Fast.ext.PCA",{alias:["widget.pca","widget.pcafield"],extend:"Ext.form.field.Text",proName:null,cityName:null,areaName:null,onAfterSelect:null,level:null,selectType:0,setRecordValue:function(e,t){var n=this;t=FastExt.Base.toBool(t,!0),e&&(e.store&&(e.store.holdUpdate=!0),n.proName&&n.name!==n.proName&&n.province&&e.set(n.proName,n.province.provinceName),n.cityName&&n.name!==n.cityName&&n.city&&e.set(n.cityName,n.city.cityName),n.areaName&&n.name!==n.areaName&&n.area&&e.set(n.areaName,n.area.areaName),e.set(n.name,n.getValue()),e.store&&(e.store.holdUpdate=!1,e.store.fireEvent("endupdate"))),t&&n.clearData()},getMenu:function(){return this.up("menu")},selectData:function(){var i=this;i.getMenu()&&(i.getMenu().holdShow=!0),Ext.isFunction(window.selectPCA)?(i.blur(),window.selectPCA(i,function(e,t,n,o){FastExt.Base.toBool(e,!1)?(i.province=t,i.area=o,i.city=n,(e=i.up("form"))&&(t&&i.proName&&e.setFieldValue(i.proName,t.provinceName),n&&i.cityName&&e.setFieldValue(i.cityName,n.cityName),o&&i.areaName&&e.setFieldValue(i.areaName,o.areaName)),e="",t&&(e=t.provinceName,i.name===i.proName&&(i.setValue(t.provinceName),e=null)),n&&(e&&(0===i.selectType?e+=" "+n.cityName:e=n.cityName),i.name===i.cityName&&(i.setValue(n.cityName),e=null)),o&&(e&&(0===i.selectType?e+=" "+o.areaName:e=o.areaName),i.name===i.areaName&&(i.setValue(o.areaName),e=null)),e&&i.setValue(e),i.getMenu()&&(i.getMenu().holdShow=!1),Ext.isFunction(i.onAfterSelect)&&i.onAfterSelect(i)):i.getMenu()&&(i.getMenu().holdShow=!1)},i.level)):FastExt.Dialog.showAlert("系统提醒","未检测到函数selectPCA！请导入FastChar-Location插件！",function(){i.getMenu()&&(i.getMenu().holdShow=!1)})},clearData:function(){this.setValue(null),this.province=null,this.area=null,this.city=null},triggers:{close:{cls:"text-clear",handler:function(){this.clearData(),Ext.isFunction(this.onClearValue)&&this.onClearValue()}},search:{cls:"text-search",handler:function(){this.selectData(),this.inputEl.blur()}}},listeners:{afterrender:function(e){var t=this;this.editable||e.inputEl.on("click",function(){t.selectData()})}},initComponent:function(){this.emptyText="请选择省市区",this.editable=!1,this.province=null,this.area=null,this.city=null,this.callParent(arguments)}})};FastDefine.PCAField=PCAField;var DateRangeField=function(){Ext.define("Fast.ext.DateRange",{alias:["widget.daterange","widget.daterangefield"],extend:"Ext.form.field.Text",beginDate:null,endDate:null,editable:!0,allowBlank:!0,maxRangeDate:-1,maxRangeMonth:-1,maxRangeYear:-1,layout:"column",format:"Y-m-d",submitValue:!0,onAfterSelect:null,onClearValue:null,getMenu:function(){return this.up("menu")},selectData:function(){var i=this;i.getMenu()&&(i.getMenu().holdShow=!0);var a=Ext.now(),r=Ext.create("Ext.menu.Menu",{floating:!0,items:[{xtype:"panel",padding:"10 10 10 10",layout:"column",style:{background:"#ffffff",borderWidth:1,borderColor:"#ffffff",color:"#eeeee"},border:0,items:[{xtype:"combo",fieldLabel:"快速选择",valueField:"value",labelWidth:60,margin:"5 5 5 5",editable:!1,columnWidth:1,triggers:{close:{cls:"text-clear",handler:function(){this.setValue(null),i.clearData()}}},listeners:{change:function(e,t,n,o){if(t){i.endDate=Ext.Date.format(new Date,i.format),6===t?i.beginDate=Ext.Date.format(new Date,i.format):1===t?i.beginDate=Ext.Date.format(Ext.Date.add(new Date,Ext.Date.DAY,-7),i.format):2===t?i.beginDate=Ext.Date.format(Ext.Date.add(new Date,Ext.Date.MONTH,-1),i.format):3===t?i.beginDate=Ext.Date.format(Ext.Date.add(new Date,Ext.Date.MONTH,-3),i.format):4===t?i.beginDate=Ext.Date.format(Ext.Date.add(new Date,Ext.Date.MONTH,-6),i.format):5===t&&(i.beginDate=Ext.Date.format(Ext.Date.add(new Date,Ext.Date.YEAR,-1),i.format));t=i.refreshValue();if(t)return FastExt.Dialog.toast(t),e.setValue(null),i.clearData(),void FastExt.Component.shakeComment(r);Ext.getCmp("beginDate"+a).setValue(i.beginDate),Ext.getCmp("endDate"+a).setValue(i.endDate)}}},store:Ext.create("Ext.data.Store",{data:[{text:"今天",value:6},{text:"近一周",value:1},{text:"近一个月",value:2},{text:"近三个月",value:3},{text:"近六个月",value:4},{text:"近一年",value:5}]})},{fieldLabel:"开始日期",margin:"5 5 5 5",xtype:"datefield",id:"beginDate"+a,columnWidth:1,labelWidth:60,format:i.format,value:i.beginDate,emptyText:"开始日期"},{fieldLabel:"结束日期",margin:"5 5 5 5",xtype:"datefield",id:"endDate"+a,columnWidth:1,labelWidth:60,format:i.format,value:i.endDate,emptyText:"结束日期"},{xtype:"panel",layout:"hbox",columnWidth:1,border:0,items:[{xtype:"button",text:"确定",margin:"5 5 5 5",flex:.42,handler:function(){var e=Ext.getCmp("beginDate"+a).getValue(),t=Ext.getCmp("endDate"+a).getValue();i.beginDate=Ext.util.Format.date(e,i.format),i.endDate=Ext.util.Format.date(t,i.format),Ext.isEmpty(i.beginDate)&&(i.beginDate=Ext.Date.format(new Date(0),i.format)),Ext.isEmpty(i.endDate)&&(i.endDate=Ext.Date.format(new Date,i.format));t=i.refreshValue();if(t)return FastExt.Dialog.toast(t),void FastExt.Component.shakeComment(r);Ext.isFunction(i.onAfterSelect)&&i.onAfterSelect(i),r.close()}}]}]}]});r.setWidth(Math.max(this.getWidth(),200)),r.showBy(this,"tl-bl?")},clearData:function(){this.setValue(null),this.beginDate=null,this.endDate=null},refreshValue:function(){var e=this;e.setValue(null);var t=Ext.Date.parse(e.beginDate,e.format),n=Ext.Date.parse(e.endDate,e.format);if(n<t)return e.clearData(),"开始日期必须小于等于结束日期！";if(0<e.maxRangeDate){var o=Ext.Date.add(t,Ext.Date.DAY,e.maxRangeDate);if(!Ext.Date.between(n,t,o))return e.clearData(),"日期范围区间必须在"+e.maxRangeDate+"天以内！"}if(0<e.maxRangeMonth){o=Ext.Date.add(t,Ext.Date.MONTH,e.maxRangeMonth);if(!Ext.Date.between(n,t,o))return e.clearData(),"日期范围区间必须在"+e.maxRangeMonth+"个月以内！"}if(0<e.maxRangeYear){o=Ext.Date.add(t,Ext.Date.YEAR,e.maxRangeYear);if(!Ext.Date.between(n,t,o))return e.clearData(),"日期范围区间必须在"+e.maxRangeYear+"年以内！"}return e.setValue(e.beginDate+" 至 "+e.endDate),Ext.Date.isEqual(t,n)&&e.setValue("今天"),null},triggers:{close:{cls:"text-clear",handler:function(){this.clearData(),Ext.isFunction(this.onClearValue)&&this.onClearValue()}},search:{cls:"text-search",handler:function(){this.selectData(),this.inputEl.blur()}}},initComponent:function(){this.editable=!1,this.refreshValue(),this.callParent(arguments)}})};FastDefine.DateRangeField=DateRangeField;var DateField=function(){Ext.define("Fast.ext.Date",{alias:["widget.date","widget.datefield"],extend:"Ext.form.field.Text",format:"Y-m-d H:i:s",getMenu:function(){return this.up("menu")},isValid:function(){var e=this;if(e.callParent(arguments)){if(!Ext.isEmpty(e.getValue()))if(!Ext.Date.parse(e.getValue(),this.format))return e.invalidText="日期格式错误！格式必须为："+this.format,e.markInvalid(this.invalidText),!1;return!0}return!1},selectData:function(){var t=this;null!=t.getMenu()&&(t.getMenu().holdShow=!0),FastExt.Dialog.showFastDatePicker(t.bodyEl,t.getValue(),this.format).then(function(e){null!=t.getMenu()&&(t.getMenu().holdShow=!1),e&&t.setValue(e)})},triggers:{search:{cls:"x-form-date-trigger",handler:function(){this.selectData()}}},listeners:{afterrender:function(e){var t=this;this.editable||e.inputEl.on("click",function(){t.selectData()})}},initComponent:function(){this.callParent(arguments)}})};FastDefine.DateField=DateField;var ColorField=function(){Ext.define("Fast.ext.ColorField",{extend:"Ext.form.field.Text",alias:["widget.colorfield"],editable:!1,getMenu:function(){return this.up("menu")},beforeBodyEl:['<div class="'+Ext.baseCSSPrefix+'colorpicker-field-swatch"><div id="{id}-swatchEl" data-ref="swatchEl" class="'+Ext.baseCSSPrefix+'colorpicker-field-swatch-inner"></div></div>'],cls:Ext.baseCSSPrefix+"colorpicker-field",childEls:["swatchEl"],setValue:function(e){e=FastExt.Color.toColor(e);var t=this,n=t.inputEl;return n&&t.emptyText&&!Ext.isEmpty(e)&&(n.removeCls(t.emptyUICls),t.valueContainsPlaceholder=!1),t.callParent(arguments),t.applyEmptyText(),Ext.ux.colorpick.ColorUtils.setBackground(t.swatchEl,Ext.ux.colorpick.ColorUtils.parseColor(e)),t},triggers:{search:{cls:"extIcon extSearch",handler:function(){this.selectData()}}},selectData:function(){var t=this;null!=t.getMenu()&&(t.getMenu().holdShow=!0),FastExt.Dialog.showFastColorPicker(t.inputEl,t.getValue(),function(e){t.setValue(e.toHEXA().toString())}).then(function(e){null!=t.getMenu()&&(t.getMenu().holdShow=!1)})},clearData:function(){this.setValue(null)}})},subClass;for(subClass in FastDefine.ColorField=ColorField,FastDefine)FastDefine[subClass]()}(FastDefine=FastDefine||{}),function(y){var e=(t.showWait=function(e){Ext.MessageBox.show({alwaysOnTop:!0,modal:!0,title:"系统提醒",msg:e,progressText:"请耐心等待，即将完成操作",progress:!0,closable:!1});var t=0,n=function(){Ext.MessageBox.isHidden()||(130===(t+=.5)&&(t=0),Ext.MessageBox.updateProgress(t/100,"请耐心等待，即将完成操作"),setTimeout(n,5))};setTimeout(n,5)},t.hideWait=function(){Ext.MessageBox.isVisible()&&Ext.MessageBox.hide()},t.toast=function(e){Ext.toast({html:e,closable:!0,align:"t",slideInDuration:200,slideBackDuration:200,minWidth:180,slideBackAnimation:"easeOut",iconCls:"extIcon extInfo",title:"消息提示"})},t.showHtml=function(e,t,n){var o=parseInt((.4*document.body.clientWidth).toFixed(0)),i=parseInt((.6*document.body.clientHeight).toFixed(0));Ext.create("Ext.window.Window",{title:t,layout:"fit",height:i,width:o,minHeight:500,minWidth:600,constrain:!0,resizable:!0,maximizable:!0,modal:!0,maximized:!1,iconCls:"extIcon extSee",draggable:!0,scrollable:!0,html:n,alwaysOnTop:!0,toFrontOnShow:!0}).show()},t.showLink=function(e,t,n,o){var i=parseInt((.4*document.body.clientWidth).toFixed(0)),a=parseInt((.6*document.body.clientHeight).toFixed(0)),r=Ext.create("Ext.panel.Panel",{layout:"border",region:"center",border:0,iframePanel:!0,listeners:{afterrender:function(e,t){this.setLoading("正在努力加载中，请稍后……"),this.update("<iframe onload='iFrameLoadDone()' src='"+n+"'  width='100%' height='100%' frameborder='0'>")}}});window.iFrameLoadDone=function(){r.setLoading(!1)},Ext.create("Ext.window.Window",y.Json.mergeJson({title:t,layout:"fit",height:a,width:i,minHeight:500,minWidth:600,resizable:!0,maximizable:!0,modal:!0,constrain:!0,maximized:!1,iconCls:"extIcon extSee",draggable:!0,scrollable:!1,alwaysOnTop:!0,toFrontOnShow:!0,items:[r],listeners:{close:function(){window.iFrameLoadDone=null}}},o)).show()},t.showEditorHtml=function(e,t,n,o){var i=parseInt((.4*document.body.clientWidth).toFixed(0)),a=parseInt((.6*document.body.clientHeight).toFixed(0));Ext.create("Ext.window.Window",{title:t,layout:"fit",height:a,width:i,minHeight:500,minWidth:600,resizable:!0,maximizable:!0,modal:!0,constrain:!0,maximized:!1,iconCls:"extIcon extSee",draggable:!0,scrollable:!1,alwaysOnTop:!0,toFrontOnShow:!0,iframePanel:!0,listeners:{show:function(){var e=y.System.formatUrlVersion("base/editor/show.html");window.showEditorDone=function(){window.showEditorFrame.window.showContent(n)},this.update("<iframe name='showEditorFrame' src='"+e+"'  width='100%' height='100%' frameborder='0'>")}}}).show()},t.showText=function(e,t,n,o){var i=parseInt((.4*document.body.clientWidth).toFixed(0)),a=parseInt((.6*document.body.clientHeight).toFixed(0));Ext.create("Ext.window.Window",{title:n,icon:t,iconCls:t,maximizable:!0,height:a,width:i,minHeight:500,minWidth:600,resizable:!0,layout:"fit",animateTarget:e,items:[{xtype:"textarea",value:o}],modal:!0,constrain:!0,alwaysOnTop:!0}).show()},t.showCode=function(t,n,e){try{t&&t.blur();var o=parseInt((.4*document.body.clientWidth).toFixed(0)),i=parseInt((.6*document.body.clientHeight).toFixed(0)),a=Ext.create("Ext.window.Window",{title:"查看内容",height:i,width:o,minHeight:500,minWidth:600,animateTarget:t,resizable:!0,layout:"fit",maximizable:!0,iconCls:"extIcon extSee",autoScroll:!0,modal:!0,constrain:!0,bodyStyle:{background:"#000000"},listeners:{show:function(e){PR.prettyPrint()}}});e?a.update("<pre class='prettyprint linenums windowpre'>"+n+"</pre>"):a.update("<pre class='prettyprint windowpre'>"+n+"</pre>"),a.show()}catch(e){y.Dialog.showText(t,null,"查看内容",n)}},t.showException=function(e,t){var n,o;e&&(y.Dialog.hideWait(),(n=e)instanceof Error&&(n=(n=e.stack).replace(/\n/g,"<br/>").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;").replace(/ /g,"&nbsp;&nbsp;")),null!=t?t+="，来自"+t:t="",y.System.getExt("debug").value&&(o=Ext.create("Ext.window.Window",{title:"系统异常",height:180,width:270,layout:"fit",resizable:!1,maximizable:!1,constrain:!0,fixed:!0,modal:!0,draggable:!1,iconCls:"extIcon extError",html:"<div  style='padding:15px;background: #fff;' align='center'>【"+t+"】系统发生异常，请及时告知系统管理员！</div>",buttons:[{text:"下次再说",flex:1,handler:function(){o.close()}},{text:"查看错误",flex:1,handler:function(){y.Dialog.showCode(this,n,!0)}}]})).show(),console.error(e))},t.showAlert=function(e,t,n,o){Ext.isEmpty(o)&&(o=!0),Ext.MessageBox.show({title:e,message:t,modal:o,defaultFocus:1,buttons:Ext.MessageBox.OK,fn:n,minWidth:250})},t.showImage=function(e,n,t,o){Ext.isEmpty(o)&&(o=!1);var i=[];Ext.isArray(n)?i=n:i.push({url:n});var a=-1;if(null!=Ext.getStore("ImageViewStore")){var r=!1,l=Ext.getStore("ImageViewStore");return l.each(function(e,t){if(e.get("url")===n)return r=!0,Ext.getCmp("ImageViewGrid").getSelectionModel().select(t),!1}),void(r||(l.add(i),-1===a&&(a=l.count()-1),l.imgSelectIndex=a,Ext.getCmp("ImageViewGrid").getSelectionModel().select(a)))}-1===a&&(a=0);var s=Ext.create("Ext.data.Store",{fields:["url"],autoLoad:!1,imgSelectIndex:a,id:"ImageViewStore",data:i}),d=Ext.create("Ext.grid.Panel",{store:s,region:"west",hideHeaders:!0,id:"ImageViewGrid",width:125,disabled:!0,border:1,scrollable:"y",columns:[{header:"文件",dataIndex:"url",flex:1,align:"center",renderer:function(e){return Ext.isEmpty(e)?"<span style='color: #ccc;'>无</span>":"<img width='30px' onerror=\"javascript:this.src='images/default_img.png';\" src='"+e+"'/>"}}],tbar:[{xtype:"button",border:1,text:"打包下载",iconCls:"extIcon extDownload",handler:function(e){var n={};s.each(function(e,t){n["path"+t]=e.get("url")}),y.Form.buildForm("zipFile",n).submit()}}],listeners:{selectionchange:function(){try{var e=0;1<this.getStore().getCount()?(this.setHidden(!1),e=120):this.setHidden(!0);var t=this.getSelectionModel().getSelection();setTimeout(function(){window.imgViewFrame.window.showImage(y.System.formatUrl(t[0].get("url")),y.System.http)},e)}catch(e){y.Dialog.showException(e,"showImage")}}}});window.imageViewerLoadDone=function(){Ext.getCmp("ImageViewGrid").setDisabled(!1);try{var e=Ext.getStore("ImageViewStore").imgSelectIndex;Ext.getCmp("ImageViewGrid").getSelectionModel().select(e)}catch(e){y.Dialog.showException(e,"showImage")}},window.imageViewerSize=function(e,t){Ext.getCmp("ImageViewWindow").setTitle("查看图片 "+e+"x"+t)};l=Ext.create("Ext.panel.Panel",{layout:"fit",region:"center",border:0,height:"auto",iframePanel:!0,html:'<div style="background: #000000;width: 100%;height: 100%;"></div>',listeners:{afterrender:function(e,t){s.getCount()<=1?d.setHidden(!0):d.setHidden(!1),e.update("<iframe style='background: #000000;width: 100%;height: 100%;' name='imgViewFrame'  src='"+y.System.formatUrlVersion("base/image-view/index.html")+"' width='100%' height='100%' frameborder='0' scrolling='no' />")}},bbar:{xtype:"toolbar",dock:"bottom",layout:{type:"hbox",align:"middle",pack:"center"},items:[{xtype:"button",iconCls:"extIcon extZoomOut",handler:function(){window.imgViewFrame.window.zoomOut()}},{xtype:"button",iconCls:"extIcon extZoomIn",handler:function(){window.imgViewFrame.window.zoomIn()}},{xtype:"button",iconCls:"extIcon extOneOne",handler:function(){window.imgViewFrame.window.oneOne()}},{xtype:"button",iconCls:"extIcon extAround",handler:function(){window.imgViewFrame.window.rotate()}},{xtype:"button",iconCls:"extIcon extLeftRight",handler:function(){window.imgViewFrame.window.flipA()}},{xtype:"button",iconCls:"extIcon extTopBottom",handler:function(){window.imgViewFrame.window.flipB()}},{xtype:"button",iconCls:"extIcon extDownload2",handler:function(){var e=d.getSelectionModel().getSelection();y.Base.download(e[0].get("url"))}}]}}),a=parseInt((.4*document.body.clientWidth).toFixed(0)),i=parseInt((.6*document.body.clientHeight).toFixed(0));Ext.create("Ext.window.Window",{title:"查看图片",height:i,width:a,minHeight:500,minWidth:600,id:"ImageViewWindow",layout:"border",iconCls:"extIcon extImage",resizable:!0,alwaysOnTop:!0,maximizable:!0,modal:o,constrain:!0,animateTarget:e,items:[d,l],listeners:{close:function(e){s.destroy(),Ext.isFunction(t)&&t()}}}).show()},t.showVideo=function(e,t){e&&e.blur(),Ext.create("Ext.window.Window",{title:"查看视频",layout:"fit",height:600,width:700,resizable:!1,constrain:!0,maximizable:!1,modal:!0,maximized:!1,iconCls:"extIcon extSee",draggable:!0,scrollable:!1,alwaysOnTop:!0,toFrontOnShow:!0,listeners:{show:function(){var e=y.System.formatUrlVersion("base/video/player.html");window.getVideoUrl=function(){return t},this.update("<iframe allowfullscreen='allowfullscreen' mozallowfullscreen='mozallowfullscreen' msallowfullscreen='msallowfullscreen' oallowfullscreen='oallowfullscreen' webkitallowfullscreen='webkitallowfullscreen' style='background-color: black;' name='showVideoFrame' src='"+e+"'  width='100%' height='100%' frameborder='0' scrolling='no' >")}}}).show()},t.showEditor=function(e,t,n){e&&e.blur();var o="PublicTextArea"+(new Date).getTime(),i=parseInt((.4*document.body.clientWidth).toFixed(0)),a=parseInt((.6*document.body.clientHeight).toFixed(0)),r=Ext.create("Ext.window.Window",{title:t,iconCls:"extIcon extEdit",resizable:!0,maximizable:!0,height:a,width:i,minHeight:500,minWidth:600,layout:"fit",animateTarget:e,items:[{id:o,emptyText:"请输入内容……",xtype:"textarea"}],modal:!0,constrain:!0,closeAction:"hide",listeners:{show:function(e){y.Server.showExtConfig("PublicEditor","TextEditorCache",function(e,t){e&&Ext.getCmp(o).setValue(t),Ext.getCmp(o).focus()})}},buttons:[{text:"暂存",iconCls:"extIcon extSave whiteColor",handler:function(){y.Dialog.showWait("暂存中，请稍后……"),y.Server.saveExtConfig("PublicEditor","TextEditorCache",Ext.getCmp(o).getValue(),function(e,t){y.Dialog.hideWait(),e?y.Dialog.toast("暂存成功！"):y.Dialog.showAlert("系统提醒",t)})}},{text:"重置",iconCls:"extIcon extReset",handler:function(){Ext.getCmp(o).setValue(null),y.Server.deleteExtConfig("PublicEditor","TextEditorCache")}},{text:"确定",iconCls:"extIcon extOk",handler:function(){y.Dialog.showWait("请稍后……"),y.Server.deleteExtConfig("PublicEditor","TextEditorCache",function(e){y.Dialog.hideWait(),Ext.isFunction(n)&&n(Ext.getCmp(o).getValue()),r.close()})}}]});r.show()},t.showJson=function(t,n,o){try{t&&t.blur();var e=parseInt((.4*document.body.clientWidth).toFixed(0)),i=parseInt((.6*document.body.clientHeight).toFixed(0)),a=Ext.create("Ext.window.Window",{title:n,height:i,width:e,minHeight:500,minWidth:600,animateTarget:t,resizable:!0,layout:"fit",maximizable:!0,iconCls:"extIcon extSee",autoScroll:!0,modal:!0,constrain:!0}),r=new JSONFormat(o,4).toString();a.update("<div style='padding: 20px;'>"+r+"</div>"),a.show()}catch(e){y.Dialog.showText(t,null,n,o)}},t.showFormatJson=function(t,n){try{t&&t.blur();var e=parseInt((.4*document.body.clientWidth).toFixed(0)),o=parseInt((.6*document.body.clientHeight).toFixed(0)),i=Ext.create("Ext.window.Window",{title:"查看数据",height:o,width:e,minHeight:500,minWidth:600,animateTarget:t,layout:"fit",resizable:!0,maximizable:!0,iconCls:"extIcon extSee",autoScroll:!0,modal:!0,constrain:!0}),a=new JSONFormat(n,4).toString();i.update("<div style='padding: 20px;'>"+a+"</div>"),i.show()}catch(e){y.Dialog.showText(t,null,"查看数据",n)}},t.showFastDatePicker=function(f,p,E){return new Ext.Promise(function(i,e){var a=(new Date).getTime();Ext.isEmpty(E)&&(E="Y-m-d H:i:s");for(var t=[],n=0;n<24;n++){var o=y.Base.prefixInteger(n,2);t.push({text:o})}for(var r=[],n=0;n<60;n++){o=y.Base.prefixInteger(n,2);r.push({text:o})}var l=(l=!Ext.isEmpty(p)?Ext.Date.parse(p,E):l)||new Date,s=Ext.Date.format(l,"H"),d=Ext.Date.format(l,"i"),c=Ext.Date.format(l,"s"),u=0,x=-1!==E.indexOf("H"),m=-1!==E.indexOf("i"),g=-1!==E.indexOf("s");x&&u++,m&&u++,g&&u++;var h=Ext.create("Ext.menu.Menu",{showSeparator:!1,layout:"border",padding:"0 0 0 0",style:{background:"#ffffff"},alwaysOnTop:!0,width:330,height:400,listeners:{hide:function(e,t){y.Base.runCallBack(i)}},items:[{xtype:"datepicker",id:"dateValue"+a,region:"center",showToday:!1,margin:"0 0 0 0",border:0,value:l},{xtype:"panel",layout:"column",margin:"0 0 0 0",region:"south",border:0,items:[{xtype:"panel",columnWidth:1,layout:"column",border:0,items:[{id:"hourValue"+a,columnWidth:1/u,emptyText:"时",minValue:0,margin:"0 0 0 5",maxValue:23,displayField:"text",valueField:"text",editable:!1,hidden:!x,value:s,store:Ext.create("Ext.data.Store",{autoLoad:!0,data:t}),xtype:"combo"},{xtype:"displayfield",width:30,hidden:!x,value:"<div align='center'>时</div>"},{id:"minuteValue"+a,columnWidth:1/u,emptyText:"分",minValue:0,maxValue:59,displayField:"text",valueField:"text",editable:!1,value:d,hidden:!m,store:Ext.create("Ext.data.Store",{autoLoad:!0,data:r}),xtype:"combo"},{xtype:"displayfield",width:30,hidden:!m,value:"<div align='center'>分</div>"},{id:"secondsValue"+a,columnWidth:1/u,emptyText:"秒",minValue:0,maxValue:59,displayField:"text",valueField:"text",editable:!1,value:c,hidden:!g,store:Ext.create("Ext.data.Store",{autoLoad:!0,data:r}),xtype:"combo"},{xtype:"displayfield",width:30,hidden:!g,value:"<div align='center'>秒</div>"}]},{xtype:"button",columnWidth:1,margin:"5 5 5 5",text:"确定",handler:function(){var e=Ext.getCmp("dateValue"+a),t=Ext.getCmp("hourValue"+a),n=Ext.getCmp("minuteValue"+a),o=Ext.getCmp("secondsValue"+a),e=e.getValue();e.setHours(parseInt(t.getValue())),e.setMinutes(parseInt(n.getValue())),e.setSeconds(parseInt(o.getValue())),y.Base.runCallBack(i,Ext.Date.format(e,E)),h.close()}}]}]});h.showBy(f)})},t.showFastColorPicker=function(t,o,i){return Ext.isEmpty(o)&&(o="#42445a"),new Ext.Promise(function(n,e){Ext.create("Ext.menu.Menu",{showSeparator:!1,layout:"border",padding:"0 0 0 0",style:{background:"#ffffff"},alwaysOnTop:!0,width:250,height:320,listeners:{hide:function(e,t){y.Base.runCallBack(n)},mouseleave:function(e){var t=window.colorPickerFrame.window.document.getElementsByTagName("body")[0];y.Base.dispatchTargetEvent(window.colorPickerFrame.window.document,t,"mouseup")}},items:[{xtype:"panel",region:"center",margin:"0 0 0 0",border:0,listeners:{afterrender:function(){var t=this;window.onColorPickerLoadDone=function(e){t.setLoading(!1),e.on("change",function(e,t,n){Ext.isFunction(i)&&i(e,t,n)})},t.setLoading("加载控件中……");var e=y.System.formatUrlVersion("base/colorpicker/index.html",{color:o.replace("#","")});t.update("<iframe name='colorPickerFrame'  src='"+e+"' width='100%' height='100%' frameborder='0' scrolling='no' />")}}}]}).showBy(t)})},t);function t(){}y.Dialog=e}(FastExt=FastExt||{}),function(e){var t;(t=e.Target||(e.Target={}))._blank="_blank",t._self="_self",t._parent="_parent",t._top="_top",t.framename="framename",(t=e.AppendPosition||(e.AppendPosition={})).left="left",t.right="right",(t=e.ComputeType||(e.ComputeType={})).sum="sum",t.avg="avg",t.min="min",t.max="max",(e=e.PowerType||(e.PowerType={})).gridcolumn="gridcolumn",e.button="button",e.menuitem="menuitem"}(FastEnum=FastEnum||{}),function(e){for(var t in e.StringExtend=function(){String.prototype.endWith=function(e){return!(!e||""===e||0===this.length||e.length>this.length)&&this.substring(this.length-e.length)===e},String.prototype.startWith=function(e){return!(!e||""===e||0===this.length||e.length>this.length)&&this.substr(0,e.length)===e},String.prototype.firstUpperCase=function(){return this.replace(/^\S/,function(e){return e.toUpperCase()})},String.prototype.truthLength=function(){return this.replace(/[\u0391-\uFFE5]/g,"aa").length},String.prototype.trimAllSymbol=function(){return this.replace(/[\ |\~|\`|\!|\@|\#|\$|\%|\^|\&|\*|\(|\)|\-|\_|\+|\=|\||\\|\[|\]|\{|\}|\;|\:|\"|\'|\,|\<|\.|\>|\/|\?/\，/\。/\；/\：/\“/\”/\》/\《/\|/\{/\}/\、/\!/\~/\`]/g,"")},String.prototype.replaceAll=function(e,t){return this.replace(new RegExp(e,"g"),t)}},e.ArrayExtend=function(){Array.prototype.exists=function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return!0;return!1}},e.ComponentExtend=function(){this.iframePanel=!1},e.GridExtend=function(){this.tabPanelList=!1},e.FormPanelExtend=function(){Ext.form.FormPanel.prototype.setFieldValue=function(e,t){this.getForm().findField(e).setValue(t)},Ext.form.FormPanel.prototype.getFieldValue=function(e){return this.getForm().findField(e).getValue()},Ext.form.FormPanel.prototype.getField=function(e){return this.getForm().findField(e)},Ext.form.FormPanel.prototype.submitForm=function(i,a,r){var l=this;return a=a||{},r=r||"正在提交中……",l.submiting?new Ext.Promise(function(e,t){t({success:!1,message:"数据正在提交中，不可重复提交！"})}):new Ext.Promise(function(n,o){var e={submitEmptyText:!1,waitMsg:r,params:a,success:function(e,t){l.submiting=!1,Ext.Msg.alert("系统提醒",t.result.message,function(e){"ok"===e&&n(t.result)})},failure:function(e,t){l.submiting=!1,Ext.Msg.alert("系统提醒",t.result.message),o(t.result)}};i&&(e.params.entityCode=i.entityCode,i.menu&&(e.params.menu=FastExt.Store.getStoreMenuText({entity:i})));var t=l.getForm();t.isValid()?(l.submiting=!0,t.submit(e)):(l.submiting=!1,o({success:!1,message:"表单填写不完整！"}))})},Ext.form.FormPanel.prototype.saveCache=function(e){Ext.isEmpty(e)&&(e=this.cacheKey);var n={};this.getForm().getFields().each(function(e,t){Ext.isDate(e.getValue())?n[e.getName()]=Ext.Date.format(e.getValue(),e.format):n[e.getName()]=e.getValue()});e={configKey:e,configType:"FormPanelCache",configValue:Ext.encode(n)};FastExt.Dialog.showWait("暂存数据中……"),$.post("ext/config/saveExtConfig",e,function(e){FastExt.Dialog.hideWait(),e.success?FastExt.Dialog.toast("暂存成功！"):FastExt.Dialog.showAlert("系统提醒",e.message)})},Ext.form.FormPanel.prototype.restoreCache=function(e){Ext.isEmpty(e)&&(e=this.cacheKey);var t=this;$.post("ext/config/showExtConfig",{configKey:e,configType:"FormPanelCache"},function(e){var n;e.success&&(n=Ext.decode(e.data.configValue),t.getForm().getFields().each(function(e,t){n.hasOwnProperty(e.getName())&&e.setValue(n[e.getName()])}))})},Ext.form.FormPanel.prototype.deleteCache=function(e){Ext.isEmpty(e)&&(e=this.cacheKey),$.post("ext/config/deleteExtConfig",{configKey:e,configType:"FormPanelCache"},function(e){})}},e.FileFieldExtend=function(){this.multiple=!1},e.FieldExtend=function(){Ext.form.field.Base.prototype.blur=function(){try{this.inputEl&&this.inputEl.blur()}catch(e){console.error(e)}}},e.TextFieldExtend=function(){this.useHistory=!1},e.ColumnExtend=function(){},e.MenuExtend=function(){this.holdShow=!1},e)e[t]()}(FastExtend=FastExtend||{}),function(p){var e=(t.formatLength=function(e){return e<1024?e+"B":e<1048576?(e/1024).toFixed(2)+"KB":(e/1024/1024).toFixed(2)+"M"},t.uploadFile=function(c,u,x,m){return new Ext.Promise(function(a,e){var r,n,l,t="上传文件",o="files",i=-1,s=-1,d="file";p.FileModule.validate(u,"fileModules")&&(1===u.length&&(t="上传"+u[0].tipMsg,o=u[0].type,i=u[0].width,s=u[0].height),Ext.isEmpty(m)&&(m=!0),c&&(c.name&&(d=c.name),c.dataIndex&&(d=c.dataIndex)),r=Ext.create("Ext.form.FormPanel",{url:"upload",method:"POST",margin:"5",fileUpload:!0,width:400,callBacked:!1,border:0,layout:"column",items:[{xtype:"filefield",fieldLabel:t,labelWidth:60,labelAlign:"right",buttonText:"选择文件",allowBlank:!1,name:d,multiple:x,columnWidth:1,listeners:{change:function(e,t,n){if(null!=t&&0!==t.length){for(var o="",i=0;i<u.length;i++){var a=u[i];if(a.reg){if(a.reg.test(t))return void r.doSubmit()}else if(a.regStr&&new RegExp(a.regStr).test(t))return void r.doSubmit();o=o+"或"+a.tipMsg}r.form.reset(),Ext.Msg.alert("系统提醒","请上传有效的"+o.substring(1))}}}},{xtype:"hiddenfield",name:"type",value:o},{xtype:"hiddenfield",name:"file.width",value:i},{xtype:"hiddenfield",name:"file.height",value:s}],doSubmit:function(){var n,o,i=r.form;i.isValid()&&((n=new Ext.LoadMask({msg:"正在上传附件中…",target:l})).show(),(o=function(t){var e;t>=u.length?i.submit({success:function(e,t){p.Dialog.toast("文件上传成功！"),a.called||(a.called=!0,a(t.result.data)),l.close()},failure:function(e,t){n.destroy(),Ext.Msg.alert("系统提醒","上传失败！"+t.result.message)}}):(e=u[t],Ext.isFunction(e.onFileSelect)?e.onFileSelect(r.getForm().findField(d)).then(function(e){Ext.isEmpty(e)?o(t+1):(n.destroy(),r.form.reset(),Ext.Msg.alert("系统提醒",e))}):o(t+1))})(0))},listeners:{render:function(e){try{new Ext.util.KeyMap({target:e.getEl(),key:13,fn:r.doSubmit,scope:Ext.getBody()})}catch(e){console.error(e)}}}}),n="btnSubmit"+(new Date).getTime(),(l=Ext.create("Ext.window.Window",{title:t,layout:"fit",resizable:!1,scrollable:!1,width:500,items:r,modal:!0,iconCls:"extIcon extUpload",animateTarget:c,constrain:!0,buttons:[{text:"使用地址",iconCls:"extIcon extEdit",hidden:!m,handler:function(){Ext.Msg.prompt("使用自定义的文件地址","填写自定义的文件路径（http）：",function(e,t){"ok"===e&&(Ext.isEmpty(t)||(a.called||(a.called=!0,a({url:t})),l.close()))})}},{text:"网络同步",iconCls:"extIcon extLink",handler:function(){Ext.Msg.prompt("从网络中下载文件","填写网络文件路径（http）：",function(e,t){"ok"===e&&(p.Dialog.showWait("正在同步中，请稍后……"),$.post("upload",{url:t,__accept:"application/json"},function(e){p.Dialog.hideWait(),e.success?(p.Dialog.toast("文件上传成功！"),a.called||(a.called=!0,a(e.data)),l.close()):Ext.Msg.alert("系统提醒","上传失败！"+e.message)}))})}},"->",{text:"重置",width:88,iconCls:"extIcon extReset",handler:function(){r.form.reset()}},{text:"上传",width:88,id:n,iconCls:"extIcon extOk",handler:function(){r.doSubmit()}}],listeners:{show:function(e,t){r.getForm().findField(d).fileInputEl.dom.click(),Ext.getCmp(n).focus()},close:function(e,t){a.called||(a.called=!0,a())}}})).show())})},t.showFiles=function(i,e,t,n,o){if(p.FileModule.validate(t,"fileModules")){i&&i.blur();var a=[],r=p.Renders.file();if(o=o||"文件管理",!Ext.isEmpty(n)){var l=n;Ext.isString(n)&&(l=Ext.JSON.decode(n));for(var s=0;s<l.length;s++){var d=l[s].split("@"),c=d[0],u=c.substring(c.lastIndexOf("/")+1),x=-1;1<d.length&&(u=d[1]),2<d.length&&(x=d[2]),a.push({url:c,name:u,length:x})}}1===t.length&&(r=t[0].renderer,o=t[0].tipMsg+"管理");n=[];n.push({header:"文件",dataIndex:"url",flex:1,align:"center",renderer:r}),i.showFileName&&(n.push({header:"文件名",dataIndex:"name",width:150,align:"center",field:{xtype:"textfield",listeners:{change:function(){g.modify=!0}}},renderer:p.Renders.normal()}),i.showFileLength&&n.push({header:"大小",dataIndex:"length",width:100,align:"center",renderer:p.Renders.fileSize()}));var m=Ext.now(),g=Ext.create("Ext.data.Store",{autoLoad:!0,data:a}),h=Ext.create("Ext.grid.Panel",{selModel:p.Grid.getGridSelModel(),store:g,columnLines:!0,cellTip:!0,columns:n,plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:2})],selType:"cellmodel",tbar:[{xtype:"button",border:1,text:"删除",id:"btnDeleteFile"+m,iconCls:"extIcon extDelete",disabled:!0,handler:function(){var o=h.getSelectionModel().getSelection();0===o.length?p.Dialog.toast("请您选择需要删除的文件！"):Ext.Msg.confirm("系统提醒","您确定立即删除选中的附件吗？",function(e,t){var n;"yes"===e&&(n={},Ext.Array.each(o,function(e,t){n["path["+t+"]"]=e.get("url")}),p.Dialog.showWait("正在删除中……"),p.Server.deleteAttach(n,function(e,t){p.Dialog.hideWait(),e?(h.getSelectionModel().deselectAll(),p.Dialog.showAlert("系统提醒","删除成功！"),Ext.Array.each(o,function(e,t){g.remove(e),g.modify=!0})):p.Dialog.showAlert("系统提醒",t)}))})}},{xtype:"button",border:1,text:"上传",iconCls:"extIcon extUpload",handler:function(){p.File.uploadFile(this,t,!0).then(function(e){if(e){if(Ext.isArray(e))for(var t=0;t<e.length;t++)g.add(e[t]);else g.add(e);g.modify=!0}})}}],listeners:{selectionchange:function(){var e=this.getSelectionModel().getSelection();Ext.getCmp("btnDeleteFile"+m).setDisabled(!(0<e.length))}}}),f=Ext.create("Ext.window.Window",{title:o,height:300,width:400,minWidth:400,minHeight:300,layout:"fit",resizable:!0,modal:!0,constrain:!0,iconCls:"extIcon extFolder",animateTarget:i,items:[h],buttons:[{text:"确定",iconCls:"extIcon extOk",handler:function(){var o=[];g.each(function(e,t){var n=e.get("url");i.showFileName&&(n=n+"@"+e.get("name"),i.showFileLength&&(n=n+"@"+e.get("length"))),o.push(n)}),null!=e&&e(Ext.encode(o)),f.close()}}],listeners:{close:function(){g.modify}}});f.show()}},t);function t(){}p.File=e;n.validate=function(e,t){return Ext.isEmpty(e)?(p.Dialog.showAlert("系统提醒","参数"+t+"必传！"),!1):Ext.isArray(e)?0!==e||(p.Dialog.showAlert("系统提醒","参数"+t+"集合不可为空！"),!1):(p.Dialog.showAlert("系统提醒","参数"+t+"必需Array格式！"),!1)},n.file=function(){return{regStr:".*",reg:new RegExp(/\.*$/i),tipMsg:"文件",type:"file",renderer:p.Renders.file()}},n.image=function(e,t){return{width:e=Ext.isEmpty(e)?-1:e,height:t=Ext.isEmpty(t)?-1:t,regStr:".(jpg|png|gif|jpeg|svg|bmp)",reg:new RegExp(/\.(jpg|png|gif|jpeg|svg|bmp)$/i),tipMsg:"图片",type:"images",renderer:p.Renders.image(24)}},n.mp4=function(e){return{regStr:".(mp4)",reg:new RegExp(/\.(mp4)$/i),tipMsg:"mp4",type:"videos",maxDuration:e,onFileSelect:function(i){var a=this;return new Ext.Promise(function(t,e){var n,o;Ext.isEmpty(a.maxDuration)?t():(n=i.fileInputEl.dom.files[0],n=URL.createObjectURL(n),(o=new Audio(n)).addEventListener("loadedmetadata",function(e){1e3*o.duration>parseInt(a.maxDuration)&&t("视频最大时长不得超过"+a.maxDuration/1e3+"秒！")}))})},renderer:p.Renders.file()}},n.word=function(){return{regStr:".(doc|docx)",reg:new RegExp(/\.(doc|docx)$/i),tipMsg:"word文档",type:"words",renderer:p.Renders.file()}},n.excel=function(){return{regStr:".(xls|xlsx)",reg:new RegExp(/\.(xls|xlsx)$/i),tipMsg:"excel文档",type:"excels",renderer:p.Renders.file()}},n.ppt=function(){return{regStr:".(ppt|pptx)",reg:new RegExp(/\.(ppt|pptx)$/i),tipMsg:"ppt文档",type:"ppt",renderer:p.Renders.file()}},n.pdf=function(){return{regStr:".(pdf)",reg:new RegExp(/\.(pdf)$/i),tipMsg:"pdf文档",type:"pdf",renderer:p.Renders.file()}},n.zip=function(){return{regStr:".(zip|rar)",reg:new RegExp(/\.(zip|rar)$/i),tipMsg:"zip压缩包",type:"zip",renderer:p.Renders.file()}},n.text=function(){return{regStr:".(txt)",reg:new RegExp(/\.(txt)$/i),tipMsg:"txt文档",type:"txt",renderer:p.Renders.file()}},n.data=function(){return{regStr:".(data)",reg:new RegExp(/\.(data)$/i),tipMsg:"数据文件",type:"data",renderer:p.Renders.file()}},e=n;function n(){}p.FileModule=e}(FastExt=FastExt||{}),function(e){var t=(n.buildForm=function(e,t){var n,o=$("<form></form>");for(n in o.attr("action",e),o.attr("method","post"),t){var i=$("<input type='text' name='"+n+"' />");i.attr("value",t[n]),o.append(i)}return $(document.body).append(o),o},n.isDateField=function(e){return!!e&&("datefield"===e||"datefield"===e.xtype)},n.isNumberField=function(e){return!!e&&("numberfield"===e||"numberfield"===e.xtype)},n.isTextField=function(e){return!!e&&("textfield"===e||"textfield"===e.xtype)},n.isComboField=function(e){return!!e&&("combobox"===e||"combo"===e.xtype)},n.isFileField=function(e){return!!e&&("fastfile"===e||"fastfile"===e.xtype||"fastfilefield"===e||"fastfilefield"===e.xtype)},n.isFilesField=function(e){return!!e&&("fastfiles"===e||"fastfiles"===e.xtype||"fastfilesfield"===e||"fastfilesfield"===e.xtype)},n.isEnumField=function(e){return!!e&&("enumcombo"===e||"enumcombobox"===e||"enumcombo"===e.xtype||"enumcombobox"===e.xtype)},n.isContentField=function(e){return!!e&&("contentfield"===e||"content"===e||"contentfield"===e.xtype||"content"===e.xtype)},n.isHtmlContentField=function(e){return!!e&&("htmlcontentfield"===e||"htmlcontent"===e||"htmlcontentfield"===e.xtype||"htmlcontent"===e.xtype)},n.isLinkField=function(e){return!!e&&("linkfield"===e||"link"===e||"linkfield"===e.xtype||"link"===e.xtype)},n.isTargetField=function(e){return!!e&&("targetfield"===e||"target"===e||"targetfield"===e.xtype||"target"===e.xtype)},n.isPCAField=function(e){return!!e&&("pcafield"===e||"pca"===e||"pcafield"===e.xtype||"pca"===e.xtype)},n.isMapField=function(e){return!!e&&("mapfield"===e||"map"===e||"mapfield"===e.xtype||"map"===e.xtype)},n.getFieldError=function(e){var t=e.getErrors();return 0===t.length&&(t=[e.invalidText]),Ext.isEmpty(t[0])&&(t[0]="数据错误！"),t},n);function n(){}e.Form=t}(FastExt=FastExt||{}),function(FastExt){var Grid=function(){function Grid(){Ext.override(Ext.grid.Panel,{initComponent:Ext.Function.createSequence(Ext.grid.Panel.prototype.initComponent,FastExt.Grid.onGridInitComponent)}),Ext.override(Ext.tree.Panel,{initComponent:Ext.Function.createSequence(Ext.tree.Panel.prototype.initComponent,FastExt.Grid.onGridInitComponent)}),Ext.override(Ext.grid.Panel,{afterRender:Ext.Function.createSequence(Ext.grid.Panel.prototype.afterRender,FastExt.Grid.onGridAfterRender)}),Ext.override(Ext.tree.Panel,{afterRender:Ext.Function.createSequence(Ext.tree.Panel.prototype.afterRender,FastExt.Grid.onGridAfterRender)})}return Grid.onGridInitComponent=function(){var e=this;e.bufferedRenderer=!1,e.entityList&&(e.getStore()&&(e.getStore().grid=e).getStore().where&&(e.fromRecycle=e.getStore().where["^fromRecycle"]),FastExt.Grid.configGridContextMenu(e),FastExt.Grid.configDefaultToolBar(e),FastExt.Grid.configGridListeners(e))},Grid.onGridAfterRender=function(){var e,t=this;t.entityList&&((e=t.up("[tabContainer=true]"))&&(t.tabPanelList=!0),t.updateButtons&&0!==t.updateButtons.length?t.updateEnable=!0:t.updateEnable=!1,FastExt.Grid.configGridLayout(t).then(function(){FastExt.Grid.configGridTip(t),t.setLoading(!1),t.getStore().grid=t,FastExt.System.silenceGlobalSave?(e.close(),FastExt.System.doNextSilenceMenu()):t.getStore().isLoaded()||t.getStore().loadPage(1)}))},Grid.addGridContextMenu=function(e,t,n){var o;e.contextMenu&&t&&(Ext.isFunction(e.contextMenu.getXType)||(o=new Ext.menu.Menu({items:[]}),Ext.isArray(e.contextMenu)&&o.add(e.contextMenu),e.contextMenu=o),Ext.isEmpty(n)?e.contextMenu.add(t):e.contextMenu.insert(n,t))},Grid.configGridContextMenu=function(s){var e=0;FastExt.Grid.addGridContextMenu(s,{iconCls:"extIcon extDetails editColor",text:"查看详情",handler:function(e,t){var n="";s.getStore().entity.menu&&(n="【"+s.getStore().entity.menu.text+"】");var o=parseInt((.3*document.body.clientWidth).toFixed(0)),i=parseInt((.6*document.body.clientHeight).toFixed(0));Ext.create("Ext.window.Window",{title:"查看详情"+n,subtitle:n,height:i,width:o,minHeight:450,minWidth:400,iconCls:"extIcon extDetails",layout:"border",resizable:!0,collapsible:!0,constrain:!0,maximizable:!0,animateTarget:e,listeners:{close:function(e,t){e.items.get(0).changeListener.destroy()},show:function(e){e.focus()}},items:[FastExt.Grid.getDetailsPanel(s,!0)]}).show()}},e++),FastExt.Grid.addGridContextMenu(s,{iconCls:"extIcon extCopy2",text:"复制数据",menu:[{text:"复制单元格",iconCls:"extIcon extCopy2",handler:function(){var e=s.contextMenu;FastExt.Base.copyToBoard($(e.cellTd).text()),FastExt.Dialog.toast("复制成功！")}},{text:"复制整行",iconCls:"extIcon extCopy2",handler:function(){var e=s.contextMenu,t="";$(e.tr).find("td").each(function(){t+=$(this).text()+"\t"}),FastExt.Base.copyToBoard(t),FastExt.Dialog.toast("复制成功！")}},{text:"复制数据",iconCls:"extIcon extCopy2",handler:function(){var e=s.contextMenu,t=e.record,e=e.cellContext.column.dataIndex;Ext.isArray(t.get(e))?FastExt.Base.copyToBoard(Ext.encode(t.get(e))):FastExt.Base.copyToBoard(t.get(e)),FastExt.Dialog.toast("复制成功！")}}]},e++),FastExt.Grid.addGridContextMenu(s,{iconCls:"extIcon extEdit editColor",text:"编辑数据",onBeforeShow:function(){var e=this.ownerCt;!Ext.isEmpty(e.cellContext.column.dataIndex)&&1===s.getSelection().length&&FastExt.Base.toBool(e.cellContext.column.editable,!0)?(this.show(),e.cellContext.column.field||e.cellContext.column.hasListener("dblclick")||this.hide()):this.hide()},handler:function(){var e=this.ownerCt;e.cellContext.column.field?(s.doEdit=!0,s.findPlugin("cellediting").startEditByPosition(e.cellContext)):e.cellContext.column.fireEvent("dblclick",s,this,e.rowIndex)}},e++),s.getStore().entity&&(FastExt.Grid.addGridContextMenu(s,{iconCls:"extIcon extLink",text:"搜索链",onBeforeShow:function(){this.show();var e=this.ownerCt;if(Ext.isObject(e.cellContext.column.searchLink)&&1===s.getSelection().length){for(var t=new Ext.menu.Menu({items:[]}),n=e.record,o=e.cellContext.column.dataIndex,i=e.cellContext.column.searchLink.columns,a=0;a<i.length;a++){var r=i[a],r={icon:r.parent.icon,text:r.parent.text+"【"+r.text+"】",column:r,value:n.get(o),handler:function(){var e={};e[this.column.dataIndex]=this.value,FastExt.System.showTab(this.column.parent.method,$.md5(this.column.id+this.value),"搜索："+this.text,this.icon,!0,!1,e)}};t.add(r)}this.setMenu(t)}else this.hide()},menu:[]},e++),FastExt.Grid.addGridContextMenu(s,{iconCls:"extIcon extSearch searchColor",text:"查找此数据",onBeforeShow:function(){var e=this.ownerCt;Ext.isEmpty(e.cellContext.column.dataIndex)||FastExt.Grid.isFileColumn(e.cellContext.column)||FastExt.Grid.isFilesColumn(e.cellContext.column)||1!==s.getSelection().length?this.hide():this.show()},handler:function(){var e=this.ownerCt,t=e.record,n=e.cellContext.column.dataIndex;e.cellContext.column.searchValue(t.get(n))}},+e),FastExt.Grid.addGridContextMenu(s,{iconCls:"extIcon extClear",text:"清空此数据",onBeforeShow:function(){var e=this.ownerCt;Ext.isEmpty(e.cellContext.column.dataIndex)||1!==s.getSelection().length?this.hide():this.show()},handler:function(){var l=this;Ext.Msg.confirm("系统提醒","您确定清空选中的单元格数据吗？",function(e,t){if("yes"===e){var n=l.ownerCt,o=n.record,e=n.cellContext.column.dataIndex;Ext.isObject(n.cellContext.column.field)&&(Ext.isEmpty(n.cellContext.column.field.name)||(e=n.cellContext.column.field.name));for(var i={entityCode:s.getStore().entity.entityCode},a=0;a<s.getStore().entity.idProperty.length;a++){var r=s.getStore().entity.idProperty[a];i["data."+r]=o.get(r)}s.getStore().entity.menu&&(i.menu=FastExt.Store.getStoreMenuText(s.getStore())),i["data."+e]="<null>",FastExt.Dialog.showWait("正在清空中……"),FastExt.Server.updateEntity(i,function(e,t){FastExt.Dialog.hideWait(),e?(FastExt.Dialog.toast("清除成功！"),s.getStore().reload()):Ext.Msg.alert("系统提醒",t)})}})}},5))},Grid.configGridHeadMenu=function(n){var o;FastExt.Base.toBool(n.columnContextMenu,!0)&&n.columnHeadMenu&&(n.columnMenu||(n.columnMenu={}),n.columnMenu&&(o=n.columnHeadMenu).on("beforeshow",function(e){var t;FastExt.Grid.hasColumnField(o.activeHeader)||(e.activeHeader.batchUpdate=!1,e.activeHeader.operation=!1,e.activeHeader.searchLink=!1,e.activeHeader.batchRandom=!1),(FastExt.Grid.isFilesColumn(e.activeHeader)||FastExt.Grid.isFileColumn(e.activeHeader)||FastExt.Grid.isLinkColumn(o.activeHeader)||FastExt.Grid.isMapColumn(o.activeHeader)||FastExt.Grid.isTargetColumn(o.activeHeader)||FastExt.Grid.isPCAColumn(o.activeHeader))&&(e.activeHeader.batchRandom=!1),FastExt.Grid.isContentColumn(e.activeHeader)&&(e.activeHeader.searchLink=!1),e.configHeadMenu||(e.configHeadMenu=!0,t=[],FastExt.Base.toBool(n.columnMenu.lookField,!0)&&t.push({text:"查看字段",iconCls:"extIcon extField",onBeforeShow:function(){FastExt.Base.toBool(o.activeHeader.lookField,!0)?this.show():this.hide()},handler:function(){Ext.Msg.alert("查看字段",o.activeHeader.dataIndex)}}),t.push({text:"清除无效数据",iconCls:"extIcon extClear grayColor",onBeforeShow:function(){FastExt.Base.toBool(o.activeHeader.batchClear,!0)?this.show():this.hide()},handler:function(){var e={title:"清除无效数据",icon:Ext.Msg.QUESTION,message:"将清除属性【"+o.activeHeader.text+"】在【当前当前条件】下为空的所有无效数据！请您确定操作！",buttons:Ext.Msg.YESNO,defaultFocus:"no",callback:function(e,t){var n;"yes"===e&&(FastExt.Dialog.showWait("正在清除数据中……"),e=(n=FastExt.Grid.getColumnGrid(o.activeHeader)).getStore().proxy.extraParams,n={entityCode:n.getStore().entity.entityCode,field:o.activeHeader.dataIndex,menu:FastExt.Store.getStoreMenuText(n.getStore())},FastExt.Server.clearEntity(FastExt.Json.mergeJson(n,e),function(e,t){FastExt.Dialog.hideWait(),e&&FastExt.Grid.getColumnGrid(o.activeHeader).getStore().loadPage(1),FastExt.Dialog.showAlert("清理结果",t)}))}};Ext.Msg.confirm(e)}}),n.getStore().entity&&(FastExt.Base.toBool(n.columnMenu.searchLink,!0)&&t.push({text:"配置搜索链",iconCls:"extIcon extLink",onBeforeShow:function(){!FastExt.Grid.getColumnGrid(o.activeHeader).fromRecycle&&FastExt.Base.toBool(o.activeHeader.searchLink,!0)?this.show():this.hide()},handler:function(){FastExt.Grid.configColumnSearchLink(o.activeHeader)}}),FastExt.Base.toBool(n.columnMenu.operation,!0)&&t.push({text:"计算数据",iconCls:"extIcon extMath",onBeforeShow:function(){!FastExt.Grid.getColumnGrid(o.activeHeader).fromRecycle&&FastExt.Base.toBool(o.activeHeader.operation,!1)?this.show():this.hide()},menu:[{text:"计算总和",iconCls:"extIcon extMath",handler:function(){FastExt.Grid.showColumnCompute(n,o.activeHeader,FastEnum.ComputeType.sum)}},{text:"计算平均值",iconCls:"extIcon extMath",handler:function(){FastExt.Grid.showColumnCompute(n,o.activeHeader,FastEnum.ComputeType.avg)}},{text:"计算最大值",iconCls:"extIcon extMath",handler:function(){FastExt.Grid.showColumnCompute(n,o.activeHeader,FastEnum.ComputeType.max)}},{text:"计算最小值",iconCls:"extIcon extMath",handler:function(){FastExt.Grid.showColumnCompute(n,o.activeHeader,FastEnum.ComputeType.min)}}]})),FastExt.Base.toBool(n.columnMenu.batchUpdate,!0)&&t.push({text:"批量修改数据",iconCls:"extIcon extEdit",onBeforeShow:function(){!FastExt.Grid.getColumnGrid(o.activeHeader).fromRecycle&&FastExt.Base.toBool(o.activeHeader.editable,!0)&&FastExt.Base.toBool(o.activeHeader.batchUpdate,!0)?this.show():this.hide()},handler:function(){FastExt.Grid.showBatchEditColumn(o.activeHeader)}}),FastExt.Base.toBool(n.columnMenu.batchRandom,!0)&&t.push({text:"批量随机数据",iconCls:"extIcon extRandom",onBeforeShow:function(){!FastExt.Grid.getColumnGrid(o.activeHeader).fromRecycle&&FastExt.Base.toBool(o.activeHeader.editable,!0)&&FastExt.Base.toBool(o.activeHeader.batchRandom,!0)?this.show():this.hide()},handler:function(){FastExt.Grid.showBatchEditColumnRandom(o.activeHeader)}}),FastExt.Base.toBool(n.columnMenu.cancelSort,!0)&&t.push({text:"取消排序",iconCls:"extIcon extCancelOrder",onBeforeShow:function(){!FastExt.Grid.getColumnGrid(o.activeHeader).fromRecycle&&FastExt.Base.toBool(o.activeHeader.cancelSort,!0)?this.show():this.hide()},handler:function(){try{var e=n.getStore().getSorters();if(0===e.count())return;e.removeByKey(o.activeHeader.dataIndex),n.getStore().loadPage(1),o.activeHeader.sortDirection=null,FastExt.Grid.refreshColumnStyle(o.activeHeader)}catch(e){FastExt.Dialog.showException(e)}}}),e.insert(0,t)),FastExt.Menu.fireMenuEvent(e,"onBeforeShow")}))},Grid.configDefaultToolBar=function(t){var e,n;!t||(e=t.down("toolbar[dock='top']"))&&(FastExt.Base.toBool(t.fromRecycle,!1)?e.setHidden(!0):FastExt.Base.toBool(t.defaultToolBar,!0)&&t.operate&&(n={xtype:"button",text:"更多操作",iconCls:"extIcon extMore",menu:[{text:"导出Excel",iconCls:"extIcon extExcel",hidden:!FastExt.Base.toBool(t.operate.excelOut,!0),handler:function(){FastExt.Grid.exportGrid(t)}},{text:"导入Excel",iconCls:"extIcon extExcel",hidden:!FastExt.Base.toBool(t.operate.excelIn,!0),menu:[{text:"下载模板",iconCls:"extIcon extExcelModule searchColor",handler:function(){FastExt.Grid.downExcelModel(t)}},{text:"导入数据",iconCls:"extIcon extExcelImport searchColor",handler:function(){var e={entityCode:t.getStore().entity.entityCode};FastExt.Grid.importExcel(this,e,t.importExcelItems).then(function(e){e&&t.getStore().loadPage(1)})}}]},{iconCls:"extIcon extDownload searchColor",text:"下载数据",handler:function(){FastExt.Grid.downDataGrid(t)}},{iconCls:"extIcon extUpload searchColor",text:"上传数据",handler:function(){var e={entityCode:t.getStore().entity.entityCode};FastExt.Grid.loadDataGrid(this,e).then(function(e){e&&t.getStore().loadPage(1)})}},{iconCls:"extIcon extSet",text:"操作设置",handler:function(){FastExt.Grid.setGrid(this,t)}}]},e.add("->"),e.add(n)))},Grid.configGridTip=function(o){var e;!o||(e=o.getView())&&(o.tip=new Ext.ToolTip({target:e.el,delegate:".x-grid-cell-inner",trackMouse:!0,renderTo:Ext.getBody(),listeners:{beforeshow:function(e){if(o.operate&&!o.operate.hoverTip)return!1;var t=e.triggerElement.innerHTML;if(Ext.isEmpty(t)||"&nbsp;"===t)return!1;var n=t,t=e.triggerElement.firstChild;if(null!=t&&1===t.nodeType){if("x-grid-row-checker"===t.getAttribute("class"))return!1;t=t.getAttribute("details-id");if(window[t])return e.update(window[t]),!0}e.update(n)}}}))},Grid.configGridListeners=function(s){s&&!s.configListener&&(s.configListener=!0,s.onTabActivate=function(e){this.operate.refreshData&&this.getStore().reload()},s.refreshSelect=function(){var i=this;i.selectButtons&&Ext.each(i.selectButtons,function(e,t){var n=i.getSelection().length;i.selectCount&&(n=i.selectCount);var o=e.checkSelect;"multiple"===o||"m"===o||1<o?e.setDisabled(!(0<n)):"radio"!==o&&"r"!==o&&"single"!==o&&"s"!==o&&1!==o||e.setDisabled(!(1===n))})},s.refreshDetailsPanel=function(){var e=this;if(e.detailsPanels&&0!==e.detailsPanels.length)for(var t=0;t<e.detailsPanels.length;t++){var n=e.detailsPanels[t];n&&(n.fromWindow||e.operate&&e.operate.autoDetails?n.setRecord(e):n.close())}},s.on("viewready",function(e,t){e.getHeaderContainer().sortOnClick=!1}),s.on("beforedestroy",function(e,t){FastExt.Grid.saveGridColumn(e)}),s.on("columnmove",function(e,t,n,o,i){t.isSubHeader?t.groupHeaderText=t.ownerCt.text:t.groupHeaderText=null}),s.on("headertriggerclick",function(e,t,n,o,i){Ext.isEmpty(t.dataIndex)||s.fromRecycle||(e.sortOnClick=!1,e.triggerColumn=t)}),s.on("headercontextmenu",function(e,t,n,o,i){Ext.isEmpty(t.dataIndex)||s.fromRecycle||(e.sortOnClick=!1,e.onHeaderTriggerClick(t,n,t.triggerEl))}),s.on("headermenucreate",function(e,t,n,o){s.columnHeadMenu=t,FastExt.Grid.configGridHeadMenu(s)}),s.on("headerclick",function(e,t,n,o,i){Ext.isEmpty(t.dataIndex)||(e.sortOnClick=!1,FastExt.Grid.showColumnSearchMenu(t)||e.onHeaderTriggerClick(t,n,t.triggerEl))}),s.on("sortchange",function(e,t,n,o){Ext.isEmpty(t.dataIndex)||(t.sortDirection=n,FastExt.Grid.refreshColumnStyle(t))}),s.on("columnresize",function(e,t,n,o){e.sortOnClick=!1}),s.on("columnschanged",function(e,t){e.sortOnClick=!1}),s.on("cellcontextmenu",function(e,t,n,o,i,a,r,l){Ext.isEmpty(r.position.column.dataIndex)||s.fromRecycle||Ext.isObject(s.contextMenu)&&0<s.contextMenu.items.length&&(s.contextMenu.cellIndex=n,s.contextMenu.record=o,s.contextMenu.rowIndex=a,s.contextMenu.cellTd=t,s.contextMenu.tr=i,s.contextMenu.cellContext=r.position,s.contextMenu.on("show",function(e,t){var n;e.cellTd&&(n=FastExt.Color.toColor(FastExt.System.getExt("front-color-dark").value),$(e.cellTd).css("background",n))}),s.contextMenu.on("hide",function(e,t){e.cellTd&&$(e.cellTd).css("background","transparent")}),e.getSelectionModel().select(o),e.fireEvent("selectionchange",e,o,l),FastExt.Menu.fireMenuEvent(s.contextMenu,"onBeforeShow"),s.contextMenu.showAt(r.getXY()))}),s.getStore().on("endupdate",function(e){try{if(!s.getStore())return!0;if(s.getStore().holdUpdate)return!0;var n=s.getStore().getUpdatedRecords();Ext.each(s.updateButtons,function(e,t){e.setDisabled(0===n.length)}),s.operate&&s.operate.autoUpdate&&FastExt.Store.commitStoreUpdate(s.getStore())}catch(e){FastExt.Dialog.showException(e,"endupdate")}}),s.on("celldblclick",function(e,t,n,o,i,a,r,l){s.doEdit=!0}),s.on("beforeedit",function(e,t,n){if(!s.updateEnable)return!1;if(!s.doEdit)return!1;if(s.fromRecycle)return!1;if(s.doEdit=!1,!FastExt.Base.toBool(t.column.editable,!0))return!1;if(t.column.hasListener("beforeedit")&&!t.column.fireEvent("beforeedit",t))return!1;var o=t.column.field,i=Ext.get(t.cell);return o.labelTitle=t.column.text,Ext.isFunction(o.setValue)&&!FastExt.Base.toBool(t.column.password,!1)&&(Ext.isObject(t.value)||Ext.isArray(t.value)?o.setValue(JSON.stringify(t.value),t.record):o.setValue(t.value,t.record)),Ext.isFunction(o.showWindow)?o.showWindow(i,function(e){Ext.isEmpty(t.value)&&Ext.isEmpty(e.getValue())||FastExt.Store.setRecordValue(t.record,t.field,e)}):(t.column.editMenu||(t.column.editMenu=Ext.create("Ext.menu.Menu",{modal:!0,layout:"fit",showSeparator:!1,items:[{xtype:"panel",layout:"fit",width:i.getWidth(),height:i.getHeight(),style:{background:"#ffffff",borderWidth:1,borderColor:"#ffffff",color:"#eeeee"},border:0,items:[o]}],listeners:{show:function(n,e){n.items.get(0).items.get(0).focus();try{new Ext.util.KeyMap({target:n.getEl(),key:13,fn:function(e,t){n.hide()},scope:this})}catch(e){console.error(e)}},beforehide:function(e,t){var n=e.items.get(0).items.get(0);if(n.isValid())return!0;n=FastExt.Form.getFieldError(n);return FastExt.Dialog.toast(n[0]),FastExt.Component.shakeComment(e,function(){e.holdShow=!1}),!(e.holdShow=!0)},hide:function(e,t){var n;!e.context||(n=e.items.get(0).items.get(0))&&((Ext.isEmpty(e.context.value)||FastExt.Base.toBool(e.context.column.password,!1))&&Ext.isEmpty(n.getValue())||(FastExt.Store.setRecordValue(e.context.record,e.context.field,n),n.setValue(null)))}}})),t.column.editMenu.setWidth(t.column.getWidth()),(t.column.editMenu.context=t).column.editMenu.showBy(i,"tl")),!1}),s.on("selectionchange",function(e,t,n){try{s.refreshSelect();var o=s.child("#pagingToolBar");o&&o.updateInfo()}catch(e){FastExt.Dialog.showException(e,"按钮选中检测！[selectionchange]")}}))},Grid.configGridLayout=function(n){return new Ext.Promise(function(e,t){n&&(FastExt.System.silenceGlobalSave||n.setLoading("初始化配置中……"),FastExt.Grid.restoreGridOperate(n).then(function(){FastExt.Grid.restoreGridColumn(n).then(function(){e(!0)})}))})},Grid.getDetailsPanel=function(e,t){var n="";e.getStore().entity.menu&&(n=e.getStore().entity.menu.text),e.detailsPanels||(e.detailsPanels=[]);n={subtitle:n,layout:"border",border:0,autoScroll:!1,scrollable:!1,closeAction:"hide",dataId:-1,currIsClosed:!1,closeTimer:null,isWindow:t,setRecord:function(t){try{var e,n=this;if(!n.items)return!1;window.clearTimeout(n.closeTimer),null!=t?1===(e=t.getSelectionModel().getSelection()).length?(n.record=e[0],n.items.get(0).setRecord(t,e[0]),n.show()):n.isVisible()&&!this.isWindow&&(n.closeTimer=setTimeout(function(){n.close(),setTimeout(function(){var e=t.view.getEl().getScrollLeft();t.view.getEl().scrollTo("left",e-1,!1)},100)},80)):n.close()}catch(e){FastExt.Dialog.showException(e)}return!0},listeners:{afterrender:function(){this.isWindow&&this.setRecord(e)},collapse:function(e,t){this.down("#close").hide()},beforeexpand:function(e,t){this.down("#close").show()}},items:[FastExt.Grid.builderDetailsGrid()]};t?n.region="center":(n.title="数据详情",n.iconCls="extIcon extDetails",n.collapsed=!1,n.split=!0,n.hidden=!0,n.region="east",n.maxWidth=parseInt((document.body.clientWidth/2).toFixed(0)),n.width=parseInt((.3*document.body.clientWidth).toFixed(0)),n.minWidth=200,n.tools=[{type:"gear",callback:function(){FastExt.Grid.setGrid(this,e)}},{type:"close",itemId:"close",callback:function(){o.collapse()}}]);var o=Ext.create("Ext.panel.Panel",n);return o.fromWindow=t,o.changeListener=e.on({scope:e,selectionchange:function(e,t,n){try{var o=e;(o=e.getStore().grid?e.getStore().grid:o).refreshDetailsPanel()}catch(e){FastExt.Dialog.showException(e)}},destroyable:!0}),e.detailsPanels.push(o),o},Grid.builderDetailsGrid=function(){return Ext.create("Ext.grid.Panel",{border:0,scrollable:"y",region:"center",store:Ext.create("Ext.data.Store",{groupField:"groupHeaderText",autoLoad:!1,fields:[]}),hideHeaders:!0,deferRowRender:!1,superGrid:null,features:[{ftype:"grouping",collapsible:!1,hideGroupedHeader:!0,expandTip:null,collapseTip:null,groupHeaderTpl:["<b>{name:this.formatName}</b>",{formatName:function(e){return e.toString().startsWith("BASE")?"基本属性":e}}]}],setRecord:function(e,t){for(var n=(this.superGrid=e).getColumns(),o=[],i="BASE-"+(new Date).getTime(),a=0;a<n.length;a++){var r,l=n[a];!Ext.isEmpty(l.dataIndex)&&FastExt.Base.toBool(l.hideable,!0)&&(r={text:l.configText,value:t.get(l.dataIndex),dataIndex:l.dataIndex,groupHeaderText:l.groupHeaderText,renderer:l.renderer,index:l.getIndex(),record:t,linkColumn:l,configEditor:FastExt.Base.toBool(l.editable,!0),editor:!1},Ext.isEmpty(l.field)&&(r.configEditor=!1),r.groupHeaderText?i="BASE-"+a+"-"+(new Date).getTime():r.groupHeaderText=i,o.push(r))}o.sort(function(e,t){return e.index-t.index}),this.getStore().loadData(o)},columns:[{header:"名称",dataIndex:"text",align:"right",flex:.3,tdCls:"tdVTop",renderer:function(e,t,n){return Ext.isEmpty(e)?"":(t.style="color:#000000;overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space:normal !important;line-height:20px;word-break:break-word; ","<b>"+e+"：</b>")}},{header:"值",dataIndex:"value",flex:.7,align:"left",renderer:function(t,e,n){try{e.style="overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space:normal !important;line-height:20px;word-break:break-word; ";var o=n.get("renderer");if(Ext.isFunction(o)){var i=o(t,e,n.get("record"),-1,-1,null,null,!0);return Ext.isEmpty(i)?"<font color='#ccc'>无</font>":i}return t}catch(e){return t}}},{xtype:"actioncolumn",width:50,sortable:!1,menuDisabled:!0,items:[{iconCls:"extIcon extEdit",tooltip:"编辑数据",align:"center",isDisabled:function(e,t,n,o,i){return!FastExt.Base.toBool(i.get("editor"),!1)},getClass:function(e,t,n){return FastExt.Base.toBool(n.get("editor"),!1)?"extIcon extEdit":""},handler:FastExt.Grid.showDetailsEditMenu}]}],tbar:{flex:1,emptyText:"查找属性（轻敲回车键）",margin:"5",xtype:"textfield",doSearch:function(){var e=this.ownerCt,t=e.getStore(),i=0,a=t.getAt(0).get("dataIndex"),r=null,l=this.getValue();Ext.isEmpty(l)||t.each(function(e,t){var n=e.get("text").toString(),o=e.get("value");return 0<=n.indexOf(l)?(i=t,a=e.get("dataIndex"),r=n,void 0):!Ext.isEmpty(o)&&0<=o.toString().indexOf(l)?(i=t,a=e.get("dataIndex"),r=n,!1):void 0}),FastExt.Grid.scrollToColumn(e.superGrid,a,r),e.getSelectionModel().select(i),e.view.focusRow(i)},triggers:{search:{cls:"text-search",handler:function(){this.doSearch()}}},listeners:{render:function(e,t){try{new Ext.util.KeyMap({target:e.getEl(),key:13,fn:function(e,t){this.doSearch()},scope:this})}catch(e){console.error(e)}}}},bbar:{xtype:"label",style:{background:"#ffffff"},text:"小技巧：双击属性可快速定位左侧表格对应的列！",padding:"10"},viewConfig:{enableTextSelection:!0},listeners:{itemmouseenter:function(e,t,n,o,i,a){t.set("editor",t.get("configEditor"))},itemmouseleave:function(e,t,n,o,i,a){t.set("editor",!1)},itemdblclick:function(){try{var e=this.getSelectionModel().getSelection();if(0==e.length)return;FastExt.Grid.scrollToColumn(this.superGrid,e[0].get("dataIndex"),e[0].get("text"))}catch(e){FastExt.Dialog.showException(e,"details:itemdblclick")}}}})},Grid.hasSearchColumn=function(e){var n=!1;return Ext.each(e.getColumns(),function(e,t){if(!Ext.isEmpty(e.dataIndex)&&e.where&&0<e.where.length)return!(n=!0)}),n},Grid.getColumn=function(e,t,n){for(var o=e.getColumns(),i=0;i<o.length;i++){var a=o[i];if(a.dataIndex===t)return n&&a.text,a}return null},Grid.checkColumnSearch=function(e){try{var t=!1;Ext.each(e.getColumns(),function(e){if(e.where&&0<e.where.length)return!(t=!0)});var n,o=e.child("#pagingToolBar");!o||(n=o.down("button[toolType=searchBtn]"))&&(t?n.setIconCls("extIcon extSearch redColor"):n.setIconCls("extIcon extSearch grayColor"))}catch(e){console.error(e)}},Grid.hasColumnField=function(e){try{return Ext.isObject(e.field)?!0:!Ext.isEmpty(e.field)}catch(e){console.error(e)}return!1},Grid.isColumnType=function(e){return"gridcolumn"===e||"gridcolumn"===e.xtype},Grid.isDateColumn=function(e){return!!e&&FastExt.Form.isDateField(e.field)},Grid.isNumberColumn=function(e){return!!e&&FastExt.Form.isNumberField(e.field)},Grid.isComboColumn=function(e){return!!e&&FastExt.Form.isComboField(e.field)},Grid.isFileColumn=function(e){return!!e&&FastExt.Form.isFileField(e.field)},Grid.isContentColumn=function(e){return!!e&&(FastExt.Form.isHtmlContentField(e.field)||FastExt.Form.isContentField(e.field))},Grid.isFilesColumn=function(e){return!!e&&FastExt.Form.isFilesField(e.field)},Grid.isEnumColumn=function(e){return!!e&&FastExt.Form.isEnumField(e.field)},Grid.isLinkColumn=function(e){return!!e&&FastExt.Form.isLinkField(e.field)},Grid.isMapColumn=function(e){return!!e&&FastExt.Form.isMapField(e.field)},Grid.isPCAColumn=function(e){return!!e&&FastExt.Form.isPCAField(e.field)},Grid.isTargetColumn=function(e){return!!e&&FastExt.Form.isTargetField(e.field)},Grid.getGridSelModel=function(){return Ext.create("Ext.grid.selection.SpreadsheetModel",{pruneRemoved:!1,checkboxSelect:!0,hasLockedHeader:!0,cellSelect:!1,rowNumbererHeaderWidth:0,listeners:{focuschange:function(e,t,n,o){e.store&&e.store.grid&&((e=e.store.grid.child("#pagingToolBar"))&&e.updateInfo())}}})},Grid.blinkColumn=function(e){var t,n,o;e.blinking||(e.blinking=!0,t=e.getEl().getStyle("color"),o="#e41f00",0<(n=e.getEl().getStyle("background")).indexOf("linear-gradient")&&(o="linear-gradient(0deg, #e41f00, #fefefe)"),e.setStyle({color:"white",background:o}),setTimeout(function(){e.setStyle({color:t,background:n}),e.blinking=!1},1e3))},Grid.scrollToColumn=function(e,t,n){t=FastExt.Grid.getColumn(e,t,n);FastExt.Grid.blinkColumn(t);n=t.getLocalX();t.isSubHeader&&(n+=t.ownerCt.getLocalX()),e.view.getEl().scrollTo("left",n,!0)},Grid.setGrid=function(e,n){var o=Ext.create("Ext.form.Panel",{bodyPadding:5,region:"center",autoScroll:!0,viewModel:{data:n.operate},defaults:{labelWidth:4*FastExt.Base.getNumberValue(FastExt.System.fontSize)+8},items:[{xtype:"checkboxfield",fieldLabel:"删除提醒",labelAlign:"right",name:"alertDelete",columnWidth:1,bind:"{alertDelete}",uncheckedValue:!1,boxLabel:"删除数据时，系统会弹出确认删除框，避免误操作删除！"},{xtype:"checkboxfield",fieldLabel:"修改提醒",labelAlign:"right",columnWidth:1,name:"alertUpdate",bind:"{alertUpdate}",hidden:!n.updateEnable,uncheckedValue:!1,boxLabel:"修改数据时，系统会弹出确认修改框，避免误操作修改！"},{xtype:"checkboxfield",fieldLabel:"自动提交",labelAlign:"right",columnWidth:1,name:"autoUpdate",bind:"{autoUpdate}",hidden:!n.updateEnable,uncheckedValue:!1,boxLabel:"双击编辑修改数据后，系统自动提交被修改的数据！"},{xtype:"checkboxfield",fieldLabel:"弹出详情",labelAlign:"right",columnWidth:1,name:"autoDetails",bind:"{autoDetails}",uncheckedValue:!1,boxLabel:"点击数据时，右侧自动弹出此数据的详情窗体！"},{xtype:"checkboxfield",fieldLabel:"悬浮阅览",labelAlign:"right",columnWidth:1,name:"hoverTip",bind:"{hoverTip}",uncheckedValue:!1,boxLabel:"当鼠标悬浮在数据超过2秒后，会在鼠标右下方弹出此数据的阅览！"},{xtype:"checkboxfield",fieldLabel:"数据刷新",labelAlign:"right",columnWidth:1,name:"refreshData",bind:"{refreshData}",uncheckedValue:!1,boxLabel:"离开此标签页后，再次返回此标签页时将刷新当前标签页的列表数据！"}]}),t="操作设置";n.getStore().entity&&n.getStore().entity.menu&&(t=FastExt.Store.getStoreMenuText(n.getStore())+"-"+t);var i=parseInt((.3*document.body.clientWidth).toFixed(0)),a=parseInt((.4*document.body.clientHeight).toFixed(0)),r=Ext.create("Ext.window.Window",{title:t,iconCls:"extIcon extSet",height:a,width:i,minHeight:370,minWidth:300,layout:"border",resizable:!1,animateTarget:e,items:[o],modal:!0,constrain:!0,buttons:["->",{text:"保存配置",iconCls:"extIcon extSave whiteColor",handler:function(){FastExt.Dialog.showWait("正在保存中…"),FastExt.Server.saveExtConfig(n.code,"GridOperate",Ext.encode(o.getForm().getValues()),function(e,t){FastExt.Dialog.hideWait(),e?(n.operate=o.getForm().getValues(),FastExt.Dialog.toast("操作设置成功！"),r.close()):Ext.Msg.alert("系统提醒",t)})}},{text:"取消",iconCls:"extIcon extClose",handler:function(){r.close()}}]});r.show()},Grid.getColumnEnumName=function(e){return FastExt.Grid.isEnumColumn(e)&&Ext.isObject(e.field)?e.field.enumName:null},Grid.getColumnFieldType=function(e){return Ext.isObject(e.field)?e.field.xtype:e.field},Grid.exportGrid=function(s){var e,d;s.getStore().entity?(e="您确定导出当前条件下的所有数据吗？",0<(d=s.getSelection()).length&&(e="您确定导出选中的"+d.length+"条数据吗？"),Ext.Msg.confirm("系统提醒",e,function(e,t){if("yes"===e){var e=s.getStore().proxy.extraParams,n={};if(s.getStore().entity.menu&&(n.title=s.getStore().entity.menu.text),0<d.length)for(var o=0;o<d.length;o++)for(var i=d[o],a=0;a<s.getStore().entity.idProperty.length;a++){var r=s.getStore().entity.idProperty[a],l="where['"+r+"#']";n[l]||(n[l]=[]),n[l].push(i.get(r))}Ext.each(s.getColumns(),function(e,t){e.isHidden()||Ext.isEmpty(e.dataIndex)||(n["column["+t+"].width"]=e.width,n["column["+t+"].text"]=e.configText,n["column["+t+"].groupHeaderText"]=e.groupHeaderText,n["column["+t+"].enum"]=FastExt.Grid.getColumnEnumName(e),n["column["+t+"].dataIndex"]=e.dataIndex,n["column["+t+"].file"]=FastExt.Grid.isFileColumn(e),n["column["+t+"].files"]=FastExt.Grid.isFilesColumn(e))}),FastExt.Dialog.showWait("正在导出中……"),FastExt.Server.exportExcel(FastExt.Json.mergeJson(n,e),function(e,t,n){FastExt.Dialog.hideWait(),e?(FastExt.Dialog.toast(n),location.href="attach/"+t):Ext.Msg.alert("系统提醒","导出失败！"+n)})}})):Ext.Msg.alert("系统提醒","导出失败！Grid的DataStore未绑定Entity!")},Grid.downExcelModel=function(e){FastExt.Dialog.showWait("正在生成中……");var n={entityCode:e.getStore().entity.entityCode};e.getStore().entity.menu&&(n.title=e.getStore().entity.menu.text),Ext.each(e.getColumns(),function(e,t){FastExt.Grid.isFileColumn(e)||FastExt.Grid.isFilesColumn(e)||!FastExt.Base.toBool(e.excelHeader,!0)||e.isHidden()||Ext.isEmpty(e.dataIndex)||(n["column["+(t=t<10?"0"+t:t)+"].width"]=e.width,n["column["+t+"].text"]=e.configText,n["column["+t+"].groupHeaderText"]=e.groupHeaderText,n["column["+t+"].enum"]=FastExt.Grid.getColumnEnumName(e),n["column["+t+"].type"]=FastExt.Grid.getColumnFieldType(e),n["column["+t+"].dataIndex"]=e.dataIndex,FastExt.Grid.isLinkColumn(e)&&(n["column["+t+"].dataIndex"]=e.field.name))}),FastExt.Server.excelModule(n,function(e,t,n){FastExt.Dialog.hideWait(),e?(FastExt.Dialog.toast("生成成功！"),location.href="attach/"+t):Ext.Msg.alert("系统提醒","生成失败！"+n)})},Grid.importExcel=function(t,r,l,s){return new Ext.Promise(function(o,e){l=l?Ext.Array.clone(l):[],s=s||FastExt.Server.importEntityExcelUrl(),l.push({xtype:"filefield",fieldLabel:"Excel文件",buttonText:"选择文件",allowBlank:!1,name:"file",columnWidth:1,listeners:{change:function(e,t,n){null!=t&&0!=t.length&&(FastExt.FileModule.excel().reg.test(t)||(i.form.reset(),Ext.Msg.alert("系统提醒","请上传有效的Excel文档！")))}}});var i=Ext.create("Ext.form.FormPanel",{url:s,method:"POST",margin:"5",fileUpload:!0,width:400,callBacked:!1,border:0,layout:"column",defaults:{labelWidth:80,margin:"5 5 5 5",labelAlign:"right",emptyText:"请填写"},items:l,doSubmit:function(){var n,e=i.form;e.isValid()&&((n=new Ext.LoadMask({msg:"正在导入中…",target:a})).show(),e.submit({params:r,success:function(e,t){n.destroy(),Ext.Msg.alert("系统提醒",t.result.message,function(){FastExt.Base.runCallBack(o,t.result),a.close()})},failure:function(e,t){n.destroy(),Ext.Msg.alert("系统提醒","导入失败！"+t.result.message)}}))},listeners:{render:function(e){try{new Ext.util.KeyMap({target:e.getEl(),key:13,fn:i.doSubmit,scope:Ext.getBody()})}catch(e){console.error(e)}}}}),n="btnSubmit"+(new Date).getTime(),a=Ext.create("Ext.window.Window",{title:"导入Excel数据",layout:"fit",resizable:!1,scrollable:!1,items:[i],modal:!0,iconCls:"extIcon extUpload",animateTarget:t,constrain:!0,buttons:[{text:"重置",width:88,iconCls:"extIcon extReset",handler:function(){i.form.reset()}},{text:"上传",width:88,id:n,iconCls:"extIcon extOk",handler:function(){i.doSubmit()}}],listeners:{show:function(e,t){1===l.length&&(i.getForm().findField("file").fileInputEl.dom.click(),Ext.getCmp(n).focus())}}});a.show()})},Grid.downDataGrid=function(s){var e,d;s.getStore().entity?(e="您确定下载当前条件下的所有数据吗？",0<(d=s.getSelection()).length&&(e="您确定下载选中的"+d.length+"条数据吗？"),Ext.Msg.confirm("系统提醒",e,function(e,t){if("yes"===e){var e=s.getStore().proxy.extraParams,n={};if(s.getStore().entity.menu&&(n.title=s.getStore().entity.menu.text),0<d.length)for(var o=0;o<d.length;o++)for(var i=d[o],a=0;a<s.getStore().entity.idProperty.length;a++){var r=s.getStore().entity.idProperty[a],l="where['"+r+"#']";n[l]||(n[l]=[]),n[l].push(i.get(r))}FastExt.Dialog.showWait("正在下载中……"),FastExt.Server.downData(FastExt.Json.mergeJson(n,e),function(e,t,n){FastExt.Dialog.hideWait(),e?(FastExt.Dialog.toast(t),location.href="attach/"+n):Ext.Msg.alert("系统提醒",t)})}})):Ext.Msg.alert("系统提醒","下载失败！Grid的DataStore未绑定Entity!")},Grid.loadDataGrid=function(t,r){return new Ext.Promise(function(o,e){var i=Ext.create("Ext.form.FormPanel",{url:FastExt.Server.loadEntityDataUrl(),method:"POST",margin:"5",fileUpload:!0,width:400,callBacked:!1,border:0,layout:"column",defaults:{labelWidth:80,margin:"5 5 5 5",labelAlign:"right",emptyText:"请填写"},items:[{xtype:"filefield",fieldLabel:"数据文件",buttonText:"选择文件",allowBlank:!1,name:"file",columnWidth:1,listeners:{change:function(e,t,n){null!=t&&0!=t.length&&(FastExt.FileModule.data().reg.test(t)||(i.form.reset(),Ext.Msg.alert("系统提醒","请上传有效的数据文件！")))}}}],doSubmit:function(){var n,e=i.form;e.isValid()&&((n=new Ext.LoadMask({msg:"正在上传中…",target:a})).show(),e.submit({params:r,success:function(e,t){n.destroy(),Ext.Msg.alert("系统提醒",t.result.message,function(){FastExt.Base.runCallBack(o,t.result),a.close()})},failure:function(e,t){n.destroy(),Ext.Msg.alert("系统提醒","上传失败！"+t.result.message)}}))},listeners:{render:function(e){try{new Ext.util.KeyMap({target:e.getEl(),key:13,fn:i.doSubmit,scope:Ext.getBody()})}catch(e){console.error(e)}}}}),n="btnSubmit"+(new Date).getTime(),a=Ext.create("Ext.window.Window",{title:"上传实体数据",layout:"fit",resizable:!1,scrollable:!1,items:[i],modal:!0,iconCls:"extIcon extUpload",animateTarget:t,constrain:!0,buttons:[{text:"重置",width:88,iconCls:"extIcon extReset",handler:function(){i.form.reset()}},{text:"上传",width:88,id:n,iconCls:"extIcon extOk",handler:function(){i.doSubmit()}}],listeners:{show:function(e,t){i.getForm().findField("file").fileInputEl.dom.click(),Ext.getCmp(n).focus()}}});a.show()})},Grid.saveGridColumn=function(a){if(!Ext.isEmpty(a.code))return new Ext.Promise(function(n,t){try{var i={};Ext.each(a.getColumns(),function(e,t){var n,o;Ext.isEmpty(e.dataIndex)||!FastExt.System.isSuperRole()&&!e.hideable&&e.hidden||((n={column:!0}).width=e.width,n.hidden=e.isHidden(),n.locked=e.isLocked(),n.text=e.configText,n.dataIndex=e.dataIndex,n.groupHeaderText=e.groupHeaderText,a.getStore().entity&&(n.entityCode=a.getStore().entityCode),(o=a.getStore().getSorters().getByKey(e.dataIndex))&&(n.sortDirection=o.getDirection()),n.searchLink=e.searchLink,n.index=e.getIndex(),o="function "+(o=e.renderer.toString()).substring(o.indexOf("(")),n.renderer=o,n.rendererFunction=e.rendererFunction,FastExt.Base.toBool(e.editable,!0)&&(n.editorField=FastExt.Grid.getColumnSimpleEditorJson(e)),i[e.code]=n)});var e={pageSize:a.getStore().pageSize,column:!1};i.PageTool=e;var o={};a.getStore().entity&&a.getStore().entity.menu&&(o.menuId=a.getStore().entity.menu.id,FastExt.Base.toBool(a.tabPanelList,!1)&&(o.entityCode=a.getStore().entity.entityCode)),FastExt.Server.saveExtConfig(a.code,"GridColumn",Ext.encode(i),function(e,t){n(e)},o)}catch(e){t(e)}})},Grid.restoreGridColumn=function(E){return new Ext.Promise(function(p,t){try{if(Ext.isEmpty(E.code))return void t("Grid编号[code]不可为空！");FastExt.Server.showExtConfig(E.code,"GridColumn",function(e,t){var n={};e&&(n=Ext.decode(t));for(var o=[],i={},a=[],r=E.getColumns(),l=0;l<r.length;l++){var s=r[l];if(!Ext.isEmpty(s.dataIndex)&&(!FastExt.Base.toBool(E.power,!0)||s.hideable||!s.hidden)){var d=s.cloneConfig();if(d.groupHeaderText=s.groupHeaderText,n.hasOwnProperty(s.code)){var c=n[s.code];for(u in c)"renderer"!==u&&"rendererFunction"!==u&&(d[u]=c[u])}d.sortDirection&&a.push({property:d.dataIndex,direction:d.sortDirection}),Ext.isEmpty(d.groupHeaderText)||(s=d.groupHeaderText,i.hasOwnProperty(s)||(i[s]=[]),i[s].push(o.length)),o.push(d)}}var u,x=[];for(u in i){var m=i[u];if(!(m.length<2)){for(var g=999999,h=[],l=0;l<m.length;l++){var f=m[l],g=Math.min(g,f),f=o[f];h.push(f)}h.sort(function(e,t){return e.index-t.index}),o[g]={index:g,text:u,menuDisabled:!0,columns:h},x=x.concat(h)}}for(l=0;l<x.length;l++)o=Ext.Array.remove(o,x[l]);o.sort(function(e,t){return e.index-t.index}),n.hasOwnProperty("PageTool")&&(e=n.PageTool,E.getStore().pageSize=e.pageSize,(t=E.down("combo[pageTool=true]"))&&t.setValue(e.pageSize)),FastExt.System.silenceGlobalSave||E.getStore().sort(a),E.reconfigure(o),p()})}catch(e){t(e)}})},Grid.restoreGridOperate=function(o){return new Ext.Promise(function(n,t){try{if(Ext.isEmpty(o.code))return void t("Grid编号[code]不可为空！");FastExt.Server.showExtConfig(o.code,"GridOperate",function(e,t){e?o.operate=Ext.decode(t):Ext.isEmpty(o.operate)&&(o.operate=new GridOperate),n()})}catch(e){t(e)}})},Grid.getColumnGrid=function(e){return e.grid||(e.grid=e.up("treepanel,grid")),e.grid.ownerGrid||null},Grid.showColumnCompute=function(e,o,i){try{if(!o)return void Ext.Msg.alert("系统提醒","计算失败!计算列无效！");if(!e.getStore().entity)return void Ext.Msg.alert("系统提醒","计算失败！Grid的DataStore未绑定Entity!");var t=e.getSelection();if(0<t.length){for(var n=null,a="",r=0;r<t.length;r++){var l=t[r],s=parseFloat(l.get(o.dataIndex));"sum"===i?(a=o.configText+"总和：",n=n||0,n+=s):"avg"===i?(a=o.configText+"平均值：",n=n||0,n+=s):"min"===i?(a=o.configText+"最小值：",n=n||s,n=Math.min(s,n)):"max"===i&&(a=o.configText+"最大值：",n=n||s,n=Math.max(s,n))}"avg"===i&&(n/=t.length);try{Ext.isFunction(o.renderer)?Ext.Msg.alert("系统提醒","当前选中的数据，"+a+o.renderer(n)):Ext.Msg.alert("系统提醒","当前选中的数据，"+a+n)}catch(e){Ext.Msg.alert("系统提醒","当前选中的数据，"+a+n)}return}var d=e.getStore().proxy.extraParams,c={entityCode:e.getStore().entity.entityCode,field:o.dataIndex,type:i};FastExt.Dialog.showWait("正在计算中……"),$.post("entity/compute",FastExt.Json.mergeJson(c,d),function(t){FastExt.Dialog.hideWait();var n="";"sum"===i?n=o.configText+"总和：":"avg"===i?n=o.configText+"平均值：":"min"===i?n=o.configText+"最小值：":"max"===i&&(n=o.configText+"最大值：");try{Ext.isFunction(o.renderer)?Ext.Msg.alert("系统提醒",n+o.renderer(t.data)):Ext.Msg.alert("系统提醒",n+t.data)}catch(e){Ext.Msg.alert("系统提醒",n+t.data)}})}catch(e){console.error(e)}},Grid.getColumnSimpleEditor=function(e,t){try{var n={};return Ext.isObject(e.field)?n.xtype=e.field.xtype:n.xtype=e.field,Ext.isObject(e.config.field)&&(n=t?FastExt.Base.copy(e.config.field):e.config.field),t&&(FastExt.Form.isContentField(e.field)||FastExt.Form.isHtmlContentField(e.field)||FastExt.Form.isTargetField(e.field)||FastExt.Form.isPCAField(e.field))&&(n.xtype="textfield"),Ext.isEmpty(n.xtype)&&(n.xtype="textfield"),n.dataIndex=e.dataIndex,t&&(n.columnSearchField=!0),n}catch(e){console.error(e)}return null},Grid.getColumnSimpleEditorJson=function(e,t){t=FastExt.Grid.getColumnSimpleEditor(e,t);return t?FastExt.Json.objectToJson(t):null},Grid.showBatchEditColumn=function(o){var e=o.batchField;if(!e){if(!(e=FastExt.Grid.getColumnSimpleEditor(o)))return;e.flex=1,e.emptyText="请输入",e=o.batchField=Ext.create(e)}function i(n){var e;Ext.isEmpty(n.getValue())||FastExt.Grid.getColumnGrid(o).getStore()&&(FastExt.Grid.getColumnGrid(o).getStore().holdUpdate=!0,0<(e=FastExt.Grid.getColumnGrid(o).getSelectionModel().getSelection()).length?Ext.each(e,function(e,t){FastExt.Store.setRecordValue(e,o.dataIndex,n)}):FastExt.Grid.getColumnGrid(o).getStore().each(function(e,t){FastExt.Store.setRecordValue(e,o.dataIndex,n)}),FastExt.Grid.getColumnGrid(o).getStore().holdUpdate=!1,FastExt.Grid.getColumnGrid(o).getStore().fireEvent("endupdate"))}var t="批量修改当前页的【"+o.text+"】数据";0<FastExt.Grid.getColumnGrid(o).getSelection().length&&(t="批量修改选择的"+FastExt.Grid.getColumnGrid(o).getSelection().length+"条【"+o.text+"】数据"),Ext.isFunction(e.setEmptyText)&&e.setEmptyText(t),Ext.isFunction(e.showWindow)?e.showWindow(o,function(e){i(e)},t):(o.batchEditMenu||(o.batchEditMenu=Ext.create("Ext.menu.Menu",{showSeparator:!1,layout:"fit",doUpdate:function(){var e=this,n=e.items.get(0).items.get(0);if(!n.isValid())return FastExt.Component.shakeComment(e),void FastExt.Dialog.toast(FastExt.Form.getFieldError(n)[0]);var t=this.down("button[name='confirm']");t.setText("稍等"),t.setDisabled(!0),new Ext.Promise(function(e,t){i(n),n.setValue(null),e()}).then(function(){t.setText("确定"),t.setDisabled(!1),e.hide()})},items:[{xtype:"panel",layout:{type:"hbox",align:"stretch"},style:{background:"#ffffff",borderWidth:1,borderColor:"#ffffff",color:"#eeeee"},border:0,items:[e,{xtype:"button",text:"确定",name:"confirm",width:60,margin:"0 0 0 2",handler:function(){o.batchEditMenu.doUpdate()}}]}],listeners:{show:function(e,t){e.items.get(0).items.get(0).focus()}}})),o.batchEditMenu.setWidth(o.getWidth()),o.batchEditMenu.showBy(o,"tl"))},Grid.showBatchEditColumnRandom=function(o){var c,u,e,t,n,i,a,r,l,s,d,x,m,g;Ext.isFunction(window.showRandomData)?window.showRandomData(o):(c="Random"+Ext.now(),n=!(t=1),d="Y-m-d H:i:s",u=FastExt.Grid.getColumnGrid(o).getStore().getTotalCount(),e="批量随机生成当前页的【"+o.text+"】列数据",0<FastExt.Grid.getColumnGrid(o).getSelection().length&&(e="批量随机生成选择的"+FastExt.Grid.getColumnGrid(o).getSelection().length+"条【"+o.text+"】列数据",u=FastExt.Grid.getColumnGrid(o).getSelection().length),FastExt.Grid.isNumberColumn(o)?(t=2,n=!0):FastExt.Grid.isDateColumn(o)?(t=3,Ext.isObject(o.field)&&(d=o.field.format),n=!0):FastExt.Grid.isEnumColumn(o)||FastExt.Grid.isComboColumn(o)?(t=5,n=!0,i=[],(a=Ext.create(o.field)).getStore().each(function(e,t){i.push(e.get(a.valueField))}),x=i.join(",")):FastExt.Grid.isContentColumn(o)&&(t=4),x={xtype:"fieldcontainer",layout:"column",columnWidth:1,id:c+"_5",hidden:!0,disabled:!0,defaults:{labelWidth:60,margin:"5 5 5 5",labelAlign:"right",columnWidth:1,emptyText:"请填写"},random:function(){for(var e=[],t=Ext.getCmp(c+"_numberList").getValue().toString().split(","),n=0;n<Number.MAX_VALUE;n++){var o=t[FastExt.Base.randomInt(0,t.length-1)];if(!Ext.isEmpty(o)&&(e.push(o),e.length===u))break}return e},items:[{xtype:"fieldset",columnWidth:1,layout:"column",defaults:{labelWidth:60,margin:"5 5 5 5",labelAlign:"right",columnWidth:1,emptyText:"请填写"},title:"数字集合设置",items:[{fieldLabel:"数字集合",id:c+"_numberList",allowBlank:!(d={xtype:"fieldcontainer",layout:"column",columnWidth:1,id:c+"_4",hidden:!0,disabled:!0,defaults:{labelWidth:60,margin:"5 5 5 5",labelAlign:"right",columnWidth:1,emptyText:"请填写"},random:function(){var e=[],t=Ext.getCmp(c+"_minLength").getValue(),n=Ext.getCmp(c+"_maxLength").getValue(),o=Ext.getCmp(c+"_longTextList").getValue();if(!(n<t)){for(var i=o.toString().trimAllSymbol().split(""),a=0;a<Number.MAX_VALUE;a++){for(var r=FastExt.Base.randomInt(t,n),l=[],s=0;s<Number.MAX_VALUE;s++){var d=i[FastExt.Base.randomInt(0,i.length-1)];if(l.push(d),l.length===r)break}if(e.push(l.join("")),e.length===u)break}return e}FastExt.Dialog.showAlert("系统提醒","最大长度必须大于最小长度！")},items:[{xtype:"fieldset",columnWidth:1,layout:"column",defaults:{labelWidth:60,margin:"5 5 5 5",labelAlign:"right",columnWidth:1,emptyText:"请填写"},title:"文字设置",items:[{fieldLabel:"文字库",id:c+"_longTextList",allowBlank:!(s={xtype:"fieldcontainer",layout:"column",columnWidth:1,id:c+"_3",hidden:!0,disabled:!0,defaults:{labelWidth:60,margin:"5 5 5 5",labelAlign:"right",columnWidth:1,emptyText:"请填写"},random:function(){var e=[],t=Ext.getCmp(c+"_minDate").getValue(),n=Ext.getCmp(c+"_maxDate").getValue();if(!(t.getTime()>n.getTime())){for(var o=0;o<Number.MAX_VALUE;o++){var i=n.getTime()-t.getTime(),i=Math.random()*i+t.getTime(),i=new Date(i);if(e.push(Ext.Date.format(i,Ext.getCmp(c+"_minDate").format)),e.length===u)break}return e}FastExt.Dialog.showAlert("系统提醒","最大日期必须大于最小日期！")},items:[{xtype:"fieldset",columnWidth:1,layout:"column",defaults:{labelWidth:60,margin:"5 5 5 5",labelAlign:"right",columnWidth:1,emptyText:"请填写"},title:"日期设置",items:[{fieldLabel:"最小日期",xtype:"datefield",id:c+"_minDate",allowBlank:!(l={xtype:"fieldcontainer",layout:"column",columnWidth:1,id:c+"_2",hidden:!0,disabled:!0,defaults:{labelWidth:60,margin:"5 5 5 5",labelAlign:"right",columnWidth:1,emptyText:"请填写"},random:function(){var e=[],t=Ext.getCmp(c+"_dotNumber").getValue(),n=Ext.getCmp(c+"_minNumber").getValue(),o=Ext.getCmp(c+"_maxNumber").getValue();if(!(o<n)){for(var i=0;i<Number.MAX_VALUE;i++){var a=Math.random()*(o-n)+n;if(e.push(a.toFixed(t)),e.length===u)break}return e}FastExt.Dialog.showAlert("系统提醒","最大数字必须大于最小数字！")},items:[{xtype:"fieldset",columnWidth:1,layout:"column",defaults:{labelWidth:60,margin:"5 5 5 5",labelAlign:"right",columnWidth:1,emptyText:"请填写"},title:"数字设置",items:[{fieldLabel:"保留位数",id:c+"_dotNumber",value:0,allowBlank:!(r={xtype:"fieldcontainer",layout:"column",columnWidth:1,id:c+"_1",defaults:{labelWidth:60,margin:"5 5 5 5",labelAlign:"right",columnWidth:1,emptyText:"请填写"},random:function(){for(var e=[],t=Ext.getCmp(c+"_textPrefix").getValue(),n=Ext.getCmp(c+"_textStartNumber").getValue(),o=parseInt(n);o<Number.MAX_VALUE&&(e.push(t+o),e.length!==u);o++);return e},items:[{xtype:"fieldset",columnWidth:1,layout:"column",defaults:{labelWidth:60,margin:"5 5 5 5",labelAlign:"right",columnWidth:1,emptyText:"请填写"},title:"文字设置",items:[{fieldLabel:"文字前缀",id:c+"_textPrefix",allowBlank:!1,xtype:"textfield"},{fieldLabel:"开始序数",id:c+"_textStartNumber",value:1,allowBlank:!1,xtype:"numberfield"}]}]}),xtype:"numberfield"},{fieldLabel:"最小数字",id:c+"_minNumber",value:0,allowBlank:!1,xtype:"numberfield"},{fieldLabel:"最大数字",id:c+"_maxNumber",allowBlank:!1,xtype:"numberfield"}]}]}),format:d},{fieldLabel:"最大日期",xtype:"datefield",id:c+"_maxDate",allowBlank:!1,format:d}]}]}),xtype:"textfield",listeners:{change:function(e,t,n,o){Ext.getCmp(c+"_maxLength").setValue(t.truthLength())}}},{fieldLabel:"最小长度",id:c+"_minLength",value:1,minValue:1,allowBlank:!1,xtype:"numberfield"},{fieldLabel:"最大长度",id:c+"_maxLength",allowBlank:!1,minValue:1,xtype:"numberfield"}]}]}),value:x,xtype:"textfield"},{xtype:"displayfield",value:"以英文逗号（,）为分隔符！"}]}]},m=Ext.create("Ext.form.Panel",{bodyPadding:5,region:"center",autoScroll:!0,layout:"column",defaults:{labelWidth:60,margin:"5 5 5 5",labelAlign:"right",columnWidth:1,emptyText:"请填写"},items:[{xtype:"combo",name:"autoType",fieldLabel:"随机类型",editable:!1,displayField:"text",valueField:"id",value:1,listeners:{change:function(e,t,n,o){Ext.getCmp(c+"_"+n).setHidden(!0),Ext.getCmp(c+"_"+n).setDisabled(!0),Ext.getCmp(c+"_"+t).setHidden(!1),Ext.getCmp(c+"_"+t).setDisabled(!1)}},store:Ext.create("Ext.data.Store",{fields:["id","text"],data:[{text:"文本",id:1},{text:"长文本",id:4},{text:"数字",id:2},{text:"数字集合",id:5},{text:"日期",id:3}]})},r,l,s,d,x]}),(g=Ext.create("Ext.window.Window",{title:e,height:360,iconCls:"extIcon extRandom",width:450,layout:"border",items:[m],modal:!0,constrain:!0,listeners:{show:function(){var e=m.getField("autoType");e.setValue(t),e.setReadOnly(n)}},buttons:["->",{text:"取消",iconCls:"extIcon extClose",handler:function(){g.close()}},{text:"立即生成",iconCls:"extIcon extOk whiteColor",handler:function(){var n,e;m.getForm().isValid()&&(e=m.getFieldValue("autoType"),(e=Ext.getCmp(c+"_"+e).random())&&0!==e.length&&(0!==(n=e).length&&FastExt.Grid.getColumnGrid(o).getStore()&&(FastExt.Grid.getColumnGrid(o).getStore().holdUpdate=!0,0<(e=FastExt.Grid.getColumnGrid(o).getSelectionModel().getSelection()).length?Ext.each(e,function(e,t){Ext.isObject(n[t])?FastExt.Store.setRecordValue(e,o.dataIndex,n[t]):e.set(o.dataIndex,n[t])}):FastExt.Grid.getColumnGrid(o).getStore().each(function(e,t){Ext.isObject(n[t])?FastExt.Store.setRecordValue(e,o.dataIndex,n[t]):e.set(o.dataIndex,n[t])}),FastExt.Grid.getColumnGrid(o).getStore().holdUpdate=!1,FastExt.Grid.getColumnGrid(o).getStore().fireEvent("endupdate")),g.close()))}}]})).show())},Grid.configColumnSearchLink=function(t){var e="";t.searchLink&&(e=t.searchLink.checked),FastExt.System.showMenuColumns(t,e).then(function(e){0<e.columns.length?(t.searchLink=e,FastExt.Dialog.toast("配置成功！")):(t.searchLink=null,FastExt.Dialog.toast("已清空搜索链！"))})},Grid.refreshColumnStyle=function(e){try{var t;Ext.isEmpty(e.dataIndex)||(t=e.sortDirection,t=Ext.isEmpty(t)?"<font size='1'></font>":"ASC"===t?"<font color='red' size='1'>&nbsp;&nbsp;[正序]</font>":"<font color='red' size='1'>&nbsp;&nbsp;[倒序]</font>",Ext.isEmpty(e.sumText)&&(e.sumText="<font size='1'></font>"),e.searching?(e.setText(FastExt.Base.getSVGIcon("extSearch")+"&nbsp;"+e.configText+e.sumText+t+"&nbsp;"),e.setStyle("color","red")):(e.setText("&nbsp;"+e.configText+e.sumText+t+"&nbsp;"),e.setStyle("color","#444444")),FastExt.Grid.checkColumnSort(FastExt.Grid.getColumnGrid(e)))}catch(e){console.error(e)}},Grid.checkColumnSort=function(e){try{var t,n=0<e.getStore().getSorters().length,o=e.child("#pagingToolBar");o&&(t=o.down("button[toolType=sortBtn]"),n?t.setIconCls("extIcon extSort redColor"):t.setIconCls("extIcon extSort grayColor"))}catch(e){console.error(e)}},Grid.configColumnProperty=function(e){try{e.configText=e.text,e.toSearchKey=function(e,t){return"where['@"+this.getIndex()+FastExt.Base.toString(e.link,"&")+this.dataIndex+e.compare+":index"+t+"']"},e.searchValue=function(e){this.where||(this.where=[]),this.where.push({link:"&",compare:"=",value:e}),this.doSearch()},e.clearSearch=function(){var e=this,t=FastExt.Grid.getColumnGrid(e).getStore().proxy.extraParams;if(e.where)for(var n=0;n<e.where.length;n++){var o=e.toSearchKey(e.where[n],n);t.hasOwnProperty(o)&&delete t[o]}e.where=[],e.searchMenu=null,e.searching=!1,FastExt.Grid.refreshColumnStyle(e)},e.doSearch=function(e){var t=this,n=FastExt.Grid.getColumnGrid(t).getStore().proxy.extraParams;if(t.where){for(var o=0;o<t.where.length;o++){var i=t.where[o],a=t.toSearchKey(i,o),r=i.value;0<=i.compare.indexOf("?")&&(r="%"+i.value+"%"),n[a]=r}FastExt.Base.toBool(e,!0)&&FastExt.Grid.getColumnGrid(t).getStore().loadPage(1),t.searching=0!==t.where.length,FastExt.Grid.refreshColumnStyle(t)}},e.where&&0<e.where.length&&e.doSearch(!1),e.isSubHeader?e.groupHeaderText=e.ownerCt.text:e.groupHeaderText=null}catch(e){console.error(e)}},Grid.configColumnListener=function(e){try{e.on("blur",function(e,t,n){})}catch(e){console.error(e)}},Grid.buildSearchItem=function(e,t){try{var n=FastExt.Grid.getColumnSimpleEditor(e,!0);return n?(n.validator=null,n.flex=1,n.margin="2 2 0 0",n.repeatTriggerClick=!1,n.onClearValue=function(){Ext.isFunction(this.ownerCt.removeSearch)?this.ownerCt.removeSearch():this.ownerCt.destroy()},n.triggers={close:{cls:"text-clear",handler:function(){this.onClearValue()}}},FastExt.Form.isEnumField(n)?n.editable=!1:n.editable=!0,n.emptyText="请输入条件值",t||(t={link:"&",compare:"=",value:""},FastExt.Form.isTextField(n)?t.compare="?":FastExt.Form.isDateField(n)&&(t.compare=">")),n.value=t.value,n.submitValue=!1,n.name="value",{xtype:"panel",margin:"0",searchItem:!0,border:0,flex:1,region:"center",layout:{type:"hbox",align:"stretch"},toParam:function(){var t={};return this.items.each(function(e){if(Ext.isFunction(e.getValue)){if(!e.isValid())return FastExt.Component.shakeComment(e),FastExt.Dialog.toast(e.getErrors()[0]),t=null,!1;Ext.isDate(e.getValue())?t[e.getName()]=Ext.Date.format(e.getValue(),e.format):t[e.getName()]=e.getValue()}}),t},setParam:function(t){this.items.each(function(e){Ext.isFunction(e.getValue)&&("compare"===e.getName()?e.setValue(t.compare):"link"===e.getName()?e.setValue(t.link):e.setValue(t.value))})},items:[{xtype:"combo",name:"link",value:FastExt.Base.toString(t.link,"&"),margin:"2 2 0 2",width:35,valueField:"text",editable:!1,hideTrigger:!0,tpl:Ext.create("Ext.XTemplate",'<ul class="x-list-plain"><tpl for=".">','<li role="option" class="x-boundlist-item" style="font-size: 12px;">{desc}</li>',"</tpl></ul>"),listeners:{afterrender:function(e,t){e.getPicker().setMinWidth(100)}},store:FastExt.Store.getCompareLinkDataStore()},{xtype:"combo",name:"compare",value:t.compare,margin:"2 2 0 2",width:35,valueField:"text",editable:!1,hideTrigger:!0,tpl:Ext.create("Ext.XTemplate",'<ul class="x-list-plain"><tpl for=".">','<li role="option" class="x-boundlist-item" style="font-size: 12px;">{desc}</li>',"</tpl></ul>"),listeners:{afterrender:function(e,t){e.getPicker().setMinWidth(100)}},store:FastExt.Store.getCompareDataStore()},n]}):void 0}catch(e){console.error(e)}return null},Grid.showColumnSearchMenu=function(o){try{if(!FastExt.Base.toBool(FastExt.Grid.getColumnGrid(o).columnSearch,!0))return!1;if(FastExt.Grid.isFilesColumn(o)||FastExt.Grid.isFileColumn(o))return!1;if(!FastExt.Base.toBool(o.search,!0))return!1;if(FastExt.Base.toBool(o.encrypt,!1))return!1;if(o.searchMenu||(o.searchMenu=new Ext.menu.Menu({padding:"0 0 0 0",power:!1,showSeparator:!1,columnSearchMenu:!0,style:{background:"#ffffff"},addSearchItem:function(e){var t=this.items.length-1;5<=t||this.insert(t,FastExt.Grid.buildSearchItem(o,e))},doSearch:function(){var n=[];this.items.each(function(e,t){if(e.searchItem){e=e.toParam();if(!e)return n=null,!1;Ext.isEmpty(e.value)||(e.index=t,n.push(e))}}),n&&(o.clearSearch(),o.where=n,o.doSearch(),this.hide())},items:[{xtype:"panel",layout:{type:"hbox",align:"stretch"},margin:"2",border:0,items:[{xtype:"button",text:"搜索",flex:1,iconCls:"extIcon extSearch",margin:"0 2 0 0",handler:function(){this.ownerCt.ownerCt.doSearch()}},{xtype:"button",iconCls:"extIcon extPlus fontSize14",width:35,handler:function(){this.ownerCt.ownerCt.addSearchItem()}}]}],listeners:{show:function(n,e){o.addCls("x-column-header-open"),1===n.items.length&&n.addSearchItem();try{new Ext.util.KeyMap({target:n.getEl(),key:13,fn:function(e,t){n.doSearch()},scope:n})}catch(e){console.error(e)}},hide:function(e,t){o.removeCls("x-column-header-open")}}})),o.where)for(var e=0;e<o.where.length;e++){var t=o.where[e];Ext.isEmpty(t.index)&&(t.index=e),t.index<o.searchMenu.items.length-1?o.searchMenu.items.getAt(t.index).setParam(t):o.searchMenu.addSearchItem(t)}return o.searchMenu.setWidth(Math.max(parseInt(o.getWidth()),200)),o.searchMenu.showBy(o,"tl-bl?"),!0}catch(e){console.error(e)}return!1},Grid.showColumnSearchWin=function(n,a){var o,i,e,r;n.searchWin||(o=FastExt.Store.getGridColumnStore(a,!0),i=function(e,t){t=FastExt.Grid.buildSearchItem(FastExt.Grid.getColumn(a,e.get("id"),e.get("text")),t);return t.removeSearch=function(){this.ownerCt.destroy()},{xtype:"panel",flex:1,columnWidth:1,layout:"hbox",margin:"0",border:0,toParam:function(){var e={},t=this.items.get(0),t=t.getStore().findRecord("id",t.getValue(),0,!1,!1,!0);e.text=t.get("text"),e.dataIndex=t.get("id");t=this.items.get(1);return e=FastExt.Json.mergeJson(e,t.toParam())},items:[{xtype:"combo",region:"west",valueField:"id",displayField:"text",flex:.4,margin:"2 0 0 2",value:e.get("id"),editable:!1,listeners:{change:function(e,t,n,o){var i=this.up("panel");i.remove(i.items.get(1),!0);t=e.getStore().findRecord("id",t,0,!1,!1,!0),t=FastExt.Grid.buildSearchItem(FastExt.Grid.getColumn(a,t.get("id"),t.get("text")));t.removeSearch=function(){this.ownerCt.destroy()},i.insert(1,t)}},store:o},t]}},e=(e=a.searchItems)||[],r=Ext.create("Ext.form.FormPanel",{margin:"5",border:0,layout:"column",width:400,scrollable:!0,defaults:{labelWidth:80,margin:"5 5 5 5",labelAlign:"right",emptyText:"请填写"},items:e}),Ext.each(a.getColumns(),function(e){if(e.where)for(var t=o.findRecord("id",e.dataIndex,0,!1,!1,!0),n=0;n<e.where.length;n++)r.add(i(t,e.where[n]))}),0===r.items.length&&r.add(i(o.getAt(0))),n.searchWin=Ext.create("Ext.window.Window",{title:"搜索数据",layout:"fit",constrain:!0,iconCls:"extIcon extSearch",resizable:!0,minHeight:200,minWidth:400,height:200,animateTarget:n,items:[r],listeners:{close:function(e,t){n.searchWin=null}},buttons:[{text:"清空条件",iconCls:"extIcon extClear whiteColor",handler:function(){r.removeAll(),Ext.each(a.getColumns(),function(e){e.clearSearch()}),a.getStore().loadPage(1)}},"->",{text:"添加条件",iconCls:"extIcon extPlus",handler:function(){r.add(i(o.getAt(0)));var e=50+35*r.items.length+55;r.scrollTo(0,e,!1)}},{text:"确定",iconCls:"extIcon extOk",handler:function(){Ext.each(a.getColumns(),function(e){e.clearSearch()});var n=[];r.items.each(function(e){if(!e.toParam){var t={};return t["where['"+e.name+"']"]=e.getValue(),void Ext.apply(a.getStore().proxy.extraParams,t)}t=e.toParam();if(t&&!Ext.isEmpty(t.value)){e=FastExt.Grid.getColumn(a,t.dataIndex,t.text);if(!e)return!1;e.where||(e.where=[]),delete t.dataIndex,delete t.text,e.where.push(t),n.push(e)}}),Ext.each(n,function(e){e.doSearch(!1)}),a.getStore().loadPage(1)}}]}),a.ownerCt.add(n.searchWin)),n.searchWin.show()},Grid.getPageToolBar=function(i){var t=!1;i.entity&&FastExt.Base.toBool(i.entity.recycle,!1)&&(t=!0);var e=!1;i.where&&FastExt.Base.toBool(i.where["^fromRecycle"],!1)&&(e=!0);var n=FastExt.Store.getStoreMenuText(i),o=Ext.create("Ext.toolbar.Paging",{store:i,dock:"bottom",itemId:"pagingToolBar",pageSize:i.pageSize,displayInfo:!0,inputItemWidth:70,overflowHandler:"scroller"}),a={xtype:"combo",pageTool:!0,displayField:"text",valueField:"id",editable:!1,width:100,value:i.pageSize,store:FastExt.Store.getPageDataStore(),listeners:{change:function(e,t,n){if(!FastExt.System.silenceGlobalSave&&null!=t&&0!=t){if(!e.getStore().getById(t))return e.totalCount=t,void e.setValue(-1);-1===t?(this.ownerCt.pageSize=i.getTotalCount(),i.pageSize=i.getTotalCount(),Ext.isEmpty(e.totalCount)||(this.ownerCt.pageSize=e.totalCount,i.pageSize=e.totalCount)):(this.ownerCt.pageSize=t,i.pageSize=t),i.loadPage(1)}}}},r={xtype:"button",tooltip:"拷贝数据",subtext:"拷贝数据@"+n,checkSelect:2,iconCls:"extIcon extCopy2 grayColor",handler:function(){var e=i.grid.getSelection();0!==e.length?Ext.Msg.confirm("系统提醒","您确定复制选中的"+e.length+"条数据吗？",function(e,t){"yes"===e&&(FastExt.Dialog.showWait("正在复制数据中……"),FastExt.Store.commitStoreCopy(i.grid.getStore(),i.grid.getSelection()).then(function(e){e&&(i.grid.getSelectionModel().deselectAll(),i.grid.getStore().isGrouped()&&i.grid.getView().getFeature("group").collapseAll(),FastExt.Dialog.hideWait())}))}):FastExt.Dialog.showAlert("系统提醒","请选择需要复制的数据！")}},l={xtype:"button",tooltip:"清空数据",subtext:"清空数据@"+n,iconCls:"extIcon extClear grayColor",handler:function(){var n=FastExt.Store.getStoreMenuText(i.grid.getStore()),e="<div style='line-height: 170%;'>";e+="<b style='color: red;font-size: 18px;'>请您谨慎操作！</b><br/>",n&&(e+="<b style='color: red;font-size: 16px;'>当前页面【"+n+"】</b><br/>"),e+="<b style='font-size: 16px;'>您确定清空当前条件下的所有数据吗？！<br/>当前共"+i.getTotalCount()+"条数据！</b>",t&&(e+="<br/><b style='color: red;font-size: 14px;line-height: 18px;'>此操作将跳过回收站！</b>"),e+="</div>";e={title:"系统提醒",icon:Ext.Msg.WARNING,message:e,buttons:Ext.Msg.YESNO,defaultFocus:"no",cls:"redAlert",callback:function(e,t){"yes"===e&&FastExt.System.validOperate("清空【"+n+"】数据",function(){FastExt.Dialog.showWait("正在清空数据中……");var e=i.grid.getStore().proxy.extraParams,t={entityCode:i.entity.entityCode,all:!0};i.grid.getStore().entity.menu&&(t.menu=FastExt.Store.getStoreMenuText(i.grid.getStore())),FastExt.Server.deleteEntity(FastExt.Json.mergeJson(t,e),function(e,t){FastExt.Dialog.hideWait(),e&&i.loadPage(1),FastExt.Dialog.showAlert("系统提醒",t)})})}};Ext.Msg.on("hide",function(){clearTimeout(Ext.Msg.timeout);var e=Ext.Msg.msgButtons.yes;e.setText("是"),e.enable()},this,{single:!0});var e=Ext.Msg.show(e),o=function(e){var t=Ext.Msg.msgButtons.yes;if(e<=0)return t.setText("立即清空"),void t.enable();t.setText(e+"秒后可操作"),t.disable(),Ext.Msg.timeout=setTimeout(function(){o(e-1)},1e3)};Ext.Msg.msgButtons.yes.disable(),FastExt.Component.shakeComment(e,function(){var e=5;50<i.getTotalCount()&&(e=15),5e3<i.getTotalCount()&&(e=20),1e4<i.getTotalCount()&&(e=30),o(e)},3e3)}};e&&(l.tooltip="清空回收站");var s={xtype:"button",tooltip:"回收站",iconCls:"extIcon extRecycle grayColor",handler:function(){FastExt.Grid.showRecycleGrid(this,i)}},d={xtype:"button",toolType:"searchBtn",tooltip:"搜索数据",iconCls:"extIcon extSearch grayColor",handler:function(){FastExt.Grid.showColumnSearchWin(this,i.grid)}},c={xtype:"button",toolType:"sortBtn",tooltip:"排序数据",iconCls:"extIcon extSort grayColor",handler:function(){FastExt.Grid.showColumnSortWin(this,i.grid)}},n={xtype:"button",toolType:"timerBtn",tooltip:"定时刷新",iconCls:"extIcon extAlarm grayColor",handler:function(){FastExt.Grid.showTimerRefreshGrid(this,i.grid)}};o.insert(0,a),o.insert(0,{xtype:"label",text:"每页",margin:"0 10 0 10"});a=o.child("#refresh"),a=o.items.indexOf(a);return o.insert(++a,n),o.insert(++a,"-"),o.insert(++a,d),o.insert(++a,c),e&&(c={xtype:"button",tooltip:"还原数据",checkSelect:2,iconCls:"extIcon extReback grayColor",handler:function(){FastExt.Grid.rebackGridData(i.grid)}},o.insert(++a,"-"),o.insert(++a,c)),o.insert(++a,"-"),e||o.insert(++a,r),o.insert(++a,l),!e&&t&&(o.insert(++a,"-"),o.insert(++a,s)),o},Grid.showRecycleGrid=function(obj,dataStore){var title,entityObj,where,gridPanel,entityOwner,winWidth,winHeight,win;dataStore&&(title="回收站",dataStore.entity.menu&&(title=dataStore.entity.menu.text+"-回收站"),entityObj=eval("new "+dataStore.entity.entityCode+"()"),entityObj.menu={id:$.md5(title),text:title},where={"^fromRecycle":!0},gridPanel=entityObj.getList(FastExt.Json.mergeJson(where,dataStore.where)),entityOwner=gridPanel.down("[entityList=true]"),entityOwner.code=$.md5(dataStore.entity.entityCode+"回收站"),winWidth=parseInt((.7*document.body.clientWidth).toFixed(0)),winHeight=parseInt((.8*document.body.clientHeight).toFixed(0)),win=Ext.create("Ext.window.Window",{title:title,iconCls:"extIcon extRecycle",layout:"fit",height:winHeight,width:winWidth,minHeight:500,minWidth:600,constrain:!0,resizable:!0,modal:!0,maximizable:!0,animateTarget:obj,maximized:!1,items:[gridPanel]}),win.show())},Grid.rebackGridData=function(o){return new Ext.Promise(function(n,e){var t;o.getStore().entity?0!==o.getSelection().length?(t=o.getSelection().length,t={title:"系统提醒",icon:Ext.Msg.QUESTION,message:"您确定还原选中的"+t+"条数据吗？",buttons:Ext.Msg.YESNO,defaultFocus:"no",callback:function(e,t){"yes"===e&&(FastExt.Dialog.showWait("正在还原数据中……"),FastExt.Store.commitStoreReback(o.getStore(),o.getSelection()).then(function(e,t){e&&(o.getSelectionModel().deselectAll(),o.getStore().isGrouped()&&o.getView().getFeature("group").collapseAll(),FastExt.Dialog.hideWait(),Ext.Msg.alert("系统提醒","还原成功！")),n(e)}))}},Ext.Msg.show(t)):FastExt.Dialog.toast("请您先选择需要还原的数据！"):Ext.Msg.alert("系统提醒","还原失败！Grid的DataStore未绑定Entity!")})},Grid.showColumnSortWin=function(n,o){var i,a,r;n.sortWin||(i=FastExt.Store.getGridColumnStore(o),a=function(e,t){return t=t||"ASC",{xtype:"panel",flex:1,columnWidth:1,layout:"hbox",margin:"0",border:0,toParam:function(){var e={},t=this.items.get(0);e.property=t.getValue();t=this.items.get(1);return e.direction=t.getValue(),e},items:[{xtype:"combo",region:"west",valueField:"id",flex:.4,margin:"2 0 0 2",value:e.get("id"),displayField:"text",editable:!1,store:i},{xtype:"combo",flex:1,valueField:"value",editable:!1,margin:"2 2 0 2",value:t,triggers:{close:{cls:"text-clear",handler:function(){this.ownerCt.destroy()}}},store:Ext.create("Ext.data.Store",{fields:["id","text"],data:[{text:"无",value:"NONE"},{text:"正序",value:"ASC"},{text:"倒序",value:"DESC"}]})}]}},r=Ext.create("Ext.form.FormPanel",{margin:"5",border:0,layout:"column",width:400,scrollable:!0,defaults:{labelWidth:80,margin:"5 5 5 5",labelAlign:"right",emptyText:"请填写"},items:[]}),o.getStore().getSorters().each(function(e){var t=i.findRecord("id",e.getProperty(),0,!1,!1,!0);r.add(a(t,e.getDirection()))}),0===r.items.length&&r.add(a(i.getAt(0),"NONE")),n.sortWin=Ext.create("Ext.window.Window",{title:"排序数据",layout:"fit",constrain:!0,iconCls:"extIcon extSort",resizable:!0,minHeight:200,minWidth:400,height:200,animateTarget:n,items:[r],listeners:{close:function(e,t){n.sortWin=null}},buttons:[{text:"添加条件",iconCls:"extIcon extPlus",handler:function(){r.add(a(i.getAt(0)));var e=50+35*r.items.length+55;r.scrollTo(0,e,!1)}},{text:"确定",iconCls:"extIcon extOk",handler:function(){o.getStore().getSorters().clear(),Ext.each(o.getColumns(),function(e){e.sortDirection=null,FastExt.Grid.refreshColumnStyle(e)});var n=[];r.items.each(function(e){var t=e.toParam();n.push(t);e=FastExt.Grid.getColumn(o,t.property);e.sortDirection=t.direction,FastExt.Grid.refreshColumnStyle(e)}),0<n.length?o.getStore().sort(n):o.getStore().loadPage(1),FastExt.Grid.checkColumnSort(o)}}]}),o.ownerCt.add(n.sortWin)),n.sortWin.show()},Grid.showTimerRefreshGrid=function(n,t){var e;n.timerWin||(t.timerConfig||(t.timerConfig={state:0,value:30}),e=Ext.create("Ext.form.FormPanel",{margin:"5",border:0,layout:"column",width:400,scrollable:!0,defaults:{labelWidth:120,margin:"5 5 5 5",labelAlign:"right",emptyText:"请填写"},viewModel:{data:t.timerConfig},items:[{xtype:"combo",name:"state",displayField:"text",valueField:"id",fieldLabel:"是否启动",editable:!1,flex:1,columnWidth:1,value:0,allowBlank:!1,bind:"{state}",store:FastExt.Store.getYesOrNoDataStore()},{xtype:"numberfield",name:"value",bind:"{value}",fieldLabel:"时间间隔（秒）",columnWidth:1,minValue:1,value:30,decimalPrecision:0,allowBlank:!1}]}),n.timerWin=Ext.create("Ext.window.Window",{title:"定时刷新数据",layout:"fit",constrain:!0,iconCls:"extIcon extAlarm",resizable:!0,minHeight:200,minWidth:400,height:200,animateTarget:n,items:[e],listeners:{close:function(e,t){n.timerWin=null}},buttons:[{text:"确定",iconCls:"extIcon extOk",handler:function(){e.getForm().isValid()&&(t.timerConfig=e.getValues(),t.timerRefresh=function(){t.timerTimeout&&clearTimeout(t.timerTimeout);var e=t.child("#pagingToolBar");!e||(e=e.down("button[toolType=timerBtn]"))&&(1===parseInt(t.timerConfig.state)?e.setIconCls("extIcon extTimer redColor"):e.setIconCls("extIcon extTimer grayColor")),0!==parseInt(t.timerConfig.state)&&(t.timerTimeout=setTimeout(function(){t.getStore().reload(),t.timerRefresh()},1e3*parseInt(t.timerConfig.value)))},t.timerRefresh(),0===parseInt(t.timerConfig.state)?FastExt.Dialog.toast("已关闭定时器！"):FastExt.Dialog.toast("已启动定时器！"),n.timerWin.close())}}]}),t.ownerCt.add(n.timerWin)),n.timerWin.show()},Grid.deleteGridData=function(i){return new Ext.Promise(function(t,e){var n,o;i.getStore().entity?0!==i.getSelection().length?(o=i.getSelection().length,n=function(){FastExt.Dialog.showWait("正在删除数据中……"),FastExt.Store.commitStoreDelete(i.getStore(),i.getSelection()).then(function(e){e&&(i.getSelectionModel().deselectAll(),i.getStore().isGrouped()&&i.getView().getFeature("group").collapseAll(),FastExt.Dialog.hideWait()),t(e)})},i.operate&&i.operate.alertDelete?(o={title:"系统提醒",icon:Ext.Msg.QUESTION,message:"您确定删除选中的"+o+"条数据吗？",buttons:Ext.Msg.YESNO,defaultFocus:"no",callback:function(e,t){"yes"===e&&n()}},Ext.Msg.show(o)):n()):FastExt.Dialog.toast("请您先选择需要删除的数据！"):Ext.Msg.alert("系统提醒","删除失败！Grid的DataStore未绑定Entity!")})},Grid.updateGridData=function(o){return new Ext.Promise(function(n,e){o.getStore().entity?0!==o.getStore().getUpdatedRecords().length?o.operate&&o.operate.alertUpdate?Ext.Msg.confirm("系统提醒","您确定提交被修改的数据吗？",function(e,t){"yes"===e&&(FastExt.Dialog.showWait("正在修改数据中……"),FastExt.Store.commitStoreUpdate(o.getStore()).then(function(e){n(e),e&&FastExt.Dialog.hideWait()}))}):(FastExt.Dialog.showWait("正在修改数据中……"),FastExt.Store.commitStoreUpdate(o.getStore()).then(function(e){n(e),e&&FastExt.Dialog.hideWait()})):FastExt.Dialog.toast("当前暂无数据被修改！"):Ext.Msg.alert("系统提醒","修改失败！Grid的DataStore未绑定Entity!")})},Grid.showDetailsWindow=function(obj,title,entity,record){FastExt.Server.showColumns(entity.entityCode,function(success,value,message){if(success){var columnInfos=Ext.decode(value),data=[],lastGroupNon=1,key;for(key in columnInfos)if(columnInfos.hasOwnProperty(key)){var column=columnInfos[key];if(!Ext.isEmpty(column.dataIndex)){var d={value:record.get(column.dataIndex),groupHeaderText:column.groupHeaderText,record:record,entity:entity,configEditor:!1,editor:!1},c,fieldObj;for(c in column)column.hasOwnProperty(c)&&(d[c]=column[c]);Ext.isEmpty(column.editorField)||(fieldObj=FastExt.Json.jsonToObject(column.editorField),null==fieldObj||Ext.isEmpty(fieldObj.xtype)||(d.configEditor=!0)),d.groupHeaderText?lastGroupNon++:d.groupHeaderText=lastGroupNon,data.push(d)}}data.sort(function(e,t){return e.index-t.index});var detailsStore=Ext.create("Ext.data.Store",{fields:[],autoLoad:!1,groupField:"groupHeaderText"});detailsStore.loadData(data),detailsStore.sort("index","ASC");var detailsGrid=Ext.create("Ext.grid.Panel",{border:0,scrollable:"y",region:"center",store:detailsStore,hideHeaders:!0,features:[{ftype:"grouping",collapsible:!1,hideGroupedHeader:!0,expandTip:null,collapseTip:null,groupHeaderTpl:["<b>{name:this.formatName}</b>",{formatName:function(e){return Ext.isNumeric(e)?"基本属性":e}}]}],columns:[{header:"名称",power:!1,dataIndex:"text",flex:.3,tdCls:"tdVTop",align:"right",renderer:function(e,t,n){return t.style="overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space:normal !important;line-height:20px;word-break:break-word; ","<b>"+e+"：</b>"}},{header:"值",dataIndex:"value",power:!1,flex:.7,align:"left",renderer:function(val,m,r){try{m.style="overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space:normal !important;line-height:20px;word-break:break-word; ";var fun=null,rendererFunction=r.get("rendererFunction"),renderer,fun;return fun=rendererFunction?eval(rendererFunction):(renderer=r.get("renderer"),FastExt.Base.loadFunction(renderer)),Ext.isEmpty(fun)||(val=fun(val,m,r.get("record"),-1,-1,null,null,!0)),Ext.isEmpty(val)||"null"===val?"<font color='#ccc'>无</font>":val}catch(e){return val}}},{xtype:"actioncolumn",width:50,sortable:!1,menuDisabled:!0,items:[{iconCls:"extIcon extEdit",tooltip:"编辑数据",align:"center",isDisabled:function(e,t,n,o,i){return!FastExt.Base.toBool(i.get("editor"),!1)},getClass:function(e,t,n){return FastExt.Base.toBool(n.get("editor"),!1)?"extIcon extEdit":""},handler:FastExt.Grid.showDetailsEditMenu}]}],viewConfig:{loadMask:{msg:"正在为您在加载数据…"},enableTextSelection:!0},listeners:{itemmouseenter:function(e,t,n,o,i,a){t.set("editor",t.get("configEditor"))},itemmouseleave:function(e,t,n,o,i,a){t.set("editor",!1)}}}),winButtons=[];FastExt.System.searchMenuByEntityCode(entity.entityCode)&&winButtons.push({text:"管理界面",iconCls:"extIcon extWindow whiteColor",handler:function(){var e=FastExt.System.searchMenuByEntityCode(entity.entityCode);e?FastExt.System.lastTabId!==e.id?FastExt.System.selectMenu(e.id):FastExt.Component.shakeComment(Ext.getCmp(e.id)):FastExt.Dialog.showAlert("系统提醒","打开失败！您或没有此功能的管理权限！")}});var winWidth=parseInt((.3*document.body.clientWidth).toFixed(0)),winHeight=parseInt((.6*document.body.clientHeight).toFixed(0)),win=Ext.create("Ext.window.Window",{title:title,height:winHeight,width:winWidth,minHeight:450,iconCls:"extIcon extDetails",minWidth:400,layout:"border",resizable:!0,constrain:!0,maximizable:!0,animateTarget:obj,listeners:{destroy:function(e,t){},show:function(e){e.focus()}},items:[detailsGrid],buttons:winButtons});win.show()}else FastExt.Dialog.showAlert("系统提醒",message)})},Grid.createDetailsGrid=function(e,t,n,o){var i=Ext.create("Ext.data.Store",{autoLoad:!1,fields:[],data:e}),e={header:"值",dataIndex:"value",flex:.7,align:"left",renderer:function(t,e,n){try{e.style="overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space:normal !important;line-height:20px;word-break:break-word; ";var o=n.get("renderer");if(Ext.isFunction(o)){var i=o(t,e,n.get("record"),-1,-1,null,null,!0);return Ext.isEmpty(i)?"<font color='#ccc'>无</font>":i}return t}catch(e){return t}},listeners:{dblclick:function(e,t,n,o,i,a,r){}}},o={region:"center",border:0,columnLines:!0,store:i,viewConfig:{enableTextSelection:!0},updateData:function(e){i.setData(e)},columns:[FastExt.Json.mergeJson({header:"名称",dataIndex:"name",flex:.3,align:"right",renderer:function(e,t,n){return t.style="color:#000000;overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space:normal !important;line-height:20px;word-break:break-word; ","<b>"+e+"：</b>"},listeners:{dblclick:function(e,t,n,o,i,a,r){}}},n),FastExt.Json.mergeJson(e,o)]};return Ext.create("Ext.grid.Panel",FastExt.Json.mergeJson(o,t))},Grid.showDetailsEditMenu=function(e,t,n,o,i,a){var r,l,s=a.get("linkColumn")?Ext.create(FastExt.Grid.getColumnSimpleEditor(a.get("linkColumn"))):Ext.create(FastExt.Json.jsonToObject(a.get("editorField")));s?(e.getSelectionModel().selectRange(t,t),t=e.getCell(a,1),s.flex=1,s.emptyText="请输入",s.region="center","password"!==FastExt.Base.toString(s.inputType,"none")&&Ext.isFunction(s.setValue)&&(e=a.get("value"),Ext.isObject(e)||Ext.isArray(e)?s.setValue(JSON.stringify(e),a.get("record")):s.setValue(e,a.get("record"))),r=function(e){e.isValid()&&(Ext.isEmpty(e.getValue())||(FastExt.Store.setRecordValue(a.get("record"),a.get("dataIndex"),e),FastExt.Store.setRecordValue(a,"value",e),FastExt.Store.commitStoreUpdate(a.get("record").store).then(function(e){e&&a.store.commitChanges()})))},Ext.isFunction(s.showWindow)?s.showWindow(t,function(e){r(e)}):((l=Ext.create("Ext.menu.Menu",{showSeparator:!1,layout:"fit",doUpdate:function(){var e=this.items.get(0).items.get(0);if(!e.isValid())return FastExt.Component.shakeComment(this),void FastExt.Dialog.toast(FastExt.Form.getFieldError(e)[0]);r(e),this.hide()},items:[{xtype:"panel",layout:{type:"hbox",align:"stretch"},style:{background:"#ffffff",borderWidth:1,borderColor:"#ffffff",color:"#eeeee"},border:0,items:[s,{xtype:"button",text:"确定",name:"confirm",region:"east",width:60,margin:"0 0 0 2",handler:function(){l.doUpdate()}}]}],listeners:{show:function(e,t){e.items.get(0).items.get(0).focus()}}})).setWidth(t.getWidth()),l.showBy(t,"tl"))):FastExt.Dialog.toast("此属性无法编辑！")},Grid}();FastExt.Grid=Grid;var GridOperate=(Object.defineProperty(yC.prototype,"alertDelete",{get:function(){return this._alertDelete},set:function(e){this._alertDelete=e},enumerable:!1,configurable:!0}),Object.defineProperty(yC.prototype,"alertUpdate",{get:function(){return this._alertUpdate},set:function(e){this._alertUpdate=e},enumerable:!1,configurable:!0}),Object.defineProperty(yC.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(e){this._autoUpdate=e},enumerable:!1,configurable:!0}),Object.defineProperty(yC.prototype,"autoDetails",{get:function(){return this._autoDetails},set:function(e){this._autoDetails=e},enumerable:!1,configurable:!0}),Object.defineProperty(yC.prototype,"hoverTip",{get:function(){return this._hoverTip},set:function(e){this._hoverTip=e},enumerable:!1,configurable:!0}),Object.defineProperty(yC.prototype,"refreshData",{get:function(){return this._refreshData},set:function(e){this._refreshData=e},enumerable:!1,configurable:!0}),yC);function yC(){this._alertDelete=!0,this._alertUpdate=!0,this._autoUpdate=!1,this._autoDetails=!0,this._hoverTip=!1,this._refreshData=!1}FastExt.GridOperate=GridOperate}(FastExt=FastExt||{}),function(e){var t=(n.rotateOSSImgUrl=function(e,t){return Ext.isEmpty(e)||Ext.isEmpty(t)?e:0<=e.toString().indexOf("?")?e+"&x-oss-process=image/rotate,"+t:e+"?x-oss-process=image/rotate,"+t},n);function n(){}e.Image=t}(FastExt=FastExt||{}),function(e){var t=(n.jsonToObject=function(e){try{return Ext.decode(e)}catch(e){}return null},n.objectToJson=function(e){try{return Ext.encode(e)}catch(e){}return null},n.mergeJson=function(e,t){var n={};if(!Ext.isEmpty(e))for(var o in e)n[o]=e[o];if(!Ext.isEmpty(t))for(var o in t)n[o]=t[o];return n},n);function n(){}e.Json=t}(FastExt=FastExt||{}),function(h){var e=(t.selAddressInMap=function(u,x,m,g){return new Ext.Promise(function(o,e){var t="";Ext.isEmpty(x)||Ext.isEmpty(m)||0===parseFloat(x)||0===parseFloat(m)||(t=x+","+m);function n(e,n){Ext.Msg.prompt(e,"请输入坐标经纬度(lng,lat)",function(e,t){"ok"===e&&(t=t.toString().replaceAll(" ","").replaceAll("，",","),window.mapFrame&&(n?window.mapFrame.window.AMap.convertFrom([t.split(",")],n,function(e,t){t=t.locations[0];window.mapFrame.window.setLngLatAddress(t.toString())}):window.mapFrame.window.setLngLatAddress(t)))})}var i=Ext.create("Ext.panel.Panel",{layout:"border",region:"center",iframePanel:!0,border:0}),a=Ext.create("Ext.form.FormPanel",{url:"addData",method:"POST",region:"north",fileUpload:!0,autoScroll:!1,layout:{type:"hbox",align:"stretch"},defaults:{margin:"5 5 5 5"},items:[{name:"map.taskTitle",fieldLabel:"位置搜索",labelWidth:60,labelAlign:"right",id:"txtSearch",columnWidth:1,flex:1,allowBlank:!1,useHistory:!0,emptyText:"输入地址",xtype:"textfield"},{xtype:"button",width:100,text:"搜索",handler:function(){r()}},{xtype:"button",width:120,text:"查找高德坐标",handler:function(){n("查找高德坐标")}},{xtype:"button",width:120,text:"查找GPS坐标",handler:function(){n("查找GPS坐标","gps")}}],listeners:{render:function(e){try{new Ext.util.KeyMap({target:e.getEl(),key:13,fn:r,scope:Ext.getBody()})}catch(e){console.error(e)}}}}),r=function(){a.getForm().isValid()&&window.mapFrame.window.searchAddress(Ext.getCmp("txtSearch").getValue())},l=Ext.create("Ext.panel.Panel",{layout:{type:"hbox",align:"stretch"},region:"south",border:0,height:42,defaults:{margin:"5 5 5 5"},items:[{xtype:"textfield",id:"lblAddress",fieldLabel:"选择位置",labelWidth:60,value:g,labelAlign:"right",flex:1},{xtype:"textfield",id:"lblLngLat",readOnly:!0,width:160,value:t},{xtype:"button",width:100,text:"确定",handler:function(){var e=Ext.getCmp("lblLngLat"),t=e.getValue(),n=t.split(",")[0],t=t.split(",")[1];h.Base.runCallBack(o,{lng:n,lat:t,addr:Ext.getCmp("lblAddress").getValue(),pro:e.province,city:e.city,area:e.area}),c.close()}}]}),s=Ext.create("Ext.panel.Panel",{layout:"border",border:0,items:[a,i,l]}),d=parseInt((.4*document.body.clientWidth).toFixed(0)),l=parseInt((.6*document.body.clientHeight).toFixed(0)),c=Ext.create("Ext.window.Window",{title:"选择位置",height:l,width:d,minHeight:500,minWidth:600,iconCls:"extIcon extMap",layout:"fit",resizable:!0,maximizable:!0,animateTarget:u,constrain:!0,items:[s],modal:!0,listeners:{show:function(){var e=h.System.formatUrlVersion("base/map/select.html",{mapVersion:h.System.getExt("amap-version").value,mapKey:h.System.getExt("amap-key").value});i.update("<iframe name='mapFrame'  src='"+e+"' width='100%' height='100%' frameborder='0' scrolling='no' />")},close:function(e){h.Base.runCallBack(o)}}});c.show(),s.setLoading("正在定位中，请稍后……"),window.onMapLoadDone=function(){Ext.isEmpty(t)?window.mapFrame.window.startLocation():window.mapFrame.window.setLngLatAddress(t)},window.closeMapMask=function(){s.setLoading(!1)},window.showMapMask=function(e){e?s.setLoading(e):s.setLoading(!0)},window.alert=function(e){h.Dialog.showAlert("系统提醒",e)},window.setMarkCurrPos=function(e,t,n,o,i){Ext.getCmp("lblAddress").setValue(t);t=Ext.getCmp("lblLngLat");t.setValue(e),t.province=n,t.city=o,t.area=i}})},t.showAddressInMap=function(e,o,i,a){var t=Ext.create("Ext.panel.Panel",{layout:"border",region:"center",border:0,iframePanel:!0,listeners:{afterrender:function(e,t){var n={lnglat:o,mapVersion:h.System.getExt("amap-version").value,mapKey:h.System.getExt("amap-key").value,mapTitle:i,mapAddress:a};e.update("<iframe name='mapFrame'  src='"+h.System.formatUrlVersion("base/map/show.html",n)+"' width='100%' height='100%' frameborder='0' scrolling='no' />")}}}),n=parseInt((.4*document.body.clientWidth).toFixed(0)),r=parseInt((.6*document.body.clientHeight).toFixed(0));Ext.create("Ext.window.Window",{title:"查看位置",height:r,width:n,minHeight:500,minWidth:600,iconCls:"extIcon extMap",layout:"border",resizable:!0,maximizable:!0,animateTarget:e,constrain:!0,items:[t],modal:!0}).show(),t.setLoading("正在请求地址信息……"),window.closeMapMask=function(){t.setLoading(!1)}},t.selRectangleInMap=function(d,c,u,x,m,g){return new Ext.Promise(function(n,e){Ext.isEmpty(g)&&(g=0);var t=Ext.create("Ext.panel.Panel",{layout:"border",region:"center",iframePanel:!0,border:0}),o=Ext.create("Ext.form.FormPanel",{method:"POST",region:"north",fileUpload:!0,autoScroll:!0,height:50,layout:"column",imgRotate:g,defaults:{margin:"5 5 5 5"},items:[{name:"map.taskTitle",fieldLabel:"位置搜索",labelWidth:60,labelAlign:"right",id:"txtSearch",columnWidth:1,useHistory:!0,emptyText:"输入地址",xtype:"textfield"},{xtype:"button",width:100,text:"搜索",handler:function(){i()}},{xtype:"button",width:100,text:"选取",handler:function(){window.mapRectangleFrame.window.selectRectangle()}},{xtype:"button",width:100,text:"锚点管理",handler:function(){h.Map.manageMapAnchorPoints(this,window.mapRectangleFrame)}},{xtype:"button",width:120,text:"向左旋转图片",handler:function(){o.imgRotate+=5,360<o.imgRotate&&(o.imgRotate=0),window.mapRectangleFrame.window.setImgLayerUrl(h.Image.rotateOSSImgUrl(x,o.imgRotate))}},{xtype:"button",width:120,text:"向右旋转图片",handler:function(){o.imgRotate-=5,o.imgRotate<0&&(o.imgRotate=360),window.mapRectangleFrame.window.setImgLayerUrl(h.Image.rotateOSSImgUrl(x,o.imgRotate))}}],listeners:{render:function(e){try{new Ext.util.KeyMap({target:e.getEl(),key:13,fn:i,scope:Ext.getBody()})}catch(e){console.error(e)}}}}),i=function(){o.getForm().isValid()&&window.mapRectangleFrame.window.searchAddress(Ext.getCmp("txtSearch").getValue())},a=Ext.create("Ext.panel.Panel",{layout:"column",region:"south",border:0,height:42,defaults:{margin:"5 5 5 5"},items:[{xtype:"textfield",id:"lblSouthWestLngLat",fieldLabel:"西南角(左下)",labelAlign:"right",readOnly:!0,columnWidth:.35},{xtype:"textfield",id:"lblNorthEastLngLat",fieldLabel:"东北角(右上)",readOnly:!0,columnWidth:.35},{xtype:"textfield",id:"lblRectangleSize",labelWidth:60,fieldLabel:"矩形宽高",readOnly:!0,columnWidth:.3},{xtype:"button",width:100,text:"确定",handler:function(){var e=Ext.getCmp("lblSouthWestLngLat").getValue(),t=Ext.getCmp("lblNorthEastLngLat").getValue();h.Base.runCallBack(n,{southWestLngLat:e,southWestLng:e.split(",")[0],southWestLat:e.split(",")[1],northEastLngLat:t,northEastLng:t.split(",")[0],northEastLat:t.split(",")[1],anchors:window.mapRectangleFrame.pointDataArray,rotate:o.imgRotate}),s.close()}}]}),r=Ext.create("Ext.panel.Panel",{layout:"border",border:0,items:[o,t,a]}),l=parseInt((.4*document.body.clientWidth).toFixed(0)),a=parseInt((.6*document.body.clientHeight).toFixed(0)),s=Ext.create("Ext.window.Window",{title:"选择图层位置",height:a,width:l,minHeight:500,minWidth:600,iconCls:"extIcon extMap",layout:"fit",resizable:!0,maximizable:!0,animateTarget:d,constrain:!0,items:[r],modal:!0,listeners:{show:function(){var e=h.System.formatUrlVersion("base/map/rectangle.html",{mapVersion:h.System.getExt("amap-version").value,mapKey:h.System.getExt("amap-key").value});t.update("<iframe name='mapRectangleFrame'  src='"+e+"' width='100%' height='100%' frameborder='0' scrolling='no' />")},close:function(e){h.Base.runCallBack(n)}}});s.show(),window.onMapLoadDone=function(){var e=h.Image.rotateOSSImgUrl(x,g);if(window.mapRectangleFrame.pointDataArray=m,window.mapRectangleFrame.window.setImgLayerUrl(e),c&&u&&(r.setLoading(!1),window.mapRectangleFrame.window.selectRectangle(c,u,e)),window.mapRectangleFrame.pointDataArray){for(var t=[],n=0;n<window.mapRectangleFrame.pointDataArray.length;n++)t.push(window.mapRectangleFrame.pointDataArray[n].gdPoint);window.mapRectangleFrame.window.setAnchorPoints(t,!1)}},window.closeMapMask=function(){r.setLoading(!1)},window.showMapMask=function(e){e?r.setLoading(e):r.setLoading(!0)},window.alert=function(e){h.Dialog.showAlert("系统提醒",e)},window.setSelectBounds=function(e,t,n){Ext.getCmp("lblSouthWestLngLat").setValue(e),Ext.getCmp("lblNorthEastLngLat").setValue(t),Ext.getCmp("lblRectangleSize").setValue(n.width+"px - "+n.height+"px")}})},t.manageMapAnchorPoints=function(e,i){e&&e.blur(),i.pointDataArray||(i.pointDataArray=[]);function t(e,n){Ext.Msg.prompt(e,"请输入坐标经纬度(lng,lat)",function(e,t){"ok"===e&&(t=t.toString().replaceAll(" ","").replaceAll("，",","),i&&(n?i.window.AMap.convertFrom([t.split(",")],n,function(e,t){t=t.locations[0];a.findRecord("gdPoint",t.toString(),0,!1,!1,!0)?h.Dialog.toast("坐标已存在！"):(t={gdPoint:t.toString()},a.add(t))}):a.findRecord("gdPoint",t,0,!1,!1,!0)?h.Dialog.toast("坐标已存在！"):a.add({gdPoint:t})))})}var a=Ext.create("Ext.data.Store",{autoLoad:!0,data:i.pointDataArray}),o=Ext.create("Ext.grid.Panel",{selModel:h.Grid.getGridSelModel(),store:a,columnLines:!0,cellTip:!0,columns:[{header:"高德坐标",dataIndex:"gdPoint",align:"center",flex:1,field:{xtype:"textfield"},renderer:h.Renders.normal()}],selType:"cellmodel",tbar:[{xtype:"button",border:1,text:"删除",iconCls:"extIcon extDelete",handler:function(){var n=o.getSelectionModel().getSelection();0===n.length?h.Dialog.toast("请您选择需要删除的坐标！"):Ext.Msg.confirm("系统提醒","您确定立即删除选中的坐标吗？",function(e,t){"yes"===e&&(Ext.Array.each(n,function(e){a.remove(e)}),o.getSelectionModel().deselectAll(),h.Dialog.toast("删除成功！"))})}},{xtype:"button",border:1,text:"添加高德坐标",iconCls:"extIcon extAdd",handler:function(){t("添加高德坐标")}},{xtype:"button",border:1,text:"添加GPS坐标",iconCls:"extIcon extAdd",handler:function(){t("添加GPS坐标","gps")}}],listeners:{selectionchange:function(){}}}),r=Ext.create("Ext.window.Window",{title:"图层锚点管理",height:300,width:400,minWidth:400,minHeight:300,layout:"fit",resizable:!0,modal:!0,constrain:!0,iconCls:"extIcon extFolder",animateTarget:e,items:[o],buttons:[{text:"确定",iconCls:"extIcon extOk",handler:function(){var n=[],o=[];a.each(function(e,t){e=e.get("gdPoint");n.push(e),o.push({gdPoint:e})}),i&&(i.pointDataArray=o,i.window.setAnchorPoints(n,!0)),r.close()}}],listeners:{close:function(){}}});r.show()},t.showImgLayerInMap=function(a,r,l,s,d){return new Ext.Promise(function(t,e){var n=Ext.create("Ext.panel.Panel",{layout:"border",region:"center",iframePanel:!0,border:0}),o=parseInt((.4*document.body.clientWidth).toFixed(0)),i=parseInt((.6*document.body.clientHeight).toFixed(0));Ext.create("Ext.window.Window",{title:"查看图层位置",height:i,width:o,minHeight:500,minWidth:600,iconCls:"extIcon extMap",layout:"fit",resizable:!0,maximizable:!0,animateTarget:a,constrain:!0,items:[n],modal:!0,listeners:{show:function(){var e=h.System.formatUrlVersion("base/map/showRectangle.html",{mapVersion:h.System.getExt("amap-version").value,mapKey:h.System.getExt("amap-key").value});n.update("<iframe name='mapFrame'  src='"+e+"' width='100%' height='100%' frameborder='0' scrolling='no' />")},close:function(e){t.called||(t.called=!0,t())}}}).show(),Ext.isEmpty(d)&&(d=6),window.onMapLoadDone=function(){window.mapFrame.window.showImgLayerInMap(r,l,s,d)},window.alert=function(e){h.Dialog.showAlert("系统提醒",e)}})},t);function t(){}h.Map=e}(FastExt=FastExt||{}),function(i){var e=(t.copyMenu=function(e){var o=[];return e.items.each(function(e,t){var n={icon:e.icon,text:e.text,handler:e.handler};null!=e.getMenu()&&(n.menu=i.Menu.copyMenu(e.getMenu())),o.push(n)}),o},t.fireMenuEvent=function(e,n){e&&e.items.each(function(e,t){e.hasOwnProperty(n)&&Ext.isFunction(e[n])&&e[n](),Ext.isFunction(e.getMenu)&&i.Menu.fireMenuEvent(e.getMenu(),n)})},t);function t(){}i.Menu=e}(FastExt=FastExt||{}),function(FastOverrider){var ExtOverrider=function(){Ext.override(Ext,{getScrollbarSize:function(e){Ext.isDomReady||Ext.raise("getScrollbarSize called before DomReady");var t,n=Ext._scrollbarSize;return!e&&n||(t=document.body,(e=document.createElement("div")).style.width=e.style.height="100px",e.style.overflow="scroll",e.style.position="absolute",t.appendChild(e),Ext._scrollbarSize=n={width:e.offsetWidth-e.clientWidth,height:e.offsetHeight-e.clientHeight},t.removeChild(e)),n.width<=0&&(n.width=15),n.height<=0&&(n.height=15),n}})};FastOverrider.ExtOverrider=ExtOverrider;var ComponentOverride=function(){Ext.override(Ext.Component,{initComponent:Ext.Function.createSequence(Ext.Component.prototype.initComponent,function(){var e=this;try{if(e.validateOnBlur=!1,e.validateOnChange=!1,e.closeToolText="关闭",e.collapseToolText="关闭",e.expandToolText="展开",("window"===e.getXType()||"panel"===e.getXType())&&(!Ext.isEmpty(e.getTitle())||!Ext.isEmpty(e.subtitle))&&(e.resizable||e.split)){var i=$.md5(e.getTitle()+e.subtitle+$("title").text());try{i=$.md5(i+e.width+e.height)}catch(e){}var t=FastExt.Cache.getCache(i+"Width"),n=FastExt.Cache.getCache(i+"Height"),o=FastExt.Base.toBool(FastExt.Cache.getCache(i+"Collapse"),!1);null!=t&&(e.setWidth(t),e.setFlex(0)),null!=n&&(e.setHeight(n),e.setFlex(0)),e.collapsed=o,e.setCollapsed(o),e.on("resize",function(e,t,n,o){t!==Ext.getBody().getWidth()&&FastExt.Cache.setCache(i+"Width",t),n!==Ext.getBody().getHeight()&&FastExt.Cache.setCache(i+"Height",n)}),e.on("collapse",function(e,t,n,o){FastExt.Cache.setCache(i+"Collapse",!0)}),e.on("expand",function(e,t,n,o){FastExt.Cache.setCache(i+"Collapse",!1)})}"menuitem"===e.getXType()&&(e.on("focus",function(e,t,n){var o,i;e.isDisabled()||(o=/([^/]*.svg)/,(i=e.icon)&&o.test(i)&&(i=FastExt.Server.getIcon(o.exec(i)[1].trim(),"#ffffff"),(e=Ext.get(e.getId()+"-iconEl"))&&e.setStyle("background-image","url("+i+")")))}),e.on("blur",function(e,t,n){var o;e.isDisabled()||(o=e.icon)&&/([^/]*.svg)/.test(o)&&((e=Ext.get(e.getId()+"-iconEl"))&&e.setStyle("background-image","url("+o+")"))})),FastExt.Base.toBool(e.iframePanel,!1)&&(e.disabledCls="iframe-disabled-panel")}catch(e){console.error(e)}})}),Ext.override(Ext.Component,{show:function(){try{if(FastExt.System.isSystem()&&("window"===this.getXType()||"messagebox"===this.getXType())&&!FastExt.Base.toBool(this.sessionWin,!1)&&FastExt.System.sessionOutAlert)return this.hide(),null;var e=this,t=e.rendered;return e.hierarchicallyHidden||e.floating&&!t&&e.isHierarchicallyHidden()?(t||e.initHierarchyEvents(),1<arguments.length?(arguments[0]=null,e.pendingShow=arguments):e.pendingShow=!0):t&&e.isVisible()?e.floating&&e.onFloatShow():!1!==e.fireEvent("beforeshow",e)?(e.hidden=!1,delete this.getInherited().hidden,Ext.suspendLayouts(),t||!e.autoRender&&!e.floating||(e.doAutoRender(),t=e.rendered),t?(e.beforeShow(),Ext.resumeLayouts(),e.onShow.apply(e,arguments),e.afterShow.apply(e,arguments)):Ext.resumeLayouts(!0)):e.onShowVeto(),e}catch(e){console.error(e)}return this}}),Ext.override(Ext.Component,{onRender:Ext.Function.createSequence(Ext.Component.prototype.onRender,function(){var o,i=this;try{if(FastExt.Power.isPower())return;i.help&&((o=(o=i.bodyEl)||i.el).on("mouseleave",function(){i.helpTip&&i.helpTip.close()}),o.on("contextmenu",function(){try{var e=i.help;if(window.getHelpContent&&(e=window.getHelpContent(i.help)),i.helpTip)return void i.helpTip.close();var t=(t=i.helpAnchor)||"left",n=(i.getWidth()-20)/2;280<=(n="left"===t||"right"===t?(i.getHeight()-20)/2:n)&&(n=0),i.helpTip=Ext.create("Ext.tip.ToolTip",{target:o,resizable:!0,anchor:t,anchorOffset:n,autoHide:!1,maxWidth:400,closeAction:"destroy",html:e,showDelay:0,autoShow:!0,listeners:{beforedestroy:function(){i.helpTip=null},hide:function(){this.close()}}})}catch(e){console.error(e)}}))}catch(e){console.error(e)}})}),Ext.override(Ext.Component,{onAlignToScroll:function(){},adjustPosition:function(e,t){var n,o,i,a=this;a.isContainedFloater()&&(e+=(n=a.floatParent.getTargetEl().getViewRegion()).left,t+=n.top);try{a.pickerField&&(o=document.body.clientWidth,i=document.body.clientHeight,"datefield"===a.pickerField.xtype?(e=Math.min(a.pickerField.getX()+a.pickerField.getWidth(),o-a.getWidth()),t=Math.min(a.pickerField.getY(),i-a.getHeight())):-1!==a.pickerField.xtype.indexOf("combo")&&(e=Math.min(a.pickerField.bodyEl.getX(),o-a.getWidth()),t=Math.min(a.pickerField.getY()+a.pickerField.getHeight(),i-a.getHeight())))}catch(e){console.error(e)}return{x:e,y:t}}})};FastOverrider.ComponentOverride=ComponentOverride;var ButtonOverride=function(){Ext.override(Ext.button.Button,{afterRender:Ext.Function.createSequence(Ext.button.Button.prototype.afterRender,function(){try{var e=this;e.tipText&&(e.tip=new Ext.ToolTip({target:e.el,trackMouse:!0,renderTo:Ext.getBody(),dismissDelay:0,html:e.tipText}));var t=e.up("grid,treepanel");t&&(Ext.isEmpty(e.text)||FastExt.Grid.addGridContextMenu(t,FastExt.Button.buttonToMenuItem(e)),FastExt.Button.buttonToBind(t,e))}catch(e){console.error(e)}})})};FastOverrider.ButtonOverride=ButtonOverride;var GridOverride=function(){function GridOverride(){Ext.override(Ext.grid.CellContext,{setRow:function(e){try{var t=this,n=t.view.dataSource;return e&&("number"==typeof e?(t.rowIdx=Math.max(Math.min(e,n.getCount()-1),0),t.record=n.getAt(e)):e.isModel?(t.record=e,t.rowIdx=n.indexOf(e)):(e.tagName||e.isElement)&&(t.record=t.view.getRecord(e),t.rowIdx=n.indexOf(t.record))),t}catch(e){console.error(e)}return this}}),Ext.override(Ext.grid.column.Column,{afterRender:Ext.Function.createSequence(Ext.grid.column.Column.prototype.afterRender,function(){try{var me=this;me.code=FastExt.Power.getPowerCode(me),me.renderer||(me.renderer=FastExt.Renders.normal()),me.rendererFunction&&(me.renderer=eval(me.rendererFunction)),FastExt.Grid.configColumnProperty(me),FastExt.Grid.configColumnListener(me)}catch(e){console.error(e)}})})}return GridOverride}();FastOverrider.GridOverride=GridOverride;var LayoutOverride=function(){Ext.override(Ext.layout.container.Accordion,{nextCmp:function(e){e=e.next();return e&&e.isHidden()?this.nextCmp(e):e},prevCmp:function(e){e=e.prev();return e&&e.isHidden()?this.prevCmp(e):e},onBeforeComponentCollapse:function(e){try{var t,n=this,o=n.owner,i=void 0;if(1===n.owner.items.getCount())return!1;if(!n.processing){if(n.processing=!0,t=o.deferLayouts,o.deferLayouts=!0,(i=n.nextCmp(e)||n.prevCmp(e)).isHidden())return o.deferLayouts=t,n.processing=!1,void n.onBeforeComponentCollapse(i);if(n.multi)return o.deferLayouts=t,void(n.processing=!1);i&&i.expand(),o.deferLayouts=t,n.processing=!1}}catch(e){console.error(e)}}})};FastOverrider.LayoutOverride=LayoutOverride;var DomOverride=function(){Ext.override(Ext.dom.Element,{syncContent:function(e){try{var t,n,o,i,a,r=(e=Ext.getDom(e)).childNodes,l=r.length,s=this.dom,d=s.childNodes,c=d.length,u=void 0,x=void 0,m=s._extData;if(Ext.isIE9m&&s.mergeAttributes)s.mergeAttributes(e,!0),s.src=e.src;else for(i=(o=e.attributes).length,u=0;u<i;u++)"id"!==(a=o[u].name)&&s.setAttribute(a,o[u].value);if(m&&(m.isSynchronized=!1),l!==c)return void(s.innerHTML=e.innerHTML);for(u=0;u<l;u++){if(t=r[u],x=d[u],(n=t.nodeType)!==x.nodeType||1===n&&t.tagName!==x.tagName)return void(s.innerHTML=e.innerHTML);if(3===n)x.data=t.data;else try{t.id&&x.id!==t.id&&(x.id=t.id),x.style.cssText=t.style.cssText,x.className=t.className,Ext.fly(x,"_syncContent").syncContent(t)}catch(e){}}}catch(e){console.error(e)}}})};FastOverrider.DomOverride=DomOverride;var ToolbarOverride=function(){Ext.override(Ext.toolbar.Paging,{updateInfo:function(){var e=this,t=e.child("#displayItem"),n=e.store,o=e.getPageData();t&&(e=0===n.getCount()?e.emptyMsg:Ext.String.format(e.displayMsg,o.fromRecord,o.toRecord,o.total),n.grid&&(o=void 0,0<(o=n.grid.getSelectionModel&&n.grid.getSelectionModel().selected&&!Ext.isEmpty(n.grid.getSelectionModel().selected.rangeEnd)&&!Ext.isEmpty(n.grid.getSelectionModel().selected.rangeStart)?Math.abs(parseInt(n.grid.getSelectionModel().selected.rangeEnd)-parseInt(n.grid.getSelectionModel().selected.rangeStart))+1:n.grid.getSelection().length)&&(e="选中"+o+"行数据，"+e),n.grid.selectCount=o,Ext.isFunction(n.grid.refreshSelect)&&n.grid.refreshSelect(),Ext.isFunction(n.grid.refreshDetailsPanel())&&n.grid.refreshDetailsPanel()),t.setText(e))}})};FastOverrider.ToolbarOverride=ToolbarOverride;var UtilOverride=function(){Ext.override(Ext.util.Grouper,{sortFn:function(e,t){return 0}})};FastOverrider.UtilOverride=UtilOverride;var ResizerOverride=function(){Ext.override(Ext.resizer.Splitter,{onRender:function(){this.collapseOnDblClick=!1,this.callParent(arguments)}})};FastOverrider.ResizerOverride=ResizerOverride;var DDOverride=function(){Ext.override(Ext.dd.DragTracker,{onMouseDown:function(e){this.callParent(arguments);for(var t=Ext.ComponentQuery.query("[iframePanel=true]"),n=0;n<t.length;n++)t[n].setDisabled(!0)},endDrag:function(e){this.callParent(arguments);for(var t=Ext.ComponentQuery.query("[iframePanel=true]"),n=0;n<t.length;n++)t[n].setDisabled(!1)}})};FastOverrider.DDOverride=DDOverride;var FormOverride=function(){Ext.override(Ext.form.Basic,{submit:function(e){var t;return(e=e||{}).submitEmptyText=!1,t=e.standardSubmit||this.standardSubmit?"standardsubmit":this.api?"directsubmit":"submit",this.doAction(t,e)},isValid:function(){try{Ext.suspendLayouts();var n="",o=0,i="请正确填写数据！",e=this.getFields().filterBy(function(e){var t=!e.validate();return t&&0===o&&(n=e.getFieldLabel(),i=FastExt.Form.getFieldError(e)[0],o++),t});Ext.resumeLayouts(!0);var t=e.length<1;return t||(Ext.isEmpty(n)?FastExt.Dialog.toast("请将数据填写完整！"):Ext.isEmpty(i)?FastExt.Dialog.toast("【"+n+"】错误！"):FastExt.Dialog.toast("【"+n+"】错误："+i),FastExt.Component.shakeComment(this.owner.ownerCt)),t}catch(e){FastExt.Dialog.showException(e)}}}),Ext.override(Ext.form.field.Date,{parseDate:function(e){if(!e||Ext.isDate(e))return e;var t=FastExt.Base.guessDateFormat(e);t&&(this.format=t);var n,o=this,i=o.safeParse(e,o.format),t=o.altFormats,a=o.altFormatsArray,r=0;if(!i&&t)for(n=(a=a||t.split("|")).length;r<n&&!i;++r)i=o.safeParse(e,a[r]);return i},initComponent:Ext.Function.createSequence(Ext.form.field.Date.prototype.initComponent,function(){FastExt.System.isSystem()&&(this.format||(this.format=FastExt.System.dateFormat),"y-m-d"===this.format&&(this.format=FastExt.System.dateFormat),this.pickerAlign="tl-tr?")})}),Ext.override(Ext.form.field.File,{onRender:Ext.Function.createSequence(Ext.form.field.File.prototype.onRender,function(){this.multiple&&this.fileInputEl.dom.setAttribute("multiple","multiple")})}),Ext.override(Ext.form.field.Time,{initComponent:Ext.Function.createSequence(Ext.form.field.Time.prototype.initComponent,function(){this.invalidText="无效的时间格式!"})}),Ext.override(Ext.form.field.Text,{validate:function(){var e,t,n=this.callParent(arguments);return n&&"textfield"===this.xtype&&!this.disabled&&!this.readOnly&&this.useHistory&&(e=this.getValue(),(t=(t=FastExt.Cache.getCache(this.code))||[]).exists(e)||(t.push(e),FastExt.Cache.setCache(this.code,t))),n},initComponent:Ext.Function.createSequence(Ext.form.field.Text.prototype.initComponent,function(){var o=this;"password"===o.inputType?o.setTriggers({eayOpen:{cls:"extIcon extEye editColor",hidden:!0,handler:function(){o.up("menu")&&(o.up("menu").holdShow=!0),this.getTrigger("eayOpen").hide(),this.getTrigger("eayClose").show();var e=document.getElementById(this.getInputId());e.blur(),e.setAttribute("type","password"),setTimeout(function(){FastExt.Base.inputFocusEnd(e),o.up("menu")&&(o.up("menu").holdShow=!1)},100)}},eayClose:{cls:"extIcon extEye",handler:function(){o.up("menu")&&(o.up("menu").holdShow=!0),this.getTrigger("eayOpen").show(),this.getTrigger("eayClose").hide();var e=document.getElementById(this.getInputId());e.blur(),e.setAttribute("type","text"),setTimeout(function(){FastExt.Base.inputFocusEnd(e),o.up("menu")&&(o.up("menu").holdShow=!1)},100)}}}):"textfield"!==o.xtype||o.disabled||o.readOnly||!this.useHistory||(o.checkHistory=function(){this.code||(this.code=FastExt.Power.getPowerCode(this));var e=FastExt.Cache.getCache(this.code);return e&&0<e.length?(this.getTrigger("history").show(),!0):(this.getTrigger("history").hide(),!1)},o.clearHistory=function(){this.code||(this.code=FastExt.Power.getPowerCode(this)),FastExt.Cache.setCache(this.code,[]),FastExt.Dialog.toast("已清空历史记录！"),o.checkHistory()},o.showHistory=function(){this.code||(this.code=FastExt.Power.getPowerCode(this)),this.historyMenu=new Ext.menu.Menu({padding:"0 0 0 0",power:!1,showSeparator:!1,maxHeight:300,style:{background:"#ffffff"}}),this.historyMenuHandler=function(){o.setValue(this.text)};var e=FastExt.Cache.getCache(this.code);if(e){this.historyMenu.add({text:"清空历史记录",iconCls:"extIcon extClear",handler:function(){o.clearHistory()}});for(var t=0;t<e.length;t++){var n=e[t];this.historyMenu.add({text:n,iconCls:"extIcon extHistory",handler:this.historyMenuHandler})}this.historyMenu.setWidth(Math.max(this.bodyEl.getWidth(),200)),this.historyMenu.showBy(this.bodyEl,"tl-bl?")}},o.hideHistory=function(){this.historyMenu&&this.historyMenu.close()},o.on("change",function(e,t,n){e.checkHistory()}),o.on("afterrender",function(e,t,n){e.checkHistory()}),o.setTriggers({history:{cls:"extIcon extHistory",hidden:!0,handler:function(){o.up("menu")&&(o.up("menu").holdShow=!0),o.showHistory()}}}))})})};FastOverrider.FormOverride=FormOverride;var PowerComponentOverride=function(){Ext.override(Ext.Component,{afterRender:Ext.Function.createSequence(Ext.Component.prototype.afterRender,function(){var o;FastExt.System.isSystem()&&((o=this).power=FastExt.Base.toBool(o.power,!0),o.power&&(0<o.getXTypes().indexOf("field/")||Ext.Array.contains(FastExt.Power.types,o.getXType()))&&(o.code=FastExt.Power.getPowerCode(o),o.power&&(o.up("[power=false]")||o.code&&(o.managerPower=FastExt.Power.checkManagerPower(o),FastExt.Power.setPower(o.code,FastExt.Base.copy(o.managerPower)),FastExt.Power.hasPower(o,"show")?FastExt.Power.hasPower(o,"edit")||(o.editable=!1,Ext.isFunction(o.setReadOnly)&&o.setReadOnly(!0)):(o.hideable=!1,o.setHidden(!0),o.setDisabled(!0),o.clearListeners(),Ext.isFunction(o.collapse)&&o.collapse()),FastExt.Power.config&&(o.powerConfig=FastExt.Power.checkPower(o.code),FastExt.Power.setPowerStyle(o),o.getEl().on("contextmenu",function(e,t,n){e.stopEvent(),FastExt.Power.showPowerConfig(o,e)}))))))})}),Ext.override(Ext.Component,{setDisabled:function(e){return FastExt.Power.config?this.enable():this[e?"disable":"enable"]()}}),Ext.override(Ext.form.field.Base,{markInvalid:function(e){var t,n,o;FastExt.Power.config||(n=(t=this).ariaEl.dom,o=t.getActiveError(),t.setActiveErrors(Ext.Array.from(e)),o!==(o=t.getActiveError())&&(t.setError(o),!t.ariaStaticRoles[t.ariaRole]&&n&&n.setAttribute("aria-invalid",!0)))}})};FastOverrider.PowerComponentOverride=PowerComponentOverride;var MenuOverride=function(){Ext.override(Ext.menu.Menu,{hide:function(){if(FastExt.System.isSystem()){var e=this;if((e.powerMenu||!FastExt.Power.menuShowing)&&!e.holdShow)return e.pendingShow&&(e.pendingShow=!1),e.rendered&&!e.isVisible()||e.hasListeners.beforehide&&!1===e.fireEvent("beforehide",e)&&!e.hierarchicallyHidden||(e.getInherited().hidden=e.hidden=!0,e.fireHierarchyEvent("beforehide"),e.rendered&&e.onHide.apply(e,arguments)),e}}})};FastOverrider.MenuOverride=MenuOverride;var WindowOverride=function(){function WindowOverride(){Ext.override(Ext.Window,{initComponent:Ext.Function.createSequence(Ext.Window.prototype.initComponent,function(){try{eval(FastExt.System.getExt("window-anim").value)||(this.animateTarget=null);var regStr=/([^/]*.svg)/;this.icon&&regStr.test(this.icon)&&(this.icon=FastExt.Server.getIcon(regStr.exec(this.icon)[1].trim(),"#ffffff")),this.liveDrag=!0,this.on("show",function(e){e.toFront(!0),e.focus()})}catch(e){console.error(e)}})}),Ext.override(Ext.window.Window,{setIcon:Ext.Function.createSequence(Ext.window.Window.prototype.setIcon,function(e){var t=/([^/]*.svg)/;e&&t.test(e)&&(this.icon=FastExt.Server.getIcon(t.exec(e)[1].trim(),"#ffffff"))})})}return WindowOverride}();FastOverrider.WindowOverride=WindowOverride;var ScrollerOverride=function(){Ext.override(Ext.scroll.Scroller,{fireScrollStart:function(){if(this.callParent(arguments),this.component){this.component.focus();for(var e=Ext.ComponentQuery.query("menu[columnSearchMenu=true]"),t=0;t<e.length;t++)e[t].hide()}}})},subClass;for(subClass in FastOverrider.ScrollerOverride=ScrollerOverride,FastOverrider)FastOverrider[subClass]()}(FastOverrider=FastOverrider||{}),function(r){var e=(t.isPower=function(){return window.isPower()},t.hasPower=function(e,t){return!e.managerPower||!e.managerPower.hasOwnProperty(t)||e.managerPower[t]},t.checkPower=function(e){var t=this;t.powers[e]||(t.powers[e]=r.Base.copy(t.defaultPower));var n=t.powers[e];if(!Ext.isEmpty(n))for(var o in t.defaultPower)n.hasOwnProperty(o)||(n[o]=t.defaultPower[o]);return n},t.checkManagerPower=function(e){if(!r.System.manager)return null;if(!r.System.managerPowers&&(Ext.isEmpty(r.System.manager.managerExtPower)||0===r.System.manager.role.roleType))return null;r.System.managerPowers||(r.System.managerPowers=r.Json.jsonToObject(r.System.manager.managerExtPower)),r.System.managerPowers||(r.System.managerPowers={});var t,n=(n=r.System.managerPowers[e.code])||r.Base.copy(r.Power.defaultPower);for(t in r.Power.defaultPower)n.hasOwnProperty(t)||(n[t]=r.Power.defaultPower[t]);return n},t.pushPower=function(e,t){this.powers[e]=t},t.setPower=function(e,t){this.powers[e]||(this.powers[e]=t)},t.savePower=function(){var e=this.powers;return Ext.encode(e)},t.getPowerCode=function(e){if(null!=e){var t,n=null;if(!Ext.isFunction(e.up)||(t=e.up("window"))&&(n=t.getTitle()),e.name&&(n+=e.name),e.title&&(n+=e.title),e.text&&(n+=e.text),e.subtext&&(n+=e.subtext),e.dataIndex&&(n+=e.dataIndex),Ext.isFunction(e.getFieldLabel)&&Ext.isEmpty(e.getFieldLabel())&&(n+=e.getFieldLabel()),n)return $.md5(n)}return null},t.setPowerStyle=function(o){var e=Ext.all("[code="+o.code+"]");Ext.each(e,function(e,t){var n=r.Power.checkPower(o.code);n&&(n.show?(e.removeCls("no-show-power"),n.edit?e.removeCls("no-edit-power"):e.addCls("no-edit-power")):e.addCls("no-show-power"))})},t.showPowerConfig=function(i,e){var a,t;r.System.isSystem()&&(a=r.Power.checkPower(i.code),r.Power.menuShowing=!0,t=Ext.create("Ext.panel.Panel",{layout:{type:"vbox",pack:"center"},border:0,defaults:{height:20,power:!1},items:[{xtype:"checkbox",name:"updateAlert",checked:!0,boxLabel:"允许显示",value:a.show,listeners:{change:function(e,t,n,o){a.show=t,r.Power.setPowerStyle(i)}}},{xtype:"checkbox",name:"updateAlert",checked:!0,boxLabel:"允许编辑",hidden:!r.Grid.isColumnType(i),value:a.edit,listeners:{change:function(e,t,n,o){a.edit=t,r.Power.setPowerStyle(i)}}}]}),new Ext.menu.Menu({padding:"0 0 0 10",powerMenu:!0,style:{background:"#ffffff"},items:[t],listeners:{beforehide:function(e,t){r.Power.menuShowing=!1,r.Power.pushPower(i.code,a)}}}).showAt(e.getXY()))},t.types=[FastEnum.PowerType.gridcolumn,FastEnum.PowerType.menuitem,FastEnum.PowerType.button],t.config=!1,t.menuShowing=!1,t.powers=[],t);function t(){}r.Power=e;Object.defineProperty(n.prototype,"show",{get:function(){return this._show},set:function(e){this._show=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"edit",{get:function(){return this._edit},set:function(e){this._edit=e},enumerable:!1,configurable:!0}),e=n;function n(){this._show=!0,this._edit=!0}r.PowerSet=e}(FastExt=FastExt||{}),function(g){var e=(t.normal=function(s,d){return function(e,t,n,o,i,a,r,l){return Ext.isEmpty(e)?"<span style='color: #ccc;'>无</span>":(s=s||"",Ext.isEmpty(d)?e+=s:("left"!==d&&"l"!==d&&!g.Base.toBool(d,!1)||(e=s+e),"right"!==d&&"r"!==d||(e+=s)),l?e.replace(new RegExp("\n","g"),"<br/>").replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;").replace(new RegExp(" ","g"),"&nbsp;"):e)}},t.money=function(){return function(e){return Ext.isEmpty(e)?"<span style='color: #ccc;'>无</span>":"￥"+e}},t.text=function(){return function(e){return Ext.isEmpty(e)?"<span style='color: #ccc;'>无</span>":"<span style='white-space: pre;'>"+(e=e.replace(/<\/?.+?>/g,""))+"</span>"}},t.image=function(a,r){return function(e){try{var t="14px",n="auto";if(Ext.isEmpty(e)||"null"===e)return"<img style='object-fit: cover; border:1px solid #cccccc;height:"+t+";' src='images/default_img.png'   alt='' />";e.startWith("//")&&(e="http:"+e);try{a&&(t=a+"px"),r&&(n=r+"px")}catch(e){}var o=e.split("@")[0],i=$.md5(o);return window[i]="<img  alt='' style='object-fit: cover;border:1px solid #cccccc;width: 100px; min-height:14px;  '  width='100'  class='lazyload' onerror=\"javascript:this.src = 'images/default_img.png';\" src='"+o+"' />","<img class='lazyload'  alt='' details-id='"+i+"'  style='object-fit: cover;border:1px solid #cccccc;height:"+t+";width: "+n+"; min-width:14px; min-height:14px; ' width='"+n.replace("px","")+"' height='"+t.replace("px","")+"'  onclick=\"FastExt.Dialog.showImage(this,'"+o+"')\"   onerror=\"javascript:this.src = 'images/default_img.png';\" src='"+o+"'  />"}catch(e){return console.error(e),"<span style='color: #ccc;'>暂无图片</span>"}}},t.mp4=function(){return function(e,t,n){if(Ext.isEmpty(e)||"null"===e)return"<span style='color: #ccc;'>暂无文件</span>";var o=e.split("@"),i=o[0],e=i.substring(i.lastIndexOf("/")+1);return 1<o.length&&(e=o[1]),"&nbsp;<a href=\"javascript:showVideo(this,'"+g.System.formatUrlVersion(i)+"');\" ><span style='margin-right: 5px;'>"+g.Base.getSVGIcon("extFileMP4")+"</span>"+e+"</a>&nbsp;"}},t.office=function(){return function(e,t,n){if(Ext.isEmpty(e)||"null"===e)return"<span style='color: #ccc;'>暂无文件</span>";var o=e.split("@"),i=o[0],e=i.substring(i.lastIndexOf("/")+1);1<o.length&&(e=o[1]);o=g.Base.getSVGClassName(e);return'&nbsp;<a href="'+("https://view.officeapps.live.com/op/view.aspx?src="+g.System.formatUrlVersion(i))+"\" target='_blank' >在线预览</a>&nbsp;"+'&nbsp;<a href="'+g.System.formatUrlVersion(i)+"\" target='_blank' ><span style='margin-right: 5px;'>"+g.Base.getSVGIcon(o)+"</span>"+e+"</a>&nbsp;"}},t.file=function(r){return function(e,t,n){if(Ext.isEmpty(e)||"null"===e)return"<span style='color: #ccc;'>暂无文件</span>";var o=e.split("@"),i=o[0],a=i.substring(i.lastIndexOf("/")+1);if(1<o.length&&(a=o[1]),Ext.isEmpty(r)||(a=n.get(r)),g.FileModule.image().reg.test(a))return g.Renders.image()(e);if(g.FileModule.mp4().reg.test(a))return g.Renders.mp4()(e);if(g.FileModule.pdf().reg.test(a)||g.FileModule.word().reg.test(a)||g.FileModule.excel().reg.test(a)||g.FileModule.ppt().reg.test(a))return g.Renders.office()(e);e=g.Base.getSVGClassName(a);return'&nbsp;<a href="'+g.System.formatUrlVersion(i)+"\" target='_blank' ><span style='margin-right: 5px;'>"+g.Base.getSVGIcon(e)+"</span>"+a+"</a>&nbsp;"}},t.files=function(){return function(e,t,n,o,i,a,r,l){try{if(Ext.isEmpty(e)||"null"===e)return"<span style='color: #ccc;'>暂无文件</span>";var s=e;if(Ext.isString(e)&&!Ext.isEmpty(e))try{s=Ext.decode(e)}catch(e){console.error(e)}if(0===s.length)return"<span style='color: #ccc;'>暂无文件</span>";for(var d=$.md5(JSON.stringify(s)),c="",u=0;u<s.length;u++)c+="<div style='margin: 5px;'>"+g.Renders.file()(s[u])+"</div>";if(l)return c;g.Cache.memory[d]=c;var x='&nbsp;<a href="javascript:'+("FastExt.Dialog.showAlert('查看文件',MemoryCache['"+d+"'],null,false)")+';">共有'+s.length+"个文件！</a>&nbsp;",m=$.md5(x);return window[m]=c,x}catch(e){return console.error(e),"<span style='color: #ccc;'>暂无文件</span>"}}},t.images=function(){return function(e,t,n,o,i,a,r,l){try{if(Ext.isEmpty(e)||"null"===e)return"<span style='color: #ccc;'>暂无图片</span>";var s=e;if(Ext.isString(e)&&!Ext.isEmpty(e))try{s=Ext.decode(e)}catch(e){console.error(e)}if(0===s.length)return"<span style='color: #ccc;'>暂无图片</span>";for(var d=$.md5(JSON.stringify(s)),c="",u=[],x=0;x<s.length;x++)c+=g.Renders.image(24)(s[x])+"&nbsp;&nbsp;",u.push({url:s[x]});if(l)return c;g.Cache.memory[d]=u;var m='<a href="javascript:'+("FastExt.Dialog.showImage(null,MemoryCache['"+d+"'])")+";\" details-id='"+d+"' style='color: #4279fa;'>共有"+s.length+"张图片！</a>";return window[d]=c,m}catch(e){return console.error(e),"<span style='color: #ccc;'>暂无图片</span>"}}},t.html=function(){return function(e,t,n,o,i,a,r,l){if(Ext.isEmpty(e)||"null"===e)return"<span style='color: #ccc;'>无</span>";var s=$.md5(e);return g.Cache.memory[s]=e,'&nbsp;<a href="javascript:'+("FastExt.Dialog.showEditorHtml(this,'查看内容',MemoryCache['"+s+"'])")+';">查看内容</a>&nbsp;'}},t.html2=function(){return function(e,t,n,o,i,a,r,l){return Ext.isEmpty(e)||"null"===e?"<span style='color: #ccc;'>无</span>":l?e:e=e.replace(/[&\|\\\*^%$'"#@\-]/g,"").replace(new RegExp("\n","g"),"").replace(new RegExp("\t","g"),"").replace(new RegExp(" ","g"),"").replace(/<\/?.+?>/g,"")}},t.link=function(i,a,r){return function(e,t,n){try{if(Ext.isEmpty(e)||"null"===e)return"<span style='color: #ccc;'>无</span>";var o=n.get(i);return'&nbsp;<a href="javascript:'+("new "+a+"().showDetails(null, {'t."+r+"':'"+o+"'})")+';" >'+e+"</a>&nbsp;"}catch(e){return console.error(e),"<span style='color: #ccc;'>无</span>"}}},t.target=function(r,l,s){return function(e,t,n){try{if(Ext.isEmpty(e)||"null"===e)return"<span style='color: #ccc;'>无</span>";if(s=s||"getTargetEntity",!Ext.isFunction(window[s]))return e;var o=n.get(l),i=n.get(r),a=window[s](o,l);return a?'&nbsp;<a href="javascript:'+("new "+a.entityCode+"().showDetails(null, {'t."+a.entityId+"':'"+i+"'})")+';" >'+e+"</a>&nbsp;":e}catch(e){return console.error(e),"<span style='color: #ccc;'>无</span>"}}},t.map=function(l,s,d){return function(e,t,n){try{if(Ext.isEmpty(e)||"null"===e)return"<span style='color: #ccc;'>无</span>";var o=n.get(l),i=n.get(s),a=n.get(d);if(o&&i){var r=o+","+i;return'&nbsp;<a href="javascript:'+(a?"FastExt.Map.showAddressInMap(null,'"+r+"','"+a+"','"+e+"')":"FastExt.Map.showAddressInMap(null,'"+r+"','','"+e+"')")+';" >'+e+"</a>&nbsp;"}return e}catch(e){return"<span style='color: #ccc;'>无</span>"}}},t.mapImgLayer=function(l,s,d,c){return function(e,t,n){try{if(Ext.isEmpty(e)||"null"===e)return"<span style='color: #ccc;'>无</span>";var o=n.get(l),i=n.get(s),a=n.get(d),r=n.get(c);return(o=r?g.Image.rotateOSSImgUrl(o,r):o)&&i&&a?'&nbsp;<a href="javascript:'+(" FastExt.Map.showImgLayerInMap(null,'"+o+"','"+i+"','"+a+"')")+';" >'+e+"</a>&nbsp;":e}catch(e){return"<span style='color: #ccc;'>无</span>"}}},t.password=function(){return function(e,t,n,o,i,a,r,l){return Ext.isEmpty(e)?"<span style='color: #ccc;'>无</span>":"<span>******</span>"}},t.href=function(){return function(e,t,n){return Ext.isEmpty(e)||"null"===e?"<span style='color: #ccc;'>无</span>":"&nbsp;<a href='"+e+"' target='_blank'>"+e+"</a>&nbsp;"}},t.fileSize=function(){return function(e,t,n){try{return Ext.isEmpty(e)||"null"===e?"<span style='color: #ccc;'>无</span>":1048576<=e?(e/1024/1024).toFixed(2)+"M":1024<=e?(e/1024).toFixed(2)+"KB":e+"B"}catch(e){return console.error(e),"<span style='color: #ccc;'>无</span>"}}},t.duration=function(){return function(e,t,n){try{if(Ext.isEmpty(e)||"null"===e)return"<span style='color: #ccc;'>无</span>";var o=parseInt(e)/1e3,i=parseInt((o/3600).toString()),a=parseInt((o/60%60).toString()),r=parseInt((o%60).toString());return 0<i?i+"时"+a+"分"+r+"秒":0<a?a+"分"+r+"秒":r+"秒"}catch(e){return console.error(e),"<span style='color: #ccc;'>无</span>"}}},t.dateFormat=function(i){return function(t,e,n){try{if(Ext.isEmpty(t)||"null"===t)return"<span style='color: #ccc;'>无</span>";Ext.isEmpty(i)&&(i="Y-m-d H:i:s");var o=g.Base.guessDateFormat(t);return Ext.Date.format(Ext.Date.parse(t,o),i)}catch(e){return console.error(e),t}}},t.enum=function(i,a){return function(t){try{if(Ext.isEmpty(t))return"<span style='color: #ccc;'>无</span>";var e=g.Store.getEnumRecord(i,t,a);if(!e)return"<span style='color: #ccc;'>"+t+"</span>";var n=e.get("text"),o=e.get("color");return Ext.isEmpty(n)?"<span style='color: #ccc;'>"+t+"</span>":"<span style='color: "+g.Color.toColor(o,"#000000")+";'>"+n+"</span>"}catch(e){return"<span style='color: #ccc;'>"+t+"</span>"}}},t);function t(){}g.Renders=e}(FastExt=FastExt||{}),function(a){var e=(n.isSilenceRequest=function(){return a.Base.toBool(n.silence,!1)},n.setSilence=function(e){n.silence=e},n.loginUrl=function(){return"controller/login"},n.validOperateUrl=function(){return"controller/valid"},n.showConfigUrl=function(){return"showConfig"},n.importEntityExcelUrl=function(){return"entity/importData"},n.loadEntityDataUrl=function(){return"entity/loadData"},n.logout=function(){a.Dialog.showWait("正在退出登录中……"),$.post("controller/logout",function(){location.reload()})},n.updateEntity=function(e,t){a.Power.isPower()?t(!1,"当前正在进行界面权限配置，不可修改数据！"):$.post("entity/update",e,function(e){203!==e.code&&Ext.isFunction(t)&&(e.success?t(!0,e.message):t(!1,e.message))})},n.deleteAttach=function(e,t){a.Power.isPower()?t(!1,"当前正在进行界面权限配置，不可删除数据！"):$.post("deleteAttach",e,function(e){203!==e.code&&Ext.isFunction(t)&&(e.success?t(!0,e.message):t(!1,e.message))})},n.deleteEntity=function(e,t){a.Power.isPower()?t(!1,"当前正在进行界面权限配置，不可删除数据！"):$.post("entity/delete",e,function(e){203!==e.code&&Ext.isFunction(t)&&t(e.success,e.message)})},n.rebackEntity=function(e,t){a.Power.isPower()?t(!1,"当前正在进行界面权限配置，不可还原数据！"):$.post("entity/reback",e,function(e){203!==e.code&&Ext.isFunction(t)&&t(e.success,e.message)})},n.copyEntity=function(e,t){a.Power.isPower()?t(!1,"当前正在进行界面权限配置，不可复制数据！"):$.post("entity/copy",e,function(e){203!==e.code&&Ext.isFunction(t)&&(e.success?t(!0,e.message):t(!1,e.message))})},n.clearEntity=function(e,t){a.Power.isPower()?t(!1,"当前正在进行界面权限配置，不可复制数据！"):$.post("entity/clear",e,function(e){203!==e.code&&Ext.isFunction(t)&&(e.success?t(!0,e.message):t(!1,e.message))})},n.showExtConfig=function(e,t,n){a.Power.isPower()?n(!1):$.post("ext/config/showExtConfig",{configKey:e,configType:t},function(e){Ext.isFunction(n)&&(e.success?n(!0,e.data.configValue,e.message):n(!1,null,e.message))})},n.saveExtConfig=function(e,t,n,o,i){a.Power.isPower()?o(!1):(n={configKey:e,configType:t,configValue:n},Ext.isEmpty(i)||(n=a.Json.mergeJson(n,i)),$.post("ext/config/saveExtConfig",n,function(e){Ext.isFunction(o)&&(e.success?o(!0,e.message):o(!1,e.message))}))},n.deleteExtConfig=function(e,t,n){a.Power.isPower()?n(!1):$.post("ext/config/deleteExtConfig",{configKey:e,configType:t},function(e){Ext.isFunction(n)&&(e.success?n(!0,e.message):n(!1,e.message))})},n.exportExcel=function(e,t){a.Power.isPower()?t(!1,"当前正在进行界面权限配置，不可导出数据！"):$.post("entity/export",e,function(e){203!==e.code&&Ext.isFunction(t)&&(e.success?t(!0,e.data,e.message):t(!1,null,e.message))})},n.excelModule=function(e,t){a.Power.isPower()?t(!1,"当前正在进行界面权限配置，不可生成模板！"):$.post("entity/module",e,function(e){203!==e.code&&Ext.isFunction(t)&&(e.success?t(!0,e.data,e.message):t(!1,null,e.message))})},n.showColumns=function(e,t){$.post("ext/config/showEntityColumn?entityCode="+e,function(e){Ext.isFunction(t)&&(e.success?t(!0,e.data.configValue,e.message):t(!1,null,e.message))})},n.getIcon=function(e,t){e="icons/"+e;return Ext.isEmpty(t)?e:"icon?path="+e+"&color="+(t=t.startWith("#")?t.substring(1):t)},n.showSystemConfig=function(t){$.post("ext/config/showSystemConfig",function(e){Ext.isFunction(t)&&(e.success?t(!0,e.data,e.message):t(!1,null,e.message))})},n.deleteSystemConfig=function(t){$.post("ext/config/deleteSystemConfig",function(e){Ext.isFunction(t)&&t(e.success,e.message)})},n.loadMonitor=function(t){$.post("monitor",function(e){Ext.isFunction(t)&&t(e.success,e.data)})},n.countReport=function(t){$.post("countReport",function(e){Ext.isFunction(t)&&t(e.success,e.data)})},n.checkWaitNotice=function(e,t){n.setSilence(!0),$.post("controller/waitNotice",e,function(e){n.setSilence(!1),Ext.isFunction(t)&&t(e.success,e.data)})},n.doneWaitNotice=function(e,t){$.post("controller/doneNotice",{noticeId:e},function(e){Ext.isFunction(t)&&t(e.success,e.message,e.data)})},n.clearWaitNotice=function(t){$.post("controller/clearNotice",function(e){Ext.isFunction(t)&&t(e.success,e.message,e.data)})},n.downData=function(e,t){a.Power.isPower()?t(!1,"当前正在进行界面权限配置，不可下载数据！"):$.post("entity/downData",e,function(e){Ext.isFunction(t)&&t(e.success,e.message,e.data)})},n);function n(){$.ajaxSetup({data:{fromOS:a.Base.getOS()}}),Ext.Ajax.on("beforerequest",function(e,t,n){try{e.setExtraParams({fromOS:a.Base.getOS()})}catch(e){}})}a.Server=e}(FastExt=FastExt||{}),function(FastExt){var Store=function(){function Store(){}return Store.getStoreMenuText=function(e,t){if(t){if(t.parent){var n=FastExt.Store.getStoreMenuText(null,t.parent);if(n)return n+">"+t.text}return t.text}return e&&e.entity?FastExt.Store.getStoreMenuText(null,e.entity.menu):null},Store.commitStoreUpdate=function(c){return new Ext.Promise(function(n,e){if(c&&c.entity&&!c.commiting){var t=c.getUpdatedRecords(),o=c.getNewRecords();if(0!==(t=t.concat(o)).length){c.commiting=!0;var i={entityCode:c.entity.entityCode};c.entity.menu&&(i.menu=FastExt.Store.getStoreMenuText(c));for(var a=0;a<t.length;a++){for(var r,l=t[a],s=0;s<c.entity.idProperty.length;s++){var d=c.entity.idProperty[s];i["data["+a+"]."+d]=l.get(d)}for(r in l.modified)i["data["+a+"]."+r]=l.get(r)}FastExt.Server.updateEntity(i,function(e,t){c.commiting=!1,n(e),e?(FastExt.Dialog.toast(t),c.commitChanges()):Ext.Msg.alert("系统提醒",t)})}else n(!0)}})},Store.commitStoreDelete=function(l,s){return new Ext.Promise(function(n,e){if(l.entity){var t={entityCode:l.entity.entityCode};l.entity.menu&&(t.menu=FastExt.Store.getStoreMenuText(l));for(var o=0;o<s.length;o++)for(var i=s[o],a=0;a<l.entity.idProperty.length;a++){var r=l.entity.idProperty[a];t["data["+o+"]."+r]=i.get(r)}FastExt.Server.deleteEntity(t,function(e,t){n(e),e?(FastExt.Dialog.toast(t),e=l.currentPage,l.count()-s.length<=0&&(e-=1),l.loadPage(Math.max(e,1))):Ext.Msg.alert("系统提醒",t)})}})},Store.commitStoreReback=function(l,s){return new Ext.Promise(function(n,e){if(l.entity){var t={entityCode:l.entity.entityCode};l.entity.menu&&(t.menu=FastExt.Store.getStoreMenuText(l));for(var o=0;o<s.length;o++)for(var i=s[o],a=0;a<l.entity.idProperty.length;a++){var r=l.entity.idProperty[a];t["data["+o+"]."+r]=i.get(r)}FastExt.Server.rebackEntity(t,function(e,t){n(e),e?(e=l.currentPage,l.count()-s.length<=0&&(e-=1),l.loadPage(Math.max(e,1))):Ext.Msg.alert("系统提醒",t)})}})},Store.commitStoreCopy=function(l,s){return new Ext.Promise(function(n,e){if(l.entity){var t={entityCode:l.entity.entityCode};l.entity.menu&&(t.menu=Store.getStoreMenuText(l));for(var o=0;o<s.length;o++)for(var i=s[o],a=0;a<l.entity.idProperty.length;a++){var r=l.entity.idProperty[a];t["data["+o+"]."+r]=i.get(r)}FastExt.Server.copyEntity(t,function(e,t){n(e),e?(FastExt.Dialog.toast(t),e=l.currentPage,l.count()-s.length<=0&&(e-=1),l.loadPage(Math.max(e,1))):Ext.Msg.alert("系统提醒",t)})}})},Store.isModified=function(e){for(var t in e.data)try{if(e.isModified(t))return!0}catch(e){}return!1},Store.getEntityDataStore=function(entity,where,tree){if(!Ext.isEmpty(entity)){var config={fields:[],pageSize:20,where:where,entity:entity,remoteSort:FastExt.Base.toBool(entity.remoteSort,!0),proxy:{type:"ajax",url:"entity/list",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},listeners:{exception:function(obj,request,operation,eOpts){try{var data=eval("("+request.responseText+")");data.success||Ext.Msg.alert("数据获取失败",data.message)}catch(e){Ext.Msg.alert("数据获取失败",request.responseText)}}},reader:{type:"json",root:"list",totalProperty:"totalRow"}},listeners:{beforeload:function(t,e,n){try{if(!t.entity||!t.entity.entityCode)return!1;var o,i=t.proxy.extraParams,a={entityCode:t.entity.entityCode,limit:t.pageSize};if(t.where)for(var r in t.where)a["where['"+r+"']"]=t.where[r];if(tree&&(Ext.isEmpty(tree.parentIdValue)&&(tree.parentIdValue=-1),a.page=-1,a.fromTree=!0,a.treeParentIdName=tree.parentIdName,o=e.node.data[tree.idName],Ext.isEmpty(o)&&(o=tree.parentIdValue),t.grid&&FastExt.Grid.hasSearchColumn(t.grid)?a["where['"+tree.parentIdName+"']"]=null:a["where['"+tree.parentIdName+"']"]=o),t.grid){if(a.power=FastExt.Base.toBool(t.grid.power,!0),0<t.grid.getSelection().length?t.grid.getSelectionModel().deselectAll():t.grid.fireEvent("selectionchange",t.grid),t.grid.where)for(var r in t.grid.where)a["where['"+r+"']"]=t.grid.where[r];if(t.getSorters().each(function(e){a["indexSort['"+e.getProperty()+"']"]=FastExt.Grid.getColumn(t.grid,e.getProperty()).getIndex()}),FastExt.Grid.checkColumnSearch(t.grid),Ext.isFunction(t.grid.onBeforeLoad)){var l=t.grid.onBeforeLoad(t.grid,t,a);if(!FastExt.Base.toBool(l,!0))return!1}}return t.getProxy().setExtraParams(FastExt.Json.mergeJson(i,a)),!0}catch(e){FastExt.Dialog.showException(e,"store:beforeload")}}},autoLoad:!1,autoLoad:!1},entityStore,entityStore=tree?(FastExt.System.silenceGlobalSave||(config.root={expanded:!0}),Ext.create("Ext.data.TreeStore",config)):Ext.create("Ext.data.Store",config);return entityStore.on("load",function(e){setTimeout(function(){try{e.grid&&e.grid.syncRowHeights()}catch(e){}},300)}),entityStore}FastExt.Dialog.showAlert("系统提醒","参数entity不可为空！")},Store.getEnumDataStore=function(e,t,n,o,i){o=o||{},Ext.isEmpty(i)&&(i=!0);var a=$.md5(e+Ext.JSON.encode(o));i&&FastExt.Cache.memory.hasOwnProperty(a)||Ext.Ajax.request({url:"showEnums?enumName="+e,async:!1,params:o,success:function(e,t){try{var n=Ext.decode(e.responseText);n.success?FastExt.Cache.memory[a]=n.data:Ext.Msg.alert("枚举获取失败",n.message)}catch(e){FastExt.Dialog.showException(e,"获取枚举数据源！[getEnumDataStore]")}}});o=Ext.clone(FastExt.Cache.memory[a]);return t&&(o=Ext.Array.insert(o,0,t)),n&&(o=Ext.Array.push(o,n)),Ext.create("Ext.data.Store",{autoLoad:!1,enumName:e,data:o})},Store.getEnumRecord=function(e,t,n){return n=n||"id",FastExt.Store.getEnumDataStore(e).findRecord(n,t,0,!1,!1,!0)},Store.getEnumText=function(e,t){t=FastExt.Store.getEnumRecord(e,t);return t?t.get("text"):null},Store.getPageDataStore=function(e,t){e&&0!==e.length||(e=100),t&&0!==t.length||(t=10);for(var n=[],o=0;o<e/10;o++)n.push({text:(o+1)*t+"条",id:(o+1)*t});return Ext.create("Ext.data.Store",{id:"pageSizeDataStore",fields:["id","text"],data:n})},Store.getCompareDataStore=function(){return Ext.create("Ext.data.Store",{data:[{id:0,text:"=",desc:"等于"},{id:1,text:"!=",desc:"不等于"},{id:2,text:"?",desc:"包含"},{id:3,text:"!?",desc:"不包含"},{id:4,text:">",desc:"大于"},{id:6,text:">=",desc:"大等于"},{id:5,text:"<",desc:"小于"},{id:7,text:"<=",desc:"小等于"}]})},Store.getCompareLinkDataStore=function(){return Ext.create("Ext.data.Store",{data:[{id:0,text:"&",desc:"并且"},{id:1,text:"||",desc:"或者"}]})},Store.getGridColumnStore=function(e,t){for(var n=[],o=e.getColumns(),i=0;i<o.length;i++){var a=o[i];if(!Ext.isEmpty(a.dataIndex)){if(FastExt.Base.toBool(t,!1)){if(FastExt.Grid.isFilesColumn(a)||FastExt.Grid.isFileColumn(a))continue;if(!FastExt.Base.toBool(a.search,!0))continue;if(FastExt.Base.toBool(a.encrypt,!1))continue}n.push({text:a.configText,id:a.dataIndex,index:i})}}return Ext.create("Ext.data.Store",{fields:["id","text","index"],data:n})},Store.getYesOrNoDataStore=function(){return Ext.create("Ext.data.Store",{id:"yesOrNoDataStore",fields:["id","text"],data:[{text:"是",id:1},{text:"否",id:0}]})},Store.getThemeDataStore=function(){return Ext.create("Ext.data.Store",{id:"themeDataStore",fields:["id","text"],data:[{text:"圆润立体",id:"extjs/theme/fast-theme-wrap"},{text:"清爽扁平",id:"extjs/theme/fast-theme-flat"}]})},Store.getFontSizeDataStore=function(){return Ext.create("Ext.data.Store",{id:"fontSizeDataStore",fields:["id","text"],data:[{text:"14px",id:"14px"},{text:"16px",id:"16px"},{text:"18px",id:"18px"}]})},Store.setRecordValue=function(e,t,n){var o;n.dataIndex=t,Ext.isFunction(n.setRecordValue)?n.setRecordValue(e,!1):(o=n.getValue(),Ext.isDate(n.getValue())?e.set(t,Ext.Date.format(o,n.format)):e.set(t,o)),e.store&&FastExt.Base.toBool(n.autoUpdate,!1)&&FastExt.Store.commitStoreUpdate(e.store)},Store}();FastExt.Store=Store}(FastExt=FastExt||{}),function(FastExt){var System=function(){function System(){}return Object.defineProperty(System,"fontSize",{get:function(){return window.fontSize||this._fontSize},enumerable:!1,configurable:!0}),System.removeLoading=function(){window.removeLoading()},System.checkBrowserVersion=function(){return!(Ext.isIE&&Ext.ieVersion<11)||(Ext.create("Ext.window.Window",{title:"系统提醒",width:250,height:100,layout:"fit",icon:"icons/icon_error.svg",resizable:!1,closable:!1,html:"<div style='background:#eeeeee; padding:10px;'>您当前的IE版本太低，至少在11.0以上的IE才能使用本系统！</div>",modal:!0}).show(),!1)},System.getBodyContainer=function(){var e=Ext.getCmp("bodyContainer");return e||(Ext.getDoc().on("contextmenu",function(e){e.stopEvent()}),Ext.tip.QuickTipManager.init(),Ext.QuickTips.init(),e=Ext.create("Ext.container.Viewport",{id:"bodyContainer",layout:"card",border:0,renderTo:Ext.getBody()})),e},System.getValue=function(e){return FastExt.System[e]},System.addScript=function(t,e){if(null!=t){var n=document.getElementsByTagName("head").item(0),o=document.createElement("script"),i=!1;if(o.type="text/javascript",null!=t.src&&0<t.src.length)o.src=t.src+"?v="+FastExt.System.getExt("version").value;else if(null!=t.href&&0<t.href.length)o.src=t.href+"?v="+FastExt.System.getExt("version").value;else{if(!t.text)return void(null!=e&&e());try{o.appendChild(document.createTextNode(t.text))}catch(e){o.text=t.text}i=!0}n.appendChild(o),i?null!=e&&e():(o.onload=o.readystatechange=function(){null!=e&&e()},o.onerror=function(){alert("脚本文件"+t.src+"加载失败，请您稍后重试！")})}},System.addStyle=function(e,t){var n=document.getElementsByTagName("head").item(0),o=document.createElement("style");o.type="text/css",o.styleSheet?o.styleSheet.cssText=e:o.innerHTML=e,null!=t&&t(),n.appendChild(o)},System.getProgressLine=function(e){return Ext.isEmpty(e)&&(e="#f8c633"),FastExt.System.progressLine||(FastExt.System.progressLine=new ProgressBar.Line("#progress",{color:e,duration:1e3,easing:"easeInOut",from:{color:"#9c58b6"},to:{color:e},step:function(e,t,n){t.path.setAttribute("stroke",e.color)}})),FastExt.System.progressLine},System.initConfig=function(){FastExt.System.baseUrl=window.location.href,0<FastExt.System.baseUrl.indexOf("#")&&(FastExt.System.baseUrl=FastExt.System.baseUrl.split("#")[0]),FastExt.System.baseUrl.toString().endWith("/")||(FastExt.System.baseUrl=FastExt.System.baseUrl+"/");var e={};FastExt.Power.isPower()&&window.parent&&Ext.isFunction(window.parent.getMenuPower)&&(e={menuPower:window.parent.getMenuPower()}),Ext.Ajax.request({url:FastExt.Server.showConfigUrl(),params:e,success:function(e,t){var n,o=FastExt.Json.jsonToObject(e.responseText).data;for(n in o)o.hasOwnProperty(n)&&(FastExt.System[n]=o[n]);for(var i=FastExt.System.getAllExt(),a=0;a<i.length;a++){var r=i[a];FastExt.System[r.name]=r}FastExt.System.loadAppJs()},failure:function(e,t){FastExt.Dialog.showException(e.responseText,"获取系统配置！[system.initConfig]")}})},System.loadAppJs=function(e){if((e=e||0)>=FastExt.System.app.length)return Ext.MessageBox.updateProgress(1,"已加载成功，正在显示中"),void FastExt.System.addStyle(FastExt.System.menusCss,function(){FastExt.System.globalConfig()});Ext.MessageBox.updateProgress(parseFloat(String(e+1))/parseFloat(FastExt.System.app.length),"正在加载中，请耐心等待"),FastExt.System.addScript({src:FastExt.System.app[e]},function(){FastExt.System.loadAppJs(e+1)})},System.globalConfig=function(){for(var entities=FastExt.System.entities,i=0;i<entities.length;i++){var entity=entities[i],key;for(key in entity)if(entity.hasOwnProperty(key))try{var pro=eval(entity.entityCode+".prototype");pro[key]=entity[key],entity.js=!0}catch(e){entity.js=!1;break}}if(FastExt.Power.isPower()&&window.parent&&Ext.isFunction(window.parent.getExtPower)){if(FastExt.Power.config=!0,FastExt.Power.powers=FastExt.Json.jsonToObject(window.parent.getExtPower()),FastExt.Power.powers||(FastExt.Power.powers={}),FastExt.System.managerPowers=FastExt.Json.jsonToObject(window.parent.getParentExtPower()),FastExt.System.managerPowers)for(var code in FastExt.Power.powers)if(FastExt.System.managerPowers.hasOwnProperty(code)){var managerPower=FastExt.System.managerPowers[code],managerPowerKey;for(managerPowerKey in managerPower)managerPower[managerPowerKey]||(FastExt.Power.powers[code][managerPowerKey]=!1)}window.getExtPower=function(){return FastExt.Power.savePower()}}Ext.Ajax.on("beforerequest",function(e,t,n){try{if(FastExt.Server.isSilenceRequest())return;FastExt.System.getProgressLine(FastExt.Color.toColor(FastExt.System.getExt("front-color").value)).set(0),FastExt.System.getProgressLine(FastExt.Color.toColor(FastExt.System.getExt("front-color").value)).animate(.7)}catch(e){}}),Ext.Ajax.on("requestcomplete",function(conn,response,options){try{if(203===response.status)FastExt.System.sessionOut();else try{var jsonData=eval("("+response.responseText+")");203===jsonData.code&&FastExt.System.sessionOut()}catch(e){}}catch(e){}finally{FastExt.System.getProgressLine(FastExt.Color.toColor(FastExt.System.getExt("front-color").value)).animate(1)}}),Ext.Ajax.on("requestexception",function(e,t,n,o){try{if(FastExt.Server.isSilenceRequest())return;FastExt.Dialog.showException(t.responseText,"请求异常！")}catch(e){}finally{FastExt.System.getProgressLine(FastExt.Color.toColor(FastExt.System.getExt("front-color").value)).animate(1)}}),$(document).ajaxStart(function(e){try{if(FastExt.Server.isSilenceRequest())return;FastExt.System.getProgressLine(FastExt.Color.toColor(FastExt.System.getExt("front-color").value)).set(0),FastExt.System.getProgressLine(FastExt.Color.toColor(FastExt.System.getExt("front-color").value)).animate(.7)}catch(e){}}),$(document).ajaxComplete(function(event,xhr,options){try{if(203===xhr.status)FastExt.System.sessionOut();else try{var jsonData=eval("("+xhr.responseText+")");203===jsonData.code&&FastExt.System.sessionOut()}catch(e){}}catch(e){}finally{FastExt.System.getProgressLine(FastExt.Color.toColor(FastExt.System.getExt("front-color").value)).animate(1)}}),$(document).ajaxError(function(e,t,n){try{if(FastExt.Server.isSilenceRequest())return;FastExt.Dialog.showException(t.responseText,"请求异常")}catch(e){}finally{FastExt.System.getProgressLine(FastExt.Color.toColor(FastExt.System.getExt("front-color").value)).animate(1)}}),window.addEventListener("popstate",function(e){FastExt.System.selectTab(FastExt.System.selectTabFromHref())},!1),FastExt.System.init=!0,FastExt.System.initSystem()},System.initSystem=function(){FastExt.System.removeLoading();var n=this,e=FastExt.System.getBodyContainer();e.removeAll();var t=FastExt.Color.toColor(n["theme-color"].value),o=FastExt.Color.toColor(n["front-color"].value),i=n["system-logo"].value,a=n.version.desc,r=$("title").text()+a;Ext.isEmpty(i)&&(i="icons/icon_head_system.svg");a=Ext.create("Ext.toolbar.Toolbar",{height:60,padding:"0 0 0 0",border:0,flex:1,power:!1,cls:"headContainer",style:{background:t},items:[{xtype:"image",src:i,height:40,width:40,cls:"headLogo",margin:"10 5 5 5",style:{borderRadius:"10px"}},{xtype:"label",margin:"0 0 0 5",html:"<div class='headTitle' style='color: "+o+";' >"+r+"</div>"},"->",{xtype:"button",iconCls:"extIcon extRole",text:n.manager.managerName,minWidth:135,cls:"headButton",menu:[{text:"修改登录密码",iconCls:"extIcon extResetPassword",handler:function(){n.modifyPassword(this)}}]},{xtype:"button",iconCls:"extIcon extExits",text:"退出登录",cls:"headButton",handler:function(){n.logout()}}]}),i=Ext.create("Ext.toolbar.Toolbar",{border:0,padding:"0 0 0 0",flex:1,height:3,style:{background:t},html:'<div class="progress" id="progress"></div>'}),o=Ext.create("Ext.panel.Panel",{layout:"absolute",region:"north",height:60,border:0,hidden:FastExt.Power.config,items:[a,i],listeners:{afterlayout:function(){this.getEl().on("dblclick",function(){FastExt.System.fullscreen?FastExt.System.outFullscreen():FastExt.System.inFullScreen()})}}}),r=parseInt((.25*document.body.clientWidth).toFixed(0)),a=Ext.create("Ext.panel.Panel",{border:0,region:"center",cls:"treelist-with-nav",scrollable:"y",items:[{xtype:"treelist",id:"leftTreeList",reference:"treelist",expanderOnly:!1,singleExpand:!0,ui:"nav",scrollable:"y",expanderFirst:!1,selectOnExpander:!0,highlightPath:!0,store:{type:"tree",root:{expanded:!0,children:n.menus}},viewModel:{formulas:{selectionItem:function(e){try{var t=e("treelist.selection");return t&&t.data.leaf&&n.showTab(t.data.method,t.data.id,t.data.text,t.data.icon),t}catch(e){FastExt.Dialog.showException(e)}}}}}],listeners:{resize:function(e,t,n,o,i,a){var r=t<=128,l=Ext.getCmp("leftTreeList"),s=l.ownerCt.ownerCt;l.setMicro(r),r?s.setWidth(44):s.setWidth(t)}}});n.tabPanelContainer=Ext.create("Ext.tab.Panel",{region:"center",id:"tabs",plain:!0,style:{marginTop:"-8px"},items:[],recordTab:function(){FastExt.System.recordTab()},plugins:["tabreorderer",{ptype:"tabclosemenu"}]});var i=Ext.create("Ext.panel.Panel",{layout:"border",region:"center",border:0,style:{background:"#eeeeee"},items:[n.tabPanelContainer]}),l=Ext.create("Ext.panel.Panel",{layout:"border",region:"west",border:0,width:r,minWidth:44,maxWidth:500,subtitle:"左侧菜单",split:!0,style:{background:"#32404e"},items:[{xtype:"image",height:35,border:0,padding:"5 5 5 5",region:"south",src:FastExt.Server.getIcon("icon_v_menu.svg"),cls:"leftBottom",listeners:{el:{click:function(){l.getWidth()<=44?null!=l.oldWidth?l.setWidth(Math.max(200,l.oldWidth)):l.setWidth(200):(l.oldWidth=l.getWidth(),l.setWidth(44))}}}},a]});n.tabPanelContainer.add({title:"首页",xtype:"panel",id:"tabWelcome",reorderable:!1,closable:!1,layout:"fit",iconCls:"extIcon extIndex",justFixed:!0,items:[FastExt.System.getWelcomePanel()],listeners:{beforeactivate:function(e){if(!FastExt.System.silenceGlobalSave)try{n.selectMenu(n.lastTabId,!0)}catch(e){}},activate:function(e){var t;FastExt.System.silenceGlobalSave||n.restoredTab&&(t={title:e.title,url:n.baseUrl},window.history.pushState(t,e.title,n.baseUrl))}}});i=Ext.create("Ext.panel.Panel",{layout:"border",border:0,bodyStyle:{background:t},items:[o,l,i]});e.add(i);var s=n.selectTabFromHref();FastExt.Base.toBool(n["tab-record"].value,!0)?(Ext.MessageBox.updateProgress(1,"即将完成操作，请耐心等待","系统初始化成功！获取菜单中…"),n.restoreTab().then(function(e){Ext.MessageBox.isVisible()&&Ext.MessageBox.hide();e=FastExt.Json.jsonToObject(e);n.restoredTab=!0,e&&(Ext.each(e,function(e){s===e.id&&(e.active=!0),n.showTab(e.method,e.id,e.title,e.icon,e.active,!0,e.where,e.closable,e.reorderable)}),0!==e.length&&n.tabPanelContainer.getActiveTab()||n.tabPanelContainer.setActiveTab(Ext.getCmp("tabWelcome")))})):(Ext.MessageBox.isVisible()&&Ext.MessageBox.hide(),n.tabPanelContainer.setActiveTab(Ext.getCmp("tabWelcome")))},System.sessionOut=function(){var e;this.sessionOutAlert||(Ext.MessageBox.hide(),this.sessionOutAlert=!0,(e=Ext.create("Ext.window.Window",{title:"系统提醒",height:150,width:250,layout:"fit",resizable:!1,maximizable:!1,sessionWin:!0,fixed:!0,draggable:!1,iconCls:"extIcon extSessionOut",html:"<div  style='padding:15px;background: #fff;'>会话失效，请您重新登录！</div>",modal:!0,alwaysOnTop:!0,toFrontOnShow:!0,buttons:[{text:"重新登录",iconCls:"extIcon extLogin",flex:1,handler:function(){e.close()}}],listeners:{destroy:function(e,t){FastExt.Power.isPower()?window.parent.close():location.reload()}}})).show())},System.logout=function(){Ext.Msg.confirm("系统提示","<br/>您是否确定退出登录吗？",function(e){"yes"===e&&FastExt.Server.logout()})},System.getExt=function(e){return window.getExt(e)},System.getAllExt=function(){return window.getAllExt()},System.isSystem=function(){try{if(FastExt.System.init)return!0}catch(e){}return!1},System.isSuperRole=function(){return!(!this.manager||!this.manager.role||0!==this.manager.role.roleType)},System.inFullScreen=function(){try{var e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen(),this.fullscreen=!0}catch(e){console.error(e)}},System.outFullscreen=function(){try{var e=e;e.exitFullscreen?e.exitFullscreen():e.msExitFullscreen?e.msExitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitExitFullscreen&&e.webkitExitFullscreen(),this.fullscreen=!1}catch(e){console.error(e)}},System.validOperate=function(n,o,i){var e,t,a,r,l,s;n&&(l=Cookies.get("ValidOperate"+$.md5(n)),i=i||86400,l?o():(e="normal"===FastExt.System.getExt("login-type").value,l=5*FastExt.Base.getNumberValue(FastExt.System.fontSize)+8,t=function(){var e,t=a.form;t.isValid()&&(e=a.form.findField("loginPassword").getValue(),t.submit({params:{loginPassword:$.md5(e),operate:n,timeout:i},waitMsg:"正在为您验证中……",success:function(e,t){s.close(),o()},failure:function(e,t){r(),Ext.Msg.alert("验证失败",t.result.message,function(){-3===t.result.code&&a.form.findField("validateCode").focus()})}}))},a=Ext.create("Ext.form.FormPanel",{url:FastExt.Server.validOperateUrl(),method:"POST",fileUpload:!0,border:0,width:"100%",layout:"anchor",region:"center",bodyStyle:{},padding:"10 10 0 10",items:[{xtype:"textfield",fieldLabel:"登录账号",labelAlign:"right",labelWidth:l,margin:"10 10 0 0",name:"loginName",allowBlank:!1,blankText:"请输入当前登录名",emptyText:"请输入当前登录名",anchor:"100%"},{xtype:"textfield",fieldLabel:"登录密码",labelAlign:"right",labelWidth:l,inputType:"password",margin:"10 10 0 0",allowBlank:!1,blankText:"请输入登录密码",emptyText:"请输入登录密码",submitValue:!1,name:"loginPassword",anchor:"100%"},{xtype:"fieldcontainer",labelWidth:0,anchor:"100%",layout:{type:"hbox",align:"stretch"},hidden:e,items:[{xtype:"textfield",fieldLabel:"验证码",labelAlign:"right",labelWidth:l,margin:"10 10 0 0",allowBlank:e,flex:1,name:"validateCode",emptyText:"请输入验证码",blankText:"请输入验证码"},{xtype:"image",margin:"10 10 0 0",width:70,id:"imgCode",height:32}]},{xtype:"fieldcontainer",labelWidth:0,anchor:"100%",layout:{type:"hbox",align:"stretch"},items:[{xtype:"button",text:"取消",iconCls:"extIcon extReset",flex:1,tipText:"取消验证",margin:"10 5 10 10",handler:function(){s.close()}},{xtype:"button",text:"确定",tipText:"确定验证",margin:"10 10 10 5",iconCls:"extIcon extOk",flex:1,handler:function(){t()}}]}],listeners:{render:function(e){try{new Ext.util.KeyMap({target:e.getEl(),key:13,fn:t,scope:Ext.getBody()})}catch(e){console.error(e)}}}}),r=function(){try{a.form.findField("validateCode").reset(),Ext.getCmp("imgCode").setSrc("showCaptcha?t="+Math.random())}catch(e){}},l=Ext.create("Ext.panel.Panel",{region:"south",layout:"fit",width:"100%",border:0,html:"<div align='center' style='font-size: small;color:red;text-decoration:none; padding-left: 40px;padding-right: 40px;padding-bottom: 10px;'>完成验证后将自动继续《"+n+"》操作</div>"}),(s=Ext.create("Ext.window.Window",{title:"当前操作需要安全验证",iconCls:"extIcon extPower",width:380,resizable:!1,layout:"vbox",toFrontOnShow:!0,modal:!0,constrain:!0,items:[a,l]})).show(null,function(){try{e||(r(),Ext.get("imgCode").on({click:function(){r()}}))}catch(e){}})))},System.formatUrlVersion=function(e,t){var n=e;if(e.indexOf("v=")<0&&(n=0<e.indexOf("?")?e+"&v="+FastExt.System.getValue("version").value:e+"?v="+FastExt.System.getValue("version").value),t)for(var o in t)t.hasOwnProperty(o)&&(n=n+"&"+o+"="+t[o]);return n},System.formatUrl=function(e,t){return e.startWith("http://")||e.startWith("https://")?e:this.formatUrlVersion(this.http+e,t)},System.asyncMethod=function(method){return new Ext.Promise(function(resolve,reject){try{var itemValue=eval(method);resolve(itemValue)}catch(e){resolve(null),console.error(e)}})},System.getMenu=function(e){e=Ext.getCmp("leftTreeList").getStore().getNodeById(e);if(e){e=e.data;return e&&e.parentId&&"root"!==e.parentId&&(e.parent=this.getMenu(e.parentId)),e}return null},System.findLastTag=function(){for(var e=Ext.getCmp("tabs"),t=e.items.items.length-1;0<=t;t--){var n=e.items.items[t];if(n&&!FastExt.Base.toBool(n.tab.closable,!0)&&!FastExt.Base.toBool(n.tab.reorderable,!0))return n}return null},System.recordTab=function(){return new Ext.Promise(function(n,t){try{var o=[],i=Ext.getCmp("tabs");i.items.each(function(e,t){var n={};Ext.isEmpty(e.method)||(n.method=e.method,n.where=e.where,n.title=e.title,n.icon=e.icon,n.id=e.id,n.closable=e.closable,n.reorderable=e.reorderable,n.active=e===i.getActiveTab(),o.push(n))}),FastExt.Server.saveExtConfig("SystemTabs","TabRecord",FastExt.Json.objectToJson(o),function(e,t){n(e)})}catch(e){t(e)}})},System.restoreTab=function(){return new Ext.Promise(function(n,t){try{FastExt.Server.showExtConfig("SystemTabs","TabRecord",function(e,t){n(t)})}catch(e){t(e)}})},System.selectTab=function(e){var t=Ext.getCmp(e);return t?(this.tabPanelContainer.setActiveTab(t),t.focus(),!0):this.selectMenu(e,!1)},System.selectMenu=function(e,t){try{Ext.isEmpty(t)&&(t=!1);var n=Ext.getCmp("leftTreeList"),o=n.getStore().getNodeById(e);if(!o)return!1;var i=o.get("parentId");if(!Ext.isEmpty(i)){var a=n.getStore().getNodeById(i);if(t)return n.setSelection(a),void a.collapse();"root"!==i&&(a.expand(!1,!0),this.selectMenu(i,t))}return n.setSelection(o),!0}catch(e){FastExt.Dialog.showException(e,"选择菜单！[system.selectMenu]")}},System.existMenu=function(e){return null!=Ext.getCmp("leftTreeList").getStore().getNodeById(e)},System.searchMenuByEntityCode=function(o){var i=function(e){if(!e)return null;for(var t=0;t<e.length;t++){var n=e[t];if(n.method&&0<=n.method.indexOf(o))return n;if(n.children){n=i(n.children);if(n)return n}}return null};return i(this.menus)},System.getAllMethodMenu=function(i){Ext.isEmpty(i)&&(i="");var a=function(e,t){if(e)for(var n=0;n<e.length;n++){var o=e[n];o.method&&0<=o.method.indexOf(i)&&t.push(o),a(o.children,t)}},e=[];return a(FastExt.System.menus,e),e},System.showTab=function(a,r,e,t,n,o,i,l,s){var d,c,u=this,x=Ext.getCmp("tabs");x.getActiveTab()&&r===x.getActiveTab().getId()||(t&&0!==t.length||(t=FastExt.Server.getIcon("icon_function.svg")),Ext.isEmpty(o)&&(o=!0),Ext.isEmpty(n)&&(n=!0),d=function(e,t){var n,o;e&&(!(n=u.getMenu(e.getId()))||(o=Ext.get(e.tabBtnId+"-btnIconEl"))&&(e=n.color,t&&(e=FastExt.Color.toColor(u["theme-color"].value)),o.setStyle("background-image","url("+FastExt.Server.getIcon(n.iconName,e)+")")))},c=(c=Ext.getCmp(r))||x.add({xtype:"panel",id:r,code:r,icon:t,layout:"fit",title:e,border:0,tabContainer:!0,closable:FastExt.Base.toBool(l,!0),reorderable:FastExt.Base.toBool(s,!0),methodInvoked:!1,method:a,where:i,items:[],tabBtnId:null,doFixed:function(){var e,t=this;t.tab.setClosable(!t.tab.closable),t.tab.closable?(t.reorderable=t.tab.reorderable=!0,(e=FastExt.System.findLastTag())&&x.moveAfter(t,e)):((e=FastExt.System.findLastTag())&&x.moveAfter(t,e),t.reorderable=t.tab.reorderable=!1),Ext.isFunction(x.recordTab)&&x.recordTab()},doCopyUrl:function(){FastExt.Base.copyToBoard(FastExt.System.baseUrl+"#/"+this.title+"/"+this.id),FastExt.Dialog.toast("复制成功！")},listeners:{deactivate:function(e){if(!FastExt.System.silenceGlobalSave)try{d(e,!1);var t=e.down("[entityList=true]");t&&t.onTabDeactivate&&t.onTabDeactivate(e)}catch(e){console.error(e)}},activate:function(n){var e;if(n&&(u.lastTabId=n.id,FastExt.System.silenceGlobalSave||(u.existMenu(n.id)&&u.selectMenu(n.id,!1),d(n,!0)),!n.methodInvoked||FastExt.System.silenceGlobalSave?u.asyncMethod(a).then(function(e){try{if(!e)return;n.methodInvoked=!0;var t=e.down("[entityList=true]");t&&(t.where=FastExt.Json.mergeJson(n.where,t.where),t.code=$.md5(r)),n.add(e)}catch(e){console.error(e)}}):(e=n.down("[entityList=true]"))&&e.onTabActivate&&e.onTabActivate(n),!FastExt.System.silenceGlobalSave)){try{var t=window.location.href;if(0<t.indexOf("#")){var o=t.substring(t.lastIndexOf("/")+1);if(n.id===o)return}var i={title:n.title,url:u.baseUrl+"#/"+n.title+"/"+n.id};window.history.pushState(i,n.title,u.baseUrl+"#/"+n.title+"/"+n.id)}catch(e){console.error(e)}u.recordTab()}},afterlayout:function(e,t,n){if(!FastExt.System.silenceGlobalSave)try{Ext.get(this.tabBtnId).dom.ondblclick=function(){var n=e.getId();x.items.each(function(e,t){0!==t&&e.id===n&&e.closable&&e.close()})},x.getActiveTab()&&x.getActiveTab().getId()===e.getId()&&d(e,!0)}catch(e){}},destroy:function(e,t){FastExt.System.silenceGlobalSave||u.recordTab()}},initEvents:function(){this.tabBtnId=this.getEl().getAttribute("aria-labelledby")}}),n&&(FastExt.System.silenceGlobalSave?x.setActiveTab(c):x.getActiveTab()&&x.getActiveTab().getId()===c.getId()||(!o||(o=u.findLastTag())&&Ext.getCmp("tabs").moveAfter(c,o),x.setActiveTab(c))))},System.closeAllTab=function(){Ext.getCmp("tabs").items.each(function(e,t){e.closable&&e.close()})},System.addTab=function(e,t,n,o){var i=(i=Ext.getCmp(t))||this.tabPanelContainer.add({title:n,xtype:"panel",id:t,code:t,icon:o,border:0,tabContainer:!0,closable:!0,reorderable:!0,layout:"fit",items:[e]});this.tabPanelContainer.setActiveTab(i)},System.selectTabFromHref=function(){var e=window.location.href;return 0<e.indexOf("#")?e.substring(e.lastIndexOf("/")+1):null},System.modifyPassword=function(e){var t=Ext.create("Ext.form.FormPanel",{url:"controller/modifyPassword",method:"POST",fileUpload:!0,border:0,width:"100%",layout:"anchor",region:"center",bodyStyle:{},items:[{xtype:"textfield",fieldLabel:"当前密码",labelAlign:"right",labelWidth:60,margin:"10 10 10 10",name:"managerPassword",allowBlank:!1,inputType:"password",blankText:"请输入用户当前密码",anchor:"100%"},{xtype:"textfield",fieldLabel:"新密码",labelAlign:"right",labelWidth:60,margin:"10 10 10 10",name:"newPassword",allowBlank:!1,inputType:"password",blankText:"请输入用户新密码",anchor:"100%"},{xtype:"textfield",fieldLabel:"确认密码",labelAlign:"right",labelWidth:60,margin:"10 10 10 10",name:"reNewPassword",allowBlank:!1,inputType:"password",blankText:"请确认密码",anchor:"100%"},{xtype:"hiddenfield",name:"managerId",value:this.manager.managerId},{xtype:"fieldcontainer",labelWidth:0,layout:"column",items:[{xtype:"button",text:"立即修改",margin:"10 10 10 5",iconCls:"extIcon extOk",columnWidth:1,handler:function(){n()}}]}],listeners:{render:function(e){try{new Ext.util.KeyMap({target:e.getEl(),key:13,fn:n,scope:Ext.getBody()})}catch(e){console.error(e)}}}}),n=function(){var e=t.form;e.isValid()&&e.submit({waitMsg:"正在修改中……",success:function(e,t){FastExt.Dialog.toast(t.result.message),o.close(),t.result.success&&Ext.Msg.alert("系统提醒","您当前的密码已被修改，请您重新登录！",function(){FastExt.Server.logout()})},failure:function(e,t){Ext.Msg.alert("系统提醒",t.result.message)}})},o=Ext.create("Ext.window.Window",{title:"修改登录密码",height:250,icon:e.icon,iconCls:e.iconCls,width:400,layout:"border",resizable:!1,maximizable:!1,animateTarget:e,constrain:!0,items:[t],modal:!0});o.show()},System.getEntity=function(e){for(var t=this.entities,n=0;n<t.length;n++){var o=t[n];if(o.entityCode===e)return o}return null},System.showMenuColumns=function(obj,checked){return new Ext.Promise(function(resolve,reject){var dataStore=Ext.create("Ext.data.TreeStore",{proxy:{type:"ajax",url:"showMenuColumn",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},listeners:{exception:function(obj,request,operation,eOpts){var data=eval("("+request.responseText+")");data.success||Ext.Msg.alert("数据获取失败",data.message)}},reader:{type:"json"}},root:{expanded:!0},listeners:{load:function(e,t,n){},beforeload:function(e,t){Ext.apply(e.proxy.extraParams,{checked:checked})}}}),treePanel=Ext.create("Ext.tree.Panel",{store:dataStore,rootVisible:!1,bufferedRenderer:!1,animate:!0,containerScroll:!0,autoScroll:!0,lastCheckNode:null,viewConfig:{loadMask:{msg:"加载功能菜单中，请稍后……"}},listeners:{checkchange:function(e,t,n,o){t?(e.bubble(function(e){e.set("checked",!0)}),e.cascadeBy(function(e){e.set("checked",!0)})):e.cascadeBy(function(e){e.set("checked",!1)})}}}),win=Ext.create("Ext.window.Window",{title:"搜索链配置",width:400,height:470,layout:"fit",iconCls:"extIcon extLink",resizable:!0,animateTarget:obj,maximizable:!0,constrain:!0,items:[treePanel],modal:!0,buttons:[{text:"重置",iconCls:"extIcon extReset",handler:function(){dataStore.reload()}},{text:"确定",iconCls:"extIcon extOk",handler:function(){for(var e,t,n,o=treePanel.getChecked(),i=[],a="",r=0;r<o.length;r++)o[r].isLeaf()&&((e={}).text=o[r].data.text,e.id=o[r].data.id,e.dataIndex=o[r].data.dataIndex,e.parentId=o[r].data.parentId,(t=treePanel.getStore().findNode("id",e.parentId,0,!1,!1,!0))&&(n=t.data,(t={}).text=n.text,t.id=n.id,t.method=n.method,t.icon=n.icon,e.parent=t,i.push(e))),a+=","+o[r].data.id;resolve({checked:a,columns:i}),win.close()}}]});win.show()})},System.showPowerMenus=function(obj,checked,parent){return new Ext.Promise(function(resolve,reject){var dataStore=Ext.create("Ext.data.TreeStore",{proxy:{type:"ajax",url:"showPowerMenus",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},listeners:{exception:function(obj,request,operation,eOpts){var data=eval("("+request.responseText+")");data.success||Ext.Msg.alert("数据获取失败",data.message)}},reader:{type:"json"}},root:{expanded:!0},listeners:{load:function(e,t,n){},beforeload:function(e,t){Ext.apply(e.proxy.extraParams,{checked:checked,parent:parent})}}}),treePanel=Ext.create("Ext.tree.Panel",{store:dataStore,rootVisible:!1,bufferedRenderer:!1,animate:!0,containerScroll:!0,autoScroll:!0,viewConfig:{loadMask:{msg:"加载功能菜单中，请稍后……"}},listeners:{checkchange:function(e,t,n,o){t?(e.bubble(function(e){e.set("checked",!0)}),e.cascadeBy(function(e){e.set("checked",!0)})):e.cascadeBy(function(e){e.set("checked",!1)})}}}),winWidth=parseInt((.4*document.body.clientWidth).toFixed(0)),winHeight=parseInt((.5*document.body.clientHeight).toFixed(0)),win=Ext.create("Ext.window.Window",{title:"权限配置（选择功能菜单）",height:winHeight,width:winWidth,minHeight:400,minWidth:470,layout:"fit",iconCls:"extIcon extSelect",resizable:!0,animateTarget:obj,maximizable:!0,constrain:!0,items:[treePanel],modal:!0,buttons:[{text:"重置",iconCls:"extIcon extReset",handler:function(){dataStore.reload()}},{text:"确定",iconCls:"extIcon extOk",handler:function(){for(var e=treePanel.getChecked(),t="",n=0;n<e.length;n++)t+=","+e[n].data.id;resolve(t),win.close()}}]});win.show()})},System.showPowerExt=function(e,o,i,a){return new Ext.Promise(function(e,t){window.getMenuPower=function(){return o},window.getExtPower=function(){return i},window.getParentExtPower=function(){return a},window.close=function(){Ext.getCmp("ExtPowerWindow").close()};var n=Ext.create("Ext.window.Window",{title:"配置界面权限（在组件上右击鼠标进行编辑权限）",id:"ExtPowerWindow",iconCls:"extIcon extPower",layout:"border",resizable:!1,maximized:!0,fixed:!0,draggable:!1,listeners:{show:function(e){e.update("<iframe name='extPowerFrame'  src='power?managerId=0' width='100%' height='100%' frameborder='0' scrolling='no' />")}},buttons:[{text:"保存权限配置",handler:function(){e(window.extPowerFrame.window.getExtPower()),n.close()}}]});n.show()})},System.showList=function(menuId,entityCode,where){var entity=FastExt.System.getEntity(entityCode);if(!entity)throw"操作失败！未获取到 '"+entityCode+"' 实体类！请检查实体类关联的表格是否存在！";if(!entity.js)throw"操作失败！未获取到 '"+entityCode+"' JS对象！";where=where||{};var entityJsObj=eval("new "+entityCode+"()");return entityJsObj.menu=FastExt.System.getMenu(menuId),entityJsObj.getList(where)},System.getWelcomePanel=function(){var e=[FastExt.System.getSystemOperate(),FastExt.System.getSystemWaitNotice()];FastExt.System.isSuperRole()&&e.push(FastExt.System.getSystemBugReport());var t=Ext.create("Ext.panel.Panel",{layout:{type:"accordion"},region:"center",border:0,flex:.6,items:e}),n=[];FastExt.System.isSuperRole()&&(n.push(FastExt.System.getSystemVersion()),n.push(FastExt.System.getSystemConfig()),n.push(FastExt.System.getSystemMonitor()));e=Ext.create("Ext.panel.Panel",{layout:"accordion",region:"east",border:0,flex:.4,collapsed:!1,split:!0,subtitle:"系统右侧面板",items:n}),t=[t];return 0<n.length&&t.push(e),window.initWelcomeItems&&window.initWelcomeItems(t),FastExt.Power.isPower()||FastExt.System.startCheckSystemWait(!0),Ext.create("Ext.panel.Panel",{layout:"border",region:"center",border:0,items:t})},System.getSystemOperate=function(){var o=Ext.create("Ext.data.Store",{autoLoad:!1,fields:[],id:"SystemLogStore",idProperty:"operateId",pageSize:50,proxy:{type:"ajax",url:"entity/list",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},reader:{type:"json",root:"list",totalProperty:"totalRow"}}}),e=Ext.create("Ext.toolbar.Paging",{store:o,dock:"bottom",border:0,overflowHandler:"scroller",displayInfo:!0}),i=Ext.create("Ext.grid.Panel",{region:"center",border:0,power:!0,multiColumnSort:!0,iconCls:"extIcon extLog",columnLines:!0,title:"系统操作日志",hideHeaders:!0,store:o,columns:[{header:"操作类型",dataIndex:"systemLogType",align:"center",width:120},{header:"操作介绍",dataIndex:"systemLogContent",align:"center",flex:1},{header:"操作时间",dataIndex:"systemLogDateTime",width:160,align:"center"},{header:"操作",dataIndex:"systemLogId",width:100,align:"center",renderer:function(e){return'<a href="javascript:FastExt.System.showSystemLogDetails('+e+');">查看详情</a>'}}],dockedItems:[e],viewConfig:{enableTextSelection:!0,loadMask:{msg:"正在为您在加载数据…"}}});return e.insert(e.items.getCount()-2,{xtype:"button",iconCls:"extIcon extSearch",tooltip:"搜索日志",handler:function(){i.add(FastExt.System.showSearchSysOperate(i,this))}}),e.insert(e.items.getCount()-3,"-"),o.on("beforeload",function(e,t){var n={};null!=i.searchForm&&(n=i.searchForm.getValues()),Ext.apply(e.proxy.extraParams,n),Ext.apply(e.proxy.extraParams,{entityCode:"ExtSystemLogEntity",limit:o.pageSize})}),o.loadPage(1),i},System.showSystemLogDetails=function(e){e=Ext.getStore("SystemLogStore").findRecord("systemLogId",e,0,!1,!1,!0),e=FastExt.Grid.createDetailsGrid(function(e){var t,n=[],o={a__managerName:"管理员",systemLogType:"操作类型",systemLogContent:"操作详情",systemLogIp:"来自IP",systemLogClient:"浏览器信息",systemSendData:"提交的数据",systemResultData:"返回的数据",systemLogDateTime:"操作时间"};for(t in o)n.push({name:o[t],key:t,value:e[t]});return n}(e.getData()),{region:"center",power:!1,hideHeaders:!0},{width:100,flex:0},{align:"left",renderer:function(e,t,n){return t.style="overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space:normal !important;line-height:20px;word-break:break-word; ","systemLogIp"===n.get("key")?"<a href='https://www.baidu.com/s?wd="+e+"' target='_blank'>"+e+"</a>":e},listeners:{dblclick:function(e,t,n,o,i,a,r){e=e.getStore().getAt(n),n=e.get("key");"systemSendData"!==n&&"systemResultData"!==n||FastExt.Dialog.showFormatJson(t,e.get("value"))}}});Ext.create("Ext.window.Window",{title:"日志详情",height:500,iconCls:"extIcon extDetails",width:500,layout:"border",resizable:!0,maximizable:!0,items:[e],modal:!0,constrain:!0}).show()},System.showSearchSysOperate=function(n,e){var t;return n.searchForm||(n.searchForm=Ext.create("Ext.form.FormPanel",{bodyPadding:5,region:"center",autoScroll:!0,layout:"column",defaults:{labelWidth:100,margin:"5 5 5 5",labelAlign:"right",emptyText:"可输入…"},listeners:{render:function(e,t){try{new Ext.util.KeyMap({target:e.getEl(),key:13,fn:function(){n.getStore().loadPage(1)},scope:this})}catch(e){console.error(e)}}},items:[{fieldLabel:"关键字",columnWidth:1,name:"where['^search']",xtype:"textfield"},{fieldLabel:"开始时间",columnWidth:.5,name:"where['systemLogDateTime>=']",xtype:"datefield",format:"Y-m-d"},{fieldLabel:"结束时间",columnWidth:.5,name:"where['systemLogDateTime<=']",xtype:"datefield",format:"Y-m-d"},{fieldLabel:"操作用户",columnWidth:.5,name:"where['a__managerName%?%']",xtype:"textfield"},{fieldLabel:"操作类型",columnWidth:.5,name:"where['systemLogType%?%']",xtype:"textfield"}]}),t=e.text,Ext.isEmpty(t)&&(t="搜索系统日志"),n.searchWin=Ext.create("Ext.window.Window",{title:t,closeAction:"hide",width:500,minWidth:500,minHeight:110,height:230,layout:"border",constrain:!0,iconCls:"extIcon extSearch",resizable:!0,collapsible:!0,animateTarget:e,items:[n.searchForm],buttons:[{text:"重置",iconCls:"extIcon extReset",handler:function(){n.searchForm.reset(),n.getStore().loadPage(1)}},{text:"搜索",iconCls:"extIcon extSearch",handler:function(){n.getStore().loadPage(1)}}]})),n.searchWin.show(),n.searchWin},System.getSystemWaitNotice=function(){var entity=eval("new ExtSystemNoticeEntity()");entity.menu={text:"系统问题上报"};var dataStoreNotice=Ext.create("Ext.data.Store",{autoLoad:!1,fields:[],id:"SystemWaitNoticeStore",entity:entity,pageSize:50,proxy:{type:"ajax",url:"entity/list",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},reader:{type:"json",root:"list",totalProperty:"totalRow"}}}),pagingtoolbar=Ext.create("Ext.toolbar.Paging",{store:dataStoreNotice,dock:"bottom",border:0,overflowHandler:"scroller",displayInfo:!0}),dataGridNotice=Ext.create("Ext.grid.Panel",{region:"center",border:0,power:!0,multiColumnSort:!0,iconCls:"extIcon extTip",columnLines:!0,title:"系统待办事项",hideHeaders:!0,store:dataStoreNotice,columns:[{header:"待办标题",dataIndex:"noticeTitle",align:"center",width:200},{header:"处理人",dataIndex:"a__managerName",align:"center",flex:1},{header:"待办内容",dataIndex:"noticeStateStr",align:"center",width:120},{header:"录入时间",dataIndex:"noticeDateTime",width:200,align:"center"}],plugins:[{ptype:"rowexpander",rowBodyTpl:new Ext.XTemplate("<p>【{noticeTitle}】{noticeContent}</p>","<p><tpl if='noticeState==0' ><a id='aNoticeAction{noticeId}' href='javascript:FastExt.System.setDoneSystemWait({noticeId});'>标记为已读</a>&nbsp;&nbsp;&nbsp;&nbsp;</tpl><tpl if='noticeAction' ><a href=\"javascript:{noticeAction};\">立即前往</a></tpl></p>")}],dockedItems:[pagingtoolbar],viewConfig:{enableTextSelection:!0,loadMask:{msg:"正在为您在加载数据…"}}});return dataStoreNotice.on("beforeload",function(e,t){var n={};null!=dataGridNotice.searchForm&&(n=dataGridNotice.searchForm.getValues()),Ext.apply(e.proxy.extraParams,n),Ext.apply(e.proxy.extraParams,{entityCode:"ExtSystemNoticeEntity",limit:dataStoreNotice.pageSize})}),dataStoreNotice.loadPage(1),dataGridNotice},System.getSystemBugReport=function(){var entity=eval("new ExtBugReportEntity()");entity.menu={text:"系统问题上报"};var dataStoreBugReport=Ext.create("Ext.data.Store",{autoLoad:!1,fields:[],id:"SystemBugReportStore",pageSize:50,entity:entity,proxy:{type:"ajax",url:"entity/list",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},reader:{type:"json",root:"list",totalProperty:"totalRow"}}}),pagingtoolbar=Ext.create("Ext.toolbar.Paging",{store:dataStoreBugReport,dock:"bottom",border:0,overflowHandler:"scroller",displayInfo:!0}),dataGridBugReport=Ext.create("Ext.grid.Panel",{region:"center",border:0,power:!0,multiColumnSort:!0,iconCls:"extIcon extBug",columnLines:!0,title:"系统问题上报",hideHeaders:!0,store:dataStoreBugReport,refreshCount:function(){var n=this;FastExt.Server.countReport(function(e,t){0<t?n.setTitle("系统问题上报 <span style='color: red;font-size: small;'>待处理（"+t+"）</span>"):n.setTitle("系统问题上报")})},columns:[{header:"功能类型",dataIndex:"funcTypeStr",align:"center",width:100},{header:"问题反馈",dataIndex:"bugContent",align:"center",flex:1,renderer:FastExt.Renders.text()},{header:"反馈状态",dataIndex:"reportStateStr",width:65,align:"center"},{header:"上报时间",dataIndex:"reportDateTime",width:120,align:"center"},{header:"操作",dataIndex:"reportId",width:100,align:"center",renderer:function(e){return'<a href="javascript:FastExt.System.showBugReportDetails('+e+');">查看详情</a>'}}],dockedItems:[pagingtoolbar],viewConfig:{enableTextSelection:!0,loadMask:{msg:"正在为您在加载数据…"}}}),beginIndex=2;return pagingtoolbar.insert(pagingtoolbar.items.getCount()-beginIndex,"-"),pagingtoolbar.insert(pagingtoolbar.items.getCount()-beginIndex,{xtype:"button",iconCls:"extIcon extSearch",tooltip:"搜索问题",handler:function(){dataGridBugReport.add(FastExt.System.showSearchBugReport(dataGridBugReport,this))}}),pagingtoolbar.insert(pagingtoolbar.items.getCount()-beginIndex,"-"),pagingtoolbar.insert(pagingtoolbar.items.getCount()-beginIndex,{xtype:"button",iconCls:"extIcon extAdd grayColor",tooltip:"添加问题",handler:function(){entity.showAdd(this).then(function(){dataStoreBugReport.loadPage(1)})}}),dataStoreBugReport.on("beforeload",function(e,t){var n={};null!=dataGridBugReport.searchForm&&(n=dataGridBugReport.searchForm.getValues()),Ext.apply(e.proxy.extraParams,n),Ext.apply(e.proxy.extraParams,{entityCode:"ExtBugReportEntity",limit:dataStoreBugReport.pageSize})}),dataStoreBugReport.on("load",function(e,t,n,o,i){dataGridBugReport.refreshCount()}),dataStoreBugReport.loadPage(1),dataGridBugReport},System.setDoneSystemWait=function(n){FastExt.Dialog.showWait("正在标记中，请稍后……"),FastExt.Server.doneWaitNotice(n,function(e,t){FastExt.Dialog.hideWait(),e?(FastExt.Dialog.toast(t),$("#aNoticeAction"+n).remove(),Ext.getCmp("bNoticeAction"+n)&&(Ext.getCmp("bNoticeAction"+n).destroy(),(e=Ext.getCmp("NoticeAlertWindow"))&&0===$("[type='bNoticeAction']").length&&e.close())):FastExt.Dialog.showAlert("系统提醒",t)})},System.startCheckSystemWait=function(s){window.clearTimeout(FastExt.Server.checkWaitNoticeTimer);var d={};if(!s)for(var e=$("[type='bNoticeAction']"),t=0;t<e.length;t++)d["noticeId_"+t]=$(e[t]).attr("data-id");FastExt.System.silenceGlobalSave?FastExt.Server.checkWaitNoticeTimer=setTimeout(function(){FastExt.System.startCheckSystemWait()},3e3):FastExt.Server.checkWaitNotice(d,function(e,t){try{if(e){var n=Ext.getCmp("NoticeAlertWindow");if(t.length<=0&&0===Object.keys(d).length)return void(n&&n.close());for(var o=[],i=!1,a=0;a<t.length;a++){var r=t[a],l={xtype:"fieldset",margin:"10",id:"bNoticeAction"+r.noticeId,style:{background:"#ffffff"},columnWidth:1,viewModel:{data:r},defaults:{anchor:"100%",height:"auto",margin:"0",labelAlign:"right",labelWidth:0,columnWidth:1,disabled:!0,disabledCls:".x-item-disabled-normal"},items:[{xtype:"displayfield",bind:"{noticeContent}",renderer:function(e,t){var n=t.ownerCt.viewModel.data,t="<b style='display: block;font-size: 16px;margin-bottom: 10px;'>"+n.noticeTitle+"</b>";return t+="<div>"+e+"</div>",t+="<div style='margin-top: 10px;display: flex;' ><a type='bNoticeAction' data-id='"+n.noticeId+"' href='javascript:FastExt.System.setDoneSystemWait("+n.noticeId+");'>标记为已读</a>",Ext.isEmpty(n.noticeAction)||(t+='&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:'+n.noticeAction+';">立即前往</a>'),t+="<span style='flex: 1;text-align: right;'>"+n.noticeDateTime+"</span></div>",t+="<div style='font-size: smaller;color: #a0a0a0;margin-top: 10px;'>注：如果已处理请标记为已读！</div>"}}]};o.push(l),0===$("#bNoticeAction"+r.noticeId).length&&(i=!0)}if(!i&&!s)return;n||(n=Ext.create("Ext.window.Window",{title:"系统待办事项",id:"NoticeAlertWindow",width:400,height:400,layout:"column",closable:!1,constrain:!0,iconCls:"extIcon extTip",resizable:!1,scrollable:!0,tools:[{type:"refresh",callback:function(){Ext.getStore("SystemWaitNoticeStore").loadPage(1),FastExt.System.startCheckSystemWait(!0)}},{type:"close",callback:function(){FastExt.Dialog.showWait("正在清除中，请稍后……"),FastExt.Server.clearWaitNotice(function(e,t){FastExt.Dialog.hideWait(),e?n.close():FastExt.Dialog.showAlert("系统提醒",t)})}}],collapsible:!0})).showAt(5*$(window).width(),5*$(window).width()),s?(n.removeAll(),n.add(o)):(n.insert(0,o),n.setScrollY(0,!0)),window.onSystemNoticeShow&&window.onSystemNoticeShow()}}finally{FastExt.Server.checkWaitNoticeTimer=setTimeout(function(){FastExt.System.startCheckSystemWait()},3e3)}})},System.showBugReportDetails=function(e){function t(e){var t,n=[],o={a__managerName:"上报用户",funcTypeStr:"功能类型",funcName:"功能名称",bugContent:"问题描述",bugFlow:"操作步骤",bugImagesHtml:"问题截图",fixInfo:"修改意见",reportStateStr:"上报状态",reportDateTime:"上报时间"};for(t in o)n.push({name:o[t],value:e[t]});return n}var n=Ext.getStore("SystemBugReportStore"),o=n.findRecord("reportId",e,0,!1,!1,!0),i=FastExt.Grid.createDetailsGrid(t(o.getData()),{region:"center",power:!1,hideHeaders:!0},{width:100,flex:0},{align:"left"}),a=Ext.create("Ext.window.Window",{title:"问题详情",height:500,iconCls:"extIcon extDetails",width:500,layout:"border",resizable:!0,maximizable:!0,items:[i],modal:!0,constrain:!0,buttons:["->",{text:"删除问题",iconCls:"extIcon extDelete whiteColor",handler:function(){Ext.Msg.show({title:"系统提醒",icon:Ext.Msg.QUESTION,message:"您确定这条问题吗？",buttons:Ext.Msg.YESNO,defaultFocus:"no",callback:function(e,t){"yes"===e&&FastExt.Store.commitStoreDelete(n,[o]).then(function(){a.close()})}})}},{text:"反馈修改意见",iconCls:"extIcon extEdit",handler:function(){FastExt.Dialog.showEditor(this,"提交修改意见",function(e){o.set("fixInfo",e),o.set("reportState",1),o.set("reportStateStr","已处理"),FastExt.Store.commitStoreUpdate(n),i.updateData(t(o.getData()))})}}]});a.show()},System.showSearchBugReport=function(n,e){var t;return n.searchForm||(n.searchForm=Ext.create("Ext.form.FormPanel",{bodyPadding:5,region:"center",autoScroll:!0,layout:"column",defaults:{labelWidth:100,margin:"5 5 5 5",labelAlign:"right",emptyText:"可输入…"},listeners:{render:function(e,t){try{new Ext.util.KeyMap({target:e.getEl(),key:13,fn:function(){n.getStore().loadPage(1)},scope:this})}catch(e){console.error(e)}}},items:[{name:"where['funcType']",xtype:"enumcombo",fieldLabel:"功能类型",columnWidth:.5,enumName:"ExtBugFuncTypeEnum"},{name:"where['reportState']",xtype:"enumcombo",fieldLabel:"上报状态",columnWidth:.5,enumName:"ExtBugReportStateEnum"},{fieldLabel:"开始时间",columnWidth:.5,name:"where['reportDateTime>=']",xtype:"datefield",format:"Y-m-d"},{fieldLabel:"结束时间",columnWidth:.5,name:"where['reportDateTime<=']",xtype:"datefield",format:"Y-m-d"},{fieldLabel:"操作用户",columnWidth:.5,name:"where['a__managerName%?%']",xtype:"textfield"},{fieldLabel:"关键字",columnWidth:.5,name:"where['systemLogContent%?%']",xtype:"textfield"}]}),t=e.text,Ext.isEmpty(t)&&(t="搜索问题上报"),n.searchWin=Ext.create("Ext.window.Window",{title:t,closeAction:"hide",width:550,minWidth:500,minHeight:110,height:250,layout:"border",constrain:!0,iconCls:"extIcon extSearch",resizable:!0,collapsible:!0,animateTarget:e,items:[n.searchForm],buttons:[{text:"重置",iconCls:"extIcon extReset",handler:function(){n.searchForm.reset(),n.getStore().loadPage(1)}},{text:"搜索",iconCls:"extIcon extSearch",handler:function(){n.getStore().loadPage(1)}}]})),n.searchWin.show(),n.searchWin},System.getSystemVersion=function(){var e=[{name:"项目名称",value:FastExt.System.title.value},{name:"项目版本",value:FastExt.System.version.desc},{name:"项目位置",value:FastExt.System.root.value},{name:"操作文档",value:"<a href='"+FastExt.System["doc-extjs"].href+"' target='_blank' >"+FastExt.System["doc-extjs"].value+"</a>"},{name:"本机IP地址",value:FastExt.System.host.value},{name:"系统环境",value:FastExt.System.os.value},{name:"数据库",value:FastExt.System.db.value},{name:"运行服务器",value:FastExt.System.server.value},{name:"服务器位置",value:FastExt.System.catalina.value},{name:"核心框架",value:"<a href='http://www.fastchar.com' target='_blank' >"+FastExt.System.fastchar.value+"</a>"},{name:"开发语言",value:FastExt.System.java.value+"+ExtJs6.2.0+HTML5+CSS3"},{name:"开发服务商",value:"<a href='"+FastExt.System.developer.href+"' target='_blank'>"+FastExt.System.developer.value+"</a>"},{name:"版权归属",value:"<a href='"+FastExt.System.getExt("copyright").href+"' target='_blank'>"+FastExt.System.getExt("copyright").value+"</a>"}];return FastExt.Grid.createDetailsGrid(e,{title:"系统基本信息",iconCls:"extIcon extVersion",power:!1,hideHeaders:!0},{},{align:"center"})},System.getSystemConfig=function(){var n=Ext.create("Ext.form.FormPanel",{url:"ext/config/saveSystemConfig",bodyPadding:5,method:"POST",region:"center",power:!1,border:0,title:"系统全局设置",iconCls:"extIcon extSet",autoScroll:!0,defaults:{labelWidth:100,margin:"5 5 5 5",labelAlign:"right",emptyText:"请填写"},viewModel:{data:null},layout:"column",items:[{xtype:"fieldset",title:"基本设置",columnWidth:1,layout:"column",defaults:{anchor:"100%",margin:"5 5 5 5"},items:[{name:"theme-color",xtype:"colorfield",fieldLabel:"系统主题颜色",columnWidth:1,bind:"{theme-color}"},{name:"front-color",xtype:"colorfield",fieldLabel:"系统前景颜色",columnWidth:1,bind:"{front-color}"},{name:"theme",fieldLabel:"系统主题风格",columnWidth:1,xtype:"combo",displayField:"text",valueField:"id",editable:!1,value:1,bind:"{theme}",store:FastExt.Store.getThemeDataStore()},{name:"window-anim",fieldLabel:"系统窗体动画",columnWidth:1,xtype:"combo",displayField:"text",valueField:"id",editable:!1,value:1,bind:"{window-anim}",store:FastExt.Store.getYesOrNoDataStore()},{name:"tab-record",fieldLabel:"标签记忆功能",columnWidth:1,xtype:"combo",displayField:"text",valueField:"id",editable:!1,value:1,bind:"{tab-record}",store:FastExt.Store.getYesOrNoDataStore()},{name:"font-size",fieldLabel:"系统字体大小",columnWidth:1,xtype:"combo",displayField:"text",valueField:"id",editable:!1,value:1,bind:"{font-size}",store:FastExt.Store.getFontSizeDataStore()},{xtype:"button",text:"恢复默认",iconCls:"extIcon extReset whiteColor",columnWidth:.5,handler:function(){Ext.Msg.confirm("系统提醒","您确定恢复系统默认的配置吗？",function(e,t){"yes"===e&&(FastExt.Dialog.showWait("请稍后……"),n.getForm().reset(),FastExt.Server.deleteSystemConfig(function(e,t){FastExt.Dialog.hideWait(),e?location.reload():FastExt.Dialog.showAlert("系统提醒",t)}))})}},{xtype:"button",text:"保存配置",columnWidth:.5,iconCls:"extIcon extSave whiteColor",margin:"5 5 5 0 ",handler:function(){n.doSubmit()}}]},{xtype:"fieldset",title:"系统配置",columnWidth:1,layout:"column",defaults:{anchor:"100%",margin:"5 5 5 5"},items:[{xtype:"button",text:"初始化系统配置",columnWidth:1,iconCls:"extIcon extRefresh whiteColor",handler:function(){Ext.Msg.confirm("系统提醒","确定初初始化系统配置吗？",function(e,t){"yes"==e&&FastExt.System.startSilenceSaveConfig()})}},{xtype:"button",text:"下载系统配置",columnWidth:.5,iconCls:"extIcon extDownload whiteColor",handler:function(){FastExt.Dialog.showWait("正在获取系统配置文件中……"),$.post("downSystemConfig",function(e){FastExt.Dialog.hideWait(),e.success?(FastExt.Dialog.toast("获取成功！"),FastExt.Base.openUrl(e.data,FastEnum.Target._self)):FastExt.Dialog.showAlert("系统提醒",e.message)})}},{xtype:"button",text:"上传系统配置",columnWidth:.5,margin:"5 5 5 0 ",iconCls:"extIcon extUpload whiteColor",handler:function(){var o=Ext.create("Ext.form.FormPanel",{url:"loadSystemConfig",method:"POST",margin:"5",fileUpload:!0,width:400,callBacked:!1,border:0,layout:"column",items:[{xtype:"filefield",fieldLabel:"系统配置文件",labelWidth:120,labelAlign:"right",buttonText:"选择文件",allowBlank:!1,name:"systemConfigFile",columnWidth:1}],doSubmit:function(){var n,e=o.form;e.isValid()&&((n=new Ext.LoadMask({msg:"正在上传文件中…",target:i})).show(),e.submit({success:function(e,t){FastExt.Dialog.toast(t.result.message),i.close()},failure:function(e,t){n.destroy(),Ext.Msg.alert("系统提醒","上传失败！"+t.result.message)}}))},listeners:{render:function(e){try{new Ext.util.KeyMap({target:e.getEl(),key:13,fn:o.doSubmit,scope:Ext.getBody()})}catch(e){console.error(e)}}}}),n="btnSubmit"+(new Date).getTime(),i=Ext.create("Ext.window.Window",{title:"上传系统配置文件",layout:"fit",resizable:!1,scrollable:!1,width:500,items:o,modal:!0,iconCls:"extIcon extUpload",animateTarget:this,constrain:!0,buttons:[{text:"重置",width:88,iconCls:"extIcon extReset",handler:function(){o.form.reset()}},{text:"上传",width:88,id:n,iconCls:"extIcon extOk",handler:function(){o.doSubmit()}}],listeners:{show:function(e,t){o.getForm().findField("systemConfigFile").fileInputEl.dom.click(),Ext.getCmp(n).focus()}}});i.show()}}]}],doSubmit:function(){var e=n.form;e.isValid()&&e.submit({waitMsg:"正在保存配置中……",success:function(e,t){Ext.Msg.alert("系统设置","设置保存成功！",function(e){"ok"===e&&location.reload()})},failure:function(e,t){Ext.Msg.alert("保存失败",t.result.message)}})}});return FastExt.Server.showSystemConfig(function(e,t){e&&n.getViewModel().setData(t)}),n},System.getSystemMonitor=function(){var e=Ext.create("Ext.panel.Panel",{layout:"column",region:"north",power:!1,border:0,bodyPadding:5,title:"系统监控信息",iconCls:"extIcon extMonitor",closable:!1,autoScroll:!0}),m=function(x){FastExt.Server.loadMonitor(function(e,t){if(x.removeAll(),t){for(var n=t.desc,o=t.data,i=0,a=0;a<n.length;a++){var r,l,s=n[a],d=[];for(r in s)"title"!==r&&(l={xtype:"textfield",fieldLabel:s[r],bind:"{"+r+"}"},d.push(l));var c=o[a],u=s.title;c.alert&&(i++,u="<b style='color: #c21904;'>"+u+"【预警】</b>"),x.add({xtype:"fieldset",title:u,columnWidth:1,collapsible:!0,viewModel:{data:c},defaults:{anchor:"100%",labelAlign:"right",labelWidth:80,columnWidth:1,disabled:!0,disabledCls:".x-item-disabled-normal"},items:d})}x.add({xtype:"button",text:"刷新信息",columnWidth:1,margin:"5 5 5 5",handler:function(e){e.setText("正在刷新"),e.setDisabled(!0),m(x)}}),0<i&&x.setTitle("<b style='color: #c21904;' >系统监控信息（"+i+"个预警）</b>")}})};return m(e),e},System.showLogin=function(e){var t=$("title").text(),n=FastExt.System.getExt("login-background").href,o=FastExt.Color.toColor(FastExt.System.getExt("theme-color").value),i=FastExt.System.getExt("login-logo").value,a="normal"===FastExt.System.getExt("login-type").value,r=FastExt.System.getExt("copyright").value,l=FastExt.System.getExt("copyright").href,s=FastExt.System.getExt("indexUrl").value,d=FastExt.System.getExt("version").desc,c=(new Date).getFullYear();-1===n.indexOf("?")&&(n+="?1=1"),-1===(n=-1===n.indexOf("bg=")?n+"&bg="+o:n).indexOf("dot=")&&(n=n+"&dot="+o);var u=Ext.create("Ext.panel.Panel",{layout:"fit",border:0,iframePanel:!0,html:"<iframe name='loginFrame'  src='"+n+"' width='100%' height='100%' style='border: 0px; overflow-x: hidden;background-color: "+o+"'/>"}),x="<div align='center' class='headPanel' style='color:"+o+";'><img class='loginLogo'  width='50px' height='50px;' src='"+i+"' /><h2>"+t+"</h2></div>";i&&0!==i.length||(x="<div align='center' class='headPanel' style='color:"+o+";'><h2>"+t+"</h2></div>");n=Ext.create("Ext.panel.Panel",{region:"north",layout:"fit",bodyCls:"bgNull",width:"100%",bodyStyle:{},border:0,height:"auto",html:x}),i=Cookies.get("loginNameValue"),o=Cookies.get("loginPasswordValue"),t=Cookies.get("loginMemberValue");Ext.isEmpty(t)&&(t="0");function m(){try{g.form.findField("validateCode").reset(),Ext.getCmp("imgCode").setSrc("showCaptcha?t="+Math.random())}catch(e){}}var x=3*FastExt.Base.getNumberValue(FastExt.System.fontSize)+8,g=Ext.create("Ext.form.FormPanel",{url:FastExt.Server.loginUrl(),method:"POST",fileUpload:!0,bodyCls:"bgNull",border:0,width:"100%",layout:"anchor",region:"center",bodyStyle:{},padding:"10 10 10 10",items:[{xtype:"fieldset",title:"",layout:"anchor",padding:"10 10 0 10",items:[{xtype:"textfield",fieldLabel:"登录名",labelAlign:"right",labelWidth:x,margin:"10 10 0 0",name:"loginName",allowBlank:!1,blankText:"请输入登录名",emptyText:"请输入登录名",value:i,anchor:"100%"},{xtype:"textfield",fieldLabel:"密码",labelAlign:"right",labelWidth:x,inputType:"password",margin:"10 10 0 0",allowBlank:!1,blankText:"请输入登录密码",emptyText:"请输入登录密码",value:o,submitValue:!1,name:"loginPassword",anchor:"100%"},{xtype:"fieldcontainer",labelWidth:0,anchor:"100%",layout:{type:"hbox",align:"stretch"},hidden:a,items:[{xtype:"textfield",fieldLabel:"验证码",labelAlign:"right",labelWidth:x,margin:"10 10 0 0",allowBlank:a,flex:1,name:"validateCode",emptyText:"请输入验证码",blankText:"请输入验证码"},{xtype:"image",margin:"10 10 0 0",width:70,cls:"validCodeImg",id:"imgCode",height:32}]},{name:"loginMember",fieldLabel:"记住",xtype:"combo",labelAlign:"right",labelWidth:x,margin:"10 10 0 0",displayField:"text",valueField:"id",editable:!1,anchor:"100%",value:t,submitValue:!1,allowBlank:!1,store:Ext.create("Ext.data.Store",{data:[{id:"0",text:"用户名"},{id:"1",text:"用户名和密码"}]})},{xtype:"fieldcontainer",labelWidth:0,anchor:"100%",layout:{type:"hbox",align:"stretch"},items:[{xtype:"button",text:"重置",iconCls:"extIcon extReset",flex:1,tipText:"重置数据",margin:"10 5 10 10",handler:function(){g.form.reset()}},{xtype:"button",text:"登录",id:"btnLogin",tipText:"登录系统",margin:"10 10 10 5",iconCls:"extIcon extOk",flex:1,handler:function(){h()}}]}]}],listeners:{render:function(e){try{new Ext.util.KeyMap({target:e.getEl(),key:13,fn:h,scope:Ext.getBody()})}catch(e){console.error(e)}}}}),h=function(){var e,t=g.form;t.isValid()&&((e=window.onBeforeLogin)?e(t.getValues(),function(){f()}):f())},f=function(){var e,t,n,o=g.form;o.isValid()&&(e=g.form.findField("loginPassword").getValue(),t=g.form.findField("loginName").getValue(),n=g.form.findField("loginMember").getValue(),Cookies.set("loginNameValue",t,{expires:30}),Cookies.set("loginMemberValue",n,{expires:30}),1===parseInt(n)?Cookies.set("loginPasswordValue",e,{expires:30}):Cookies.remove("loginPasswordValue"),o.submit({params:{loginPassword:$.md5(e)},waitMsg:"正在为您登录……",success:function(e,t){FastExt.System.addScript({src:s+"?v="+FastExt.System.getExt("version").value})},failure:function(e,t){m(),-2===t.result.code&&g.form.findField("loginPassword").reset(),Ext.Msg.alert("登录失败",t.result.message,function(){-3===t.result.code&&g.form.findField("validateCode").focus()})}}))},t="_blank";l.startWith("javascript:")&&(t="_self");d=Ext.create("Ext.panel.Panel",{region:"south",layout:"fit",width:"100%",height:50,bodyCls:"bgNull",border:0,html:"<div align='center'><a href='"+l+"' target='"+t+"' style='font-size: xx-small;color:#aaa;text-decoration:none;'>"+r+"</a></div><div align='center' style='font-size: xx-small;color:#aaa;margin-top: 5px;'>Copyright © "+c+" "+d+"</div>"}),d=Ext.create("Ext.window.Window",{title:"管理员登录",iconCls:"extIcon extLogin",width:420,resizable:!1,layout:"vbox",bodyCls:"bgImage",closable:!1,toFrontOnShow:!0,constrain:!0,items:[n,g,d]});d.show(null,function(){Ext.getCmp("btnLogin").focus();try{a||(m(),Ext.get("imgCode").on({click:function(){m()}}))}catch(e){}}),e.add(u),e.add(d)},System.startSilenceSaveConfig=function(e){Ext.isEmpty(FastExt.System.allShowListMethodMenu)&&(FastExt.System.allShowListMethodMenu=FastExt.System.getAllMethodMenu("showList")),FastExt.System.closeAllTab(),FastExt.System.silenceGlobalSave=!0,Ext.MessageBox.show({alwaysOnTop:!0,modal:!0,animateTarget:e,title:"系统提醒",msg:"初始化系统配置",progressText:"请耐心等待，即将完成操作",progress:!0,closable:!1}),FastExt.System.doNextSilenceMenu()},System.doNextSilenceMenu=function(){Ext.isEmpty(FastExt.System.doNextSilenceMenuIndex)&&(FastExt.System.doNextSilenceMenuIndex=0);var e=FastExt.System.allShowListMethodMenu,t=FastExt.System.doNextSilenceMenuIndex;if(t>=e.length)return FastExt.Dialog.showAlert("系统提醒","系统配置已初始化完毕！"),FastExt.System.silenceGlobalSave=!1,void(FastExt.System.doNextSilenceMenuIndex=0);Ext.MessageBox.updateProgress(parseFloat(String(t+1))/parseFloat(e.length),"正在读取配置中，请耐心等待");e=e[t];FastExt.System.showTab(e.method,e.id,e.text,e.icon),FastExt.System.doNextSilenceMenuIndex=t+1},System._fontSize="14px",System.lastTabId=-1,System.dateFormat="Y-m-d H:i:s",System.init=!1,System.menus=null,System.http=null,System.baseUrl=null,System.regByImage=/\.(jpg|png|gif|jpeg)$/i,System.regByMP4=/\.(mp4)$/i,System.regByExcel=/\.(xls|xlsx)$/i,System.regByWord=/\.(doc)$/i,System.regByText=/\.(txt)$/i,System.fullscreen=!1,System.sessionOutAlert=!1,System.restoredTab=!1,System.silenceGlobalSave=!1,System}();FastExt.System=System;var SystemScript=(Object.defineProperty(YY.prototype,"src",{get:function(){return this._src},set:function(e){this._src=e},enumerable:!1,configurable:!0}),Object.defineProperty(YY.prototype,"href",{get:function(){return this._href},set:function(e){this._href=e},enumerable:!1,configurable:!0}),Object.defineProperty(YY.prototype,"text",{get:function(){return this._text},set:function(e){this._text=e},enumerable:!1,configurable:!0}),YY);function YY(){}FastExt.SystemScript=SystemScript;var SystemCompat=function(){window.getEntityDataStore=FastExt.Store.getEntityDataStore,window.commitStoreUpdate=FastExt.Store.commitStoreUpdate,window.getGridSelModel=FastExt.Grid.getGridSelModel,window.renders=FastExt.Renders,window.files=FastExt.FileModule,window.getPageToolBar=FastExt.Grid.getPageToolBar,window.getDetailsPanel=FastExt.Grid.getDetailsPanel,window.system=FastExt.System,window.toBool=FastExt.Base.toBool,window.deleteGridData=FastExt.Grid.deleteGridData,window.updateGridData=FastExt.Grid.updateGridData,window.runCallBack=FastExt.Base.runCallBack,window.showDetailsWindow=FastExt.Grid.showDetailsWindow,window.showWait=FastExt.Dialog.showWait,window.hideWait=FastExt.Dialog.hideWait,window.toast=FastExt.Dialog.toast,window.showAlert=FastExt.Dialog.showAlert,window.showLink=FastExt.Dialog.showLink,window.showCode=FastExt.Dialog.showCode,window.showEditorHtml=FastExt.Dialog.showEditorHtml,window.showException=FastExt.Dialog.showException,window.showJson=FastExt.Dialog.showJson,window.showVideo=FastExt.Dialog.showVideo,window.showImage=FastExt.Dialog.showImage,window.showText=FastExt.Dialog.showText,window.shakeComment=FastExt.Component.shakeComment,window.rotateOSSImgUrl=FastExt.Image.rotateOSSImgUrl,window.showRectangle=FastExt.Map.selRectangleInMap,window.MemoryCache=FastExt.Cache.memory,window.buildUUID8=FastExt.Base.buildUUID8,window.openUrl=FastExt.Base.openUrl,window.server=FastExt.Server},subClass;for(subClass in FastExt.SystemCompat=SystemCompat,FastExt)FastExt[subClass]()}(FastExt=FastExt||{});