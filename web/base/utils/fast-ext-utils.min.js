var FastExt,FastExt,FastExt,FastExt,FastExt,FastExt,FastDefine,FastExt,FastExt,FastEnum,FastExtend,FastExt,FastExt,FastExt,FastExt,FastExt,FastExt,FastExt,FastExt,FastOverrider,FastExt,FastExt,FastExt,FastExt,FastExt;!function(FastExt){var Base=function(){function Base(){}return Base.getOS=function(){try{var t=navigator.userAgent,e="Win32"===navigator.platform||"Windows"===navigator.platform,n="Mac68K"===navigator.platform||"MacPPC"===navigator.platform||"Macintosh"===navigator.platform||"MacIntel"===navigator.platform;if(n)return"Mac";if("X11"===navigator.platform&&!e&&!n)return"Unix";if(-1<String(navigator.platform).indexOf("Linux"))return"Linux";if(e)return-1<t.indexOf("Windows NT 5.0")||-1<t.indexOf("Windows 2000")?"Windows 2000":-1<t.indexOf("Windows NT 5.1")||-1<t.indexOf("Windows XP")?"Windows XP":-1<t.indexOf("Windows NT 5.2")||-1<t.indexOf("Windows 2003")?"Windows 2003":-1<t.indexOf("Windows NT 6.0")||-1<t.indexOf("Windows Vista")?"Windows Vista":-1<t.indexOf("Windows NT 6.1")||-1<t.indexOf("Windows 7")?"Windows 7":-1<t.indexOf("Windows NT 8.0")||-1<t.indexOf("Windows 8")?"Windows 8":-1<t.indexOf("Windows NT 10.0")||-1<t.indexOf("Windows 10")?"Windows 10":"Windows"}catch(t){}return"Other"},Base.toBool=function(t,e){return Ext.isEmpty(e)&&(e=!1),Ext.isEmpty(t)?e:Ext.isString(t)?"0"!==t&&"false"!==t.toLowerCase()&&("1"===t||"true"===t.toLowerCase()||e):Ext.isNumber(t)?0!==t&&(1===t||e):Ext.isBoolean(t)?t:Boolean(t)},Base.copyToBoard=function(t){var e=document.createElement("input");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("Copy"),e.style.display="none",$(e).remove()},Base.copy=function(t){var e={};if(t instanceof Array)e=t.concat();else if(t instanceof Function)e=t;else for(var n in t)e[n]=t[n];return e},Base.loadFunction=function(functionStr){try{if(functionStr.toString().trim().startsWith("function")){var functionKey="do"+$.md5(functionStr);if(Ext.isEmpty(FastExt.Cache.memory[functionKey])){var myScript=document.createElement("script");myScript.type="text/javascript";var code="let "+functionKey+"="+functionStr;try{myScript.appendChild(document.createTextNode(code))}catch(ex){myScript.text=code}document.body.appendChild(myScript),FastExt.Cache.memory[functionKey]=!0}return eval(functionKey)}}catch(e){}return null},Base.download=function(t){var e=t.split("?")[0].substring(t.lastIndexOf("/")),n=document.createElement("a"),i=new MouseEvent("click");n.download="file"+e,n.href=t,n.dispatchEvent(i)},Base.openUrl=function(t,e){Ext.isEmpty(e)&&(e=FastEnum.Target._blank);var n=document.createElement("a");n.click?(n.setAttribute("href",t),n.setAttribute("target",e),n.style.display="none",document.body.appendChild(n),n.click()):window.location.href=t},Base.runCallBack=function(t,e){if(Ext.isFunction(t)&&!t.callBacked){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];t.apply(this,n),t.callBacked=!0}},Base.buildOnlyCode=function(t){t+=Ext.now();return $.md5(t)},Base.getNumberValue=function(t){return parseFloat(t.replace(/[^0-9]/gi,""))},Base.prefixInteger=function(t,e){return(Array(e).join("0")+t).slice(-e)},Base.getSVGIcon=function(t){return'<svg class="svgIcon fileIcon" aria-hidden="true"><use xlink:href="#'+t+'"></use></svg>'},Base.getSVGClassName=function(t){t=t.toString().toLowerCase();var e="extFile";return FastExt.File.isSuffixFile(t,"doc","docx")?e="extFileWord":FastExt.File.isSuffixFile(t,"xls","xlsx")?e="extFileExcel":FastExt.File.isSuffixFile(t,"pdf")?e="extFilePDF":FastExt.File.isSuffixFile(t,"ppt")?e="extFilePPT":FastExt.File.isSuffixFile(t,"zip","rar","gzip")?e="extFileZIP":FastExt.File.isSuffixFile(t,"apk","aar")?e="extFileAPK":FastExt.File.isSuffixFile(t,"jpg","jpeg")?e="extFileJPG":FastExt.File.isSuffixFile(t,"png")?e="extFilePNG":FastExt.File.isSuffixFile(t,"psd")?e="extFilePSD":FastExt.File.isSuffixFile(t,"html","shtml")?e="extFileHTMl":FastExt.File.isSuffixFile(t,"txt")?e="extFileTXT":FastExt.File.isSuffixFile(t,"ipa")&&(e="extFileIOS"),e},Base.guessDateFormat=function(t){return FastExt.Dates.guessDateFormat(t)},Base.parseDate=function(t){return FastExt.Dates.parseDate(t)},Base.getUrlContentType=function(t,n){var i,e;t&&n&&(i=$.md5(t.toString()),(e=FastExt.Cache.getCache(i))?n(e):$.ajax({type:"HEAD",url:t,complete:function(t,e){FastExt.Cache.setCache(i,t.getResponseHeader("content-type")),n(t.getResponseHeader("content-type"))},error:function(){FastExt.Cache.setCache(i,"un-know"),n("un-know")}}))},Base.inputFocusEnd=function(t){try{t.focus();var e,n=t.value.length;document.selection?((e=t.createTextRange()).moveStart("character",n),e.collapse(),e.select()):"number"==typeof t.selectionStart&&"number"==typeof t.selectionEnd&&(t.selectionStart=t.selectionEnd=n)}catch(t){console.error(t)}},Base.randomInt=function(t,e){return t===e?t:Math.floor(Math.random()*(e-t+1)+t)},Base.getTargetElement=function(t){if(t){if(Ext.isElement(t))return t;if(!Ext.isEmpty(t.xtype)&&t.getEl())return t.getEl().dom}return null},Base.getTargetBodyElement=function(t){return t&&!Ext.isEmpty(t.xtype)&&t.body?t.body.dom:this.getTargetElement(t)},Base.isElementInViewport=function(t){try{var e=t.getBoundingClientRect();return e.width<=0&&e.height<=0?!1:0<=e.top&&0<=e.left&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)}catch(t){}return!1},Base.loadCssCode=function(t,e){var n=document.getElementsByTagName("head").item(0),i=document.createElement("style");i.type="text/css",i.styleSheet?i.styleSheet.cssText=t:i.innerHTML=t,null!=e&&e(),n.appendChild(i)},Base.dispatchTargetEvent=function(t,e,n){var i;t.createEvent?((i=t.createEvent("MouseEvents")).initEvent(n,!0,!1),e.dispatchEvent(i)):t.createEventObject&&e.fireEvent("on"+n)},Base.buildUUID4=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},Base.buildUUID8=function(){return(4294967296*(1+Math.random())|0).toString(16).substring(1)},Base.buildUUID12=function(){return FastExt.Base.buildUUID4()+FastExt.Base.buildUUID8()},Base.buildUUID16=function(){return FastExt.Base.buildUUID8()+FastExt.Base.buildUUID8()},Base.getUrlParams=function(t,e){e=new RegExp(e+"=([^&]*)(?:&)?");return t.match(e)&&t.match(e)[1]},Base.toString=function(t,e){return Ext.isEmpty(e)&&(e=t),Ext.isEmpty(t)?e:t.toString()},Base.toPlanParams=function(t){for(var e=[],n=0;n<t.length;n++){var i=t[n];Ext.isString(i)?e.push('"'+i+'"'):e.push(i)}return e.join(",")},Base.getEmptyPromise=function(){return new Ext.Promise(function(t,e){t()})},Base}();FastExt.Base=Base}(FastExt=FastExt||{}),function(i){var t=(e.buttonToMenuItem=function(t){if(t.hidden)return null;var n,e={icon:t.icon,iconCls:t.iconCls,text:t.text,subtext:t.subtext,handler:t.handler,disabled:t.disabled};return null!=t.getMenu()&&(n=[],t.getMenu().items.each(function(t,e){t=i.Button.buttonToMenuItem(t);t&&n.push(t)}),e.menu=n),e},e.buttonToBind=function(n,t){t.checkSelect&&(n.selectButtons||(n.selectButtons=[]),t.setDisabled(!0),n.selectButtons.push(t)),t.checkUpdate&&(n.updateButtons||(n.updateButtons=[]),t.setDisabled(!0),n.updateButtons.push(t)),t.bindDetail&&Ext.isFunction(t.handler)&&(n.bindDetailButtons||(n.bindDetailButtons=[]),n.bindDetailButtons.push(t)),null!=t.getMenu()&&t.getMenu().items.each(function(t,e){i.Button.buttonToBind(n,t)})},e);function e(){}i.Button=t}(FastExt=FastExt||{}),function(t){var e=(n.setCache=function(t,e){try{localStorage.setItem(t,JSON.stringify(e))}catch(t){}},n.getCache=function(t){try{return JSON.parse(localStorage.getItem(t))}catch(t){}return null},n.removeCache=function(t){localStorage.removeItem(t)},n.memory={},n);function n(){}t.Cache=e}(FastExt=FastExt||{}),function(r){var t=(e.toColor=function(t,e){if(Ext.isEmpty(e)&&(e="#FFFFFF"),Ext.isEmpty(t))return e;if(t.toString().startWith("#"))return t.toString();try{t=t.toString().replaceAll(" ","");var n=Ext.ux.colorpick.ColorUtils.parseColor(t);return"#"+Ext.ux.colorpick.ColorUtils.formats.HEX8(n)}catch(t){}return"#"+t},e.showColorPicker=function(i,o,a){return Ext.isEmpty(o)&&(o="#42445a"),new Ext.Promise(function(n,t){function e(){r.Color.loadedPickrJs=!0,Ext.create("Ext.menu.Menu",{showSeparator:!1,layout:"border",padding:"0 0 0 0",style:{background:"#ffffff"},alwaysOnTop:!0,width:250,height:320,listeners:{hide:function(t,e){t.close(),r.Base.runCallBack(n)}},items:[{xtype:"panel",region:"center",margin:"0 0 0 0",border:0,listeners:{afterrender:function(){new Pickr({el:r.Base.getTargetBodyElement(this),theme:"monolith",inline:!0,default:o,showAlways:!0,useAsButton:!0,swatches:["rgba(244, 67, 54, 1)","rgba(233, 30, 99, 0.95)","rgba(156, 39, 176, 0.9)","rgba(103, 58, 183, 0.85)","rgba(63, 81, 181, 0.8)","rgba(33, 150, 243, 0.75)","rgba(3, 169, 244, 0.7)","rgba(0, 188, 212, 0.7)","rgba(0, 150, 136, 0.75)","rgba(76, 175, 80, 0.8)","rgba(139, 195, 74, 0.85)","rgba(205, 220, 57, 0.9)","rgba(255, 235, 59, 0.95)","rgba(255, 193, 7, 1)"],components:{preview:!0,opacity:!0,hue:!0,interaction:{hex:!0,input:!0,rgba:!0}}}).on("change",function(t,e,n){Ext.isFunction(a)&&a(t,e,n)})}}}]}).showBy(i)}r.Color.loadedPickrJs?e():r.System.addScript({src:r.Color.pickrJsPath},function(){r.System.addStylesheet({href:r.Color.pickrThemePath},e)})})},e.pickrJsPath="base/colorpicker/pickr.es5.min.js",e.pickrThemePath="base/colorpicker/monolith.min.css",e);function e(){}r.Color=t}(FastExt=FastExt||{}),function(t){var e=(n.shakeComment=function(i,t,o){if(i){o=o||1080;try{function a(){clearInterval(e),i.setX(s),i.setY(l),Ext.isFunction(t)&&t()}var r=0,s=i.getX(),l=i.getY(),e=setInterval(function(){try{var t=r/180*Math.PI,e=3*Math.sin(t),n=3*Math.cos(t);i.setX(s+e),i.setY(l+n),(r+=90)>o&&a()}catch(t){a()}},30)}catch(t){}}},n.isCenterByContainer=function(t){var e=t.ownerCt;if(Ext.isEmpty(e)&&(e=t.container),e=t.constrain?t.constrainTo:e){var n=parseInt(((e.getWidth()-t.getWidth())/2).toFixed(0)),e=parseInt(((e.getHeight()-t.getHeight())/2).toFixed(0));if(console.log("preX",n,"preY",e),console.log("X",t.x,"Y",t.y),n==t.x&&e==t.y)return!0}return!1},n.isSameByContainer=function(t,e){var n=t.ownerCt;Ext.isEmpty(n)&&(n=t.container),t.constrain&&(n=t.constrainTo);t=e.ownerCt;return Ext.isEmpty(t)&&(t=e.container),e.constrain&&(t=e.constrainTo),!(!n||!t)&&n.id==t.id},n);function n(){}t.Component=e}(FastExt=FastExt||{}),function(F){var t=(e.formatMillisecond=function(t,e){return Ext.Date.format(new Date(t),e)},e.formatDateStr=function(t,e){return Ext.Date.format(F.Dates.parseDate(t),e)},e.guessDateFormat=function(t){if(!t||Ext.isDate(t))return"";t=t.toString().trim();var e=new RegExp("[0-9]{4}-[0-9]{2}-[0-9]{2} [0-9]{2}:[0-9]{2}:[0-9]{2}");return e.test(t)?"Y-m-d H:i:s":(e=new RegExp("[0-9]{4}-[0-9]{2}-[0-9]{2} [0-9]{2}:[0-9]{2}")).test(t)?"Y-m-d H:i":(e=new RegExp("[0-9]{4}-[0-9]{2}-[0-9]{2} [0-9]{2}")).test(t)?"Y-m-d H":(e=new RegExp("[0-9]{4}-[0-9]{2}-[0-9]{2}")).test(t)?"Y-m-d":(e=new RegExp("[0-9]{4}-[0-9]{2}")).test(t)?"Y-m":(e=new RegExp("[0-9]{4}")).test(t)?"Y":(e=new RegExp("[0-9]{4}/[0-9]{2}/[0-9]{2} [0-9]{2}:[0-9]{2}:[0-9]{2}")).test(t)?"Y/m/d H:i:s":(e=new RegExp("[0-9]{4}/[0-9]{2}/[0-9]{2} [0-9]{2}:[0-9]{2}")).test(t)?"Y/m/d H:i":(e=new RegExp("[0-9]{4}/[0-9]{2}/[0-9]{2} [0-9]{2}")).test(t)?"Y/m/d H":(e=new RegExp("[0-9]{4}/[0-9]{2}/[0-9]{2}")).test(t)?"Y/m/d":(e=new RegExp("[0-9]{4}/[0-9]{2}")).test(t)?"Y/m":""},e.parseDate=function(t){if(Ext.isEmpty(t))return null;var e=F.Dates.guessDateFormat(t);return Ext.Date.parse(t,e)},e.showDatePicker=function(E,y,w){return new Ext.Promise(function(o,t){var a=(new Date).getTime();Ext.isEmpty(w)&&(w="Y-m-d H:i:s");for(var e=[],n=0;n<24;n++){var i=F.Base.prefixInteger(n,2);e.push({text:i})}for(var r=[],n=0;n<60;n++){i=F.Base.prefixInteger(n,2);r.push({text:i})}var s=(s=!Ext.isEmpty(y)?Ext.Date.parse(y,F.Dates.guessDateFormat(y)):s)||new Date,l=Ext.Date.format(s,"H"),d=Ext.Date.format(s,"i"),c=Ext.Date.format(s,"s"),u=0,x=-1!==w.indexOf("d"),m=-1!==w.indexOf("H"),g=-1!==w.indexOf("i"),h=-1!==w.indexOf("s");m&&u++,g&&u++,h&&u++;var f={xtype:"datepicker",id:"dateValue"+a,region:"center",showToday:!1,margin:"0 0 0 0",border:0,value:s};x||(f={xtype:"monthpicker",id:"dateValue"+a,region:"center",showButtons:!1,margin:"0 0 0 0",border:0,value:s});var p=Ext.create("Ext.menu.Menu",{showSeparator:!1,layout:"border",padding:"0 0 0 0",style:{background:"#ffffff"},alwaysOnTop:!0,width:330,height:400,listeners:{hide:function(t,e){F.Base.runCallBack(o)}},items:[f,{xtype:"panel",layout:"column",margin:"0 0 0 0",region:"south",border:0,items:[{xtype:"panel",columnWidth:1,layout:"column",border:0,items:[{id:"hourValue"+a,columnWidth:1/u,emptyText:"时",minValue:0,margin:"0 0 0 5",maxValue:23,displayField:"text",valueField:"text",editable:!1,hidden:!m,value:l,store:Ext.create("Ext.data.Store",{autoLoad:!0,data:e}),xtype:"combo"},{xtype:"displayfield",width:30,hidden:!m,value:"<div align='center'>时</div>"},{id:"minuteValue"+a,columnWidth:1/u,emptyText:"分",minValue:0,maxValue:59,displayField:"text",valueField:"text",editable:!1,value:d,hidden:!g,store:Ext.create("Ext.data.Store",{autoLoad:!0,data:r}),xtype:"combo"},{xtype:"displayfield",width:30,hidden:!g,value:"<div align='center'>分</div>"},{id:"secondsValue"+a,columnWidth:1/u,emptyText:"秒",minValue:0,maxValue:59,displayField:"text",valueField:"text",editable:!1,value:c,hidden:!h,store:Ext.create("Ext.data.Store",{autoLoad:!0,data:r}),xtype:"combo"},{xtype:"displayfield",width:30,hidden:!h,value:"<div align='center'>秒</div>"}]},{xtype:"button",columnWidth:1,margin:"5 5 5 5",text:"确定",handler:function(){var t=Ext.getCmp("dateValue"+a),e=Ext.getCmp("hourValue"+a),n=Ext.getCmp("minuteValue"+a),i=Ext.getCmp("secondsValue"+a),t=t.getValue();Ext.isDate(t)?(t.setHours(parseInt(e.getValue())),t.setMinutes(parseInt(n.getValue())),t.setSeconds(parseInt(i.getValue())),F.Base.runCallBack(o,Ext.Date.format(t,w))):((i=new Date).setMonth(t[0]),i.setFullYear(t[1]),i.setDate(1),F.Base.runCallBack(o,Ext.Date.format(i,w))),p.close()}}]}]});p.showBy(E)})},e);function e(){}F.Dates=t}(FastExt=FastExt||{}),function(FastDefine){var EnumComboBox=function(){Ext.define("Fast.ext.EnumComboBox",{alias:["widget.enumcombobox","widget.enumcombo"],extend:"Ext.form.field.ComboBox",enumName:"NONE",enumValue:"id",enumText:"text",exclude:[],include:[],params:{},firstData:null,lastData:null,editable:!1,useCache:!0,searchable:!1,reloadEnum:function(){var t=this;t.setStore(FastExt.Store.getEnumDataStore(t.enumName,t.firstData,t.lastData,t.params,t.useCache,!0))},constructor:function(t){var e=this;e.displayField=FastExt.Base.toString(t.enumText,e.enumText),e.valueField=FastExt.Base.toString(t.enumValue,e.enumValue),e.emptyText="请选择",e.exclude=t.exclude,e.include=t.include,e.store=FastExt.Store.getEnumDataStore(t.enumName,t.firstData,t.lastData,t.params,t.useCache),e.exclude||(e.exclude=[]),e.include||(e.include=[]),e.store.filterBy(function(t){return!e.exclude.exists(t.get(e.enumValue))&&(!(0<e.include.length)||!!e.include.exists(t.get(e.enumValue)))}),this.callParent(arguments)}})};FastDefine.EnumComboBox=EnumComboBox;var FastFileField=function(){Ext.define("Fast.ext.FastFile",{extend:"Ext.form.field.Text",alias:["widget.fastfile","widget.fastfilefield"],fileModules:[],editable:!1,getMenu:function(){return this.up("menu")},onFileChange:function(t){},listeners:{change:function(t,e,n,i){Ext.isEmpty(e)?(t.getTrigger("open").hide(),t.getTrigger("close").hide()):(t.getTrigger("open").show(),t.getTrigger("close").show())},afterrender:function(t){var e=this;this.editable||t.inputEl.on("click",function(){e.selectData()})}},initComponent:function(){for(var t="",e=0;e<this.fileModules.length;e++)t=t+"或"+this.fileModules[e].tipMsg;this.emptyText="请上传"+t.substring(1),this.editable=!1,this.callParent(arguments)},triggers:{open:{cls:"extIcon extEye",hidden:!0,handler:function(){var t=this;if(1===t.fileModules.length){if("images"===t.fileModules[0].type)return t.getMenu()&&(t.getMenu().holdShow=!0),t.blur(),void FastExt.Dialog.showImage(t,t.getValue(),function(){t.getMenu()&&(t.getMenu().holdShow=!1)},!0);if("videos"===t.fileModules[0].type)return void FastExt.Dialog.showVideo(this,t.getValue())}if(t.fileObj){var e=t.fileObj.name;if(FastExt.FileModule.image().match(e))return void FastExt.Dialog.showImage(t,t.getValue(),null,!0);if(FastExt.FileModule.mp4().match(e))return void FastExt.Dialog.showVideo(this,t.getValue());if(FastExt.FileModule.pdf().match(e)||FastExt.FileModule.word().match(e)||FastExt.FileModule.excel().match(e)||FastExt.FileModule.ppt().match(e))return void FastExt.File.officeViewer(t.getValue())}location.href=t.getValue()}},search:{cls:"extIcon extUpload",handler:function(){this.selectData()}},close:{cls:"text-clear",hidden:!0,handler:function(){this.clearData()}}},selectData:function(){var e=this;e.getMenu()&&(e.getMenu().holdShow=!0),FastExt.File.uploadFile(e,e.fileModules).then(function(t){e.getMenu()&&(e.getMenu().holdShow=!1),t&&(e.fileObj=t,e.setValue(t.url),e.onFileChange(t))})},clearData:function(){this.setValue(null)}})};FastDefine.FastFileField=FastFileField;var FastFilesField=function(){Ext.define("Fast.ext.FastFiles",{alias:["widget.fastfiles","widget.fastfilesfield"],extend:"Ext.form.field.Text",editable:!1,fileModules:[],allowBlank:!0,autoUpdate:!1,showFileName:!1,showFileLength:!1,submitArray:!1,getMenu:function(){return this.up("menu")},listeners:{afterrender:function(t){var e=this;this.editable||t.inputEl.on("click",function(){e.showWindow(e)})}},initComponent:function(){for(var t,e="",n=0;n<this.fileModules.length;n++)e=e+"或"+this.fileModules[n].tipMsg;this.emptyText="请上传"+e.substring(1),this.editable=!1,!this.submitArray||(t=this.up("form"))&&t.add({xtype:"hiddenfield",name:this.name+"@JsonArray",value:!0}),this.callParent(arguments)},triggers:{search:{cls:"text-search",handler:function(){this.showWindow(this)}}},showWindow:function(t,e,n){var i=this;FastExt.File.showFiles(this,function(t){i.setValue(t),Ext.isFunction(e)&&e(i)},i.fileModules,i.getValue(),n)}})};FastDefine.FastFilesField=FastFilesField;var ContentField=function(){Ext.define("Fast.ext.Content",{alias:["widget.content","widget.contentfield"],extend:"Ext.form.field.TextArea",height:220,emptyText:"请填写……",allowBlank:!0,getCode:function(){return $.md5(this.getName()+this.dataIndex+this.getFieldLabel())},showWindow:function(t,e,n){Ext.isEmpty(n)&&(n="编辑内容");var i,o,a=this;a.oldValue=a.getValue(),a.editorWin||(i=parseInt((.4*document.body.clientWidth).toFixed(0)),o=parseInt((.6*document.body.clientHeight).toFixed(0)),a.editorWin=Ext.create("Ext.window.Window",{title:n,iconCls:"extIcon extEdit",resizable:!0,maximizable:!0,height:o,width:i,minHeight:500,minWidth:600,layout:"fit",animateTarget:t,items:[a],modal:!0,constrain:!0,closeAction:"hide",listeners:{show:function(t){FastExt.Server.showExtConfig(a.getCode(),"TextEditorCache",function(t,e){t&&(a.setValue(e),FastExt.Dialog.toast("已恢复暂存的数据！"))})}},buttons:[{text:"清除暂存",iconCls:"extIcon extDelete whiteColor",handler:function(){FastExt.Dialog.showWait("正在清除中，请稍后……"),FastExt.Server.deleteExtConfig(a.getCode(),"TextEditorCache",function(t){FastExt.Dialog.hideWait(),t&&FastExt.Dialog.toast("清除成功！")})}},"->",{text:"暂存",iconCls:"extIcon extSave whiteColor",handler:function(){FastExt.Dialog.showWait("暂存中，请稍后……"),FastExt.Server.saveExtConfig(a.getCode(),"TextEditorCache",a.getValue(),function(t,e){FastExt.Dialog.hideWait(),t?FastExt.Dialog.toast("暂存成功！"):FastExt.Dialog.showAlert("系统提醒",e)})}},{text:"重置",iconCls:"extIcon extReset",handler:function(){a.setValue(a.oldValue),FastExt.Server.deleteExtConfig(a.getCode(),"TextEditorCache")}},{text:"确定",iconCls:"extIcon extOk",handler:function(){FastExt.Dialog.showWait("请稍后……"),FastExt.Server.deleteExtConfig(a.getCode(),"TextEditorCache",function(t){FastExt.Dialog.hideWait(),Ext.isFunction(a.editorWin.callBack)&&a.editorWin.callBack(a),a.editorWin.close()})}}]})),a.editorWin.setTitle(n),a.editorWin.callBack=e,a.editorWin.animateTarget=t,a.editorWin.show()}})};FastDefine.ContentField=ContentField;var HtmlContentField=function(){Ext.define("Fast.ext.HtmlContent",{alias:["widget.htmlcontent","widget.htmlcontentfield"],extend:"Ext.form.FieldContainer",height:400,getName:function(){return this.name},autoShowEditor:!0,allowBlank:!0,iframePanel:!0,showEditor:function(){var t=this,e="EditorFrame"+Ext.now();window["editorLoadDone"+e]=function(){t.setValue(t.value),t.setPostImageUrl(FastExt.System.formatUrl("upload?type=editor"))},t.editorFrameId=e;var n=FastExt.System.formatUrlVersion("base/editor/index.html?id="+e);t.update("<iframe id='"+e+"'  src='"+n+"' width='100%' height='100%' frameborder='0' scrolling='no' style='border: 1px solid #d0d0d0;'/>")},listeners:{afterrender:function(t){t.autoShowEditor&&t.showEditor()}},getCode:function(){return $.md5(this.getName()+this.dataIndex+this.getFieldLabel())},isValid:function(){return!0},getValue:function(){var t=this.down("[realValue=true]");return t?t.getValue():this.value},setValue:function(t){var e=this.down("[realValue=true]");return e&&e.setValue(t),this.value=t,this},setHtml:function(t){this.setValue(t)},setPostImageUrl:function(t){var e;!this.editorFrameId||(e=document.getElementById(this.editorFrameId))&&Ext.isFunction(e.contentWindow.getHtmlValue)&&e.contentWindow.setPostImageUrl(t)},initComponent:function(){var n=this;n.items=[{xtype:"textfield",name:n.name,hidden:!0,realValue:!0,fieldLabel:n.fieldLabel,allowBlank:n.allowBlank,validation:"请输入"+n.fieldLabel,isValid:function(){return!(!this.allowBlank&&Ext.isEmpty($(this.getRawValue()).text()))},getRawValue:function(){if(n.editorFrameId){var t=document.getElementById(n.editorFrameId);if(t&&Ext.isFunction(t.contentWindow.getHtmlValue))return t.contentWindow.getHtmlValue()}return null},setValue:function(t){var e;return n.value=t,!n.editorFrameId||(e=document.getElementById(n.editorFrameId))&&Ext.isFunction(e.contentWindow.setHtmlValue)&&e.contentWindow.setHtmlValue(t),this}}],n.callParent(arguments)},showWindow:function(t,e,n){Ext.isEmpty(n)&&(n="编辑内容");var i,o,a=this;a.autoShowEditor=!1,a.oldValue=a.value,a.editorWin||(i=parseInt((.4*document.body.clientWidth).toFixed(0)),o=parseInt((.6*document.body.clientHeight).toFixed(0)),a.editorWin=Ext.create("Ext.window.Window",{title:n,iconCls:"extIcon extEdit",resizable:!0,maximizable:!0,height:o,width:i,minHeight:500,minWidth:600,layout:"fit",animateTarget:t,items:[a],modal:!0,constrain:!0,closeAction:"hide",listeners:{show:function(t){a.showEditor(),FastExt.Server.showExtConfig(a.getCode(),"HtmlEditorCache",function(t,e){t&&(a.setValue(e),FastExt.Dialog.toast("已恢复暂存的数据！"))})}},buttons:[{text:"清除暂存",iconCls:"extIcon extDelete whiteColor",handler:function(){FastExt.Dialog.showWait("正在清除中，请稍后……"),FastExt.Server.deleteExtConfig(a.getCode(),"HtmlEditorCache",function(t){FastExt.Dialog.hideWait(),t&&FastExt.Dialog.toast("清除成功！")})}},"->",{text:"暂存",iconCls:"extIcon extSave whiteColor",handler:function(){FastExt.Dialog.showWait("暂存中，请稍后……"),FastExt.Server.saveExtConfig(a.getCode(),"HtmlEditorCache",a.getValue(),function(t,e){FastExt.Dialog.hideWait(),t?FastExt.Dialog.toast("暂存成功！"):FastExt.Dialog.showAlert("系统提醒",e)})}},{text:"重置",iconCls:"extIcon extReset",handler:function(){a.setValue(a.oldValue),FastExt.Server.deleteExtConfig(a.getCode(),"HtmlEditorCache")}},{text:"确定",iconCls:"extIcon extOk",handler:function(){a.getCode();FastExt.Dialog.showWait("请稍后……"),FastExt.Server.deleteExtConfig(a.getCode(),"HtmlEditorCache",function(t){FastExt.Dialog.hideWait(),Ext.isFunction(a.editorWin.callBack)&&a.editorWin.callBack(a),a.editorWin.close()})}}]})),a.editorWin.setTitle(n),a.editorWin.callBack=e,a.editorWin.animateTarget=t,a.editorWin.show()}})};FastDefine.HtmlContentField=HtmlContentField;var LinkField=function(){function LinkField(){Ext.define("Fast.ext.Link",{alias:["widget.link","widget.linkfield"],extend:"Ext.form.FieldContainer",entityId:null,entityIdDefaultValue:-1,entityText:null,entityCode:null,linkValue:{},editable:!1,allowBlank:!0,layout:"fit",multiSelect:!1,autoDisabled:!0,submitValue:!0,onBeforeSelect:null,onAfterSelect:null,onClearSelect:null,binds:[],isValid:function(){var t=this.down("[name="+this.name+"Display]");return t.allowBlank=this.allowBlank,t.isValid()},getName:function(){return this.name},getValue:function(){return this.submitValue?this.down("[name="+this.name+"]").getValue():this.getText()},getText:function(){return this.down("[name="+this.name+"Display]").getValue()},setRecordValue:function(t){var e=this;if(t&&(!Ext.isEmpty(e.getText())||!Ext.isEmpty(t.get(e.dataIndex)))){if(t.store&&(t.store.holdUpdate=!0),t.set(e.name,e.getValue()),t.set(e.dataIndex,e.getText()),e.record)for(var n=0;n<e.binds.length;n++){var i=e.binds[n].toString().split("@");if(1<i.length)for(var o=i[0],a=e.record.get(o),r=1;r<i.length;r++)t.set(i[r],a)}t.store&&(t.store.holdUpdate=!1,t.store.fireEvent("endupdate"))}},setValue:function(t,e){var n=this;return n.down("[name="+n.name+"Display]").setValue(t),e&&n.setRawValue(e.get(n.name)),t||(n.setRawValue(-1),n.down("[name="+n.name+"MoreFields]").removeAll(!0)),n},setHtml:function(t){this.setValue(t)},setRawValue:function(t,e){var n=this,i=n.down("[name="+n.name+"]");i&&i.setValue(t);var o=n.down("[name="+n.name+"MoreFields]");if(o.removeAll(!0),e)for(var a=0;a<e.length;a++)(s=Ext.create({xtype:"hiddenfield",name:n.name})).setValue(e[a]),o.add(s);if(n.record)for(a=0;a<n.binds.length;a++){var r=n.binds[a].toString().split("@");if(1<r.length)for(var s,l=r[0],d=n.record.get(l),c=1;c<r.length;c++)(s=Ext.create({xtype:"hiddenfield",name:r[c]})).setValue(d),o.add(s)}},getRawValue:function(){var t=this.down("[name="+this.name+"]");return t?t.getValue():null},getMenu:function(){return this.up("menu")},selectData:function(callback){var me=this,entity,entityObj,display,selectTitle;Ext.isFunction(me.onBeforeSelect)&&!me.onBeforeSelect(me)||(me.getMenu()&&(me.getMenu().holdShow=!0),me.entityCode?me.entityId?me.entityText?(entity=FastExt.System.getEntity(me.entityCode),entity?entity.js?(entityObj=eval("new "+me.entityCode+"()"),Ext.isFunction(entityObj.showSelect)?(display=me.down("[name="+me.name+"Display]"),display.blur(),selectTitle=entity.shortName,me.fieldLabel&&(selectTitle=me.fieldLabel),me.labelTitle&&(selectTitle=me.labelTitle),entityObj.showSelect(this,"选择"+selectTitle,me.linkValue.where,me.multiSelect).then(function(t){if(t){if(Ext.isFunction(callback))return void callback(t);if(1===t.length){var e=t[0];me.record=e,me.setValue(e.get(me.entityText)),me.setRawValue(e.get(me.entityId))}else if(1<t.length){me.record=t[0],me.records=t;for(var n="",i=[],o=0;o<t.length;o++){var a=t[o].get(me.entityText);n+="#"+(a=Ext.isEmpty(a)?"无":a),i.push(t[o].get(me.entityId))}me.setRawValue(i[0],i.slice(1)),me.setValue(n.substring(1))}Ext.isFunction(me.onAfterSelect)&&me.onAfterSelect(me)}me.getMenu()&&(me.getMenu().holdShow=!1)})):FastExt.Dialog.showAlert("系统提醒","'"+me.entityCode+"' JS对象不存在函数showSelect(obj,callBack)！",function(){me.getMenu()&&(me.getMenu().holdShow=!1)})):FastExt.Dialog.showAlert("系统提醒","未获取到 '"+me.entityCode+"' JS对象！",function(){me.getMenu()&&(me.getMenu().holdShow=!1)}):FastExt.Dialog.showAlert("系统提醒","未获取到 '"+me.entityCode+"' 实体类！",function(){me.getMenu()&&(me.getMenu().holdShow=!1)})):FastExt.Dialog.showAlert("系统提醒","请配置组件的entityText属性值！",function(){me.getMenu()&&(me.getMenu().holdShow=!1)}):FastExt.Dialog.showAlert("系统提醒","请配置组件的entityId属性值！",function(){me.getMenu()&&(me.getMenu().holdShow=!1)}):FastExt.Dialog.showAlert("系统提醒","请配置组件的entityCode属性值！",function(){me.getMenu()&&(me.getMenu().holdShow=!1)}))},clearData:function(){var t=this;t.setValue(null),t.setRawValue(-1),t.down("[name="+t.name+"MoreFields]").removeAll(!0),Ext.isFunction(t.onClearSelect)&&t.onClearSelect(t)},initComponent:function(){var e=this;!window.getLinkFieldDefaultValue||(t=window.getLinkFieldDefaultValue(e))&&(e.linkValue?e.linkValue=FastExt.Json.mergeJson(e.linkValue,t):e.linkValue=t),e.linkValue||(e.linkValue={},e.linkValue[e.entityId]=e.entityIdDefaultValue,e.linkValue[e.entityText]=null),e.linkValue.hasOwnProperty(e.entityId)||(e.linkValue[e.entityId]=e.entityIdDefaultValue),Ext.isEmpty(e.linkValue[e.entityId])&&(e.linkValue[e.entityId]=e.entityIdDefaultValue),Ext.isEmpty(e.name)&&(e.name="LinkField"+Ext.now());for(var t=(t=e.linkValue[e.entityText])||e.value,n=[],i=0;i<e.binds.length;i++){var o=e.binds[i].toString().split("@");if(1<o.length)for(var a=o[0],r=e.linkValue[a],s=1;s<o.length;s++)n.push({xtype:"hiddenfield",name:o[s],value:r})}e.items=[{xtype:"hiddenfield",name:e.name,value:e.linkValue[e.entityId]},{xtype:"fieldcontainer",name:e.name+"MoreFields",hidden:!0,items:n},{xtype:"textfield",name:e.name+"Display",editable:e.editable,value:t,disabled:null!=e.linkValue[e.entityText]&&e.autoDisabled,hideLabel:!0,fieldLabel:e.fieldLabel,allowBlank:e.allowBlank,emptyText:"请选择",listeners:{afterrender:function(t){this.editable||t.inputEl.on("click",function(){e.selectData()})}},triggers:{close:{cls:"text-clear",handler:function(){e.clearData(),Ext.isFunction(e.onClearValue)&&e.onClearValue()}},search:{cls:"text-search",handler:function(){e.selectData(),this.inputEl.blur()}}}}],e.callParent(arguments)}})}return LinkField}();FastDefine.LinkField=LinkField;var TargetField=function(){Ext.define("Fast.ext.Target",{alias:["widget.target","widget.targetfield"],extend:"Ext.form.FieldContainer",layout:"column",labelWidth:null,targetType:null,targetTypeReadOnly:!1,targetTypeEnum:null,targetId:null,targetValue:{},targetFunction:"getTargetEntity",targetEnumValue:"id",targetEnumText:"text",include:[],exclude:[],getValue:function(){return this.down("[name="+this.targetId+"]").getText()},setValue:function(t,e){var n=this;n.down("[name="+n.targetId+"]").setValue(t),e&&(n.targetValue={},n.targetValue[n.targetType]=e.get(n.targetType),n.targetValue[n.targetId]=e.get(n.targetId),n.holdIdValue=n.getTargetTypeValue()!=e.get(n.targetType),n.setTargetIdValue(e.get(n.targetId)),n.setTargetTypeValue(e.get(n.targetType)))},setHtml:function(t){this.setValue(t)},getSearchField:function(){},setRecordValue:function(t){var e=this;t&&(t.store&&(t.store.holdUpdate=!0),e.targetId&&t.set(e.targetId,e.getTargetIdValue()),e.targetType&&t.set(e.targetType,e.getTargetTypeValue()),e.targetText&&e.targetText!=e.dataIndex&&t.set(e.targetText,e.getValue()),t.set(e.dataIndex,e.getValue()),t.store&&(t.store.holdUpdate=!1,t.store.fireEvent("endupdate")))},setTargetTypeValue:function(t){var e=this.down("[name="+this.targetType+"]");e&&e.setValue(t)},getTargetTypeValue:function(){var t=this.down("[name="+this.targetType+"]");return t?t.getValue():0},setTargetIdValue:function(t){var e=this.down("[name="+this.targetId+"]");e&&e.setRawValue(t)},getTargetIdValue:function(){var t=this.down("[name="+this.targetId+"]");return t?t.getRawValue():-1},getTargetEntity:function(t){var e=window[this.targetFunction](t,this.targetType);return e||(FastExt.Dialog.showAlert("目标组件错误","未获取到TargetType为："+t+"的实体配置！"),null)},showWindow:function(t,e,n){Ext.isEmpty(n)&&(n="编辑目标数据");var i=this;i.editorWin||(i.editorWin=Ext.create("Ext.window.Window",{title:n,height:220,width:400,minWidth:400,minHeight:220,layout:"fit",resizable:!0,modal:!0,constrain:!0,closeAction:"hide",iconCls:"extIcon extLink",items:[i],buttons:[{text:"取消",iconCls:"extIcon extClose",handler:function(){i.editorWin.close()}},{text:"确定",iconCls:"extIcon extOk",handler:function(){i.editorWin.close(),Ext.isFunction(i.editorWin.callBack)&&i.editorWin.callBack(i)}}]})),i.editorWin.setTitle(n),i.editorWin.callBack=e,i.editorWin.animateTarget=t,i.editorWin.show()},initComponent:function(){var o=this,t=o.fieldLabel;Ext.isEmpty(t)&&(t="目标类型"),o.fieldLabel="",o.labelWidth||(o.labelWidth=60),o.labelAlign="right",o.emptyText||(o.emptyText="请填写"),o.margin||(o.margin="5 5 5 5");var e={};if(!Ext.isFunction(window[o.targetFunction]))return FastExt.Dialog.showAlert("目标组件错误","未检测到方法"+o.targetFunction+"!"),void o.callParent(arguments);o.targetValue||(o.targetValue={},o.targetValue[o.targetType]=0,o.targetValue[o.targetId]=-1),o.targetValue[o.targetType]||(o.targetValue[o.targetType]=0),o.targetValue[o.targetId]||(o.targetValue[o.targetId]=-1),o.targetEnum&&(o.targetTypeEnum=o.targetEnum),o.targetTypeEnum||(o.targetTypeEnum=o.targetType.replace(o.targetType[0],o.targetType[0].toUpperCase())+"Enum");var n=o.targetValue[o.targetType],i=o.getTargetEntity(n);i&&(e[i.entityId]=o.targetValue[o.targetId],e[i.entityText]=o.targetValue.targetText,t={name:o.targetType,xtype:"enumcombo",fieldLabel:t,columnWidth:1,value:n,labelWidth:o.labelWidth,labelAlign:o.labelAlign,emptyText:"请选择"+t,margin:o.margin,allowBlank:!1,enumValue:o.targetEnumValue,enumText:o.targetEnumText,readOnly:o.targetTypeReadOnly,enumName:o.targetTypeEnum,exclude:o.exclude,include:o.include,listeners:{change:function(t,e,n){var i=o.getTargetEntity(e);i&&((e=o.down("[name="+o.targetId+"]")).entityCode=i.entityCode,e.entityId=i.entityId,e.entityText=i.entityText,o.holdIdValue?o.holdIdValue=!1:e.setValue(null))}}},e={name:o.targetId,xtype:"linkfield",fieldLabel:"目标数据",columnWidth:1,margin:o.margin,labelWidth:o.labelWidth,labelAlign:o.labelAlign,entityCode:i.entityCode,entityId:i.entityId,entityText:i.entityText,linkValue:e,multiSelect:o.multiSelect},o.items=[t,e],o.callParent(arguments))}})};FastDefine.TargetField=TargetField;var MapField=function(){Ext.define("Fast.ext.Map",{alias:["widget.map","widget.mapfield"],extend:"Ext.form.FieldContainer",lngName:"lnt",latName:"lat",proName:null,cityName:null,areaName:null,editable:!1,emptyText:"请选择",allowBlank:!0,layout:"fit",submitValue:!0,isValid:function(){return this.down("[name="+this.name+"]").isValid()},getName:function(){return this.name},getValue:function(){return this.down("[name="+this.name+"]").getValue()},setValue:function(t,e){var n=this;n.down("[name="+n.name+"]").setValue(t),e&&(n.latName&&n.setLatValue(e.get(n.latName)),n.lngName&&n.setLngValue(e.get(n.lngName)),n.proName&&n.setProValue(e.get(n.proName)),n.cityName&&n.setCityValue(e.get(n.cityName)),n.areaName&&n.setAreaValue(e.get(n.areaName)))},setRecordValue:function(t){var e=this;t&&(t.store&&(t.store.holdUpdate=!0),e.latName&&t.set(e.latName,e.getLatValue()),e.lngName&&t.set(e.lngName,e.getLngValue()),e.proName&&t.set(e.proName,e.getProValue()),e.cityName&&t.set(e.cityName,e.getCityValue()),e.areaName&&t.set(e.areaName,e.getAreaValue()),t.set(e.name,e.getValue()),t.store&&(t.store.holdUpdate=!1,t.store.fireEvent("endupdate")))},setLatValue:function(t){var e=this.down("[name="+this.latName+"]");e&&e.setValue(t)},setLngValue:function(t){var e=this.down("[name="+this.lngName+"]");e&&e.setValue(t)},setProValue:function(t){var e=this.down("[name="+this.proName+"]");e&&e.setValue(t)},setCityValue:function(t){var e=this.down("[name="+this.cityName+"]");e&&e.setValue(t)},setAreaValue:function(t){var e=this.down("[name="+this.areaName+"]");e&&e.setValue(t)},getLatValue:function(){var t=this.down("[name="+this.latName+"]");return t?t.getValue():0},getLngValue:function(){var t=this.down("[name="+this.lngName+"]");return t?t.getValue():0},getProValue:function(){var t=this.down("[name="+this.proName+"]");return t?t.getValue():null},getCityValue:function(){var t=this.down("[name="+this.cityName+"]");return t?t.getValue():null},getAreaValue:function(){var t=this.down("[name="+this.areaName+"]");return t?t.getValue():null},getMenu:function(){return this.up("menu")},selectData:function(){var e=this;e.getMenu()&&(e.getMenu().holdShow=!0),e.down("[name="+e.name+"]").blur(),FastExt.Map.selAddressInMap(e,e.getLngValue(),e.getLatValue(),e.getValue()).then(function(t){t&&(e.setLatValue(t.lat),e.setLngValue(t.lng),e.setProValue(t.pro),e.setAreaValue(t.area),e.setCityValue(t.city),e.setValue(t.addr)),e.getMenu()&&(e.getMenu().holdShow=!1)})},clearData:function(){this.setValue(null),this.setLatValue(0),this.setLngValue(0)},initComponent:function(){var e=this;e.name||(e.name=e.dataIndex),Ext.isEmpty(e.name)&&(e.name="MapField"+Ext.now()),e.items=[{xtype:"hiddenfield",name:e.lngName,value:0},{xtype:"hiddenfield",name:e.latName,value:0},{xtype:"hiddenfield",name:e.proName},{xtype:"hiddenfield",name:e.cityName},{xtype:"hiddenfield",name:e.areaName},{xtype:"textfield",name:e.name,editable:e.editable,fieldLabel:e.fieldLabel,hideLabel:!0,allowBlank:e.allowBlank,emptyText:e.emptyText,listeners:{afterrender:function(t){this.editable||t.inputEl.on("click",function(){e.selectData()})}},triggers:{close:{cls:"text-clear",handler:function(){e.clearData(),Ext.isFunction(e.onClearValue)&&e.onClearValue()}},search:{cls:"text-search",handler:function(){e.selectData(),this.inputEl.blur()}}}}],e.callParent(arguments)}})};FastDefine.MapField=MapField;var PCAField=function(){Ext.define("Fast.ext.PCA",{alias:["widget.pca","widget.pcafield"],extend:"Ext.form.field.Text",proName:null,cityName:null,areaName:null,onAfterSelect:null,level:-1,selectType:0,setRecordValue:function(t,e){var n=this;e=FastExt.Base.toBool(e,!0),t&&(t.store&&(t.store.holdUpdate=!0),n.proName&&n.name!==n.proName&&n.province&&t.set(n.proName,n.province.provinceName),n.cityName&&n.name!==n.cityName&&n.city&&t.set(n.cityName,n.city.cityName),n.areaName&&n.name!==n.areaName&&n.area&&t.set(n.areaName,n.area.areaName),t.set(n.name,n.getValue()),t.store&&(t.store.holdUpdate=!1,t.store.fireEvent("endupdate"))),e&&n.clearData()},getMenu:function(){return this.up("menu")},selectData:function(){var o=this;o.getMenu()&&(o.getMenu().holdShow=!0),Ext.isFunction(window.selectPCA)?(o.blur(),window.selectPCA(o,function(t,e,n,i){FastExt.Base.toBool(t,!1)?(o.province=e,o.area=i,o.city=n,(t=o.up("form"))&&(e&&o.proName&&t.setFieldValue(o.proName,e.provinceName),n&&o.cityName&&t.setFieldValue(o.cityName,n.cityName),i&&o.areaName&&t.setFieldValue(o.areaName,i.areaName)),t="",e&&(t=e.provinceName,o.name===o.proName&&(o.setValue(e.provinceName),t=null)),n&&(t&&(0===o.selectType?t+=" "+n.cityName:t=n.cityName),o.name===o.cityName&&(o.setValue(n.cityName),t=null)),i&&(t&&(0===o.selectType?t+=" "+i.areaName:t=i.areaName),o.name===o.areaName&&(o.setValue(i.areaName),t=null)),t&&o.setValue(t),o.getMenu()&&(o.getMenu().holdShow=!1),Ext.isFunction(o.onAfterSelect)&&o.onAfterSelect(o)):o.getMenu()&&(o.getMenu().holdShow=!1)},o.level)):FastExt.Dialog.showAlert("系统提醒","未检测到函数selectPCA！请导入FastChar-Location插件！",function(){o.getMenu()&&(o.getMenu().holdShow=!1)})},clearData:function(){this.setValue(null),this.province=null,this.area=null,this.city=null},triggers:{close:{cls:"text-clear",handler:function(){this.clearData(),Ext.isFunction(this.onClearValue)&&this.onClearValue()}},search:{cls:"text-search",handler:function(){this.selectData(),this.inputEl.blur()}}},listeners:{afterrender:function(t){var e=this;this.editable||t.inputEl.on("click",function(){e.selectData()})}},initComponent:function(){1==this.level?this.emptyText="请选择省份":2==this.level?0==this.selectType?this.emptyText="请选择省市":this.emptyText="请选择城市":3!=this.level||0==this.selectType?this.emptyText="请选择省市区":this.emptyText="请选择区",this.editable=!1,this.province=null,this.area=null,this.city=null,this.callParent(arguments)}})};FastDefine.PCAField=PCAField;var DateRangeField=function(){Ext.define("Fast.ext.DateRange",{alias:["widget.daterange","widget.daterangefield"],extend:"Ext.form.field.Text",beginDate:null,endDate:null,editable:!0,allowBlank:!0,maxRangeDate:-1,maxRangeMonth:-1,maxRangeYear:-1,layout:"column",format:"Y-m-d",submitValue:!0,onAfterSelect:null,onClearValue:null,getMenu:function(){return this.up("menu")},selectData:function(){var o=this;o.getMenu()&&(o.getMenu().holdShow=!0);var a=Ext.now(),r=Ext.create("Ext.menu.Menu",{floating:!0,items:[{xtype:"panel",padding:"10 10 10 10",layout:"column",style:{background:"#ffffff",borderWidth:1,borderColor:"#ffffff",color:"#eeeee"},border:0,items:[{xtype:"combo",fieldLabel:"快速选择",valueField:"value",labelWidth:60,margin:"5 5 5 5",editable:!1,columnWidth:1,triggers:{close:{cls:"text-clear",handler:function(){this.setValue(null),o.clearData()}}},listeners:{change:function(t,e,n,i){if(e){o.endDate=Ext.Date.format(new Date,o.format),6===e?o.beginDate=Ext.Date.format(new Date,o.format):1===e?o.beginDate=Ext.Date.format(Ext.Date.add(new Date,Ext.Date.DAY,-7),o.format):2===e?o.beginDate=Ext.Date.format(Ext.Date.add(new Date,Ext.Date.MONTH,-1),o.format):3===e?o.beginDate=Ext.Date.format(Ext.Date.add(new Date,Ext.Date.MONTH,-3),o.format):4===e?o.beginDate=Ext.Date.format(Ext.Date.add(new Date,Ext.Date.MONTH,-6),o.format):5===e&&(o.beginDate=Ext.Date.format(Ext.Date.add(new Date,Ext.Date.YEAR,-1),o.format));e=o.refreshValue();if(e)return FastExt.Dialog.toast(e),t.setValue(null),o.clearData(),void FastExt.Component.shakeComment(r);Ext.getCmp("beginDate"+a).setValue(o.beginDate),Ext.getCmp("endDate"+a).setValue(o.endDate)}}},store:Ext.create("Ext.data.Store",{data:[{text:"今天",value:6},{text:"近一周",value:1},{text:"近一个月",value:2},{text:"近三个月",value:3},{text:"近六个月",value:4},{text:"近一年",value:5}]})},{fieldLabel:"开始日期",margin:"5 5 5 5",xtype:"datefield",id:"beginDate"+a,columnWidth:1,labelWidth:60,format:o.format,value:o.beginDate,emptyText:"开始日期"},{fieldLabel:"结束日期",margin:"5 5 5 5",xtype:"datefield",id:"endDate"+a,columnWidth:1,labelWidth:60,format:o.format,value:o.endDate,emptyText:"结束日期"},{xtype:"panel",layout:"hbox",columnWidth:1,border:0,items:[{xtype:"button",text:"确定",margin:"5 5 5 5",flex:.42,handler:function(){var t=Ext.getCmp("beginDate"+a).getValue(),e=Ext.getCmp("endDate"+a).getValue();o.beginDate=Ext.util.Format.date(t,o.format),o.endDate=Ext.util.Format.date(e,o.format),Ext.isEmpty(o.beginDate)&&(o.beginDate=Ext.Date.format(new Date(0),o.format)),Ext.isEmpty(o.endDate)&&(o.endDate=Ext.Date.format(new Date,o.format));e=o.refreshValue();if(e)return FastExt.Dialog.toast(e),void FastExt.Component.shakeComment(r);Ext.isFunction(o.onAfterSelect)&&o.onAfterSelect(o),r.close()}}]}]}]});r.setWidth(Math.max(this.getWidth(),200)),r.showBy(this,"tl-bl?")},clearData:function(){this.setValue(null),this.beginDate=null,this.endDate=null},refreshValue:function(){var t=this;t.setValue(null);var e=Ext.Date.parse(t.beginDate,t.format),n=Ext.Date.parse(t.endDate,t.format);if(n<e)return t.clearData(),"开始日期必须小于等于结束日期！";if(0<t.maxRangeDate){var i=Ext.Date.add(e,Ext.Date.DAY,t.maxRangeDate);if(!Ext.Date.between(n,e,i))return t.clearData(),"日期范围区间必须在"+t.maxRangeDate+"天以内！"}if(0<t.maxRangeMonth){i=Ext.Date.add(e,Ext.Date.MONTH,t.maxRangeMonth);if(!Ext.Date.between(n,e,i))return t.clearData(),"日期范围区间必须在"+t.maxRangeMonth+"个月以内！"}if(0<t.maxRangeYear){i=Ext.Date.add(e,Ext.Date.YEAR,t.maxRangeYear);if(!Ext.Date.between(n,e,i))return t.clearData(),"日期范围区间必须在"+t.maxRangeYear+"年以内！"}return t.setValue(t.beginDate+" 至 "+t.endDate),Ext.Date.isEqual(e,n)&&t.setValue("今天"),null},triggers:{close:{cls:"text-clear",handler:function(){this.clearData(),Ext.isFunction(this.onClearValue)&&this.onClearValue()}},search:{cls:"text-search",handler:function(){this.selectData(),this.inputEl.blur()}}},initComponent:function(){this.editable=!1,this.refreshValue(),this.callParent(arguments)}})};FastDefine.DateRangeField=DateRangeField;var DateField=function(){Ext.define("Fast.ext.Date",{alias:["widget.date","widget.datefield"],extend:"Ext.form.field.Text",format:"Y-m-d H:i:s",strict:!0,firstValue:null,getMenu:function(){return this.up("menu")},isValid:function(){var t=this;if(t.callParent(arguments)){if(!Ext.isEmpty(t.getValue()))if(!Ext.Date.parse(t.getValue(!0),this.format))return t.invalidText="日期格式错误！格式必须为："+this.format,t.markInvalid(this.invalidText),!1;return!0}return!1},setValue:function(t){var e,n=this;return Ext.isEmpty(n.firstValue)&&(n.firstValue=t),Ext.isEmpty(t)||(e=FastExt.Base.guessDateFormat(t),e=Ext.Date.parse(t,e),arguments[0]=Ext.Date.format(e,n.format)),n.callParent(arguments),n},getValue:function(t){var e=this,n=e.callParent(arguments);if(!FastExt.Base.toBool(t,!1)&&!Ext.isEmpty(e.firstValue)){if(e.firstValue===n)return e.firstValue;var i=FastExt.Base.parseDate(n),o=FastExt.Base.parseDate(e.firstValue);if(i&&o&&Ext.Date.format(i,e.format)===Ext.Date.format(o,e.format))return e.firstValue}if(e.strict&&!FastExt.Base.toBool(t,!1)){e=FastExt.Base.guessDateFormat(n);if("Y-m"===e)return n+"-01";if("Y/m"===e)return n+"/01";if("Y"===e)return n+"-01-01"}return n},selectData:function(){var e=this;null!=e.getMenu()&&(e.getMenu().holdShow=!0),FastExt.Dialog.showFastDatePicker(e.bodyEl,e.getValue(),this.format).then(function(t){null!=e.getMenu()&&(e.getMenu().holdShow=!1),t&&e.setValue(t)})},endEdit:function(){this.firstValue=null},triggers:{search:{cls:"x-form-date-trigger",handler:function(){this.selectData()}}},listeners:{afterrender:function(t){var e=this;this.editable||t.inputEl.on("click",function(){e.selectData()})}},initComponent:function(){this.callParent(arguments)}})};FastDefine.DateField=DateField;var ColorField=function(){Ext.define("Fast.ext.ColorField",{extend:"Ext.form.field.Text",alias:["widget.colorfield"],editable:!1,getMenu:function(){return this.up("menu")},beforeBodyEl:['<div class="'+Ext.baseCSSPrefix+'colorpicker-field-swatch"><div id="{id}-swatchEl" data-ref="swatchEl" class="'+Ext.baseCSSPrefix+'colorpicker-field-swatch-inner"></div></div>'],cls:Ext.baseCSSPrefix+"colorpicker-field",childEls:["swatchEl"],setValue:function(t){return this.swatchEl&&this.swatchEl.setStyle("background",t),this.callParent(arguments),this},triggers:{search:{cls:"extIcon extSearch",handler:function(){this.selectData()}}},selectData:function(){var e=this;null!=e.getMenu()&&(e.getMenu().holdShow=!0),FastExt.Dialog.showFastColorPicker(e.inputEl,e.getValue(),function(t){e.setValue(t.toRGBA().toString(0))}).then(function(t){null!=e.getMenu()&&(e.getMenu().holdShow=!1)})},clearData:function(){this.setValue(null)},initComponent:function(){var e=this;e.callParent(arguments),e.on("render",function(){var t=FastExt.Color.toColor(e.getValue(),"#00000000");e.setValue(t)})}})},subClass;for(subClass in FastDefine.ColorField=ColorField,FastDefine)FastDefine[subClass]()}(FastDefine=FastDefine||{}),function(s){var t=(e.showWait=function(t){Ext.MessageBox.show({alwaysOnTop:!0,modal:!0,title:"系统提醒",msg:t,progressText:"请耐心等待，即将完成操作",progress:!0,closable:!1});var e=0,n=function(){Ext.MessageBox.isHidden()||(130===(e+=.5)&&(e=0),Ext.MessageBox.updateProgress(e/100,"请耐心等待，即将完成操作"),setTimeout(n,5))};setTimeout(n,5)},e.hideWait=function(){Ext.MessageBox.isVisible()&&Ext.MessageBox.hide()},e.toast=function(t){var e=parseInt((.7*document.body.clientWidth).toFixed(0));Ext.toast({html:t,closable:!0,align:"t",slideInDuration:200,slideBackDuration:200,minWidth:180,maxWidth:e,slideBackAnimation:"easeOut",iconCls:"extIcon extInfo",title:"消息提示"})},e.showHtml=function(t,e,n){var i=parseInt((.4*document.body.clientWidth).toFixed(0)),o=parseInt((.6*document.body.clientHeight).toFixed(0));Ext.create("Ext.window.Window",{title:e,layout:"fit",height:o,width:i,minHeight:500,minWidth:600,constrain:!0,resizable:!0,maximizable:!0,modal:!0,maximized:!1,iconCls:"extIcon extSee",draggable:!0,scrollable:!0,html:n,alwaysOnTop:!0,toFrontOnShow:!0}).show()},e.showLink=function(t,e,n,i){var o=parseInt((.4*document.body.clientWidth).toFixed(0)),a=parseInt((.6*document.body.clientHeight).toFixed(0)),r=Ext.create("Ext.panel.Panel",{layout:"border",region:"center",border:0,iframePanel:!0,listeners:{afterrender:function(t,e){this.setLoading("正在努力加载中，请稍后……"),this.update("<iframe onload='iFrameLoadDone()' src='"+n+"'  width='100%' height='100%' frameborder='0'>")}}});window.iFrameLoadDone=function(){r.setLoading(!1)},Ext.create("Ext.window.Window",s.Json.mergeJson({title:e,layout:"fit",height:a,width:o,minHeight:500,minWidth:600,resizable:!0,maximizable:!0,modal:!0,constrain:!0,maximized:!1,iconCls:"extIcon extSee",draggable:!0,scrollable:!1,alwaysOnTop:!0,toFrontOnShow:!0,items:[r],listeners:{close:function(){window.iFrameLoadDone=null}}},i)).show()},e.showEditorHtml=function(t,e,i,n){var o=parseInt((.4*document.body.clientWidth).toFixed(0)),a=parseInt((.6*document.body.clientHeight).toFixed(0)),r=Ext.create("Ext.panel.Panel",{layout:"border",region:"center",border:0,iframePanel:!0,listeners:{afterrender:function(t,e){var n=s.System.formatUrlVersion("base/editor/show.html");window.showEditorDone=function(){window.showEditorFrame.window.showContent(i)},this.update("<iframe name='showEditorFrame' src='"+n+"'  width='100%' height='100%' frameborder='0'>")}}});Ext.create("Ext.window.Window",{title:e,layout:"fit",height:a,width:o,minHeight:500,minWidth:600,resizable:!0,maximizable:!0,modal:!0,constrain:!0,maximized:!1,iconCls:"extIcon extSee",draggable:!0,scrollable:!1,alwaysOnTop:!0,toFrontOnShow:!0,items:[r]}).show()},e.showText=function(t,e,n,i){var o=parseInt((.4*document.body.clientWidth).toFixed(0)),a=parseInt((.6*document.body.clientHeight).toFixed(0));Ext.isEmpty(e)&&(e="extIcon extSee"),Ext.create("Ext.window.Window",{title:n,icon:e,iconCls:e,maximizable:!0,height:a,width:o,minHeight:500,minWidth:600,resizable:!0,layout:"fit",animateTarget:t,items:[{xtype:"textarea",value:i}],modal:!0,constrain:!0,alwaysOnTop:!0}).show()},e.showCode=function(e,n,t,i){try{e&&e.blur(),Ext.isEmpty(i)&&(i="");var o=parseInt((.4*document.body.clientWidth).toFixed(0)),a=parseInt((.6*document.body.clientHeight).toFixed(0)),r=Ext.create("Ext.window.Window",{title:"查看内容",height:a,width:o,minHeight:500,minWidth:600,animateTarget:e,resizable:!0,layout:"fit",maximizable:!0,iconCls:"extIcon extSee",autoScroll:!0,modal:!0,constrain:!0,bodyStyle:{background:"#000000"},listeners:{show:function(t){PR.prettyPrint()}}});t?r.update("<pre class='prettyprint "+i+" linenums windowpre'>"+n+"</pre>"):r.update("<pre class='prettyprint "+i+" windowpre'>"+n+"</pre>"),r.show()}catch(t){s.Dialog.showText(e,null,"查看内容",n)}},e.showSql=function(e,n){try{n=sqlFormatter.format(n),s.Dialog.showCode(e,n,!1,"lang-sql")}catch(t){s.Dialog.showText(e,null,"查看内容",n)}},e.showException=function(t,e){var n,i;t&&(s.Dialog.hideWait(),(n=t)instanceof Error&&(n=(n=t.stack).replace(/\n/g,"<br/>").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;").replace(/ /g,"&nbsp;&nbsp;")),null!=e?e+="，来自"+e:e="",s.System.getExt("debug").value&&(i=Ext.create("Ext.window.Window",{title:"系统异常",height:180,width:270,layout:"fit",resizable:!1,maximizable:!1,constrain:!0,fixed:!0,modal:!0,draggable:!1,iconCls:"extIcon extError",html:"<div  style='padding:15px;background: #fff;' align='center'>【"+e+"】系统发生异常，请及时告知系统管理员！</div>",buttons:[{text:"下次再说",flex:1,handler:function(){i.close()}},{text:"查看错误",flex:1,handler:function(){s.Dialog.showCode(this,n,!0)}}]})).show(),console.error(t))},e.showAlert=function(t,e,n,i){Ext.isEmpty(i)&&(i=!0),Ext.MessageBox.show({title:t,message:e,modal:i,defaultFocus:1,buttons:Ext.MessageBox.OK,fn:n,minWidth:250})},e.showImage=function(t,e,n,i){s.Image.showImage(t,e,n,i)},e.showVideo=function(t,e){t&&t.blur(),Ext.create("Ext.window.Window",{title:"播放视频",layout:"fit",height:600,width:700,resizable:!1,constrain:!0,maximizable:!1,modal:!0,maximized:!1,iconCls:"extIcon extSee",draggable:!0,scrollable:!1,alwaysOnTop:!0,toFrontOnShow:!0,listeners:{show:function(){var t=s.System.formatUrlVersion("base/video/player.html");window.getVideoUrl=function(){return e},this.update("<iframe allowfullscreen='allowfullscreen' mozallowfullscreen='mozallowfullscreen' msallowfullscreen='msallowfullscreen' oallowfullscreen='oallowfullscreen' webkitallowfullscreen='webkitallowfullscreen' style='background-color: black;' name='showVideoFrame' src='"+t+"'  width='100%' height='100%' frameborder='0' scrolling='no' >")}}}).show()},e.showEditor=function(t,e,n){t&&t.blur();var i="PublicTextArea"+(new Date).getTime(),o=parseInt((.4*document.body.clientWidth).toFixed(0)),a=parseInt((.6*document.body.clientHeight).toFixed(0)),r=Ext.create("Ext.window.Window",{title:e,iconCls:"extIcon extEdit",resizable:!0,maximizable:!0,height:a,width:o,minHeight:500,minWidth:600,layout:"fit",animateTarget:t,items:[{id:i,emptyText:"请输入内容……",xtype:"textarea"}],modal:!0,constrain:!0,closeAction:"hide",listeners:{show:function(t){s.Server.showExtConfig("PublicEditor","TextEditorCache",function(t,e){t&&Ext.getCmp(i).setValue(e),Ext.getCmp(i).focus()})}},buttons:[{text:"暂存",iconCls:"extIcon extSave whiteColor",handler:function(){s.Dialog.showWait("暂存中，请稍后……"),s.Server.saveExtConfig("PublicEditor","TextEditorCache",Ext.getCmp(i).getValue(),function(t,e){s.Dialog.hideWait(),t?s.Dialog.toast("暂存成功！"):s.Dialog.showAlert("系统提醒",e)})}},{text:"重置",iconCls:"extIcon extReset",handler:function(){Ext.getCmp(i).setValue(null),s.Server.deleteExtConfig("PublicEditor","TextEditorCache")}},{text:"确定",iconCls:"extIcon extOk",handler:function(){s.Dialog.showWait("请稍后……"),s.Server.deleteExtConfig("PublicEditor","TextEditorCache",function(t){s.Dialog.hideWait(),Ext.isFunction(n)&&n(Ext.getCmp(i).getValue()),r.close()})}}]});r.show()},e.showJson=function(t,e,n){s.Json.showFormatJson(t,n,e)},e.showFormatJson=function(t,e){s.Json.showFormatJson(t,e)},e.showLottie=function(t,e){s.Lottie.showLottie(t,e)},e.showFastDatePicker=function(t,e,n){return s.Dates.showDatePicker(t,e,n)},e.showFastColorPicker=function(t,e,n){return s.Color.showColorPicker(t,e,n)},e.showMusic=function(t,e){t&&t.blur();var i=(new Date).getTime();Ext.create("Ext.window.Window",{title:"播放音频",layout:"fit",height:230,width:700,resizable:!1,constrain:!0,maximizable:!1,modal:!0,maximized:!1,iconCls:"extIcon extSee",draggable:!0,scrollable:!1,alwaysOnTop:!0,toFrontOnShow:!0,items:[{xtype:"panel",layout:"border",iframePanel:!0,itemId:"playerPanel",listeners:{afterrender:function(t,e){this.setLoading("加载音频文件中，请稍后……");var n=s.System.formatUrlVersion("base/music/player.html");this.update("<iframe allowfullscreen='allowfullscreen' mozallowfullscreen='mozallowfullscreen' msallowfullscreen='msallowfullscreen' oallowfullscreen='oallowfullscreen' webkitallowfullscreen='webkitallowfullscreen' style='background-color: black;' name='showMusicFrame' src='"+n+"'  width='100%' height='100%' frameborder='0' scrolling='no' >")}}}],listeners:{show:function(n){window.getMusicUrl=function(){return e},window.onMusicChange=function(t,e){"ready"===t?(n.getComponent("playerPanel").setLoading(!1),e.play()):"play"===t?Ext.getCmp("btnPlay"+i).setIconCls("extIcon extPause"):"pause"===t?Ext.getCmp("btnPlay"+i).setIconCls("extIcon extPlay"):"finish"===t?e.seekTo(0):"mute"===t?e.getMute()?Ext.getCmp("btnMute"+i).setIconCls("extIcon extMute"):Ext.getCmp("btnMute"+i).setIconCls("extIcon extUnmute"):"loading"===t?n.getComponent("playerPanel").setLoading("加载音频文件中，请稍后……"):"audioprocess"!==t&&"seek"!==t||(t=s.Dates.formatMillisecond(1e3*e.getCurrentTime(),"i:s"),e=s.Dates.formatMillisecond(1e3*e.getDuration(),"i:s"),n.setTitle("播放音乐  "+t+" / "+e))}}},bbar:{xtype:"toolbar",dock:"bottom",layout:{type:"hbox",align:"middle",pack:"center"},items:[{xtype:"button",id:"btnPlay"+i,iconCls:"extIcon extPlay",action:"play",handler:function(){window.showMusicFrame.window.switchPlay()}},{xtype:"button",id:"btnStop"+i,iconCls:"extIcon extStop",handler:function(){window.showMusicFrame.window.stop()}},{xtype:"button",id:"btnMute"+i,iconCls:"extIcon extUnmute",handler:function(){window.showMusicFrame.window.switchMute()}}]}}).show()},e);function e(){}s.Dialog=t}(FastExt=FastExt||{}),function(r){var t=(e.loadECharts=function(o,a){function t(){if(o.echarts)return o.echarts.hideLoading(),void o.echarts.setOption(a);var t,e,n,i=r.Base.getTargetBodyElement(o);i?(n="",Ext.isEmpty(r.ECharts.echartsThemeFile)&&(t=r.ECharts.echartsThemeFile.lastIndexOf("/"),e=r.ECharts.echartsThemeFile.lastIndexOf("."),n=r.ECharts.echartsThemeFile.substring(t+1,e)),o.echarts=echarts.init(i,n),o.echarts.setOption(a),o.on("destroy",function(t){r.ECharts.getECharts(t)&&(r.ECharts.getECharts(t).dispose(),t.echarts=null)}),o.on("resize",function(t){r.ECharts.getECharts(t)&&r.ECharts.getECharts(t).resize({animation:{duration:1e3}})})):console.error("加载ECharts失败！无法获取目标控件的BodyElement！")}this.loadedEChartsJs?t():r.System.addScript({src:r.ECharts.echartsJsFile},function(){Ext.isEmpty(r.ECharts.echartsThemeFile)?t():r.System.addScript({src:r.ECharts.echartsThemeFile},t)})},e.getECharts=function(t){return t.echarts||(console.error("获取ECharts失败！目标控件未加载echarts！"),null)},e.hasECharts=function(t){return!!t.echarts},e.showECharts=function(t,e){var n=parseInt((.6*document.body.clientWidth).toFixed(0)),i=parseInt((.7*document.body.clientHeight).toFixed(0));Ext.create("Ext.window.Window",{title:t,height:i,width:n,layout:"border",resizable:!0,maximizable:!0,constrain:!0,modal:!0,padding:"10 10 10 10",bodyStyle:{background:"#ffffff"},listeners:{show:function(t){r.ECharts.loadECharts(t,e)}}}).show()},e.echartsJsFile="base/echarts/echarts.min.js",e.echartsThemeFile="",e);function e(){}r.ECharts=t}(FastExt=FastExt||{}),function(t){var e;(e=t.Target||(t.Target={}))._blank="_blank",e._self="_self",e._parent="_parent",e._top="_top",e.framename="framename",(e=t.AppendPosition||(t.AppendPosition={})).left="left",e.right="right",(e=t.ComputeType||(t.ComputeType={})).sum="sum",e.avg="avg",e.min="min",e.max="max",(e=t.HelpEnumType||(t.HelpEnumType={}))[e.mouse_right_click=0]="mouse_right_click",e[e.mouse_in_out=1]="mouse_in_out",(e=t.TooltipAnchorType||(t.TooltipAnchorType={})).left="left",e.top="top",e.right="right",e.bottom="bottom",(t=t.PowerType||(t.PowerType={})).gridcolumn="gridcolumn",t.button="button",t.menuitem="menuitem"}(FastEnum=FastEnum||{}),function(t){for(var e in t.StringExtend=function(){String.prototype.endWith=function(t){return!(!t||""===t||0===this.length||t.length>this.length)&&this.substring(this.length-t.length)===t},String.prototype.startWith=function(t){return!(!t||""===t||0===this.length||t.length>this.length)&&this.substr(0,t.length)===t},String.prototype.firstUpperCase=function(){return this.replace(/^\S/,function(t){return t.toUpperCase()})},String.prototype.truthLength=function(){return this.replace(/[\u0391-\uFFE5]/g,"aa").length},String.prototype.trimAllSymbol=function(){return this.replace(/[\ |\~|\`|\!|\@|\#|\$|\%|\^|\&|\*|\(|\)|\-|\_|\+|\=|\||\\|\[|\]|\{|\}|\;|\:|\"|\'|\,|\<|\.|\>|\/|\?/\，/\。/\；/\：/\“/\”/\》/\《/\|/\{/\}/\、/\!/\~/\`]/g,"")},String.prototype.replaceAll=function(t,e){return this.replace(new RegExp(t,"g"),e)}},t.ArrayExtend=function(){Array.prototype.exists=function(t){for(var e=0;e<this.length;e++)if(this[e]===t)return!0;return!1}},t.ComponentExtend=function(){this.iframePanel=!1,this.helpAnchorOffset=-1},t.ButtonExtend=function(){this.contextMenu=!0,this.bindDetail=!1},t.GridExtend=function(){this.tabPanelList=!1,this.firstLoadedData=!1,this.defaultToolBar=!0,this.defaultToolBarLink=!0,this.defaultToolBarMore=!0},t.FormPanelExtend=function(){Ext.form.FormPanel.prototype.setFieldValue=function(t,e){this.getForm().findField(t).setValue(e)},Ext.form.FormPanel.prototype.getFieldValue=function(t){return this.getForm().findField(t).getValue()},Ext.form.FormPanel.prototype.getField=function(t){return this.getForm().findField(t)},Ext.form.FormPanel.prototype.submitForm=function(o,a,r,s,l){var d=this;return a=a||{},r=r||"正在提交中……",Ext.isEmpty(s)&&(s=!0),Ext.isEmpty(l)&&(l=!0),d.submiting?new Ext.Promise(function(t,e){e({success:!1,message:"数据正在提交中，不可重复提交！"})}):new Ext.Promise(function(n,i){var t={submitEmptyText:!1,waitMsg:r,params:a,success:function(t,e){d.submiting=!1,s?Ext.Msg.alert("系统提醒",e.result.message,function(t){"ok"===t&&n(e.result)}):n(e.result)},failure:function(t,e){d.submiting=!1,l&&Ext.Msg.alert("系统提醒",e.result.message),i(e.result)}};o&&(t.params.entityCode=o.entityCode,o.menu&&(t.params.menu=FastExt.Store.getStoreMenuText({entity:o})));var e=d.getForm();e.isValid()?(d.submiting=!0,e.submit(t)):(d.submiting=!1,i({success:!1,message:"表单填写不完整！"}))})},Ext.form.FormPanel.prototype.saveCache=function(t){Ext.isEmpty(t)&&(t=this.cacheKey);var n={};this.getForm().getFields().each(function(t,e){Ext.isDate(t.getValue())?n[t.getName()]=Ext.Date.format(t.getValue(),t.format):n[t.getName()]=t.getValue()});t={configKey:t,configType:"FormPanelCache",configValue:Ext.encode(n)};FastExt.Dialog.showWait("暂存数据中……"),$.post("ext/config/saveExtConfig",t,function(t){FastExt.Dialog.hideWait(),t.success?FastExt.Dialog.toast("暂存成功！"):FastExt.Dialog.showAlert("系统提醒",t.message)})},Ext.form.FormPanel.prototype.restoreCache=function(t){Ext.isEmpty(t)&&(t=this.cacheKey);var e=this;$.post("ext/config/showExtConfig",{configKey:t,configType:"FormPanelCache"},function(t){var n;t.success&&(n=Ext.decode(t.data.configValue),e.getForm().getFields().each(function(t,e){n.hasOwnProperty(t.getName())&&t.setValue(n[t.getName()])}))})},Ext.form.FormPanel.prototype.deleteCache=function(t){Ext.isEmpty(t)&&(t=this.cacheKey),$.post("ext/config/deleteExtConfig",{configKey:t,configType:"FormPanelCache"},function(t){})}},t.FileFieldExtend=function(){this.multiple=!1},t.FieldExtend=function(){this.fromHeadSearch=!1,Ext.form.field.Base.prototype.blur=function(){try{this.inputEl&&this.inputEl.blur()}catch(t){console.error(t)}}},t.TextFieldExtend=function(){this.useHistory=!1},t.ComboBoxFieldExtend=function(){this.searchable=!1},t.ColumnExtend=function(){this.search=!0},t.MenuExtend=function(){this.holdShow=!1},t.EntityExtend=function(){this.actionDeleteAll=!0,this.actionCopy=!0,this.actionTimer=!0},t)t[e]()}(FastExtend=FastExtend||{}),function(p){var t=(e.formatLength=function(t){return t<1024?t+"B":t<1048576?(t/1024).toFixed(2)+"KB":(t/1024/1024).toFixed(2)+"M"},e.isSuffixFile=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var i=t.substring(t.lastIndexOf("/")+1).toString().toLowerCase(),o=0;o<e.length;o++){var a=e[o].replace(".","").toLowerCase();if(i.endWith("."+a)||i.startWith(a+"-"))return!0}return!1},e.officeViewer=function(t){p.Base.openUrl("officeViewer?url="+t)},e.uploadFile=function(c,u,x,m){return new Ext.Promise(function(a,t){var r,n,s,e="上传文件",i="files",o=-1,l=-1,d="file";p.FileModule.validate(u,"fileModules")&&(1===u.length&&(e="上传"+u[0].tipMsg,i=u[0].type,o=u[0].width,l=u[0].height),Ext.isEmpty(m)&&(m=!0),c&&(c.name&&(d=c.name),c.dataIndex&&(d=c.dataIndex)),r=Ext.create("Ext.form.FormPanel",{url:"upload",method:"POST",margin:"5",fileUpload:!0,width:400,callBacked:!1,border:0,layout:"column",items:[{xtype:"filefield",fieldLabel:e,labelWidth:60,labelAlign:"right",buttonText:"选择文件",allowBlank:!1,name:d,multiple:x,columnWidth:1,listeners:{change:function(t,e,n){if(null!=e&&0!==e.length){for(var i="",o=0;o<u.length;o++){var a=u[o];if(a.match(e))return void r.doSubmit();i=i+"或"+a.tipMsg}r.form.reset(),Ext.Msg.alert("系统提醒","请上传有效的"+i.substring(1))}}}},{xtype:"hiddenfield",name:"type",value:i},{xtype:"hiddenfield",name:"file.width",value:o},{xtype:"hiddenfield",name:"file.height",value:l}],doSubmit:function(){var n,i,o=r.form;o.isValid()&&((n=new Ext.LoadMask({msg:"正在上传附件中…",target:s})).show(),(i=function(e){var t;e>=u.length?o.submit({success:function(t,e){p.Dialog.toast("文件上传成功！"),a.called||(a.called=!0,a(e.result.data)),s.close()},failure:function(t,e){n.destroy(),Ext.Msg.alert("系统提醒","上传失败！"+e.result.message)}}):(t=u[e],Ext.isFunction(t.onFileSelect)?t.onFileSelect(r.getForm().findField(d)).then(function(t){Ext.isEmpty(t)?i(e+1):(n.destroy(),r.form.reset(),Ext.Msg.alert("系统提醒",t))}):i(e+1))})(0))},listeners:{render:function(t){try{new Ext.util.KeyMap({target:t.getEl(),key:13,fn:r.doSubmit,scope:Ext.getBody()})}catch(t){console.error(t)}}}}),n="btnSubmit"+(new Date).getTime(),(s=Ext.create("Ext.window.Window",{title:e,layout:"fit",resizable:!1,scrollable:!1,width:500,items:r,modal:!0,iconCls:"extIcon extUpload",animateTarget:c,constrain:!0,buttons:[{text:"使用地址",iconCls:"extIcon extEdit",hidden:!m,handler:function(){Ext.Msg.prompt("使用自定义的文件地址","填写自定义的文件路径（http）：",function(t,e){"ok"===t&&(Ext.isEmpty(e)||(a.called||(a.called=!0,a({url:e})),s.close()))})}},{text:"网络同步",iconCls:"extIcon extLink",handler:function(){Ext.Msg.prompt("从网络中下载文件","填写网络文件路径（http）：",function(t,e){"ok"===t&&(p.Dialog.showWait("正在同步中，请稍后……"),$.post("upload",{url:e,__accept:"application/json"},function(t){p.Dialog.hideWait(),t.success?(p.Dialog.toast("文件上传成功！"),a.called||(a.called=!0,a(t.data)),s.close()):Ext.Msg.alert("系统提醒","上传失败！"+t.message)}))})}},"->",{text:"重置",width:88,iconCls:"extIcon extReset",handler:function(){r.form.reset()}},{text:"上传",width:88,id:n,iconCls:"extIcon extOk",handler:function(){r.doSubmit()}}],listeners:{show:function(t,e){r.getForm().findField(d).fileInputEl.dom.click(),Ext.getCmp(n).focus()},close:function(t,e){a.called||(a.called=!0,a())}}})).show())})},e.showFiles=function(o,t,e,n,i){if(p.FileModule.validate(e,"fileModules")){o&&o.blur();var a=[],r=p.Renders.file();if(i=i||"文件管理",!Ext.isEmpty(n)){var s=n;Ext.isString(n)&&(s=Ext.JSON.decode(n));for(var l=0;l<s.length;l++){var d=s[l].split("@"),c=d[0],u=c.substring(c.lastIndexOf("/")+1),x=-1;1<d.length&&(u=d[1]),2<d.length&&(x=d[2]),a.push({url:c,name:u,length:x})}}1===e.length&&(r=e[0].renderer,i=e[0].tipMsg+"管理");n=[];n.push({header:"文件",dataIndex:"url",flex:1,align:"center",renderer:r}),o.showFileName&&(n.push({header:"文件名",dataIndex:"name",width:150,align:"center",field:{xtype:"textfield",listeners:{change:function(){g.modify=!0}}},renderer:p.Renders.normal()}),o.showFileLength&&n.push({header:"大小",dataIndex:"length",width:100,align:"center",renderer:p.Renders.fileSize()}));var m=Ext.now(),g=Ext.create("Ext.data.Store",{autoLoad:!0,data:a}),h=Ext.create("Ext.grid.Panel",{selModel:p.Grid.getGridSelModel(),store:g,columnLines:!0,cellTip:!0,columns:n,plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:2})],selType:"cellmodel",tbar:[{xtype:"button",border:1,text:"删除",id:"btnDeleteFile"+m,iconCls:"extIcon extDelete",disabled:!0,handler:function(){var i=h.getSelectionModel().getSelection();0===i.length?p.Dialog.toast("请您选择需要删除的文件！"):Ext.Msg.confirm("系统提醒","您确定立即删除选中的附件吗？",function(t,e){var n;"yes"===t&&(n={},Ext.Array.each(i,function(t,e){n["path["+e+"]"]=t.get("url")}),p.Dialog.showWait("正在删除中……"),p.Server.deleteAttach(n,function(t,e){p.Dialog.hideWait(),t?(h.getSelectionModel().deselectAll(),p.Dialog.showAlert("系统提醒","删除成功！"),Ext.Array.each(i,function(t,e){g.remove(t),g.modify=!0})):p.Dialog.showAlert("系统提醒",e)}))})}},{xtype:"button",border:1,text:"上传",iconCls:"extIcon extUpload",handler:function(){p.File.uploadFile(this,e,!0).then(function(t){if(t){if(Ext.isArray(t))for(var e=0;e<t.length;e++)g.add(t[e]);else g.add(t);g.modify=!0}})}}],listeners:{selectionchange:function(){var t=this.getSelectionModel().getSelection();Ext.getCmp("btnDeleteFile"+m).setDisabled(!(0<t.length))}}}),f=Ext.create("Ext.window.Window",{title:i,height:300,width:400,minWidth:400,minHeight:300,layout:"fit",resizable:!0,modal:!0,constrain:!0,iconCls:"extIcon extFolder",animateTarget:o,items:[h],buttons:[{text:"确定",iconCls:"extIcon extOk",handler:function(){var i=[];g.each(function(t,e){var n=t.get("url");o.showFileName&&(n=n+"@"+t.get("name"),o.showFileLength&&(n=n+"@"+t.get("length"))),i.push(n)}),null!=t&&t(Ext.encode(i)),f.close()}}],listeners:{close:function(){g.modify}}});f.show()}},e);function e(){}p.File=t;n.validate=function(t,e){return Ext.isEmpty(t)?(p.Dialog.showAlert("系统提醒","参数"+e+"必传！"),!1):Ext.isArray(t)?0!==t||(p.Dialog.showAlert("系统提醒","参数"+e+"集合不可为空！"),!1):(p.Dialog.showAlert("系统提醒","参数"+e+"必需Array格式！"),!1)},n.file=function(){return{tipMsg:"文件",type:"file",renderer:p.Renders.file(),match:function(t){return new RegExp(/\.*$/i).test(t)}}},n.image=function(t,e){return{width:t=Ext.isEmpty(t)?-1:t,height:e=Ext.isEmpty(e)?-1:e,tipMsg:"图片",type:"images",renderer:p.Renders.image(24),match:function(t){return p.File.isSuffixFile(t,"jpg","png","gif","jpeg","svg","bmp","webp")}}},n.mp4=function(t){return{tipMsg:"mp4",type:"videos",maxDuration:t,onFileSelect:function(o){var a=this;return Ext.isEmpty(o.extra)&&(o.extra={}),new Ext.Promise(function(e,t){var n,i;Ext.isEmpty(a.maxDuration)?e():(n=o.fileInputEl.dom.files[0],n=URL.createObjectURL(n),(i=new Audio(n)).addEventListener("loadedmetadata",function(t){o.extra.duration=i.duration,1e3*i.duration>parseInt(a.maxDuration)?e("视频最大时长不得超过"+a.maxDuration/1e3+"秒！"):e()}))})},renderer:p.Renders.file(),match:function(t){return p.File.isSuffixFile(t,"mp4")}}},n.mp3=function(){return{tipMsg:"mp3",type:"music",renderer:p.Renders.file(),onFileSelect:function(o){return Ext.isEmpty(o.extra)&&(o.extra={}),new Ext.Promise(function(e,t){var n=o.fileInputEl.dom.files[0],n=URL.createObjectURL(n),i=new Audio(n);i.addEventListener("loadedmetadata",function(t){o.extra.duration=i.duration,e()})})},match:function(t){return p.File.isSuffixFile(t,"mp3")}}},n.word=function(){return{tipMsg:"word文档",type:"words",renderer:p.Renders.file(),match:function(t){return p.File.isSuffixFile(t,"doc","docx")}}},n.excel=function(){return{tipMsg:"excel文档",type:"excels",renderer:p.Renders.file(),match:function(t){return p.File.isSuffixFile(t,"xls","xlsx")}}},n.ppt=function(){return{tipMsg:"ppt文档",type:"ppt",renderer:p.Renders.file(),match:function(t){return p.File.isSuffixFile(t,"ppt","pptx")}}},n.pdf=function(){return{tipMsg:"pdf文档",type:"pdf",renderer:p.Renders.file(),match:function(t){return p.File.isSuffixFile(t,"pdf")}}},n.zip=function(){return{tipMsg:"zip压缩包",type:"zip",renderer:p.Renders.file(),match:function(t){return p.File.isSuffixFile(t,"zip","rar")}}},n.text=function(){return{tipMsg:"txt文档",type:"txt",renderer:p.Renders.file(),match:function(t){return p.File.isSuffixFile(t,"txt")}}},n.data=function(){return{tipMsg:"数据文件",type:"data",renderer:p.Renders.file(),match:function(t){return p.File.isSuffixFile(t,"data")}}},n.json=function(){return{tipMsg:"JSON文件",type:"json",renderer:p.Renders.file(),match:function(t){return p.File.isSuffixFile(t,"json")}}},n.apk=function(){return{tipMsg:"安卓安装包（APK）",type:"apk",renderer:p.Renders.file(),match:function(t){return p.File.isSuffixFile(t,"apk")}}},n.ipa=function(){return{tipMsg:"苹果安装包（IPA）",type:"ipa",renderer:p.Renders.file(),match:function(t){return p.File.isSuffixFile(t,"ipa")}}},t=n;function n(){}p.FileModule=t}(FastExt=FastExt||{}),function(t){var e=(n.buildForm=function(t,e){var n,i=$("<form></form>");for(n in i.attr("action",t),i.attr("method","post"),e){var o=$("<input type='text' name='"+n+"' />");o.attr("value",e[n]),i.append(o)}return $(document.body).append(i),i},n.isDateField=function(t){return!!t&&("datefield"===t||"datefield"===t.xtype)},n.isNumberField=function(t){return!!t&&("numberfield"===t||"numberfield"===t.xtype)},n.isTextField=function(t){return!!t&&("textfield"===t||"textfield"===t.xtype)},n.isComboField=function(t){return!!t&&("combobox"===t||"combo"===t.xtype)},n.isFileField=function(t){return!!t&&("fastfile"===t||"fastfile"===t.xtype||"fastfilefield"===t||"fastfilefield"===t.xtype)},n.isFilesField=function(t){return!!t&&("fastfiles"===t||"fastfiles"===t.xtype||"fastfilesfield"===t||"fastfilesfield"===t.xtype)},n.isEnumField=function(t){return!!t&&("enumcombo"===t||"enumcombobox"===t||"enumcombo"===t.xtype||"enumcombobox"===t.xtype)},n.isContentField=function(t){return!!t&&("contentfield"===t||"content"===t||"contentfield"===t.xtype||"content"===t.xtype)},n.isHtmlContentField=function(t){return!!t&&("htmlcontentfield"===t||"htmlcontent"===t||"htmlcontentfield"===t.xtype||"htmlcontent"===t.xtype)},n.isLinkField=function(t){return!!t&&("linkfield"===t||"link"===t||"linkfield"===t.xtype||"link"===t.xtype)},n.isTargetField=function(t){return!!t&&("targetfield"===t||"target"===t||"targetfield"===t.xtype||"target"===t.xtype)},n.isPCAField=function(t){return!!t&&("pcafield"===t||"pca"===t||"pcafield"===t.xtype||"pca"===t.xtype)},n.isMapField=function(t){return!!t&&("mapfield"===t||"map"===t||"mapfield"===t.xtype||"map"===t.xtype)},n.getFieldError=function(t){var e=t.getErrors();return 0===e.length&&(e=[t.invalidText]),Ext.isEmpty(e[0])&&(e[0]="数据错误！"),e},n);function n(){}t.Form=e}(FastExt=FastExt||{}),function(FastExt){var Grid=function(){function Grid(){Ext.override(Ext.grid.Panel,{initComponent:Ext.Function.createSequence(Ext.grid.Panel.prototype.initComponent,FastExt.Grid.onGridInitComponent)}),Ext.override(Ext.tree.Panel,{initComponent:Ext.Function.createSequence(Ext.tree.Panel.prototype.initComponent,FastExt.Grid.onGridInitComponent)}),Ext.override(Ext.grid.Panel,{afterRender:Ext.Function.createSequence(Ext.grid.Panel.prototype.afterRender,FastExt.Grid.onGridAfterRender)}),Ext.override(Ext.tree.Panel,{afterRender:Ext.Function.createSequence(Ext.tree.Panel.prototype.afterRender,FastExt.Grid.onGridAfterRender)})}return Grid.onGridInitComponent=function(){var t=this;t.bufferedRenderer=!1,t.firstLoadedData=!1,t.entityList&&(t.getStore()&&(t.getStore().grid=t).getStore().where&&(t.fromRecycle=t.getStore().where["^fromRecycle"]),FastExt.Grid.configGridContextMenu(t),FastExt.Grid.configDefaultToolBar(t),FastExt.Grid.configGridListeners(t))},Grid.onGridAfterRender=function(){var t,e=this;e.entityList&&((t=e.up("[tabContainer=true]"))&&(e.tabPanelList=!0),e.updateButtons&&0!==e.updateButtons.length?e.updateEnable=!0:e.updateEnable=!1,FastExt.Grid.configGridLayout(e).then(function(){FastExt.Grid.configGridTip(e),e.setLoading(!1),e.getStore().grid=e,FastExt.System.silenceGlobalSave?(e.firstLoadedData=!0,e.getStore().loadData([FastExt.Grid.buildNullData(e)]),t.close(),FastExt.System.doNextSilenceMenu()):(e.firstLoadedData=!0,e.getStore().isLoaded()||e.getStore().loadPage(1))}))},Grid.buildNullData=function(t){var n={};return Ext.each(t.getColumns(),function(t,e){Ext.isEmpty(t.dataIndex)||(n[t.dataIndex]=null)}),n},Grid.addGridContextMenu=function(t,e,n){var i;t.contextMenu&&e&&(Ext.isFunction(t.contextMenu.getXType)||(i=new Ext.menu.Menu({scrollToHidden:!0,items:[]}),Ext.isArray(t.contextMenu)&&i.add(t.contextMenu),t.contextMenu=i),Ext.isEmpty(n)?t.contextMenu.add(e):t.contextMenu.insert(n,e))},Grid.configGridContextMenu=function(l){var t=0;FastExt.Grid.addGridContextMenu(l,{iconCls:"extIcon extDetails editColor",text:"查看详情",handler:function(t,e){var n="";l.getStore().entity.menu&&(n="【"+l.getStore().entity.menu.text+"】");var i=parseInt((.3*document.body.clientWidth).toFixed(0)),o=parseInt((.6*document.body.clientHeight).toFixed(0));Ext.create("Ext.window.Window",{title:"查看详情"+n,subtitle:n,height:o,width:i,minHeight:450,minWidth:400,iconCls:"extIcon extDetails",layout:"border",resizable:!0,collapsible:!0,constrain:!0,maximizable:!0,animateTarget:t,tools:[{type:"help",callback:function(t,e,n){var i=l.getSelectionModel().getSelection()[0];FastExt.Dialog.showJson(this,"查看原始数据结构",FastExt.Json.objectToJson(i.data))}}],listeners:{show:function(t){t.focus()}},items:[FastExt.Grid.getDetailsPanel(l,!0)]}).show()}},t++),FastExt.System.isSuperRole()&&FastExt.Grid.addGridContextMenu(l,{iconCls:"extIcon extSee editColor",text:"查看数据结构",handler:function(t,e){var n=l.contextMenu.record;FastExt.Dialog.showJson(this,"查看原始数据结构",FastExt.Json.objectToJson(n.data))}},t++),FastExt.Grid.addGridContextMenu(l,{iconCls:"extIcon extCopy2",text:"复制数据",menu:[{text:"复制单元格数据",iconCls:"extIcon extCopy2",handler:function(){var t=l.contextMenu;FastExt.Base.copyToBoard($(t.cellTd).text()),FastExt.Dialog.toast("复制成功！")}},{text:"复制整行数据",iconCls:"extIcon extCopy2",handler:function(){var t=l.contextMenu,e="";$(t.tr).find("td").each(function(){e+=$(this).text()+"\t"}),FastExt.Base.copyToBoard(e),FastExt.Dialog.toast("复制成功！")}},{text:"复制单元格实际数据",iconCls:"extIcon extCopy2",handler:function(){var t=l.contextMenu,e=t.record,t=t.cellContext.column.dataIndex;Ext.isArray(e.get(t))?FastExt.Base.copyToBoard(Ext.encode(e.get(t))):FastExt.Base.copyToBoard(e.get(t)),FastExt.Dialog.toast("复制成功！")}}]},t++),FastExt.Grid.addGridContextMenu(l,{iconCls:"extIcon extEdit editColor",text:"编辑单元格数据",onBeforeShow:function(){var t=this.ownerCt;!Ext.isEmpty(t.cellContext.column.dataIndex)&&1===l.getSelection().length&&FastExt.Base.toBool(t.cellContext.column.editable,!0)?(this.show(),t.cellContext.column.field||t.cellContext.column.hasListener("dblclick")||this.hide()):this.hide()},handler:function(){var t=this.ownerCt;t.cellContext.column.field?(l.doEdit=!0,l.findPlugin("cellediting").startEditByPosition(t.cellContext)):t.cellContext.column.fireEvent("dblclick",l,this,t.rowIndex)}},t++),l.getStore().entity&&(FastExt.Grid.addGridContextMenu(l,{iconCls:"extIcon extLink",text:"单元格搜索链",onBeforeShow:function(){this.show();var t=this.ownerCt;if(Ext.isObject(t.cellContext.column.searchLink)&&1===l.getSelection().length){for(var e=new Ext.menu.Menu({items:[]}),n=t.record,i=t.cellContext.column.dataIndex,o=t.cellContext.column.searchLink.columns,a=0;a<o.length;a++){var r=o[a],r={icon:r.parent.icon,text:r.parent.text+"【"+r.text+"】",column:r,value:n.get(i),handler:function(){var t={};t[this.column.dataIndex]=this.value,FastExt.System.showTab(this.column.parent.method,$.md5(this.column.id+this.value),"搜索："+this.text,this.icon,!0,!1,t)}};e.add(r)}this.setMenu(e)}else this.hide()},menu:[]},t++),FastExt.Grid.addGridContextMenu(l,{iconCls:"extIcon extSearch searchColor",text:"查找单元格数据",onBeforeShow:function(){var t=this.ownerCt;Ext.isEmpty(t.cellContext.column.dataIndex)||!FastExt.Grid.canColumnSearch(t.cellContext.column)||1!==l.getSelection().length?this.hide():this.show()},handler:function(){var t=this.ownerCt,e=t.record,n=t.cellContext.column.dataIndex;t.cellContext.column.searchValue(e.get(n))}},t++),FastExt.Grid.addGridContextMenu(l,{iconCls:"extIcon extClear",text:"清空单元格数据",onBeforeShow:function(){var t=this.ownerCt;Ext.isEmpty(t.cellContext.column.dataIndex)||1!==l.getSelection().length?this.hide():this.show()},handler:function(){var s=this;Ext.Msg.confirm("系统提醒","您确定清空选中的单元格数据吗？",function(t,e){if("yes"===t){var n=s.ownerCt,i=n.record,t=n.cellContext.column.dataIndex;Ext.isObject(n.cellContext.column.field)&&(Ext.isEmpty(n.cellContext.column.field.name)||(t=n.cellContext.column.field.name));for(var o={entityCode:l.getStore().entity.entityCode},a=0;a<l.getStore().entity.idProperty.length;a++){var r=l.getStore().entity.idProperty[a];o["data."+r]=i.get(r)}l.getStore().entity.menu&&(o.menu=FastExt.Store.getStoreMenuText(l.getStore())),o["data."+t]="<null>",FastExt.Dialog.showWait("正在清空中……"),FastExt.Server.updateEntity(o,function(t,e){FastExt.Dialog.hideWait(),t?(FastExt.Dialog.toast("清除成功！"),l.getStore().reload()):Ext.Msg.alert("系统提醒",e)})}})}},t++))},Grid.configGridHeadMenu=function(n){var i;FastExt.Base.toBool(n.columnContextMenu,!0)&&n.columnHeadMenu&&(n.columnMenu||(n.columnMenu=new FastExt.GridColumnMenu),n.columnMenu&&((i=n.columnHeadMenu).scrollToHidden=!0,i.on("beforeshow",function(t){var e;FastExt.Grid.hasColumnField(i.activeHeader)||(t.activeHeader.batchUpdate=!1,t.activeHeader.operation=!1,t.activeHeader.searchLink=!1,t.activeHeader.batchRandom=!1),(FastExt.Grid.isFilesColumn(t.activeHeader)||FastExt.Grid.isFileColumn(t.activeHeader)||FastExt.Grid.isLinkColumn(i.activeHeader)||FastExt.Grid.isMapColumn(i.activeHeader)||FastExt.Grid.isTargetColumn(i.activeHeader)||FastExt.Grid.isPCAColumn(i.activeHeader))&&(t.activeHeader.batchRandom=!1),FastExt.Grid.isContentColumn(t.activeHeader)&&(t.activeHeader.searchLink=!1),t.configHeadMenu||(t.configHeadMenu=!0,e=[],FastExt.Base.toBool(n.columnMenu.lookField,!0)&&e.push({text:"查看字段",iconCls:"extIcon extField",onBeforeShow:function(){FastExt.Base.toBool(i.activeHeader.lookField,!0)?this.show():this.hide()},handler:function(){Ext.Msg.alert("查看字段",i.activeHeader.dataIndex)}}),e.push({text:"清除无效数据",iconCls:"extIcon extClear grayColor",onBeforeShow:function(){FastExt.Base.toBool(i.activeHeader.batchClear,!0)?this.show():this.hide()},handler:function(){var t={title:"清除无效数据",icon:Ext.Msg.QUESTION,message:"将清除属性【"+i.activeHeader.configText+"】在【当前当前条件】下为空的所有无效数据！请您确定操作！",buttons:Ext.Msg.YESNO,defaultFocus:"no",callback:function(t,e){var n;"yes"===t&&(FastExt.Dialog.showWait("正在清除数据中……"),t=(n=FastExt.Grid.getColumnGrid(i.activeHeader)).getStore().proxy.extraParams,n={entityCode:n.getStore().entity.entityCode,field:i.activeHeader.dataIndex,menu:FastExt.Store.getStoreMenuText(n.getStore())},FastExt.Server.clearEntity(FastExt.Json.mergeJson(n,t),function(t,e){FastExt.Dialog.hideWait(),t&&FastExt.Grid.getColumnGrid(i.activeHeader).getStore().loadPage(1),FastExt.Dialog.showAlert("清理结果",e)}))}};Ext.Msg.confirm(t)}}),n.getStore().entity&&(FastExt.Base.toBool(n.columnMenu.searchLink,!0)&&e.push({text:"配置搜索链",iconCls:"extIcon extLink",onBeforeShow:function(){!FastExt.Grid.getColumnGrid(i.activeHeader).fromRecycle&&FastExt.Base.toBool(i.activeHeader.searchLink,!0)?this.show():this.hide()},handler:function(){FastExt.Grid.configColumnSearchLink(i.activeHeader)}}),FastExt.Base.toBool(n.columnMenu.operation,!0)&&e.push({text:"计算数据",iconCls:"extIcon extMath",onBeforeShow:function(){!FastExt.Grid.getColumnGrid(i.activeHeader).fromRecycle&&FastExt.Base.toBool(i.activeHeader.operation,!1)?this.show():this.hide()},menu:[{text:"计算总和",iconCls:"extIcon extMath",handler:function(){FastExt.Grid.showColumnCompute(n,i.activeHeader,FastEnum.ComputeType.sum)}},{text:"计算平均值",iconCls:"extIcon extMath",handler:function(){FastExt.Grid.showColumnCompute(n,i.activeHeader,FastEnum.ComputeType.avg)}},{text:"计算最大值",iconCls:"extIcon extMath",handler:function(){FastExt.Grid.showColumnCompute(n,i.activeHeader,FastEnum.ComputeType.max)}},{text:"计算最小值",iconCls:"extIcon extMath",handler:function(){FastExt.Grid.showColumnCompute(n,i.activeHeader,FastEnum.ComputeType.min)}}]})),FastExt.Base.toBool(n.columnMenu.batchUpdate,!0)&&e.push({text:"批量修改数据",iconCls:"extIcon extEdit",onBeforeShow:function(){!FastExt.Grid.getColumnGrid(i.activeHeader).fromRecycle&&FastExt.Base.toBool(i.activeHeader.editable,!0)&&FastExt.Base.toBool(i.activeHeader.batchUpdate,!0)?this.show():this.hide()},handler:function(){FastExt.Grid.showBatchEditColumn(i.activeHeader)}}),FastExt.Base.toBool(n.columnMenu.batchRandom,!0)&&e.push({text:"批量随机数据",iconCls:"extIcon extRandom",onBeforeShow:function(){!FastExt.Grid.getColumnGrid(i.activeHeader).fromRecycle&&FastExt.Base.toBool(i.activeHeader.editable,!0)&&FastExt.Base.toBool(i.activeHeader.batchRandom,!0)?this.show():this.hide()},handler:function(){FastExt.Grid.showBatchEditColumnRandom(i.activeHeader)}}),FastExt.Base.toBool(n.columnMenu.cancelSort,!0)&&e.push({text:"取消排序",iconCls:"extIcon extCancelOrder",onBeforeShow:function(){!FastExt.Grid.getColumnGrid(i.activeHeader).fromRecycle&&FastExt.Base.toBool(i.activeHeader.cancelSort,!0)?this.show():this.hide()},handler:function(){try{var t=n.getStore().getSorters();if(0===t.count())return;t.removeByKey(i.activeHeader.dataIndex),n.getStore().loadPage(1),i.activeHeader.sortDirection=null,FastExt.Grid.refreshColumnStyle(i.activeHeader),n.saveUIConfig(!0)}catch(t){FastExt.Dialog.showException(t)}}}),t.insert(0,e)),FastExt.Menu.fireMenuEvent(t,"onBeforeShow")})))},Grid.configDefaultToolBar=function(grid){if(grid){var toolbar=grid.down("toolbar[dock='top']");if(toolbar)if(FastExt.Base.toBool(grid.fromRecycle,!1))toolbar.setHidden(!0);else if(grid.operate&&FastExt.Base.toBool(grid.defaultToolBar,!0)){var moreBtn={xtype:"button",text:"更多操作",iconCls:"extIcon extMore grayColor",menu:[{text:"导出Excel",iconCls:"extIcon extExcel",hidden:!FastExt.Base.toBool(grid.operate.excelOut,!0),handler:function(){FastExt.Grid.exportGrid(grid)}},{text:"导入Excel",iconCls:"extIcon extExcel",hidden:!FastExt.Base.toBool(grid.operate.excelIn,!0),menu:[{text:"下载模板",iconCls:"extIcon extExcelModule searchColor",handler:function(){FastExt.Grid.downExcelModel(grid)}},{text:"导入数据",iconCls:"extIcon extExcelImport searchColor",handler:function(){var t={entityCode:grid.getStore().entity.entityCode};FastExt.Grid.importExcel(this,t,grid.importExcelItems).then(function(t){t&&grid.getStore().loadPage(1)})}}]},{iconCls:"extIcon extDownload searchColor",text:"下载数据",handler:function(){FastExt.Grid.downDataGrid(grid)}},{iconCls:"extIcon extUpload searchColor",text:"上传数据",handler:function(){var t={entityCode:grid.getStore().entity.entityCode};FastExt.Grid.loadDataGrid(this,t).then(function(t){t&&grid.getStore().loadPage(1)})}},{iconCls:"extIcon extSet",text:"操作设置",handler:function(){FastExt.Grid.setGrid(this,grid)}}]};grid.getStore().entity&&FastExt.Base.toBool(grid.getStore().entity.layer,!1)&&FastExt.System.isSuperRole()&&moreBtn.menu.push({iconCls:"extIcon extPower redColor",text:"更新权限值",handler:function(){Ext.Msg.confirm("系统提醒","确定更新表格的数据权限值吗？确定后将同时更新所有相关表格的权限值！请您谨慎操作！",function(t,e){var n;"yes"==t&&(n={entityCode:grid.getStore().entity.entityCode},FastExt.System.validOperate("更新表格的数据权限层级值",function(){FastExt.Dialog.showWait("正在更新中，请稍后……"),FastExt.Server.updateLayer(n,function(t,e){FastExt.Dialog.hideWait(),FastExt.Dialog.showAlert("系统提醒",e)})},30))})}});var linkBtns={xtype:"button",text:"相关查询",checkSelect:1,iconCls:"extIcon extIntersect grayColor",menu:[]};if(grid.getStore()&&grid.getStore().entity&&grid.getStore().entity.linkTables)for(var _loop_1=function(i){var linkTable=grid.getStore().entity.linkTables[i];if(linkTable.linkColumns){var linkBtn={text:linkTable.comment};if(linkTable.menu){if(linkBtn.icon=FastExt.Server.getIcon(linkTable.menu.iconName,linkTable.menu.color),!FastExt.System.existMenu(linkTable.menu.id))return"continue"}else linkBtn.iconCls="extIcon extSearch searchColor";if(1==linkTable.linkColumns.length){var linkColumn_1=linkTable.linkColumns[0];linkBtn.handler=function(){var where={};where["t."+linkColumn_1.name]=grid.getSelection()[0].get(linkColumn_1.linkKey),where["^"+linkColumn_1.linkText[0]]=grid.getSelection()[0].get(linkColumn_1.linkText[0]);var entityJsObj=eval("new "+linkTable.entityCode+"()");entityJsObj.showWinList(this,linkTable.comment+"【"+linkColumn_1.comment+"】",where,!0)},linkBtns.menu.push(linkBtn)}else if(1<linkTable.linkColumns.length){linkBtn.menu=[];for(var _loop_2=function(j){var linkColumn=linkTable.linkColumns[j],linkChildBtn={icon:FastExt.Server.getIcon("icon_column.svg"),text:"匹配"+linkColumn.comment,handler:function(){var where={};where["t."+linkColumn.name]=grid.getSelection()[0].get(linkColumn.linkKey),where["^"+linkColumn.linkText[0]]=grid.getSelection()[0].get(linkColumn.linkText[0]);var entityJsObj=eval("new "+linkTable.entityCode+"()");entityJsObj.showWinList(this,linkTable.comment+"【"+linkColumn.comment+"】",where,!0)}};linkBtn.menu.push(linkChildBtn)},j=0;j<linkTable.linkColumns.length;j++)_loop_2(j);linkBtns.menu.push(linkBtn)}}},i=0;i<grid.getStore().entity.linkTables.length;i++)_loop_1(i);toolbar.add("->"),FastExt.Base.toBool(grid.defaultToolBarLink,!0)&&0<linkBtns.menu.length&&toolbar.add(linkBtns),FastExt.Base.toBool(grid.defaultToolBarMore,!0)&&toolbar.add(moreBtn)}}},Grid.configGridTip=function(i){var t;!i||(t=i.getView())&&(i.tip=new Ext.ToolTip({target:t.el,delegate:".x-grid-cell-inner",trackMouse:!0,renderTo:Ext.getBody(),listeners:{beforeshow:function(t){if(i.operate&&!i.operate.hoverTip)return!1;var e=t.triggerElement.innerHTML;if(Ext.isEmpty(e)||"&nbsp;"===e)return!1;var n=e,e=t.triggerElement.firstChild;if(null!=e&&1===e.nodeType){if("x-grid-row-checker"===e.getAttribute("class"))return!1;e=e.getAttribute("details-id");if(window[e])return t.update(window[e]),!0}t.update(n)}}}))},Grid.configGridListeners=function(l){l&&!l.configListener&&(l.configListener=!0,l.onTabActivate=function(t){this.operate.refreshData&&this.getStore().reload()},l.refreshSelect=function(){var o=this;o.selectButtons&&Ext.each(o.selectButtons,function(t,e){var n=o.getSelection().length;o.selectCount&&(n=o.selectCount);var i=t.checkSelect;"multiple"===i||"m"===i||1<i?t.setDisabled(!(0<n)):"radio"!==i&&"r"!==i&&"single"!==i&&"s"!==i&&1!==i||t.setDisabled(!(1===n))})},l.refreshDetailsPanel=function(){var t=this;if(!FastExt.Base.toBool(t.refreshingDetailsPanel,!1))try{if(t.refreshingDetailsPanel=!0,!t.detailsPanels||0===t.detailsPanels.length)return;for(var e=0;e<t.detailsPanels.length;e++){var n=t.detailsPanels[e];n&&(n.fromWindow||t.operate&&t.operate.autoDetails?n.setRecord(t):n.close())}}finally{t.refreshingDetailsPanel=!1}},l.saveUIConfig=function(t){var e,n;FastExt.Base.toBool(this.firstLoadedData,!1)&&(t&&FastExt.Server.setSilence(!0),n=(e=this).getStore().entity,FastExt.Grid.saveGridColumn(e).then(function(){FastExt.Grid.saveGridButton(e,n).then(function(){FastExt.Server.setSilence(!1)})}))},l.on("viewready",function(t,e){t.getHeaderContainer().sortOnClick=!1}),l.on("beforedestroy",function(t,e){t.saveUIConfig(!1)}),l.on("columnmove",function(t,e,n,i,o){e.isSubHeader?e.groupHeaderText=e.ownerCt.text:e.groupHeaderText=null,FastExt.Grid.getColumnGrid(e).saveUIConfig(!0)}),l.on("columnresize",function(t,e,n,i){t.sortOnClick=!1,FastExt.Grid.getColumnGrid(e).saveUIConfig(!0)}),l.on("columnschanged",function(t,e){t.sortOnClick=!1,FastExt.Grid.getHeaderContainerGrid(t).saveUIConfig(!0)}),l.on("headertriggerclick",function(t,e,n,i,o){Ext.isEmpty(e.dataIndex)||l.fromRecycle||(t.sortOnClick=!1,t.triggerColumn=e)}),l.on("headercontextmenu",function(t,e,n,i,o){Ext.isEmpty(e.dataIndex)||l.fromRecycle||(t.sortOnClick=!1,t.onHeaderTriggerClick(e,n,e.triggerEl))}),l.on("headermenucreate",function(t,e,n,i){l.columnHeadMenu=e,FastExt.Grid.configGridHeadMenu(l)}),l.on("headerclick",function(t,e,n,i,o){Ext.isEmpty(e.dataIndex)||(t.sortOnClick=!1,FastExt.Grid.showColumnSearchMenu(e)||t.onHeaderTriggerClick(e,n,e.triggerEl))}),l.on("sortchange",function(t,e,n,i){Ext.isEmpty(e.dataIndex)||(e.sortDirection=n,FastExt.Grid.refreshColumnStyle(e),FastExt.Grid.getColumnGrid(e).saveUIConfig(!0))}),l.on("cellcontextmenu",function(t,e,n,i,o,a,r,s){Ext.isEmpty(r.position.column.dataIndex)||l.fromRecycle||Ext.isObject(l.contextMenu)&&0<l.contextMenu.items.length&&(l.contextMenu.cellIndex=n,l.contextMenu.record=i,l.contextMenu.rowIndex=a,l.contextMenu.cellTd=e,l.contextMenu.tr=o,l.contextMenu.cellContext=r.position,l.contextMenu.on("show",function(t,e){var n;t.cellTd&&(n=FastExt.Color.toColor(FastExt.System.getExt("front-color-dark").value),$(t.cellTd).css("background",n))}),l.contextMenu.on("hide",function(t,e){t.cellTd&&$(t.cellTd).css("background","transparent")}),t.getSelectionModel().select(i),t.fireEvent("selectionchange",t,i,s),FastExt.Menu.fireMenuEvent(l.contextMenu,"onBeforeShow"),l.contextMenu.showAt(r.getXY()))}),l.getStore().on("endupdate",function(t){try{if(!l.getStore())return!0;if(l.getStore().holdUpdate)return!0;var n=l.getStore().getUpdatedRecords();Ext.each(l.updateButtons,function(t,e){t.setDisabled(0===n.length)}),l.operate&&l.operate.autoUpdate&&FastExt.Store.commitStoreUpdate(l.getStore())}catch(t){FastExt.Dialog.showException(t,"endupdate")}}),l.on("celldblclick",function(t,e,n,i,o,a,r,s){l.doEdit=!0}),l.on("beforeedit",function(t,e,n){if(!l.updateEnable)return!1;if(!l.doEdit)return!1;if(l.fromRecycle)return!1;if(l.doEdit=!1,!FastExt.Base.toBool(e.column.editable,!0))return!1;if(e.column.hasListener("beforeedit")&&!e.column.fireEvent("beforeedit",e))return!1;var i=e.column.field,o=Ext.get(e.cell);return i.labelTitle=e.column.text,i.record=e.record,Ext.isFunction(i.setValue)&&!FastExt.Base.toBool(e.column.password,!1)&&(Ext.isObject(e.value)||Ext.isArray(e.value)?i.setValue(JSON.stringify(e.value),e.record):i.setValue(e.value,e.record)),Ext.isFunction(i.startEdit)&&i.startEdit(),Ext.isFunction(i.showWindow)?i.showWindow(o,function(t){Ext.isEmpty(e.value)&&Ext.isEmpty(t.getValue())||FastExt.Store.setRecordValue(e.record,e.field,t)}):(e.column.editMenu||(e.column.editMenu=Ext.create("Ext.menu.Menu",{modal:!0,layout:"fit",showSeparator:!1,items:[{xtype:"panel",layout:"fit",width:o.getWidth(),height:o.getHeight(),style:{background:"#ffffff",borderWidth:1,borderColor:"#ffffff",color:"#eeeee"},border:0,items:[i]}],listeners:{show:function(n,t){n.items.get(0).items.get(0).focus();try{new Ext.util.KeyMap({target:n.getEl(),key:13,fn:function(t,e){n.hide()},scope:this})}catch(t){console.error(t)}},beforehide:function(t,e){var n=t.items.get(0).items.get(0);if(n.isValid())return!0;n=FastExt.Form.getFieldError(n);return FastExt.Dialog.toast(n[0]),FastExt.Component.shakeComment(t,function(){t.holdShow=!1}),!(t.holdShow=!0)},hide:function(t,e){var n;!t.context||(n=t.items.get(0).items.get(0))&&((Ext.isEmpty(t.context.value)||FastExt.Base.toBool(t.context.column.password,!1))&&Ext.isEmpty(n.getValue())?Ext.isFunction(n.endEdit)&&n.endEdit():(FastExt.Store.setRecordValue(t.context.record,t.context.field,n),Ext.isFunction(n.endEdit)&&n.endEdit(),n.setValue(null)))}}}),e.column.editMenu.addCls("edit-menu")),e.column.editMenu.setWidth(e.column.getWidth()),(e.column.editMenu.context=e).column.editMenu.showBy(o,"tl")),!1}),l.on("selectionchange",function(t,e,n){try{l.refreshSelect(),l.refreshDetailsPanel()}catch(t){FastExt.Dialog.showException(t,"按钮选中检测！[selectionchange]")}}))},Grid.configGridLayout=function(n){return new Ext.Promise(function(t,e){n?(FastExt.System.silenceGlobalSave||n.setLoading("初始化配置中……"),FastExt.Grid.restoreGridOperate(n).then(function(){FastExt.Grid.restoreGridColumn(n).then(function(){t(!0)})})):t(!0)})},Grid.getDetailsPanel=function(t,e){var n="";t.getStore().entity.menu&&(n=t.getStore().entity.menu.text),t.detailsPanels||(t.detailsPanels=[]);n={subtitle:n,layout:"border",border:0,autoScroll:!1,scrollable:!1,closeAction:"hide",dataId:-1,currIsClosed:!1,closeTimer:null,isWindow:e,setRecord:function(e){try{var t,n=this;if(!n.items)return!1;n.closeTimer&&window.clearTimeout(n.closeTimer),null!=e?1===(t=e.getSelectionModel().getSelection()).length?(n.record=t[0],n.items.get(0).setRecord(e,t[0]),n.show()):n.isVisible()&&!this.isWindow&&(n.closeTimer=setTimeout(function(){n.close(),setTimeout(function(){var t=e.view.getEl().getScrollLeft();e.view.getEl().scrollTo("left",t-1,!1)},100)},88)):n.close()}catch(t){FastExt.Dialog.showException(t)}return!0},listeners:{afterrender:function(){this.isWindow&&this.setRecord(t)},collapse:function(t,e){this.down("#close").hide()},beforeexpand:function(t,e){this.down("#close").show()}},items:[FastExt.Grid.builderDetailsGrid()]};e?n.region="center":(n.title="数据详情",n.iconCls="extIcon extDetails",n.collapsed=!1,n.split=!0,n.hidden=!0,n.region="east",n.maxWidth=parseInt((document.body.clientWidth/2).toFixed(0)),n.width=parseInt((.3*document.body.clientWidth).toFixed(0)),n.minWidth=200,n.tools=[{type:"gear",callback:function(){FastExt.Grid.setGrid(this,t)}},{type:"close",itemId:"close",callback:function(){i.collapse()}}]);var i=Ext.create("Ext.panel.Panel",n);return i.fromWindow=e,t.detailsPanels.push(i),i},Grid.builderDetailsGrid=function(){return Ext.create("Ext.grid.Panel",{border:0,scrollable:"y",region:"center",store:Ext.create("Ext.data.Store",{groupField:"groupHeaderText",autoLoad:!1,fields:[]}),hideHeaders:!0,deferRowRender:!1,superGrid:null,features:[{ftype:"grouping",collapsible:!1,hideGroupedHeader:!0,expandTip:null,collapseTip:null,groupHeaderTpl:["<b>{name:this.formatName}</b>",{formatName:function(t){return t.toString().startsWith("BASE")?"基本属性":t}}]}],setRecord:function(t,e){try{this.recordId=e.getId();for(var n=(this.superGrid=t).getColumns(),i=[],o="BASE-"+(new Date).getTime(),a=0;a<n.length;a++){var r,s=n[a];!Ext.isEmpty(s.dataIndex)&&FastExt.Base.toBool(s.hideable,!0)&&(r={text:s.configText,value:e.get(s.dataIndex),dataIndex:s.dataIndex,groupHeaderText:s.groupHeaderText,renderer:s.renderer,index:s.getIndex(),record:e,linkColumn:s,configEditor:FastExt.Base.toBool(s.editable,!0),editor:!1},Ext.isEmpty(s.field)&&(r.configEditor=!1),r.groupHeaderText?o="BASE-"+a+"-"+(new Date).getTime():r.groupHeaderText=o,i.push(r))}i.sort(function(t,e){return t.index-e.index}),this.getStore().loadData(i)}catch(t){}},columns:[{header:"名称",dataIndex:"text",align:"right",flex:.3,tdCls:"tdVTop",renderer:function(t,e,n){return Ext.isEmpty(t)?"":(e.style="color:#000000;overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space:normal !important;line-height:20px;word-break:break-word; ","<b>"+t+"：</b>")}},{header:"值",dataIndex:"value",flex:.7,align:"left",renderer:function(e,t,n){try{t.style="overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space:normal !important;line-height:20px;word-break:break-word; ";var i=n.get("renderer");if(Ext.isFunction(i)){var o=i(e,t,n.get("record"),-1,-1,null,null,!0);return Ext.isEmpty(o)?"<font color='#ccc'>无</font>":o}return e}catch(t){return e}}},{xtype:"actioncolumn",width:60,sortable:!1,menuDisabled:!0,items:[{iconCls:"extIcon extEdit marginRight5",tooltip:"编辑数据",align:"center",isDisabled:function(t,e,n,i,o){return!FastExt.Base.toBool(o.get("editor"),!1)},getClass:function(t,e,n){return FastExt.Base.toBool(n.get("editor"),!1)?"extIcon extEdit marginRight5":""},handler:FastExt.Grid.showDetailsEditMenu},{iconCls:"extIcon extCopy2 grayColor",tooltip:"复制数据",align:"center",isDisabled:function(t,e,n,i,o){return!FastExt.Base.toBool(o.get("doCopy"),!1)},getClass:function(t,e,n){return FastExt.Base.toBool(n.get("doCopy"),!1)?"extIcon extCopy2 grayColor":""},handler:FastExt.Grid.copyDetailsValue}]}],tbar:{flex:1,emptyText:"查找属性（轻敲回车键）",margin:"5",xtype:"textfield",doSearch:function(){var t=this.ownerCt,e=t.getStore(),o=0,a=e.getAt(0).get("dataIndex"),r=null,s=this.getValue();Ext.isEmpty(s)||e.each(function(t,e){var n=t.get("text").toString(),i=t.get("value");return 0<=n.indexOf(s)?(o=e,a=t.get("dataIndex"),r=n,void 0):!Ext.isEmpty(i)&&0<=i.toString().indexOf(s)?(o=e,a=t.get("dataIndex"),r=n,!1):void 0}),FastExt.Grid.scrollToColumn(t.superGrid,a,r),t.getSelectionModel().select(o),t.view.focusRow(o)},triggers:{search:{cls:"text-search",handler:function(){this.doSearch()}}},listeners:{render:function(t,e){try{new Ext.util.KeyMap({target:t.getEl(),key:13,fn:function(t,e){this.doSearch()},scope:this})}catch(t){console.error(t)}}}},bbar:{xtype:"label",style:{background:"#ffffff"},text:"小技巧：双击属性可快速定位左侧表格对应的列！",padding:"10"},viewConfig:{enableTextSelection:!0},listeners:{itemmouseenter:function(t,e,n,i,o,a){e.set("editor",e.get("configEditor")),e.set("doCopy",!0)},itemmouseleave:function(t,e,n,i,o,a){e.set("editor",!1),e.set("doCopy",!1)},itemdblclick:function(){try{var t=this.getSelectionModel().getSelection();if(0==t.length)return;FastExt.Grid.scrollToColumn(this.superGrid,t[0].get("dataIndex"),t[0].get("text"))}catch(t){FastExt.Dialog.showException(t,"details:itemdblclick")}}}})},Grid.hasSearchColumn=function(t){var n=!1;return Ext.each(t.getColumns(),function(t,e){if(!Ext.isEmpty(t.dataIndex)&&t.where&&0<t.where.length)return!(n=!0)}),n},Grid.getColumn=function(t,e,n){for(var i=t.getColumns(),o=0;o<i.length;o++){var a=i[o];if(a.dataIndex===e)return!n||a.text!==n&&a.configText,a}return null},Grid.checkColumnSearch=function(t){try{var e=!1;Ext.each(t.getColumns(),function(t){if(t.where&&0<t.where.length)return!(e=!0)});var n,i=t.child("#pagingToolBar");!i||(n=i.down("button[toolType=searchBtn]"))&&(e?n.setIconCls("extIcon extSearch redColor"):n.setIconCls("extIcon extSearch grayColor"))}catch(t){console.error(t)}},Grid.hasColumnField=function(t){try{return Ext.isObject(t.field)?!0:!Ext.isEmpty(t.field)}catch(t){console.error(t)}return!1},Grid.isColumnType=function(t){return"gridcolumn"===t||"gridcolumn"===t.xtype},Grid.isIdPropertyColumn=function(t){var e=FastExt.Grid.getColumnGrid(t);if(e){var n=e.getStore();if(n&&n.entity&&n.entity.idProperty)for(var i=0;i<n.entity.idProperty.length;i++){var o=n.entity.idProperty[i];if(FastExt.Base.toString(t.dataIndex,"")===o)return!0}}return!1},Grid.isDateColumn=function(t){return!!t&&FastExt.Form.isDateField(t.field)},Grid.isNumberColumn=function(t){return!!t&&FastExt.Form.isNumberField(t.field)},Grid.isComboColumn=function(t){return!!t&&FastExt.Form.isComboField(t.field)},Grid.isFileColumn=function(t){return!!t&&FastExt.Form.isFileField(t.field)},Grid.isContentColumn=function(t){return!!t&&(FastExt.Form.isHtmlContentField(t.field)||FastExt.Form.isContentField(t.field))},Grid.isFilesColumn=function(t){return!!t&&FastExt.Form.isFilesField(t.field)},Grid.isEnumColumn=function(t){return!!t&&FastExt.Form.isEnumField(t.field)},Grid.isLinkColumn=function(t){return!!t&&FastExt.Form.isLinkField(t.field)},Grid.isMapColumn=function(t){return!!t&&FastExt.Form.isMapField(t.field)},Grid.isPCAColumn=function(t){return!!t&&FastExt.Form.isPCAField(t.field)},Grid.isTargetColumn=function(t){return!!t&&FastExt.Form.isTargetField(t.field)},Grid.getGridSelModel=function(){return Ext.create("Ext.grid.selection.SpreadsheetModel",{pruneRemoved:!1,checkboxSelect:!0,hasLockedHeader:!0,cellSelect:!1,rowNumbererHeaderWidth:0,listeners:{focuschange:function(t,e,n,i){}}})},Grid.blinkColumn=function(t){var e,n,i;t.blinking||(t.blinking=!0,e=t.getEl().getStyle("color"),i="#e41f00",0<(n=t.getEl().getStyle("background")).indexOf("linear-gradient")&&(i="linear-gradient(0deg, #e41f00, #fefefe)"),t.setStyle({color:"white",background:i}),setTimeout(function(){t.setStyle({color:e,background:n}),t.blinking=!1},1e3))},Grid.scrollToColumn=function(t,e,n){e=FastExt.Grid.getColumn(t,e,n);FastExt.Grid.blinkColumn(e);n=e.getLocalX();e.isSubHeader&&(n+=e.ownerCt.getLocalX()),t.view.getEl().scrollTo("left",n,!0)},Grid.setGrid=function(t,n){var i=Ext.create("Ext.form.Panel",{bodyPadding:5,region:"center",autoScroll:!0,viewModel:{data:n.operate},defaults:{labelWidth:4*FastExt.Base.getNumberValue(FastExt.System.fontSize)+8},items:[{xtype:"checkboxfield",fieldLabel:"删除提醒",labelAlign:"right",name:"alertDelete",columnWidth:1,bind:"{alertDelete}",uncheckedValue:!1,boxLabel:"删除数据时，系统会弹出确认删除框，避免误操作删除！"},{xtype:"checkboxfield",fieldLabel:"修改提醒",labelAlign:"right",columnWidth:1,name:"alertUpdate",bind:"{alertUpdate}",hidden:!n.updateEnable,uncheckedValue:!1,boxLabel:"修改数据时，系统会弹出确认修改框，避免误操作修改！"},{xtype:"checkboxfield",fieldLabel:"自动提交",labelAlign:"right",columnWidth:1,name:"autoUpdate",bind:"{autoUpdate}",hidden:!n.updateEnable,uncheckedValue:!1,boxLabel:"双击编辑修改数据后，系统自动提交被修改的数据！"},{xtype:"checkboxfield",fieldLabel:"弹出详情",labelAlign:"right",columnWidth:1,name:"autoDetails",bind:"{autoDetails}",uncheckedValue:!1,boxLabel:"点击数据时，右侧自动弹出此数据的详情窗体！"},{xtype:"checkboxfield",fieldLabel:"悬浮阅览",labelAlign:"right",columnWidth:1,name:"hoverTip",bind:"{hoverTip}",uncheckedValue:!1,boxLabel:"当鼠标悬浮在数据超过2秒后，会在鼠标右下方弹出此数据的阅览！"},{xtype:"checkboxfield",fieldLabel:"数据刷新",labelAlign:"right",columnWidth:1,name:"refreshData",bind:"{refreshData}",uncheckedValue:!1,boxLabel:"离开此标签页后，再次返回此标签页时将刷新当前标签页的列表数据！"}]}),e="操作设置";n.getStore().entity&&n.getStore().entity.menu&&(e=FastExt.Store.getStoreMenuText(n.getStore())+"-"+e);var o=parseInt((.3*document.body.clientWidth).toFixed(0)),a=Ext.create("Ext.window.Window",{title:e,iconCls:"extIcon extSet",height:400,width:o,minHeight:400,minWidth:300,layout:"border",resizable:!1,animateTarget:t,items:[i],modal:!0,constrain:!0,buttons:["->",{text:"保存配置",iconCls:"extIcon extSave whiteColor",handler:function(){FastExt.Dialog.showWait("正在保存中…"),FastExt.Server.saveExtConfig(n.code,"GridOperate",Ext.encode(i.getForm().getValues()),function(t,e){FastExt.Dialog.hideWait(),t?(n.operate=i.getForm().getValues(),FastExt.Dialog.toast("操作设置成功！"),a.close()):Ext.Msg.alert("系统提醒",e)})}},{text:"取消",iconCls:"extIcon extClose",handler:function(){a.close()}}]});a.show()},Grid.getColumnEnumName=function(t){return FastExt.Grid.isEnumColumn(t)&&Ext.isObject(t.field)?t.field.enumName:null},Grid.getColumnFieldType=function(t){return Ext.isObject(t.field)?t.field.xtype:t.field},Grid.exportGrid=function(l){var t,d;l.getStore().entity?(t="您确定导出当前条件下的所有数据吗？",0<(d=l.getSelection()).length&&(t="您确定导出选中的"+d.length+"条数据吗？"),Ext.Msg.confirm("系统提醒",t,function(t,e){if("yes"===t){var t=l.getStore().proxy.extraParams,n={};if(l.getStore().entity.menu&&(n.title=l.getStore().entity.menu.text),0<d.length)for(var i=0;i<d.length;i++)for(var o=d[i],a=0;a<l.getStore().entity.idProperty.length;a++){var r=l.getStore().entity.idProperty[a],s="where['"+r+"#']";n[s]||(n[s]=[]),n[s].push(o.get(r))}Ext.each(l.getColumns(),function(t,e){t.isHidden()||Ext.isEmpty(t.dataIndex)||(n["column["+e+"].width"]=t.width,n["column["+e+"].text"]=t.configText,n["column["+e+"].groupHeaderText"]=t.groupHeaderText,n["column["+e+"].enum"]=FastExt.Grid.getColumnEnumName(t),n["column["+e+"].dataIndex"]=t.dataIndex,n["column["+e+"].file"]=FastExt.Grid.isFileColumn(t),n["column["+e+"].files"]=FastExt.Grid.isFilesColumn(t))}),FastExt.Dialog.showWait("正在导出中……"),FastExt.Server.exportExcel(FastExt.Json.mergeJson(n,t),function(t,e,n){FastExt.Dialog.hideWait(),t?(FastExt.Dialog.toast(n),location.href="attach/"+e):Ext.Msg.alert("系统提醒","导出失败！"+n)})}})):Ext.Msg.alert("系统提醒","导出失败！Grid的DataStore未绑定Entity!")},Grid.downExcelModel=function(t){FastExt.Dialog.showWait("正在生成中……");var n={entityCode:t.getStore().entity.entityCode};t.getStore().entity.menu&&(n.title=t.getStore().entity.menu.text),Ext.each(t.getColumns(),function(t,e){FastExt.Grid.isFileColumn(t)||FastExt.Grid.isFilesColumn(t)||!FastExt.Base.toBool(t.excelHeader,!0)||t.isHidden()||Ext.isEmpty(t.dataIndex)||(n["column["+(e=e<10?"0"+e:e)+"].width"]=t.width,n["column["+e+"].text"]=t.configText,n["column["+e+"].groupHeaderText"]=t.groupHeaderText,n["column["+e+"].enum"]=FastExt.Grid.getColumnEnumName(t),n["column["+e+"].type"]=FastExt.Grid.getColumnFieldType(t),n["column["+e+"].dataIndex"]=t.dataIndex,FastExt.Grid.isLinkColumn(t)&&(n["column["+e+"].dataIndex"]=t.field.name))}),FastExt.Server.excelModule(n,function(t,e,n){FastExt.Dialog.hideWait(),t?(FastExt.Dialog.toast("生成成功！"),location.href="attach/"+e):Ext.Msg.alert("系统提醒","生成失败！"+n)})},Grid.importExcel=function(e,r,s,l){return new Ext.Promise(function(i,t){s=s?Ext.Array.clone(s):[],l=l||FastExt.Server.importEntityExcelUrl(),s.push({xtype:"filefield",fieldLabel:"Excel文件",buttonText:"选择文件",allowBlank:!1,name:"file",columnWidth:1,listeners:{change:function(t,e,n){null!=e&&0!=e.length&&(FastExt.FileModule.excel().match(e)||(o.form.reset(),Ext.Msg.alert("系统提醒","请上传有效的Excel文档！")))}}});var o=Ext.create("Ext.form.FormPanel",{url:l,method:"POST",margin:"5",fileUpload:!0,width:400,callBacked:!1,border:0,layout:"column",defaults:{labelWidth:80,margin:"5 5 5 5",labelAlign:"right",emptyText:"请填写"},items:s,doSubmit:function(){var n,t=o.form;t.isValid()&&((n=new Ext.LoadMask({msg:"正在导入中…",target:a})).show(),t.submit({params:r,success:function(t,e){n.destroy(),Ext.Msg.alert("系统提醒",e.result.message,function(){FastExt.Base.runCallBack(i,e.result),a.close()})},failure:function(t,e){n.destroy(),Ext.Msg.alert("系统提醒","导入失败！"+e.result.message)}}))},listeners:{render:function(t){try{new Ext.util.KeyMap({target:t.getEl(),key:13,fn:o.doSubmit,scope:Ext.getBody()})}catch(t){console.error(t)}}}}),n="btnSubmit"+(new Date).getTime(),a=Ext.create("Ext.window.Window",{title:"导入Excel数据",layout:"fit",resizable:!1,scrollable:!1,items:[o],modal:!0,iconCls:"extIcon extUpload",animateTarget:e,constrain:!0,buttons:[{text:"重置",width:88,iconCls:"extIcon extReset",handler:function(){o.form.reset()}},{text:"上传",width:88,id:n,iconCls:"extIcon extOk",handler:function(){o.doSubmit()}}],listeners:{show:function(t,e){1===s.length&&(o.getForm().findField("file").fileInputEl.dom.click(),Ext.getCmp(n).focus())}}});a.show()})},Grid.downDataGrid=function(l){var t,d;l.getStore().entity?(t="您确定下载当前条件下的所有数据吗？",0<(d=l.getSelection()).length&&(t="您确定下载选中的"+d.length+"条数据吗？"),Ext.Msg.confirm("系统提醒",t,function(t,e){if("yes"===t){var t=l.getStore().proxy.extraParams,n={};if(l.getStore().entity.menu&&(n.title=l.getStore().entity.menu.text),0<d.length)for(var i=0;i<d.length;i++)for(var o=d[i],a=0;a<l.getStore().entity.idProperty.length;a++){var r=l.getStore().entity.idProperty[a],s="where['"+r+"#']";n[s]||(n[s]=[]),n[s].push(o.get(r))}FastExt.Dialog.showWait("正在下载中……"),FastExt.Server.downData(FastExt.Json.mergeJson(n,t),function(t,e,n){FastExt.Dialog.hideWait(),t?(FastExt.Dialog.toast(e),location.href="attach/"+n):Ext.Msg.alert("系统提醒",e)})}})):Ext.Msg.alert("系统提醒","下载失败！Grid的DataStore未绑定Entity!")},Grid.loadDataGrid=function(e,r){return new Ext.Promise(function(i,t){var o=Ext.create("Ext.form.FormPanel",{url:FastExt.Server.loadEntityDataUrl(),method:"POST",margin:"5",fileUpload:!0,width:400,callBacked:!1,border:0,layout:"column",defaults:{labelWidth:80,margin:"5 5 5 5",labelAlign:"right",emptyText:"请填写"},items:[{xtype:"filefield",fieldLabel:"数据文件",buttonText:"选择文件",allowBlank:!1,name:"file",columnWidth:1,listeners:{change:function(t,e,n){null!=e&&0!=e.length&&(FastExt.FileModule.data().match(e)||(o.form.reset(),Ext.Msg.alert("系统提醒","请上传有效的数据文件！")))}}}],doSubmit:function(){var n,t=o.form;t.isValid()&&((n=new Ext.LoadMask({msg:"正在上传中…",target:a})).show(),t.submit({params:r,success:function(t,e){n.destroy(),Ext.Msg.alert("系统提醒",e.result.message,function(){FastExt.Base.runCallBack(i,e.result),a.close()})},failure:function(t,e){n.destroy(),Ext.Msg.alert("系统提醒","上传失败！"+e.result.message)}}))},listeners:{render:function(t){try{new Ext.util.KeyMap({target:t.getEl(),key:13,fn:o.doSubmit,scope:Ext.getBody()})}catch(t){console.error(t)}}}}),n="btnSubmit"+(new Date).getTime(),a=Ext.create("Ext.window.Window",{title:"上传实体数据",layout:"fit",resizable:!1,scrollable:!1,items:[o],modal:!0,iconCls:"extIcon extUpload",animateTarget:e,constrain:!0,buttons:[{text:"重置",width:88,iconCls:"extIcon extReset",handler:function(){o.form.reset()}},{text:"上传",width:88,id:n,iconCls:"extIcon extOk",handler:function(){o.doSubmit()}}],listeners:{show:function(t,e){o.getForm().findField("file").fileInputEl.dom.click(),Ext.getCmp(n).focus()}}});a.show()})},Grid.saveGridColumn=function(a){return Ext.isEmpty(a.code)?FastExt.Base.getEmptyPromise():new Ext.Promise(function(n,e){try{var o={};Ext.each(a.getColumns(),function(t,e){var n,i;Ext.isEmpty(t.dataIndex)||!FastExt.System.isSuperRole()&&!t.hideable&&t.hidden||((n={column:!0}).width=t.width,n.hidden=t.isHidden(),n.locked=t.isLocked(),n.text=t.configText,n.dataIndex=t.dataIndex,n.groupHeaderText=t.groupHeaderText,a.getStore().entity&&(n.entityCode=a.getStore().entityCode),(i=a.getStore().getSorters().getByKey(t.dataIndex))&&(n.sortDirection=i.getDirection()),n.searchLink=t.searchLink,n.index=t.getIndex(),n.rendererFunction=t.rendererFunction,(i=FastExt.Cache.getCache(t.getRenderCacheKey()))&&Ext.isEmpty(n.rendererFunction)&&(n.rendererFunction=i,FastExt.Cache.removeCache(t.getRenderCacheKey())),Ext.isEmpty(n.rendererFunction)&&(i="function "+(i=t.renderer.toString()).substring(i.indexOf("(")),n.renderer=i),FastExt.Base.toBool(t.editable,!0)?n.editorField=FastExt.Grid.getColumnSimpleEditorJson(t):n.editorField="",o[t.code]=n)});var t={pageSize:a.getStore().pageSize,column:!1};o.PageTool=t;var i={};a.getStore()&&a.getStore().entity&&a.getStore().entity.menu&&(i.menuId=a.getStore().entity.menu.id,FastExt.Base.toBool(a.tabPanelList,!1)&&(i.entityCode=a.getStore().entity.entityCode)),FastExt.Server.saveExtConfig(a.code,"GridColumn",Ext.encode(o),function(t,e){n(t)},i)}catch(t){e(t)}})},Grid.saveGridButton=function(t,o){return!Ext.isEmpty(t.code)&&!Ext.isEmpty(t.bindDetailButtons)&&!Ext.isEmpty(o)&&FastExt.Base.toBool(t.tabPanelList,!1)?new Ext.Promise(function(n,e){try{var i=[];Ext.each(t.bindDetailButtons,function(t,e){var n={};n.text=t.text,n.iconCls=t.iconCls,n.icon=t.icon;t="function "+(t=t.handler.toString()).substring(t.indexOf("("));n.handler=t,i.push(n)});FastExt.Server.saveExtConfig(o.entityCode,"GridButton",Ext.encode(i),function(t,e){n(t)},{})}catch(t){e(t)}}):FastExt.Base.getEmptyPromise()},Grid.restoreGridButton=function(t){return new Ext.Promise(function(i,e){try{FastExt.Server.showExtConfig(t,"GridButton",function(t,e){var n=[];t&&(n=Ext.decode(e)),i(n)})}catch(t){e(t)}})},Grid.restoreGridColumn=function(E){return new Ext.Promise(function(p,e){try{if(Ext.isEmpty(E.code))return void e("Grid编号[code]不可为空！");FastExt.Server.showExtConfig(E.code,"GridColumn",function(t,e){var n={};t&&(n=Ext.decode(e));for(var i=[],o={},a=[],r=E.getColumns(),s=0;s<r.length;s++){var l=r[s];if(!Ext.isEmpty(l.dataIndex)&&(!FastExt.Base.toBool(E.power,!0)||l.hideable||!l.hidden)){var d=l.cloneConfig();if(d.groupHeaderText=l.groupHeaderText,n.hasOwnProperty(l.code)){var c=n[l.code];for(u in c)"renderer"!==u&&"rendererFunction"!==u&&(d[u]=c[u])}d.sortDirection&&a.push({property:d.dataIndex,direction:d.sortDirection}),Ext.isEmpty(d.groupHeaderText)||(l=d.groupHeaderText,o.hasOwnProperty(l)||(o[l]=[]),o[l].push(i.length)),i.push(d)}}var u,x=[];for(u in o){var m=o[u];if(!(m.length<2)){for(var g=999999,h=[],s=0;s<m.length;s++){var f=m[s],g=Math.min(g,f),f=i[f];h.push(f)}h.sort(function(t,e){return t.index-e.index}),i[g]={index:g,text:u,menuDisabled:!0,columns:h},x=x.concat(h)}}for(s=0;s<x.length;s++)i=Ext.Array.remove(i,x[s]);i.sort(function(t,e){return t.index-e.index}),n.hasOwnProperty("PageTool")&&(t=n.PageTool,E.getStore().pageSize=Math.min(t.pageSize,FastExt.Store.maxPageSize),(e=E.down("combo[pageTool=true]"))&&e.setValue(Math.min(t.pageSize,FastExt.Store.maxPageSize))),FastExt.System.silenceGlobalSave||E.getStore().sort(a),E.reconfigure(i),p()})}catch(t){e(t)}})},Grid.restoreGridOperate=function(i){return new Ext.Promise(function(n,e){try{if(Ext.isEmpty(i.code))return void e("Grid编号[code]不可为空！");FastExt.Server.showExtConfig(i.code,"GridOperate",function(t,e){t?i.operate=Ext.decode(e):Ext.isEmpty(i.operate)&&(i.operate=new GridOperate),n()})}catch(t){e(t)}})},Grid.getColumnGrid=function(t){return t.grid||(t.grid=t.up("treepanel,grid")),t.grid.ownerGrid||null},Grid.getHeaderContainerGrid=function(t){return t.grid||(t.grid=t.up("treepanel,grid")),t.grid.ownerGrid||null},Grid.showColumnCompute=function(t,i,o){try{if(!i)return void Ext.Msg.alert("系统提醒","计算失败!计算列无效！");if(!t.getStore().entity)return void Ext.Msg.alert("系统提醒","计算失败！Grid的DataStore未绑定Entity!");var e=t.getSelection();if(0<e.length){for(var n=null,a="",r=0;r<e.length;r++){var s=e[r],l=parseFloat(s.get(i.dataIndex));"sum"===o?(a=i.configText+"总和：",n=n||0,n+=l):"avg"===o?(a=i.configText+"平均值：",n=n||0,n+=l):"min"===o?(a=i.configText+"最小值：",n=n||l,n=Math.min(l,n)):"max"===o&&(a=i.configText+"最大值：",n=n||l,n=Math.max(l,n))}"avg"===o&&(n/=e.length);try{Ext.isFunction(i.renderer)?Ext.Msg.alert("系统提醒","当前选中的数据，"+a+i.renderer(n)):Ext.Msg.alert("系统提醒","当前选中的数据，"+a+n)}catch(t){Ext.Msg.alert("系统提醒","当前选中的数据，"+a+n)}return}var d=t.getStore().proxy.extraParams,c={entityCode:t.getStore().entity.entityCode,field:i.dataIndex,type:o};FastExt.Dialog.showWait("正在计算中……"),$.post("entity/compute",FastExt.Json.mergeJson(c,d),function(e){FastExt.Dialog.hideWait();var n="";"sum"===o?n=i.configText+"总和：":"avg"===o?n=i.configText+"平均值：":"min"===o?n=i.configText+"最小值：":"max"===o&&(n=i.configText+"最大值：");try{Ext.isFunction(i.renderer)?Ext.Msg.alert("系统提醒",n+i.renderer(e.data)):Ext.Msg.alert("系统提醒",n+e.data)}catch(t){Ext.Msg.alert("系统提醒",n+e.data)}})}catch(t){console.error(t)}},Grid.getColumnSimpleEditor=function(t,e){try{var n={};return Ext.isObject(t.field)?n.xtype=t.field.xtype:n.xtype=t.field,Ext.isObject(t.config.field)&&(n=e?FastExt.Base.copy(t.config.field):t.config.field),e&&((FastExt.Form.isContentField(t.field)||FastExt.Form.isHtmlContentField(t.field)||FastExt.Form.isTargetField(t.field))&&(n.xtype="textfield"),FastExt.Form.isPCAField(t.field)&&(n.selectType=1,0<=t.text.indexOf("省")&&(n.level=1),0<=t.text.indexOf("市")&&(n.level=2),0<=t.text.indexOf("区")&&(n.level=3))),Ext.isEmpty(n.xtype)&&(n.xtype="textfield"),n.dataIndex=t.dataIndex,e&&(n.columnSearchField=!0),n}catch(t){console.error(t)}return null},Grid.getColumnSimpleEditorJson=function(t,e){e=FastExt.Grid.getColumnSimpleEditor(t,e);return e?FastExt.Json.objectToJson(e):null},Grid.showBatchEditColumn=function(i){var t=i.batchField;if(!t){if(!(t=FastExt.Grid.getColumnSimpleEditor(i)))return;t.flex=1,t.emptyText="请输入",t=i.batchField=Ext.create(t)}function o(n){var t;Ext.isEmpty(n.getValue())||FastExt.Grid.getColumnGrid(i).getStore()&&(FastExt.Grid.getColumnGrid(i).getStore().holdUpdate=!0,0<(t=FastExt.Grid.getColumnGrid(i).getSelectionModel().getSelection()).length?Ext.each(t,function(t,e){FastExt.Store.setRecordValue(t,i.dataIndex,n)}):FastExt.Grid.getColumnGrid(i).getStore().each(function(t,e){FastExt.Store.setRecordValue(t,i.dataIndex,n)}),FastExt.Grid.getColumnGrid(i).getStore().holdUpdate=!1,FastExt.Grid.getColumnGrid(i).getStore().fireEvent("endupdate"))}var e="批量修改当前页的【"+i.configText+"】数据";0<FastExt.Grid.getColumnGrid(i).getSelection().length&&(e="批量修改选择的"+FastExt.Grid.getColumnGrid(i).getSelection().length+"条【"+i.configText+"】数据"),Ext.isFunction(t.setEmptyText)&&t.setEmptyText(e),Ext.isFunction(t.showWindow)?t.showWindow(i,function(t){o(t)},e):(i.batchEditMenu||(i.batchEditMenu=Ext.create("Ext.menu.Menu",{showSeparator:!1,scrollToHidden:!0,layout:"fit",doUpdate:function(){var t=this,n=t.items.get(0).items.get(0);if(!n.isValid())return FastExt.Component.shakeComment(t),void FastExt.Dialog.toast(FastExt.Form.getFieldError(n)[0]);var e=this.down("button[name='confirm']");e.setText("稍等"),e.setDisabled(!0),new Ext.Promise(function(t,e){o(n),n.setValue(null),t()}).then(function(){e.setText("确定"),e.setDisabled(!1),t.hide()})},items:[{xtype:"panel",layout:{type:"hbox",align:"stretch"},style:{background:"#ffffff",borderWidth:1,borderColor:"#ffffff",color:"#eeeee"},border:0,items:[t,{xtype:"button",text:"确定",name:"confirm",width:60,margin:"0 0 0 2",handler:function(){i.batchEditMenu.doUpdate()}}]}],listeners:{show:function(t,e){t.items.get(0).items.get(0).focus()}}}),i.batchEditMenu.addCls("edit-menu"),i.batchEditMenu.addCls("edit-details-menu")),i.batchEditMenu.setWidth(i.getWidth()),i.batchEditMenu.showBy(i,"tl"))},Grid.showBatchEditColumnRandom=function(i){var c,u,t,e,n,o,a,r,s,l,d,x,m,g;Ext.isFunction(window.showRandomData)?window.showRandomData(i):(c="Random"+Ext.now(),n=!(e=1),d="Y-m-d H:i:s",u=FastExt.Grid.getColumnGrid(i).getStore().getTotalCount(),t="批量随机生成当前页的【"+i.configText+"】列数据",0<FastExt.Grid.getColumnGrid(i).getSelection().length&&(t="批量随机生成选择的"+FastExt.Grid.getColumnGrid(i).getSelection().length+"条【"+i.configText+"】列数据",u=FastExt.Grid.getColumnGrid(i).getSelection().length),FastExt.Grid.isNumberColumn(i)?(e=2,n=!0):FastExt.Grid.isDateColumn(i)?(e=3,Ext.isObject(i.field)&&(d=i.field.format),n=!0):FastExt.Grid.isEnumColumn(i)||FastExt.Grid.isComboColumn(i)?(e=5,n=!0,o=[],(a=Ext.create(i.field)).getStore().each(function(t,e){o.push(t.get(a.valueField))}),x=o.join(",")):FastExt.Grid.isContentColumn(i)&&(e=4),x={xtype:"fieldcontainer",layout:"column",columnWidth:1,id:c+"_5",hidden:!0,disabled:!0,defaults:{labelWidth:60,margin:"5 5 5 5",labelAlign:"right",columnWidth:1,emptyText:"请填写"},random:function(){for(var t=[],e=Ext.getCmp(c+"_numberList").getValue().toString().split(","),n=0;n<Number.MAX_VALUE;n++){var i=e[FastExt.Base.randomInt(0,e.length-1)];if(!Ext.isEmpty(i)&&(t.push(i),t.length===u))break}return t},items:[{xtype:"fieldset",columnWidth:1,layout:"column",defaults:{labelWidth:60,margin:"5 5 5 5",labelAlign:"right",columnWidth:1,emptyText:"请填写"},title:"数字集合设置",items:[{fieldLabel:"数字集合",id:c+"_numberList",allowBlank:!(d={xtype:"fieldcontainer",layout:"column",columnWidth:1,id:c+"_4",hidden:!0,disabled:!0,defaults:{labelWidth:60,margin:"5 5 5 5",labelAlign:"right",columnWidth:1,emptyText:"请填写"},random:function(){var t=[],e=Ext.getCmp(c+"_minLength").getValue(),n=Ext.getCmp(c+"_maxLength").getValue(),i=Ext.getCmp(c+"_longTextList").getValue();if(!(n<e)){for(var o=i.toString().trimAllSymbol().split(""),a=0;a<Number.MAX_VALUE;a++){for(var r=FastExt.Base.randomInt(e,n),s=[],l=0;l<Number.MAX_VALUE;l++){var d=o[FastExt.Base.randomInt(0,o.length-1)];if(s.push(d),s.length===r)break}if(t.push(s.join("")),t.length===u)break}return t}FastExt.Dialog.showAlert("系统提醒","最大长度必须大于最小长度！")},items:[{xtype:"fieldset",columnWidth:1,layout:"column",defaults:{labelWidth:60,margin:"5 5 5 5",labelAlign:"right",columnWidth:1,emptyText:"请填写"},title:"文字设置",items:[{fieldLabel:"文字库",id:c+"_longTextList",allowBlank:!(l={xtype:"fieldcontainer",layout:"column",columnWidth:1,id:c+"_3",hidden:!0,disabled:!0,defaults:{labelWidth:60,margin:"5 5 5 5",labelAlign:"right",columnWidth:1,emptyText:"请填写"},random:function(){var t=[],e=Ext.getCmp(c+"_minDate").getValue(),n=Ext.Date.parse(e,FastExt.Base.guessDateFormat(e)),e=Ext.getCmp(c+"_maxDate").getValue(),i=Ext.Date.parse(e,FastExt.Base.guessDateFormat(e));if(!(n.getTime()>i.getTime())){for(var o=0;o<Number.MAX_VALUE;o++){var a=i.getTime()-n.getTime(),a=Math.random()*a+n.getTime(),a=new Date(a);if(t.push(Ext.Date.format(a,Ext.getCmp(c+"_minDate").format)),t.length===u)break}return t}FastExt.Dialog.showAlert("系统提醒","最大日期必须大于最小日期！")},items:[{xtype:"fieldset",columnWidth:1,layout:"column",defaults:{labelWidth:60,margin:"5 5 5 5",labelAlign:"right",columnWidth:1,emptyText:"请填写"},title:"日期设置",items:[{fieldLabel:"最小日期",xtype:"datefield",id:c+"_minDate",allowBlank:!(s={xtype:"fieldcontainer",layout:"column",columnWidth:1,id:c+"_2",hidden:!0,disabled:!0,defaults:{labelWidth:60,margin:"5 5 5 5",labelAlign:"right",columnWidth:1,emptyText:"请填写"},random:function(){var t=[],e=Ext.getCmp(c+"_dotNumber").getValue(),n=Ext.getCmp(c+"_minNumber").getValue(),i=Ext.getCmp(c+"_maxNumber").getValue();if(!(i<n)){for(var o=0;o<Number.MAX_VALUE;o++){var a=Math.random()*(i-n)+n;if(t.push(a.toFixed(e)),t.length===u)break}return t}FastExt.Dialog.showAlert("系统提醒","最大数字必须大于最小数字！")},items:[{xtype:"fieldset",columnWidth:1,layout:"column",defaults:{labelWidth:60,margin:"5 5 5 5",labelAlign:"right",columnWidth:1,emptyText:"请填写"},title:"数字设置",items:[{fieldLabel:"保留位数",id:c+"_dotNumber",value:0,allowBlank:!(r={xtype:"fieldcontainer",layout:"column",columnWidth:1,id:c+"_1",defaults:{labelWidth:60,margin:"5 5 5 5",labelAlign:"right",columnWidth:1,emptyText:"请填写"},random:function(){for(var t=[],e=Ext.getCmp(c+"_textPrefix").getValue(),n=Ext.getCmp(c+"_textStartNumber").getValue(),i=parseInt(n);i<Number.MAX_VALUE&&(t.push(e+i),t.length!==u);i++);return t},items:[{xtype:"fieldset",columnWidth:1,layout:"column",defaults:{labelWidth:60,margin:"5 5 5 5",labelAlign:"right",columnWidth:1,emptyText:"请填写"},title:"文字设置",items:[{fieldLabel:"文字前缀",id:c+"_textPrefix",allowBlank:!1,xtype:"textfield"},{fieldLabel:"开始序数",id:c+"_textStartNumber",value:1,allowBlank:!1,xtype:"numberfield"}]}]}),xtype:"numberfield"},{fieldLabel:"最小数字",id:c+"_minNumber",value:0,allowBlank:!1,xtype:"numberfield"},{fieldLabel:"最大数字",id:c+"_maxNumber",allowBlank:!1,xtype:"numberfield"}]}]}),format:d},{fieldLabel:"最大日期",xtype:"datefield",id:c+"_maxDate",allowBlank:!1,format:d}]}]}),xtype:"textfield",listeners:{change:function(t,e,n,i){Ext.getCmp(c+"_maxLength").setValue(e.truthLength())}}},{fieldLabel:"最小长度",id:c+"_minLength",value:1,minValue:1,allowBlank:!1,xtype:"numberfield"},{fieldLabel:"最大长度",id:c+"_maxLength",allowBlank:!1,minValue:1,xtype:"numberfield"}]}]}),value:x,xtype:"textfield"},{xtype:"displayfield",value:"以英文逗号（,）为分隔符！"}]}]},m=Ext.create("Ext.form.Panel",{bodyPadding:5,region:"center",autoScroll:!0,layout:"column",defaults:{labelWidth:60,margin:"5 5 5 5",labelAlign:"right",columnWidth:1,emptyText:"请填写"},items:[{xtype:"combo",name:"autoType",fieldLabel:"随机类型",editable:!1,displayField:"text",valueField:"id",value:1,listeners:{change:function(t,e,n,i){Ext.getCmp(c+"_"+n).setHidden(!0),Ext.getCmp(c+"_"+n).setDisabled(!0),Ext.getCmp(c+"_"+e).setHidden(!1),Ext.getCmp(c+"_"+e).setDisabled(!1)}},store:Ext.create("Ext.data.Store",{fields:["id","text"],data:[{text:"文本",id:1},{text:"长文本",id:4},{text:"数字",id:2},{text:"数字集合",id:5},{text:"日期",id:3}]})},r,s,l,d,x]}),(g=Ext.create("Ext.window.Window",{title:t,height:360,iconCls:"extIcon extRandom",width:450,layout:"border",items:[m],modal:!0,constrain:!0,listeners:{show:function(){var t=m.getField("autoType");t.setValue(e),t.setReadOnly(n)}},buttons:["->",{text:"取消",iconCls:"extIcon extClose",handler:function(){g.close()}},{text:"立即生成",iconCls:"extIcon extOk whiteColor",handler:function(){var n,t;m.getForm().isValid()&&(t=m.getFieldValue("autoType"),(t=Ext.getCmp(c+"_"+t).random())&&0!==t.length&&(0!==(n=t).length&&FastExt.Grid.getColumnGrid(i).getStore()&&(FastExt.Grid.getColumnGrid(i).getStore().holdUpdate=!0,0<(t=FastExt.Grid.getColumnGrid(i).getSelectionModel().getSelection()).length?Ext.each(t,function(t,e){Ext.isObject(n[e])?FastExt.Store.setRecordValue(t,i.dataIndex,n[e]):t.set(i.dataIndex,n[e])}):FastExt.Grid.getColumnGrid(i).getStore().each(function(t,e){Ext.isObject(n[e])?FastExt.Store.setRecordValue(t,i.dataIndex,n[e]):t.set(i.dataIndex,n[e])}),FastExt.Grid.getColumnGrid(i).getStore().holdUpdate=!1,FastExt.Grid.getColumnGrid(i).getStore().fireEvent("endupdate")),g.close()))}}]})).show())},Grid.configColumnSearchLink=function(e){var t="";e.searchLink&&(t=e.searchLink.checked),FastExt.System.showMenuColumns(e,t).then(function(t){0<t.columns.length?(e.searchLink=t,FastExt.Dialog.toast("配置成功！")):(e.searchLink=null,FastExt.Dialog.toast("已清空搜索链！"))})},Grid.refreshColumnStyle=function(t){try{var e;Ext.isEmpty(t.dataIndex)||(e=t.sortDirection,e=Ext.isEmpty(e)?"<font size='1'></font>":"ASC"===e?"<font color='red' size='1'>&nbsp;&nbsp;[正序]</font>":"<font color='red' size='1'>&nbsp;&nbsp;[倒序]</font>",Ext.isEmpty(t.sumText)&&(t.sumText="<font size='1'></font>"),t.searching?(t.setText(FastExt.Base.getSVGIcon("extSearch")+"&nbsp;"+t.configText+t.sumText+e+"&nbsp;"),t.setStyle("color","red")):(t.setText("&nbsp;"+t.configText+t.sumText+e+"&nbsp;"),t.setStyle("color","#444444")),FastExt.Grid.checkColumnSort(FastExt.Grid.getColumnGrid(t)))}catch(t){console.error(t)}},Grid.checkColumnSort=function(t){try{var e,n=0<t.getStore().getSorters().length,i=t.child("#pagingToolBar");i&&(e=i.down("button[toolType=sortBtn]"),n?e.setIconCls("extIcon extSort redColor"):e.setIconCls("extIcon extSort grayColor"))}catch(t){console.error(t)}},Grid.configColumnProperty=function(t){try{t.configText=t.text,t.toSearchKey=function(t,e){return"where['@"+this.getIndex()+FastExt.Base.toString(t.link,"&")+this.dataIndex+t.compare+":index"+e+"']"},t.searchValue=function(t){this.where||(this.where=[]),this.where.push({link:"&",compare:"=",value:t}),this.doSearch()},t.getRenderCacheKey=function(){return FastExt.Grid.getColumnGrid(this).code+"-"+this.dataIndex+"-render"},t.clearSearch=function(){var t=this,e=FastExt.Grid.getColumnGrid(t).getStore().proxy.extraParams;if(t.where)for(var n=0;n<t.where.length;n++){var i=t.toSearchKey(t.where[n],n);e.hasOwnProperty(i)&&delete e[i]}t.where=[],t.searchMenu=null,t.searching=!1,FastExt.Grid.refreshColumnStyle(t)},t.doSearch=function(t){var e=this,n=FastExt.Grid.getColumnGrid(e).getStore().proxy.extraParams;if(e.where){for(var i=0;i<e.where.length;i++){var o=e.where[i],a=e.toSearchKey(o,i),r=o.value;0<=o.compare.indexOf("?")&&(r="%"+o.value+"%"),n[a]=r}FastExt.Base.toBool(t,!0)&&FastExt.Grid.getColumnGrid(e).getStore().loadPage(1),e.searching=0!==e.where.length,FastExt.Grid.refreshColumnStyle(e)}},t.where&&0<t.where.length&&t.doSearch(!1),t.isSubHeader?t.groupHeaderText=t.ownerCt.text:t.groupHeaderText=null,Ext.isEmpty(t.field)&&(t.editable=!1)}catch(t){console.error(t)}},Grid.configColumnListener=function(t){try{t.on("blur",function(t,e,n){})}catch(t){console.error(t)}},Grid.buildSearchItem=function(t,e){try{var n=FastExt.Grid.getColumnSimpleEditor(t,!0);return n?(n.fromHeadSearch=!0,n.validator=null,n.flex=1,n.margin="2 2 0 0",n.repeatTriggerClick=!1,n.onClearValue=function(){Ext.isFunction(this.ownerCt.removeSearch)?this.ownerCt.removeSearch():this.ownerCt.destroy()},n.triggers={close:{cls:"text-clear",handler:function(){this.onClearValue()}}},FastExt.Form.isEnumField(n)?n.editable=!1:n.editable=!0,n.emptyText="请输入条件值",e||(e={link:"&",compare:"=",value:""},FastExt.Form.isTextField(n)?e.compare="?":FastExt.Form.isDateField(n)&&(e.compare=">")),n.value=e.value,n.submitValue=!1,n.name="value",n.itemId="editorField",{xtype:"panel",margin:"0",searchItem:!0,border:0,flex:1,region:"center",layout:{type:"hbox",align:"stretch"},toParam:function(){var e={};return this.items.each(function(t){if(Ext.isFunction(t.getValue)){if(!t.isValid())return FastExt.Component.shakeComment(t),FastExt.Dialog.toast(FastExt.Form.getFieldError(t)[0]),e=null,!1;Ext.isDate(t.getValue())?e[t.getName()]=Ext.Date.format(t.getValue(),t.format):e[t.getName()]=t.getValue()}}),e},setParam:function(e){this.items.each(function(t){Ext.isFunction(t.getValue)&&("compare"===t.getName()?t.setValue(e.compare):"link"===t.getName()?t.setValue(e.link):t.setValue(e.value))})},refreshField:function(){var t=this.getComponent("compare").getValue(),e=this.getComponent("editorField");e.setDisabled(!1),"~"!=t&&"!~"!=t||(e.setValue("<null>"),e.setDisabled(!0))},items:[{xtype:"combo",name:"link",value:FastExt.Base.toString(e.link,"&"),margin:"2 2 0 2",width:35,valueField:"text",editable:!1,hideTrigger:!0,tpl:Ext.create("Ext.XTemplate",'<ul class="x-list-plain"><tpl for=".">','<li role="option" class="x-boundlist-item" style="font-size: 12px;">{desc}</li>',"</tpl></ul>"),listeners:{afterrender:function(t,e){t.getPicker().setMinWidth(100)}},store:FastExt.Store.getCompareLinkDataStore()},{xtype:"combo",name:"compare",value:e.compare,itemId:"compare",margin:"2 2 0 2",width:35,valueField:"text",editable:!1,hideTrigger:!0,tpl:Ext.create("Ext.XTemplate",'<ul class="x-list-plain"><tpl for=".">','<li role="option" class="x-boundlist-item" style="font-size: 12px;">{desc}</li>',"</tpl></ul>"),listeners:{afterrender:function(t,e){t.getPicker().setMinWidth(100)},change:function(t,e,n){var i=t.ownerCt.getComponent("editorField");"~"!=n&&"!~"!=n||i.setValue(null),t.ownerCt.refreshField()}},store:FastExt.Store.getCompareDataStore()},n],listeners:{render:function(t,e){t.refreshField()}}}):void 0}catch(t){console.error(t)}return null},Grid.canColumnSearch=function(t){return!!FastExt.Base.toBool(FastExt.Grid.getColumnGrid(t).columnSearch,!0)&&(!FastExt.Grid.isFilesColumn(t)&&!FastExt.Grid.isFileColumn(t)&&(!!FastExt.Base.toBool(t.search,!0)&&!FastExt.Base.toBool(t.encrypt,!1)))},Grid.showColumnSearchMenu=function(i){try{if(!FastExt.Grid.canColumnSearch(i))return!1;if(i.searchMenu||(i.searchMenu=new Ext.menu.Menu({padding:"0 0 0 0",power:!1,showSeparator:!1,columnSearchMenu:!0,scrollToHidden:!0,style:{background:"#ffffff"},addSearchItem:function(t){var e=this.items.length-1;5<=e||this.insert(e,FastExt.Grid.buildSearchItem(i,t))},doSearch:function(){var n=[];this.items.each(function(t,e){if(t.searchItem){t=t.toParam();if(!t)return n=null,!1;Ext.isEmpty(t.value)||(t.index=e,n.push(t))}}),n&&(i.clearSearch(),i.where=n,i.doSearch(),this.hide())},items:[{xtype:"panel",layout:{type:"hbox",align:"stretch"},margin:"2",border:0,items:[{xtype:"button",text:"搜索",flex:1,iconCls:"extIcon extSearch",margin:"0 2 0 0",handler:function(){this.ownerCt.ownerCt.doSearch()}},{xtype:"button",iconCls:"extIcon extPlus fontSize14",width:35,handler:function(){this.ownerCt.ownerCt.addSearchItem()}}]}],listeners:{show:function(n,t){i.addCls("x-column-header-open"),1===n.items.length&&n.addSearchItem();try{new Ext.util.KeyMap({target:n.getEl(),key:13,fn:function(t,e){n.doSearch()},scope:n})}catch(t){console.error(t)}},hide:function(t,e){i.removeCls("x-column-header-open")}}}),i.searchMenu.addCls("header-search-menu")),i.where)for(var t=0;t<i.where.length;t++){var e=i.where[t];Ext.isEmpty(e.index)&&(e.index=t),e.index<i.searchMenu.items.length-1?i.searchMenu.items.getAt(e.index).setParam(e):i.searchMenu.addSearchItem(e)}return i.searchMenu.setWidth(Math.max(parseInt(i.getWidth()),200)),i.searchMenu.showBy(i,"tl-bl?"),!0}catch(t){console.error(t)}return!1},Grid.showColumnSearchWin=function(n,a){var i,o,t,r;n.searchWin?FastExt.Component.shakeComment(n.searchWin):(i=FastExt.Store.getGridColumnStore(a,!0),o=function(t,e){e=FastExt.Grid.buildSearchItem(FastExt.Grid.getColumn(a,t.get("id"),t.get("text")),e);return e.removeSearch=function(){this.ownerCt.destroy()},{xtype:"panel",flex:1,columnWidth:1,layout:"hbox",margin:"0",border:0,toParam:function(){var t={},e=this.items.get(0),e=e.getStore().findRecord("id",e.getValue(),0,!1,!1,!0);t.text=e.get("text"),t.dataIndex=e.get("id");e=this.items.get(1);return t=FastExt.Json.mergeJson(t,e.toParam())},items:[{xtype:"combo",region:"west",valueField:"id",displayField:"text",flex:.4,margin:"2 0 0 2",value:t.get("id"),editable:!1,listeners:{change:function(t,e,n,i){var o=this.up("panel");o.remove(o.items.get(1),!0);e=t.getStore().findRecord("id",e,0,!1,!1,!0),e=FastExt.Grid.buildSearchItem(FastExt.Grid.getColumn(a,e.get("id"),e.get("text")));e.removeSearch=function(){this.ownerCt.destroy()},o.insert(1,e)}},store:i},e]}},t=(t=a.searchItems)||[],r=Ext.create("Ext.form.FormPanel",{margin:"5",border:0,layout:"column",width:400,scrollable:!0,defaults:{labelWidth:80,margin:"5 5 5 5",labelAlign:"right",emptyText:"请填写"},items:t}),Ext.each(a.getColumns(),function(t){if(t.where){var e=i.findRecord("id",t.dataIndex,0,!1,!1,!0);if(e)for(var n=0;n<t.where.length;n++)r.add(o(e,t.where[n]))}}),0===r.items.length&&0<i.getCount()&&r.add(o(i.getAt(0))),n.searchWin=Ext.create("Ext.window.Window",{title:"搜索数据",layout:"fit",constrain:!0,iconCls:"extIcon extSearch",resizable:!0,minHeight:200,minWidth:400,height:200,animateTarget:n,items:[r],listeners:{close:function(t,e){n.searchWin=null}},buttons:[{text:"清空条件",iconCls:"extIcon extClear whiteColor",handler:function(){r.removeAll(),Ext.each(a.getColumns(),function(t){t.clearSearch()}),a.getStore().loadPage(1)}},"->",{text:"添加条件",iconCls:"extIcon extPlus",handler:function(){r.add(o(i.getAt(0)));var t=50+35*r.items.length+55;r.scrollTo(0,t,!1)}},{text:"确定",iconCls:"extIcon extOk",handler:function(){Ext.each(a.getColumns(),function(t){t.clearSearch()});var n=[];r.items.each(function(t){if(!t.toParam){var e={};return e["where['"+t.name+"']"]=t.getValue(),void Ext.apply(a.getStore().proxy.extraParams,e)}e=t.toParam();if(e&&!Ext.isEmpty(e.value)){t=FastExt.Grid.getColumn(a,e.dataIndex,e.text);if(!t)return!1;t.where||(t.where=[]),delete e.dataIndex,delete e.text,t.where.push(e),n.push(t)}}),Ext.each(n,function(t){t.doSearch(!1)}),a.getStore().loadPage(1)}}]}),a.ownerCt.add(n.searchWin)),n.searchWin.show()},Grid.getPageToolBar=function(o){var e=!1;o.entity&&FastExt.Base.toBool(o.entity.recycle,!1)&&(e=!0);var t=!1;o.where&&FastExt.Base.toBool(o.where["^fromRecycle"],!1)&&(t=!0);var n=FastExt.Store.getStoreMenuText(o),i=Ext.create("Ext.toolbar.Paging",{store:o,dock:"bottom",itemId:"pagingToolBar",pageSize:o.pageSize,displayInfo:!0,inputItemWidth:70,overflowHandler:"scroller"}),a={xtype:"combo",pageTool:!0,displayField:"text",valueField:"id",editable:!1,width:100,value:Math.min(o.pageSize,FastExt.Store.maxPageSize),store:FastExt.Store.getPageDataStore(),listeners:{change:function(t,e,n){if(!FastExt.System.silenceGlobalSave&&null!=e&&0!=e){if(!t.getStore().getById(e))return t.totalCount=e,void t.setValue(-1);-1===e?(this.ownerCt.pageSize=o.getTotalCount(),o.pageSize=o.getTotalCount(),Ext.isEmpty(t.totalCount)||(this.ownerCt.pageSize=t.totalCount,o.pageSize=t.totalCount)):(this.ownerCt.pageSize=e,o.pageSize=e),o.loadPage(1),o.grid&&o.grid.saveUIConfig(!0)}}}},r={xtype:"button",tooltip:"拷贝数据",subtext:"拷贝数据@"+n,checkSelect:2,iconCls:"extIcon extCopy2 grayColor",handler:function(){var t=o.grid.getSelection();0!==t.length?Ext.Msg.confirm("系统提醒","您确定复制选中的"+t.length+"条数据吗？",function(t,e){"yes"===t&&(FastExt.Dialog.showWait("正在复制数据中……"),FastExt.Store.commitStoreCopy(o.grid.getStore(),o.grid.getSelection()).then(function(t){t&&(o.grid.getSelectionModel().deselectAll(),o.grid.getStore().isGrouped()&&o.grid.getView().getFeature("group").collapseAll(),FastExt.Dialog.hideWait())}))}):FastExt.Dialog.showAlert("系统提醒","请选择需要复制的数据！")}},s={xtype:"button",tooltip:"清空数据",subtext:"清空数据@"+n,iconCls:"extIcon extClear grayColor",handler:function(){var n=FastExt.Store.getStoreMenuText(o.grid.getStore()),t="<div style='line-height: 170%;'>";t+="<b style='color: red;font-size: 18px;'>请您谨慎操作！</b><br/>",n&&(t+="<b style='color: red;font-size: 16px;'>当前页面【"+n+"】</b><br/>"),t+="<b style='font-size: 16px;'>您确定清空当前条件下的所有数据吗？！<br/>当前共"+o.getTotalCount()+"条数据！</b>",e&&(t+="<br/><b style='color: red;font-size: 14px;line-height: 18px;'>此操作将跳过回收站！</b>"),t+="</div>";t={title:"系统提醒",icon:Ext.Msg.WARNING,message:t,buttons:Ext.Msg.YESNO,defaultFocus:"no",cls:"redAlert",callback:function(t,e){"yes"===t&&FastExt.System.validOperate("清空【"+n+"】数据",function(){FastExt.Dialog.showWait("正在清空数据中……");var t=o.grid.getStore().proxy.extraParams,e={entityCode:o.entity.entityCode,all:!0};o.grid.getStore().entity.menu&&(e.menu=FastExt.Store.getStoreMenuText(o.grid.getStore())),FastExt.Server.deleteEntity(FastExt.Json.mergeJson(e,t),function(t,e){FastExt.Dialog.hideWait(),t&&o.loadPage(1),FastExt.Dialog.showAlert("系统提醒",e)})},30)}};Ext.Msg.on("hide",function(){var t;Ext.Msg.timeout&&(clearTimeout(Ext.Msg.timeout),(t=Ext.Msg.msgButtons.yes).setText("是"),t.enable())},this,{single:!0}),Ext.Msg.on("show",function(t){FastExt.Component.shakeComment(t,function(){var t=5;50<o.getTotalCount()&&(t=15),5e3<o.getTotalCount()&&(t=20),1e4<o.getTotalCount()&&(t=30),i(t)},3e3)},this,{single:!0}),Ext.Msg.show(t);var i=function(t){var e=Ext.Msg.msgButtons.yes;if(t<=0)return e.setText("立即清空"),void e.enable();e.setText(t+"秒后可操作"),e.disable(),Ext.Msg.timeout=setTimeout(function(){i(t-1)},1e3)};Ext.Msg.msgButtons.yes.disable()}};t&&(s.tooltip="清空回收站");var l={xtype:"button",tooltip:"回收站",iconCls:"extIcon extRecycle grayColor",handler:function(){FastExt.Grid.showRecycleGrid(this,o)}},d={xtype:"button",toolType:"searchBtn",tooltip:"搜索数据",iconCls:"extIcon extSearch grayColor",handler:function(){FastExt.Grid.showColumnSearchWin(this,o.grid)}},c={xtype:"button",toolType:"sortBtn",tooltip:"排序数据",iconCls:"extIcon extSort grayColor",handler:function(){FastExt.Grid.showColumnSortWin(this,o.grid)}},u={xtype:"button",toolType:"timerBtn",tooltip:"定时刷新",iconCls:"extIcon extAlarm grayColor",handler:function(){FastExt.Grid.showTimerRefreshGrid(this,o.grid)}},n={xtype:"button",toolType:"reportBtn",tooltip:"图表查看",iconCls:"extIcon extReport grayColor",handler:function(){FastExt.Grid.showEChartConfigWin(this,o.grid)}};i.insert(0,a),i.insert(0,{xtype:"label",text:"每页",margin:"0 10 0 10"});a=i.child("#refresh"),a=i.items.indexOf(a);return o.entity&&FastExt.Base.toBool(o.entity.actionTimer,!0)&&i.insert(++a,u),i.insert(++a,"-"),i.insert(++a,d),i.insert(++a,c),t&&(c={xtype:"button",tooltip:"还原数据",checkSelect:2,iconCls:"extIcon extReback grayColor",handler:function(){FastExt.Grid.rebackGridData(o.grid)}},i.insert(++a,"-"),i.insert(++a,c)),i.insert(++a,"-"),t||o.entity&&FastExt.Base.toBool(o.entity.actionCopy,!0)&&i.insert(++a,r),o.entity&&FastExt.Base.toBool(o.entity.actionDeleteAll,!0)&&i.insert(++a,s),Ext.isEmpty(o.entity.echartsDate)||(i.insert(++a,"-"),i.insert(++a,n)),!t&&e&&(i.insert(++a,"-"),i.insert(++a,l)),i},Grid.showRecycleGrid=function(obj,dataStore){var title,entityObj,where,gridPanel,entityOwner,winWidth,winHeight,win;dataStore&&(title="回收站",dataStore.entity.menu&&(title=dataStore.entity.menu.text+"-回收站"),entityObj=eval("new "+dataStore.entity.entityCode+"()"),entityObj.menu={id:$.md5(title),text:title},where={"^fromRecycle":!0},gridPanel=entityObj.getList(FastExt.Json.mergeJson(where,dataStore.where)),entityOwner=gridPanel.down("[entityList=true]"),entityOwner.code=$.md5(dataStore.entity.entityCode+"回收站"),winWidth=parseInt((.7*document.body.clientWidth).toFixed(0)),winHeight=parseInt((.8*document.body.clientHeight).toFixed(0)),win=Ext.create("Ext.window.Window",{title:title,iconCls:"extIcon extRecycle",layout:"fit",height:winHeight,width:winWidth,minHeight:500,minWidth:600,constrain:!0,resizable:!0,modal:!0,maximizable:!0,animateTarget:obj,maximized:!1,items:[gridPanel]}),win.show())},Grid.rebackGridData=function(i){return new Ext.Promise(function(n,t){var e;i.getStore().entity?0!==i.getSelection().length?(e=i.getSelection().length,e={title:"系统提醒",icon:Ext.Msg.QUESTION,message:"您确定还原选中的"+e+"条数据吗？",buttons:Ext.Msg.YESNO,defaultFocus:"no",callback:function(t,e){"yes"===t&&(FastExt.Dialog.showWait("正在还原数据中……"),FastExt.Store.commitStoreReback(i.getStore(),i.getSelection()).then(function(t,e){t&&(i.getSelectionModel().deselectAll(),i.getStore().isGrouped()&&i.getView().getFeature("group").collapseAll(),FastExt.Dialog.hideWait(),Ext.Msg.alert("系统提醒","还原成功！")),n(t)}))}},Ext.Msg.show(e)):FastExt.Dialog.toast("请您先选择需要还原的数据！"):Ext.Msg.alert("系统提醒","还原失败！Grid的DataStore未绑定Entity!")})},Grid.showColumnSortWin=function(n,i){var o,a,r;n.sortWin?FastExt.Component.shakeComment(n.sortWin):(o=FastExt.Store.getGridColumnStore(i),a=function(t,e){return e=e||"ASC",{xtype:"panel",flex:1,columnWidth:1,layout:"hbox",margin:"0",border:0,toParam:function(){var t={},e=this.items.get(0);t.property=e.getValue();e=this.items.get(1);return t.direction=e.getValue(),t},items:[{xtype:"combo",region:"west",valueField:"id",flex:.5,margin:"2 0 0 2",value:t.get("id"),displayField:"text",editable:!1,store:o},{xtype:"combo",flex:.5,valueField:"value",editable:!1,margin:"2 2 0 2",value:e,triggers:{close:{cls:"text-clear",handler:function(){this.ownerCt.destroy()}}},store:Ext.create("Ext.data.Store",{fields:["id","text"],data:[{text:"无",value:"NONE"},{text:"正序",value:"ASC"},{text:"倒序",value:"DESC"}]})}]}},r=Ext.create("Ext.form.FormPanel",{margin:"5",border:0,layout:"column",width:400,scrollable:!0,defaults:{labelWidth:80,margin:"5 5 5 5",labelAlign:"right",emptyText:"请填写"},items:[]}),i.getStore().getSorters().each(function(t){var e=o.findRecord("id",t.getProperty(),0,!1,!1,!0);e&&r.add(a(e,t.getDirection()))}),0===r.items.length&&r.add(a(o.getAt(0),"NONE")),n.sortWin=Ext.create("Ext.window.Window",{title:"排序数据",layout:"fit",constrain:!0,iconCls:"extIcon extSort",resizable:!0,minHeight:200,minWidth:400,height:200,animateTarget:n,items:[r],listeners:{close:function(t,e){n.sortWin=null}},buttons:[{text:"添加条件",iconCls:"extIcon extPlus",handler:function(){r.add(a(o.getAt(0)));var t=50+35*r.items.length+55;r.scrollTo(0,t,!1)}},{text:"确定",iconCls:"extIcon extOk",handler:function(){i.getStore().getSorters().clear(),Ext.each(i.getColumns(),function(t){t.sortDirection=null,FastExt.Grid.refreshColumnStyle(t)});var n=[];r.items.each(function(t){var e=t.toParam();n.push(e);t=FastExt.Grid.getColumn(i,e.property);t.sortDirection=e.direction,FastExt.Grid.refreshColumnStyle(t)}),0<n.length?i.getStore().sort(n):i.getStore().loadPage(1),FastExt.Grid.checkColumnSort(i)}}]}),i.ownerCt.add(n.sortWin)),n.sortWin.show()},Grid.showTimerRefreshGrid=function(n,e){var t;n.timerWin?FastExt.Component.shakeComment(n.timerWin):(e.timerConfig||(e.timerConfig={state:0,value:30}),t=Ext.create("Ext.form.FormPanel",{margin:"5",border:0,layout:"column",width:400,scrollable:!0,defaults:{labelWidth:120,margin:"5 5 5 5",labelAlign:"right",emptyText:"请填写"},viewModel:{data:e.timerConfig},items:[{xtype:"combo",name:"state",displayField:"text",valueField:"id",fieldLabel:"是否启动",editable:!1,flex:1,columnWidth:1,value:0,allowBlank:!1,bind:"{state}",store:FastExt.Store.getYesOrNoDataStore()},{xtype:"combo",name:"silence",displayField:"text",valueField:"id",fieldLabel:"静默刷新",editable:!1,flex:1,columnWidth:1,value:0,allowBlank:!1,bind:"{silence}",store:FastExt.Store.getYesOrNoDataStore()},{xtype:"numberfield",name:"value",bind:"{value}",fieldLabel:"时间间隔（秒）",columnWidth:1,minValue:1,value:30,decimalPrecision:0,allowBlank:!1}]}),n.timerWin=Ext.create("Ext.window.Window",{title:"定时刷新数据",layout:"fit",constrain:!0,iconCls:"extIcon extAlarm",resizable:!0,minHeight:200,minWidth:400,height:240,animateTarget:n,items:[t],listeners:{close:function(t,e){n.timerWin=null}},buttons:[{text:"确定",iconCls:"extIcon extOk",handler:function(){t.getForm().isValid()&&(e.timerConfig=t.getValues(),e.timerRefresh=function(){e.timerTimeout&&clearTimeout(e.timerTimeout);var t=e.child("#pagingToolBar");!t||(t=t.down("button[toolType=timerBtn]"))&&(1===parseInt(e.timerConfig.state)?t.setIconCls("extIcon extTimer redColor"):t.setIconCls("extIcon extTimer grayColor")),0!==parseInt(e.timerConfig.state)&&(e.timerTimeout=setTimeout(function(){e.disabledLoadMaskOnce=1===parseInt(e.timerConfig.silence),e.getStore().reload(),e.timerRefresh()},1e3*parseInt(e.timerConfig.value)))},e.timerRefresh(),0===parseInt(e.timerConfig.state)?FastExt.Dialog.toast("已关闭定时器！"):FastExt.Dialog.toast("已启动定时器！"),n.timerWin.close())}}]}),e.ownerCt.add(n.timerWin)),n.timerWin.show()},Grid.showEChartConfigWin=function(n,e){var l,d,c;n.reportWin?FastExt.Component.shakeComment(n.reportWin):(l=FastExt.Store.getChartGridColumnStore(e),d=function(t,e){return e=e||"count",{xtype:"panel",flex:1,columnWidth:1,layout:"hbox",margin:"0",border:0,toParam:function(){var t={},e=this.items.get(0);t.property=e.getValue();var n=this.items.get(1);return t.function=n.getValue(),t.details=e.getDisplayValue()+"【"+n.getDisplayValue()+"】",t},items:[{xtype:"combo",region:"west",valueField:"id",flex:.5,margin:"2 0 0 2",value:t.get("id"),displayField:"text",editable:!1,store:l},{xtype:"combo",flex:.5,valueField:"value",editable:!1,margin:"2 2 0 2",value:e,triggers:{close:{cls:"text-clear",handler:function(){this.ownerCt.destroy()}}},store:Ext.create("Ext.data.Store",{fields:["id","text"],data:[{text:"计数",value:"count"},{text:"平均值",value:"avg"},{text:"求和",value:"sum"},{text:"最大值",value:"max"},{text:"最小值",value:"min"}]})}]}},c=Ext.create("Ext.form.FormPanel",{margin:"5",border:0,layout:"column",width:400,scrollable:!0,defaults:{labelWidth:80,margin:"5 5 5 5",labelAlign:"right",emptyText:"请填写"},items:[]}),n.reportWin=Ext.create("Ext.window.Window",{title:"图表查看",layout:"fit",constrain:!0,iconCls:"extIcon extSort",resizable:!0,minHeight:200,minWidth:400,height:200,animateTarget:n,items:[c],listeners:{close:function(t,e){n.reportWin=null},show:function(s){s.setLoading("请稍后……"),FastExt.Server.showExtConfig(e.getStore().entity.entityCode,"EChartsColumn",function(t,e,n){if(t)for(var i=FastExt.Json.jsonToObject(e),o=0;o<i.length;o++){var a=i[o],r=l.findRecord("id",a.property,0,!1,!1,!0);r&&c.add(d(r,a.function))}s.setLoading(!1),0===c.items.length&&c.add(d(l.getAt(0),"count"))})}},buttons:[{text:"添加统计",iconCls:"extIcon extPlus",handler:function(){c.add(d(l.getAt(0)));var t=50+35*c.items.length+55;c.scrollTo(0,t,!1)}},{text:"确定",iconCls:"extIcon extOk",handler:function(){var t=e.getStore().proxy.extraParams,o={entityCode:e.getStore().entity.entityCode,columnDate:e.getStore().entity.echartsDate},a=[];c.items.each(function(t,e){var n,i=t.toParam();for(n in a.push(i),i)o["echarts["+e+"]."+n]=i[n]}),FastExt.Server.saveExtConfig(e.getStore().entity.entityCode,"EChartsColumn",FastExt.Json.objectToJson(a),function(){}),FastExt.Grid.showEntityECharts(this,e.getStore().entity.comment+"【图表】",FastExt.Json.mergeJson(o,t))}}]}),e.ownerCt.add(n.reportWin)),n.reportWin.show()},Grid.showEntityECharts=function(t,e,o){var n=parseInt((.6*document.body.clientWidth).toFixed(0)),i=parseInt((.7*document.body.clientHeight).toFixed(0)),a=Ext.Date.format(Ext.Date.add(new Date,Ext.Date.MONTH,-1),"Y-m-d"),r=Ext.Date.format(new Date,"Y-m-d");o.type=0,o.chartTitle=e,o.beginDate=a,o.endDate=r;var s=Ext.create("Ext.window.Window",{title:e,height:i,width:n,minWidth:n,minHeight:i,layout:"border",resizable:!0,maximizable:!0,constrain:!0,modal:!0,refreshECharts:function(){var i=this;FastExt.ECharts.hasECharts(i)&&(i.setLoading(!1),FastExt.ECharts.getECharts(i).showLoading()),FastExt.Server.showEcharts(o,function(t,e,n){i.setLoading(!1),t?FastExt.ECharts.loadECharts(i,n):FastExt.Dialog.showAlert("系统提醒",e)})},bodyStyle:{background:"#fcfcfc"},tbar:{xtype:"toolbar",overflowHandler:"menu",items:[{xtype:"combo",fieldLabel:"图表类型",labelWidth:60,valueField:"value",editable:!1,value:0,listeners:{change:function(t,e,n,i){o.type=e,s.refreshECharts()}},store:Ext.create("Ext.data.Store",{fields:["id","text"],data:[{text:"日图表",value:0},{text:"月图表",value:1},{text:"时图表",value:2},{text:"时分图表",value:3}]})},{xtype:"daterangefield",fieldLabel:"日期范围",flex:1,margin:"0 0 0 5",maxRangeMonth:12,beginDate:a,endDate:r,labelWidth:60,onClearValue:function(){o.beginDate=this.beginDate,o.endDate=this.endDate,s.refreshECharts()},onAfterSelect:function(){o.beginDate=this.beginDate,o.endDate=this.endDate,s.refreshECharts()}},{xtype:"button",text:"折线图",iconCls:"extIcon extPolyline",margin:"0 5 0 5",handler:function(){o.chartType="line",s.refreshECharts()}},{xtype:"button",text:"柱状图",iconCls:"extIcon extReport",margin:"0 5 0 5",handler:function(){o.chartType="bar",s.refreshECharts()}},{xtype:"button",text:"堆叠图",iconCls:"extIcon extMore",margin:"0 5 0 5",handler:function(){o.chartType="stack",s.refreshECharts()}}]},listeners:{show:function(t){s.setLoading("请稍后……"),t.refreshECharts()}}});s.show()},Grid.deleteGridData=function(o){return new Ext.Promise(function(e,t){var n,i;o.getStore().entity?0!==o.getSelection().length?(i=o.getSelection().length,n=function(){FastExt.Dialog.showWait("正在删除数据中……"),FastExt.Store.commitStoreDelete(o.getStore(),o.getSelection()).then(function(t){t&&(o.getSelectionModel().deselectAll(),o.getStore().isGrouped()&&o.getView().getFeature("group").collapseAll(),FastExt.Dialog.hideWait()),e(t)})},o.operate&&o.operate.alertDelete?(i={title:"系统提醒",icon:Ext.Msg.QUESTION,message:"您确定删除选中的"+i+"条数据吗？",buttons:Ext.Msg.YESNO,defaultFocus:"no",callback:function(t,e){"yes"===t&&n()}},Ext.Msg.show(i)):n()):FastExt.Dialog.toast("请您先选择需要删除的数据！"):Ext.Msg.alert("系统提醒","删除失败！Grid的DataStore未绑定Entity!")})},Grid.updateGridData=function(i){return new Ext.Promise(function(n,t){i.getStore().entity?0!==i.getStore().getUpdatedRecords().length?i.operate&&i.operate.alertUpdate?Ext.Msg.confirm("系统提醒","您确定提交被修改的数据吗？",function(t,e){"yes"===t&&(FastExt.Dialog.showWait("正在修改数据中……"),FastExt.Store.commitStoreUpdate(i.getStore()).then(function(t){n(t),t&&FastExt.Dialog.hideWait()}))}):(FastExt.Dialog.showWait("正在修改数据中……"),FastExt.Store.commitStoreUpdate(i.getStore()).then(function(t){n(t),t&&FastExt.Dialog.hideWait()})):FastExt.Dialog.toast("当前暂无数据被修改！"):Ext.Msg.alert("系统提醒","修改失败！Grid的DataStore未绑定Entity!")})},Grid.showDetailsWindow=function(obj,title,entity,record,buttons){if(entity&&record){for(var onlyValueArray=[entity.code],j=0;j<entity.idProperty.length;j++){var idName=entity.idProperty[j];onlyValueArray.push(idName+":"+record.get(idName))}1==onlyValueArray.length&&onlyValueArray.push((new Date).getTime()),FastExt.Dialog.showWait("获取配置中……");var onlyCode=$.md5(JSON.stringify(onlyValueArray));FastExt.Grid.restoreGridButton(entity.entityCode).then(function(buttonInfos){FastExt.Server.showColumns(entity.entityCode,function(success,value,message){if(FastExt.Dialog.hideWait(),success){var columnInfos=Ext.decode(value),data=[],lastGroupNon=1,key;for(key in columnInfos)if(columnInfos.hasOwnProperty(key)){var column=columnInfos[key];if(!Ext.isEmpty(column.dataIndex)){var d={value:record.get(column.dataIndex),groupHeaderText:column.groupHeaderText,record:record,entity:entity,configEditor:!1,editor:!1},c,fieldObj;for(c in column)column.hasOwnProperty(c)&&(d[c]=column[c]);Ext.isEmpty(column.editorField)||(fieldObj=FastExt.Json.jsonToObject(column.editorField),null==fieldObj||Ext.isEmpty(fieldObj.xtype)||(d.configEditor=!0)),d.groupHeaderText?lastGroupNon++:d.groupHeaderText=lastGroupNon,data.push(d)}}data.sort(function(t,e){return t.index-e.index});var detailsStore=Ext.create("Ext.data.Store",{fields:[],autoLoad:!1,groupField:"groupHeaderText"});detailsStore.loadData(data),detailsStore.sort("index","ASC");var iframePanelArray=Ext.ComponentQuery.query("window[detailsWinId="+onlyCode+"]");if(0<iframePanelArray.length)return iframePanelArray[0].getComponent("detailsGrid").setStore(detailsStore),Ext.WindowManager.bringToFront(iframePanelArray[0],!0),void FastExt.Component.shakeComment(iframePanelArray[0]);var detailsGrid=Ext.create("Ext.grid.Panel",{border:0,scrollable:"y",region:"center",store:detailsStore,itemId:"detailsGrid",hideHeaders:!0,features:[{ftype:"grouping",collapsible:!1,hideGroupedHeader:!0,expandTip:null,collapseTip:null,groupHeaderTpl:["<b>{name:this.formatName}</b>",{formatName:function(t){return Ext.isNumeric(t)?"基本属性":t}}]}],columns:[{header:"名称",power:!1,dataIndex:"text",flex:.3,tdCls:"tdVTop",align:"right",renderer:function(t,e,n){return e.style="overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space:normal !important;line-height:20px;word-break:break-word; ","<b>"+t+"：</b>"}},{header:"值",dataIndex:"value",power:!1,flex:.7,align:"left",renderer:function(val,m,r){try{m.style="overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space:normal !important;line-height:20px;word-break:break-word; ";var fun=null,rendererFunction=r.get("rendererFunction"),renderer,fun;return fun=rendererFunction?eval(rendererFunction):(renderer=r.get("renderer"),FastExt.Base.loadFunction(renderer)),Ext.isEmpty(fun)||(val=fun(val,m,r.get("record"),-1,-1,null,null,!0)),Ext.isEmpty(val)||"null"===val?"<font color='#ccc'>无</font>":val}catch(e){return val}}},{xtype:"actioncolumn",width:60,sortable:!1,menuDisabled:!0,items:[{iconCls:"extIcon extEdit marginRight5",tooltip:"编辑数据",align:"center",isDisabled:function(t,e,n,i,o){return!FastExt.Base.toBool(o.get("editor"),!1)},getClass:function(t,e,n){return FastExt.Base.toBool(n.get("editor"),!1)?"extIcon extEdit marginRight5":""},handler:FastExt.Grid.showDetailsEditMenu},{iconCls:"extIcon extCopy2 grayColor",tooltip:"复制数据",align:"center",isDisabled:function(t,e,n,i,o){return!FastExt.Base.toBool(o.get("doCopy"),!1)},getClass:function(t,e,n){return FastExt.Base.toBool(n.get("doCopy"),!1)?"extIcon extCopy2 grayColor":""},handler:FastExt.Grid.copyDetailsValue}]}],viewConfig:{loadMask:{msg:"正在为您在加载数据…"},enableTextSelection:!0},listeners:{itemmouseenter:function(t,e,n,i,o,a){e.set("editor",e.get("configEditor")),e.set("doCopy",!0)},itemmouseleave:function(t,e,n,i,o,a){e.set("editor",!1),e.set("doCopy",!1)}}});buttons=buttons||[];var winButtons=buttons;if(FastExt.System.searchMenuByEntityCode(entity.entityCode)&&(winButtons.push({text:"管理界面",iconCls:"extIcon extWindow whiteColor",handler:function(){var t=FastExt.System.searchMenuByEntityCode(entity.entityCode);t?FastExt.System.lastTabId!==t.id?FastExt.System.selectMenu(t.id):FastExt.Component.shakeComment(Ext.getCmp(t.id)):FastExt.Dialog.showAlert("系统提醒","打开失败！您或没有此功能的管理权限！")}}),0<buttonInfos.length)){for(var moreButton={text:"其他操作",iconCls:"extIcon extMore whiteColor",menu:[]},i=0;i<buttonInfos.length;i++){var button=buttonInfos[i];moreButton.menu.push({text:button.text,iconCls:button.iconCls,icon:button.icon,functionStr:button.handler,handler:function(t,e){try{var n={getSelection:function(){return[record]},getSelectionModel:function(){return n}};window.grid=n,window.me=entity,FastExt.Base.loadFunction(this.functionStr).apply(t,e)}catch(e){console.error(e)}finally{delete window.grid,delete window.me}}})}winButtons.push(moreButton)}var winWidth=parseInt((.3*document.body.clientWidth).toFixed(0)),winHeight=parseInt((.6*document.body.clientHeight).toFixed(0)),win=Ext.create("Ext.window.Window",{title:title,detailsWinId:onlyCode,height:winHeight,width:winWidth,minHeight:450,iconCls:"extIcon extDetails",minWidth:400,layout:"border",resizable:!0,constrain:!0,maximizable:!0,animateTarget:obj,tools:[{type:"help",callback:function(t,e,n){FastExt.Dialog.showJson(this,"查看原始数据结构",FastExt.Json.objectToJson(record.data))}}],listeners:{destroy:function(t,e){},show:function(t){t.focus()}},items:[detailsGrid],buttons:winButtons});win.show()}else FastExt.Dialog.showAlert("系统提醒",message)})})}},Grid.createDetailsGrid=function(t,e,n,i){var o=Ext.create("Ext.data.Store",{autoLoad:!1,fields:[],data:t}),t={header:"值",dataIndex:"value",flex:.7,align:"left",renderer:function(e,t,n){try{t.style="overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space:normal !important;line-height:20px;word-break:break-word; ";var i=n.get("renderer");if(Ext.isFunction(i)){var o=i(e,t,n.get("record"),-1,-1,null,null,!0);return Ext.isEmpty(o)?"<font color='#ccc'>无</font>":o}return e}catch(t){return e}},listeners:{dblclick:function(t,e,n,i,o,a,r){}}},i={region:"center",border:0,columnLines:!0,store:o,viewConfig:{enableTextSelection:!0},updateData:function(t){o.setData(t)},columns:[FastExt.Json.mergeJson({header:"名称",dataIndex:"name",flex:.3,align:"right",renderer:function(t,e,n){return e.style="color:#000000;overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space:normal !important;line-height:20px;word-break:break-word; ","<b>"+t+"：</b>"},listeners:{dblclick:function(t,e,n,i,o,a,r){}}},n),FastExt.Json.mergeJson(t,i)]};return Ext.create("Ext.grid.Panel",FastExt.Json.mergeJson(i,e))},Grid.showDetailsEditMenu=function(t,e,n,i,o,a){var r,s,l=a.get("linkColumn")?Ext.create(FastExt.Grid.getColumnSimpleEditor(a.get("linkColumn"))):Ext.create(FastExt.Json.jsonToObject(a.get("editorField")));l?(t.getSelectionModel().selectRange(e,e),e=t.getCell(a,1),l.flex=1,l.emptyText="请输入",l.region="center",l.record=a.get("record"),"password"!==FastExt.Base.toString(l.inputType,"none")&&Ext.isFunction(l.setValue)&&(t=a.get("value"),Ext.isObject(t)||Ext.isArray(t)?l.setValue(JSON.stringify(t),a.get("record")):l.setValue(t,a.get("record"))),Ext.isFunction(l.startEdit)&&l.startEdit(),r=function(t){t.isValid()&&(Ext.isEmpty(t.getValue())||(FastExt.Store.setRecordValue(a.get("record"),a.get("dataIndex"),t),FastExt.Store.setRecordValue(a,"value",t),FastExt.Store.commitStoreUpdate(a.get("record").store).then(function(t){t&&a.store.commitChanges()})))},Ext.isFunction(l.showWindow)?l.showWindow(e,function(t){r(t)}):((s=Ext.create("Ext.menu.Menu",{showSeparator:!1,layout:"fit",scrollToHidden:!0,doUpdate:function(){var t=this.items.get(0).items.get(0);if(!t.isValid())return FastExt.Component.shakeComment(this),void FastExt.Dialog.toast(FastExt.Form.getFieldError(t)[0]);r(t),this.hide()},items:[{xtype:"panel",layout:{type:"hbox",align:"stretch"},style:{background:"#ffffff",borderWidth:1,borderColor:"#ffffff",color:"#eeeee"},border:0,items:[l,{xtype:"button",text:"确定",name:"confirm",region:"east",width:60,margin:"0 0 0 2",handler:function(){s.doUpdate()}}]}],listeners:{show:function(t,e){t.items.get(0).items.get(0).focus()},hide:function(t){t=t.items.get(0).items.get(0);Ext.isFunction(t.endEdit)&&t.endEdit()}}})).addCls("edit-menu"),s.addCls("edit-details-menu"),s.setWidth(e.getWidth()),s.showBy(e,"tl"))):FastExt.Dialog.toast("此属性无法编辑！")},Grid.copyDetailsValue=function(t,e,n,i,o,a){a=t.getCell(a,1);FastExt.Base.copyToBoard($(a.dom).text()),FastExt.Dialog.toast("复制成功！")},Grid}();FastExt.Grid=Grid;var GridOperate=function(){this.alertDelete=!0,this.alertUpdate=!0,this.autoUpdate=!1,this.autoDetails=!0,this.hoverTip=!1,this.refreshData=!1};FastExt.GridOperate=GridOperate;var GridColumnMenu=function(){this.cancelSort=!0,this.batchRandom=!0,this.batchUpdate=!0,this.operation=!0,this.searchLink=!0,this.lookField=!0};FastExt.GridColumnMenu=GridColumnMenu}(FastExt=FastExt||{}),function(c){var t=(e.rotateOSSImgUrl=function(t,e){if(Ext.isEmpty(t)||Ext.isEmpty(e))return t;var n=t.split("/");return n[n.length-1].startWith("svg-")?t:0<=t.toString().indexOf("?")?t+"&x-oss-process=image/rotate,"+e:t+"?x-oss-process=image/rotate,"+e},e.smallOSSImgUrl=function(t){if(Ext.isEmpty(t))return t;var e=t.split("/");return e[e.length-1].startWith("svg-")?t:0<=t.toString().indexOf("?")?t+"&x-oss-process=image/resize,h_20,m_lfit":t+"?x-oss-process=image/resize,h_20,m_lfit"},e.showImage=function(t,n,e,i){Ext.isEmpty(i)&&(i=!1);var o=[];Ext.isArray(n)?o=n:o.push({url:n});var a=-1;if(null!=Ext.getStore("ImageViewStore")){var r=!1,s=Ext.getStore("ImageViewStore");return s.each(function(t,e){if(t.get("url")===n)return r=!0,Ext.getCmp("ImageViewGrid").getSelectionModel().select(e),!1}),void(r||(s.add(o),-1===a&&(a=s.count()-1),s.imgSelectIndex=a,Ext.getCmp("ImageViewGrid").getSelectionModel().select(a)))}-1===a&&(a=0);var l=Ext.create("Ext.data.Store",{fields:["url"],autoLoad:!1,imgSelectIndex:a,id:"ImageViewStore",data:o}),d=Ext.create("Ext.grid.Panel",{store:l,region:"west",hideHeaders:!0,id:"ImageViewGrid",width:125,disabled:!0,border:1,scrollable:"y",columns:[{header:"文件",dataIndex:"url",flex:1,align:"center",renderer:function(t){return Ext.isEmpty(t)?"<span style='color: #ccc;'>无</span>":"<img width='30px' onerror=\"javascript:this.src='images/default_img.png';\" src='"+t+"'/>"}}],tbar:[{xtype:"button",border:1,text:"打包下载",iconCls:"extIcon extDownload",handler:function(t){var n={};l.each(function(t,e){n["path"+e]=t.get("url")}),c.Form.buildForm("zipFile",n).submit()}}],listeners:{selectionchange:function(){try{var t=0;1<this.getStore().getCount()?(this.setHidden(!1),t=120):this.setHidden(!0);var e=this.getSelectionModel().getSelection();setTimeout(function(){window.imgViewFrame.window.showImage(c.System.formatUrl(e[0].get("url")),c.System.http)},t)}catch(t){c.Dialog.showException(t,"showImage")}}}});window.imageViewerLoadDone=function(){Ext.getCmp("ImageViewGrid").setDisabled(!1);try{var t=Ext.getStore("ImageViewStore").imgSelectIndex;Ext.getCmp("ImageViewGrid").getSelectionModel().select(t)}catch(t){c.Dialog.showException(t,"showImage")}},window.imageViewerSize=function(t,e){Ext.getCmp("ImageViewWindow").setTitle("查看图片 "+t+"x"+e)};s=Ext.create("Ext.panel.Panel",{layout:"fit",region:"center",border:0,height:"auto",iframePanel:!0,html:'<div style="background: #000000;width: 100%;height: 100%;"></div>',listeners:{afterrender:function(t,e){l.getCount()<=1?d.setHidden(!0):d.setHidden(!1),t.update("<iframe style='background: #000000;width: 100%;height: 100%;' name='imgViewFrame'  src='"+c.System.formatUrlVersion("base/image-view/index.html")+"' width='100%' height='100%' frameborder='0' scrolling='no' />"),t.getEl().on("mouseleave",function(t){var e=window.imgViewFrame.window.document.getElementsByTagName("div")[0];c.Base.dispatchTargetEvent(window.imgViewFrame.window.document,e,"pointerup"),window.imgViewFrame.window.reset()})}},bbar:{xtype:"toolbar",dock:"bottom",layout:{type:"hbox",align:"middle",pack:"center"},items:[{xtype:"button",iconCls:"extIcon extReset",handler:function(){window.imgViewFrame.window.reset()}},{xtype:"button",iconCls:"extIcon extZoomOut",handler:function(){window.imgViewFrame.window.zoomOut()}},{xtype:"button",iconCls:"extIcon extZoomIn",handler:function(){window.imgViewFrame.window.zoomIn()}},{xtype:"button",iconCls:"extIcon extOneOne",handler:function(){window.imgViewFrame.window.oneOne()}},{xtype:"button",iconCls:"extIcon extRefresh",handler:function(){window.imgViewFrame.window.rotate()}},{xtype:"button",iconCls:"extIcon extLeftRight",handler:function(){window.imgViewFrame.window.flipA()}},{xtype:"button",iconCls:"extIcon extTopBottom",handler:function(){window.imgViewFrame.window.flipB()}},{xtype:"button",iconCls:"extIcon extDownload2",handler:function(){var t=d.getSelectionModel().getSelection();c.Base.download(t[0].get("url"))}}]}}),a=parseInt((.4*document.body.clientWidth).toFixed(0)),o=parseInt((.6*document.body.clientHeight).toFixed(0));Ext.create("Ext.window.Window",{title:"查看图片",height:o,width:a,minHeight:500,minWidth:600,id:"ImageViewWindow",layout:"border",iconCls:"extIcon extImage",resizable:!0,alwaysOnTop:!0,maximizable:!0,modal:i,constrain:!0,animateTarget:t,items:[d,s],listeners:{close:function(t){l.destroy(),Ext.isFunction(e)&&e()}}}).show()},e);function e(){}c.Image=t}(FastExt=FastExt||{}),function(s){var t=(e.jsonToObject=function(t){try{return Ext.decode(t)}catch(t){}return null},e.objectToJson=function(t){try{return Ext.encode(t)}catch(t){}return null},e.mergeJson=function(t,e){var n={};if(!Ext.isEmpty(t))for(var i in t)n[i]=t[i];if(!Ext.isEmpty(e))for(var i in e)n[i]=e[i];return n},e.showFormatJson=function(e,n,t){try{e&&e.blur(),Ext.isEmpty(t)&&(t="查看JSON数据");var i=parseInt((.4*document.body.clientWidth).toFixed(0)),o=parseInt((.6*document.body.clientHeight).toFixed(0)),a=Ext.create("Ext.window.Window",{title:t,height:o,width:i,minHeight:500,minWidth:600,animateTarget:e,layout:"fit",resizable:!0,maximizable:!0,iconCls:"extIcon extSee",autoScroll:!0,modal:!0,constrain:!0,buttons:[{text:"复制JSON数据",handler:function(){s.Dialog.toast("复制成功！"),s.Base.copyToBoard(n)}}]}),r=new JSONFormat(n,4).toString();a.update("<div style='padding: 20px;'>"+r+"</div>"),a.show()}catch(t){console.error(t),s.Dialog.showText(e,null,"查看数据",n)}},e);function e(){}s.Json=t}(FastExt=FastExt||{}),function(o){var t=(e.loadJsonAnim=function(e,n,i){function t(){o.Lottie.loadedLottieJs=!0;var t=o.Base.getTargetBodyElement(e);t?(e.lottie=bodymovin.loadAnimation({container:t,renderer:"svg",loop:!0,autoplay:!0,path:n}),i&&e.lottie.addEventListener("data_ready",i)):console.error("加载Lottie动画失败！无法获取目标控件的BodyElement！")}this.loadedLottieJs?t():o.System.addScript({src:o.Lottie.lottieJsPath},t)},e.getLottie=function(t){if(t.lottie)return t.lottie;console.error("获取Lottie失败！目标控件未加载lottie！")},e.showLottie=function(t,e){var n=parseInt((.6*document.body.clientWidth).toFixed(0)),i=parseInt((.6*document.body.clientHeight).toFixed(0));Ext.create("Ext.window.Window",{title:"查看动效",height:i,width:n,layout:"border",resizable:!0,maximizable:!0,constrain:!0,modal:!0,padding:"10 10 10 10",bodyStyle:{background:"#ffffff"},listeners:{show:function(t){t.setLoading("加载动效中，请稍后……"),o.Lottie.loadJsonAnim(t,e,function(){t.setLoading(!1)})}}}).show()},e.lottieJsPath="base/lottie/lottie.min.js",e);function e(){}o.Lottie=t}(FastExt=FastExt||{}),function(h){var t=(e.selAddressInMap=function(u,x,m,g){return new Ext.Promise(function(i,t){var e="";Ext.isEmpty(x)||Ext.isEmpty(m)||0===parseFloat(x)||0===parseFloat(m)||(e=x+","+m);function n(t,n){Ext.Msg.prompt(t,"请输入坐标经纬度(lng,lat)",function(t,e){"ok"===t&&(e=e.toString().replaceAll(" ","").replaceAll("，",","),window.mapFrame&&(n?window.mapFrame.window.AMap.convertFrom([e.split(",")],n,function(t,e){e=e.locations[0];window.mapFrame.window.setLngLatAddress(e.toString())}):window.mapFrame.window.setLngLatAddress(e)))})}var o=Ext.create("Ext.panel.Panel",{layout:"border",region:"center",iframePanel:!0,border:0}),a=Ext.create("Ext.form.FormPanel",{url:"addData",method:"POST",region:"north",fileUpload:!0,autoScroll:!1,layout:{type:"hbox",align:"stretch"},defaults:{margin:"5 5 5 5"},items:[{name:"map.taskTitle",fieldLabel:"位置搜索",labelWidth:60,labelAlign:"right",id:"txtSearch",columnWidth:1,flex:1,allowBlank:!1,useHistory:!0,emptyText:"输入地址",xtype:"textfield"},{xtype:"button",width:100,text:"搜索",handler:function(){r()}},{xtype:"button",width:120,text:"查找高德坐标",handler:function(){n("查找高德坐标")}},{xtype:"button",width:120,text:"查找GPS坐标",handler:function(){n("查找GPS坐标","gps")}}],listeners:{render:function(t){try{new Ext.util.KeyMap({target:t.getEl(),key:13,fn:r,scope:Ext.getBody()})}catch(t){console.error(t)}}}}),r=function(){a.getForm().isValid()&&window.mapFrame.window.searchAddress(Ext.getCmp("txtSearch").getValue())},s=Ext.create("Ext.panel.Panel",{layout:{type:"hbox",align:"stretch"},region:"south",border:0,height:42,defaults:{margin:"5 5 5 5"},items:[{xtype:"textfield",id:"lblAddress",fieldLabel:"选择位置",labelWidth:60,value:g,labelAlign:"right",flex:1},{xtype:"textfield",id:"lblLngLat",readOnly:!0,width:160,value:e},{xtype:"button",width:100,text:"确定",handler:function(){var t=Ext.getCmp("lblLngLat"),e=t.getValue(),n=e.split(",")[0],e=e.split(",")[1];h.Base.runCallBack(i,{lng:n,lat:e,addr:Ext.getCmp("lblAddress").getValue(),pro:t.province,city:t.city,area:t.area}),c.close()}}]}),l=Ext.create("Ext.panel.Panel",{layout:"border",border:0,items:[a,o,s]}),d=parseInt((.4*document.body.clientWidth).toFixed(0)),s=parseInt((.6*document.body.clientHeight).toFixed(0)),c=Ext.create("Ext.window.Window",{title:"选择位置",height:s,width:d,minHeight:500,minWidth:600,iconCls:"extIcon extMap",layout:"fit",resizable:!0,maximizable:!0,animateTarget:u,constrain:!0,items:[l],modal:!0,listeners:{show:function(){var t=h.System.formatUrlVersion("base/map/select.html",{mapVersion:h.System.getExt("amap-version").value,mapKey:h.System.getExt("amap-key").value});o.update("<iframe name='mapFrame'  src='"+t+"' width='100%' height='100%' frameborder='0' scrolling='no' />")},close:function(t){h.Base.runCallBack(i)}}});c.show(),l.setLoading("正在定位中，请稍后……"),window.onMapLoadDone=function(){Ext.isEmpty(e)?window.mapFrame.window.startLocation():window.mapFrame.window.setLngLatAddress(e)},window.closeMapMask=function(){l.setLoading(!1)},window.showMapMask=function(t){t?l.setLoading(t):l.setLoading(!0)},window.alert=function(t){h.Dialog.showAlert("系统提醒",t)},window.setMarkCurrPos=function(t,e,n,i,o){Ext.getCmp("lblAddress").setValue(e);e=Ext.getCmp("lblLngLat");e.setValue(t),e.province=n,e.city=i,e.area=o}})},e.showAddressInMap=function(t,i,o,a){var e=Ext.create("Ext.panel.Panel",{layout:"border",region:"center",border:0,iframePanel:!0,listeners:{afterrender:function(t,e){var n={lnglat:i,mapVersion:h.System.getExt("amap-version").value,mapKey:h.System.getExt("amap-key").value,mapTitle:o,mapAddress:a};t.update("<iframe name='mapFrame'  src='"+h.System.formatUrlVersion("base/map/show.html",n)+"' width='100%' height='100%' frameborder='0' scrolling='no' />")}}}),n=parseInt((.4*document.body.clientWidth).toFixed(0)),r=parseInt((.6*document.body.clientHeight).toFixed(0));Ext.create("Ext.window.Window",{title:"查看位置",height:r,width:n,minHeight:500,minWidth:600,iconCls:"extIcon extMap",layout:"border",resizable:!0,maximizable:!0,animateTarget:t,constrain:!0,items:[e],modal:!0}).show(),e.setLoading("正在请求地址信息……"),window.closeMapMask=function(){e.setLoading(!1)}},e.selRectangleInMap=function(d,c,u,x,m,g){return new Ext.Promise(function(n,t){Ext.isEmpty(g)&&(g=0);var e=Ext.create("Ext.panel.Panel",{layout:"border",region:"center",iframePanel:!0,border:0}),i=Ext.create("Ext.form.FormPanel",{method:"POST",region:"north",fileUpload:!0,autoScroll:!0,height:50,layout:"column",imgRotate:g,defaults:{margin:"5 5 5 5"},items:[{name:"map.taskTitle",fieldLabel:"位置搜索",labelWidth:60,labelAlign:"right",id:"txtSearch",columnWidth:1,useHistory:!0,emptyText:"输入地址",xtype:"textfield"},{xtype:"button",width:100,text:"搜索",handler:function(){o()}},{xtype:"button",width:100,text:"选取",handler:function(){window.mapRectangleFrame.window.selectRectangle()}},{xtype:"button",width:100,text:"锚点管理",handler:function(){h.Map.manageMapAnchorPoints(this,window.mapRectangleFrame)}},{xtype:"button",width:120,text:"向左旋转图片",handler:function(){i.imgRotate+=5,360<i.imgRotate&&(i.imgRotate=0),window.mapRectangleFrame.window.setImgLayerUrl(h.Image.rotateOSSImgUrl(x,i.imgRotate))}},{xtype:"button",width:120,text:"向右旋转图片",handler:function(){i.imgRotate-=5,i.imgRotate<0&&(i.imgRotate=360),window.mapRectangleFrame.window.setImgLayerUrl(h.Image.rotateOSSImgUrl(x,i.imgRotate))}}],listeners:{render:function(t){try{new Ext.util.KeyMap({target:t.getEl(),key:13,fn:o,scope:Ext.getBody()})}catch(t){console.error(t)}}}}),o=function(){i.getForm().isValid()&&window.mapRectangleFrame.window.searchAddress(Ext.getCmp("txtSearch").getValue())},a=Ext.create("Ext.panel.Panel",{layout:"column",region:"south",border:0,height:42,defaults:{margin:"5 5 5 5"},items:[{xtype:"textfield",id:"lblSouthWestLngLat",fieldLabel:"西南角(左下)",labelAlign:"right",readOnly:!0,columnWidth:.35},{xtype:"textfield",id:"lblNorthEastLngLat",fieldLabel:"东北角(右上)",readOnly:!0,columnWidth:.35},{xtype:"textfield",id:"lblRectangleSize",labelWidth:60,fieldLabel:"矩形宽高",readOnly:!0,columnWidth:.3},{xtype:"button",width:100,text:"确定",handler:function(){var t=Ext.getCmp("lblSouthWestLngLat").getValue(),e=Ext.getCmp("lblNorthEastLngLat").getValue();h.Base.runCallBack(n,{southWestLngLat:t,southWestLng:t.split(",")[0],southWestLat:t.split(",")[1],northEastLngLat:e,northEastLng:e.split(",")[0],northEastLat:e.split(",")[1],anchors:window.mapRectangleFrame.pointDataArray,rotate:i.imgRotate}),l.close()}}]}),r=Ext.create("Ext.panel.Panel",{layout:"border",border:0,items:[i,e,a]}),s=parseInt((.4*document.body.clientWidth).toFixed(0)),a=parseInt((.6*document.body.clientHeight).toFixed(0)),l=Ext.create("Ext.window.Window",{title:"选择图层位置",height:a,width:s,minHeight:500,minWidth:600,iconCls:"extIcon extMap",layout:"fit",resizable:!0,maximizable:!0,animateTarget:d,constrain:!0,items:[r],modal:!0,listeners:{show:function(){var t=h.System.formatUrlVersion("base/map/rectangle.html",{mapVersion:h.System.getExt("amap-version").value,mapKey:h.System.getExt("amap-key").value});e.update("<iframe name='mapRectangleFrame'  src='"+t+"' width='100%' height='100%' frameborder='0' scrolling='no' />")},close:function(t){h.Base.runCallBack(n)}}});l.show(),window.onMapLoadDone=function(){var t=h.Image.rotateOSSImgUrl(x,g);if(window.mapRectangleFrame.pointDataArray=m,window.mapRectangleFrame.window.setImgLayerUrl(t),c&&u&&(r.setLoading(!1),window.mapRectangleFrame.window.selectRectangle(c,u,t)),window.mapRectangleFrame.pointDataArray){for(var e=[],n=0;n<window.mapRectangleFrame.pointDataArray.length;n++)e.push(window.mapRectangleFrame.pointDataArray[n].gdPoint);window.mapRectangleFrame.window.setAnchorPoints(e,!1)}},window.closeMapMask=function(){r.setLoading(!1)},window.showMapMask=function(t){t?r.setLoading(t):r.setLoading(!0)},window.alert=function(t){h.Dialog.showAlert("系统提醒",t)},window.setSelectBounds=function(t,e,n){Ext.getCmp("lblSouthWestLngLat").setValue(t),Ext.getCmp("lblNorthEastLngLat").setValue(e),Ext.getCmp("lblRectangleSize").setValue(n.width+"px - "+n.height+"px")}})},e.manageMapAnchorPoints=function(t,o){t&&t.blur(),o.pointDataArray||(o.pointDataArray=[]);function e(t,n){Ext.Msg.prompt(t,"请输入坐标经纬度(lng,lat)",function(t,e){"ok"===t&&(e=e.toString().replaceAll(" ","").replaceAll("，",","),o&&(n?o.window.AMap.convertFrom([e.split(",")],n,function(t,e){e=e.locations[0];a.findRecord("gdPoint",e.toString(),0,!1,!1,!0)?h.Dialog.toast("坐标已存在！"):(e={gdPoint:e.toString()},a.add(e))}):a.findRecord("gdPoint",e,0,!1,!1,!0)?h.Dialog.toast("坐标已存在！"):a.add({gdPoint:e})))})}var a=Ext.create("Ext.data.Store",{autoLoad:!0,data:o.pointDataArray}),i=Ext.create("Ext.grid.Panel",{selModel:h.Grid.getGridSelModel(),store:a,columnLines:!0,cellTip:!0,columns:[{header:"高德坐标",dataIndex:"gdPoint",align:"center",flex:1,field:{xtype:"textfield"},renderer:h.Renders.normal()}],selType:"cellmodel",tbar:[{xtype:"button",border:1,text:"删除",iconCls:"extIcon extDelete",handler:function(){var n=i.getSelectionModel().getSelection();0===n.length?h.Dialog.toast("请您选择需要删除的坐标！"):Ext.Msg.confirm("系统提醒","您确定立即删除选中的坐标吗？",function(t,e){"yes"===t&&(Ext.Array.each(n,function(t){a.remove(t)}),i.getSelectionModel().deselectAll(),h.Dialog.toast("删除成功！"))})}},{xtype:"button",border:1,text:"添加高德坐标",iconCls:"extIcon extAdd",handler:function(){e("添加高德坐标")}},{xtype:"button",border:1,text:"添加GPS坐标",iconCls:"extIcon extAdd",handler:function(){e("添加GPS坐标","gps")}}],listeners:{selectionchange:function(){}}}),r=Ext.create("Ext.window.Window",{title:"图层锚点管理",height:300,width:400,minWidth:400,minHeight:300,layout:"fit",resizable:!0,modal:!0,constrain:!0,iconCls:"extIcon extFolder",animateTarget:t,items:[i],buttons:[{text:"确定",iconCls:"extIcon extOk",handler:function(){var n=[],i=[];a.each(function(t,e){t=t.get("gdPoint");n.push(t),i.push({gdPoint:t})}),o&&(o.pointDataArray=i,o.window.setAnchorPoints(n,!0)),r.close()}}],listeners:{close:function(){}}});r.show()},e.showImgLayerInMap=function(a,r,s,l,d){return new Ext.Promise(function(e,t){var n=Ext.create("Ext.panel.Panel",{layout:"border",region:"center",iframePanel:!0,border:0}),i=parseInt((.4*document.body.clientWidth).toFixed(0)),o=parseInt((.6*document.body.clientHeight).toFixed(0));Ext.create("Ext.window.Window",{title:"查看图层位置",height:o,width:i,minHeight:500,minWidth:600,iconCls:"extIcon extMap",layout:"fit",resizable:!0,maximizable:!0,animateTarget:a,constrain:!0,items:[n],modal:!0,listeners:{show:function(){var t=h.System.formatUrlVersion("base/map/showRectangle.html",{mapVersion:h.System.getExt("amap-version").value,mapKey:h.System.getExt("amap-key").value});n.update("<iframe name='mapFrame'  src='"+t+"' width='100%' height='100%' frameborder='0' scrolling='no' />")},close:function(t){e.called||(e.called=!0,e())}}}).show(),Ext.isEmpty(d)&&(d=6),window.onMapLoadDone=function(){window.mapFrame.window.showImgLayerInMap(r,s,l,d)},window.alert=function(t){h.Dialog.showAlert("系统提醒",t)}})},e);function e(){}h.Map=t}(FastExt=FastExt||{}),function(o){var t=(e.copyMenu=function(t){var i=[];return t.items.each(function(t,e){var n={icon:t.icon,text:t.text,handler:t.handler};null!=t.getMenu()&&(n.menu=o.Menu.copyMenu(t.getMenu())),i.push(n)}),i},e.fireMenuEvent=function(t,n){t&&t.items.each(function(t,e){t.hasOwnProperty(n)&&Ext.isFunction(t[n])&&t[n](),Ext.isFunction(t.getMenu)&&o.Menu.fireMenuEvent(t.getMenu(),n)})},e);function e(){}o.Menu=t}(FastExt=FastExt||{}),function(FastOverrider){var ExtOverrider=function(){function ExtOverrider(){var oldCreate=Ext.create;Ext.create=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];if(1<arguments.length)for(var stacks=(new Error).stack.split("\n"),i=0;i<stacks.length;i++){var stepArray=stacks[i].trim().split(" ");if(1<stepArray.length){var fromCode=stepArray[1],codeArray=fromCode.split(".");if(2==codeArray.length&&0<=codeArray[0].toString().indexOf("Entity"))try{var pro=eval(codeArray[0]+".prototype"),method=codeArray[1];if(pro&&pro.entityCode){var watchFunctions=FastExt.System.entityCreateFilter[pro.entityCode];if(watchFunctions)for(var j=0;j<watchFunctions.length;j++){var watchFunction=watchFunctions[j],info;Ext.isFunction(watchFunction)&&(info=new FastExt.ComponentInvokeInfo,info.method=method,info.xtype=arguments[0],info.config=arguments[1],watchFunction(info))}break}}catch(e){}}}return oldCreate.apply(this,arguments)},Ext.override(Ext,{getScrollbarSize:function(t){Ext.isDomReady||Ext.raise("getScrollbarSize called before DomReady");var e,n=Ext._scrollbarSize;return!t&&n||(e=document.body,(t=document.createElement("div")).style.width=t.style.height="100px",t.style.overflow="scroll",t.style.position="absolute",e.appendChild(t),Ext._scrollbarSize=n={width:t.offsetWidth-t.clientWidth,height:t.offsetHeight-t.clientHeight},e.removeChild(t)),n.width<=0&&(n.width=15),n.height<=0&&(n.height=15),n}})}return ExtOverrider}();FastOverrider.ExtOverrider=ExtOverrider;var PowerComponentOverride=function(){Ext.override(Ext.Component,{afterRender:Ext.Function.createSequence(Ext.Component.prototype.afterRender,function(){var i;FastExt.System.isInitSystem()&&((i=this).power=FastExt.Base.toBool(i.power,!0),i.power&&(0<i.getXTypes().indexOf("field/")||Ext.Array.contains(FastExt.Power.types,i.getXType()))&&(i.code=FastExt.Power.getPowerCode(i),i.power&&(i.up("[power=false]")||i.code&&(i.managerPower=FastExt.Power.checkManagerPower(i),FastExt.Power.setPower(i.code,FastExt.Base.copy(i.managerPower)),FastExt.Power.hasPower(i,"show")?FastExt.Power.hasPower(i,"edit")||(i.editable=!1,Ext.isFunction(i.setReadOnly)&&i.setReadOnly(!0)):(i.hideable=!1,i.setHidden(!0),i.setDisabled(!0),i.clearListeners(),Ext.isFunction(i.collapse)&&i.collapse()),FastExt.Power.config&&(i.powerConfig=FastExt.Power.checkPower(i.code),FastExt.Power.setPowerStyle(i),i.getEl().on("contextmenu",function(t,e,n){t.stopEvent(),FastExt.Power.showPowerConfig(i,t)}))))))})}),Ext.override(Ext.Component,{setDisabled:function(t){return FastExt.Power.config?(console.log("权限配置中！"),this.enable()):this[t?"disable":"enable"]()}}),Ext.override(Ext.form.field.Base,{markInvalid:function(t){var e,n,i;FastExt.Power.config||(n=(e=this).ariaEl.dom,i=e.getActiveError(),e.setActiveErrors(Ext.Array.from(t)),i!==(i=e.getActiveError())&&(e.setError(i),!e.ariaStaticRoles[e.ariaRole]&&n&&n.setAttribute("aria-invalid",!0)))}})};FastOverrider.PowerComponentOverride=PowerComponentOverride;var ComponentOverride=function(){Ext.override(Ext.Component,{initComponent:function(){var t=this;try{if(t.validateOnBlur=!1,t.validateOnChange=!1,t.closeToolText="关闭",t.collapseToolText="关闭",t.expandToolText="展开",("window"===t.getXType()||"panel"===t.getXType())&&(!Ext.isEmpty(t.getTitle())||!Ext.isEmpty(t.subtitle))&&(t.resizable||t.split)){var o=$.md5(t.getTitle()+t.subtitle+$("title").text());try{o=$.md5(o+t.width+t.height)}catch(t){}var e=FastExt.Cache.getCache(o+"Width"),n=FastExt.Cache.getCache(o+"Height"),i=FastExt.Base.toBool(FastExt.Cache.getCache(o+"Collapse"),!1);null!=e&&(t.setWidth(e),t.setFlex(0)),null!=n&&(t.setHeight(n),t.setFlex(0)),t.collapsed=i,t.setCollapsed(i),t.on("resize",function(t,e,n,i){e!==Ext.getBody().getWidth()&&FastExt.Cache.setCache(o+"Width",e),n!==Ext.getBody().getHeight()&&FastExt.Cache.setCache(o+"Height",n)}),t.on("collapse",function(t,e,n,i){FastExt.Cache.setCache(o+"Collapse",!0)}),t.on("expand",function(t,e,n,i){FastExt.Cache.setCache(o+"Collapse",!1)})}"menuitem"===t.getXType()&&(t.on("focus",function(t,e,n){var i,o;t.isDisabled()||t.isDisabled()||(i=/([^/]*.svg)/,(o=t.icon)&&i.test(o)&&(o=FastExt.Server.getIcon(i.exec(o)[1].trim(),"#ffffff"),(t=Ext.get(t.getId()+"-iconEl"))&&t.setStyle("background-image","url("+o+")")))}),t.on("deactivate",function(t,e,n){var i;t.isDisabled()||(i=t.icon)&&/([^/]*.svg)/.test(i)&&((t=Ext.get(t.getId()+"-iconEl"))&&t.setStyle("background-image","url("+i+")"))})),FastExt.Base.toBool(t.iframePanel,!1)&&(t.disabledCls="iframe-disabled-panel"),Ext.isEmpty(t.firstCls)||(t.baseCls=t.firstCls+" "+t.baseCls),this.callParent(arguments)}catch(t){console.error(t)}}}),Ext.override(Ext.Component,{show:function(){try{return!FastExt.System.isInitSystem()||"window"!==this.getXType()&&"messagebox"!==this.getXType()||FastExt.Base.toBool(this.sessionWin,!1)||!FastExt.System.sessionOutAlert?(this.callParent(arguments),this):(this.hide(),null)}catch(t){console.error(t)}return this}}),Ext.override(Ext.Component,{onRender:function(){this.callParent(arguments);var i,t,r=this;try{if(FastExt.Power.isPower())return;r.help&&(i=(i=r.bodyEl)||r.el,Ext.isEmpty(r.helpType)&&(r.helpType=FastEnum.HelpEnumType.mouse_right_click),t=function(){try{if(r.helpTip)return void(0<r.helpTip.showDelay?(r.helpTipTimeout&&clearTimeout(r.helpTipTimeout),r.helpTipTimeout=setTimeout(function(){r.helpTip&&r.helpTip.show()},r.helpTip.showDelay)):r.helpTip.show());var t=r.help;window.getHelpContent&&(t=window.getHelpContent(r.help));var e=r.helpAnchor;Ext.isEmpty(e)&&(e="left");var n=r.helpShowDelay;Ext.isEmpty(n)&&(n=0),r.helpTip=Ext.create("Ext.tip.ToolTip",{target:i,resizable:!1,anchor:e,anchorOffset:0,autoHide:!1,maxWidth:400,closeAction:"destroy",html:t,showDelay:n,autoShow:0===n,listeners:{beforedestroy:function(){r.helpTip=null,r.helpTipTimeout&&clearTimeout(r.helpTipTimeout)},hide:function(){this.close()},move:function(t,e,n,i){var o=t.anchor,a=(r.getWidth()-20)/2;"left"!==o&&"right"!==o||(a=(r.getHeight()-20)/2),Ext.isEmpty(r.helpAnchorOffset)||-1==parseInt(r.helpAnchorOffset)||(a=r.helpAnchorOffset),t.anchorOffset=a}}})}catch(t){console.error(t)}},i.on("mouseleave",function(){r.helpTip&&r.helpTip.close()}),r.helpType==FastEnum.HelpEnumType.mouse_right_click?i.on("contextmenu",function(){t()}):r.helpType==FastEnum.HelpEnumType.mouse_in_out&&i.on("mouseover",function(){t()}))}catch(t){console.error(t)}}}),Ext.override(Ext.Component,{onAlignToScroll:function(){},adjustPosition:function(t,e){var n,i,o,a=this;a.isContainedFloater()&&(t+=(n=a.floatParent.getTargetEl().getViewRegion()).left,e+=n.top);try{a.pickerField&&(i=document.body.clientWidth,o=document.body.clientHeight,"datefield"===a.pickerField.xtype?(t=Math.min(a.pickerField.getX()+a.pickerField.getWidth(),i-a.getWidth()),e=Math.min(a.pickerField.getY(),o-a.getHeight())):-1!==a.pickerField.xtype.indexOf("combo")&&(t=Math.min(a.pickerField.bodyEl.getX(),i-a.getWidth()),e=Math.min(a.pickerField.getY()+a.pickerField.getHeight(),o-a.getHeight())))}catch(t){console.error(t)}return{x:t,y:e}}}),Ext.override(Ext.Component,{afterShow:function(t,e,n){var i,o,a=this,r=a.el;t=a.getAnimateTarget(t),(t=!a.ghost?null:t)?(i={x:r.getX(),y:r.getY(),width:r.dom.offsetWidth,height:r.dom.offsetHeight},t={x:t.getX(),y:t.getY(),width:Math.min(t.dom.offsetWidth,r.dom.offsetWidth/2),height:Math.min(t.dom.offsetHeight,r.dom.offsetHeight/2)},r.addCls(a.offsetsCls),(o=a.ghost()).el.stopAnimation(),o.setX(-1e4),a.ghostBox=i,o.el.animate({from:t,to:i,listeners:{afteranimate:function(){delete o.componentLayout.lastComponentSize,a.unghost(),delete a.ghostBox,a.setX(i.x),a.setY(i.y),r.removeCls(a.offsetsCls),a.onShowComplete(e,n)}}})):a.onShowComplete(e,n),a.fireHierarchyEvent("show")},onHide:function(t,e,n){var i,o,a=this,r=a.el;a.ariaStaticRoles[a.ariaRole]||a.ariaEl.dom.setAttribute("aria-hidden",!0),a.revertFocus(),t=a.getAnimateTarget(t),(t=!a.ghost?null:t)&&(r={x:t.getX(),y:t.getY(),width:Math.min(t.dom.offsetWidth,r.dom.offsetWidth/2),height:Math.min(t.dom.offsetHeight,r.dom.offsetHeight/2)},(i=a.ghost()).el.stopAnimation(),o=a.getSize(),i.el.animate({to:r,listeners:{afteranimate:function(){delete i.componentLayout.lastComponentSize,i.el.hide(),i.setHiddenState(!0),i.el.setSize(o),a.afterHide(e,n)}}})),a.el.hide(),t||a.afterHide(e,n)}})};FastOverrider.ComponentOverride=ComponentOverride;var LoadMaskOverride=function(){Ext.override(Ext.LoadMask,{show:function(){var t=this;return t.target&&(t.target.disabledLoadMaskOnce||t.target.disabledLoadMask)?(t.target.disabledLoadMaskOnce=!1,t):t.isElement?(t.ownerCt.mask(this.useMsg?this.msg:"",this.msgCls),void t.fireEvent("show",this)):t.callParent(arguments)}})};FastOverrider.LoadMaskOverride=LoadMaskOverride;var ButtonOverride=function(){Ext.override(Ext.button.Button,{afterRender:function(){try{var t=this;t.tipText&&(t.tip=new Ext.ToolTip({target:t.el,trackMouse:!0,renderTo:Ext.getBody(),dismissDelay:0,html:t.tipText}));var e=t.up("grid,treepanel");e&&(!Ext.isEmpty(t.text)&&FastExt.Base.toBool(t.contextMenu,!0)&&FastExt.Grid.addGridContextMenu(e,FastExt.Button.buttonToMenuItem(t)),FastExt.Button.buttonToBind(e,t)),this.callParent(arguments)}catch(t){console.error(t)}}})};FastOverrider.ButtonOverride=ButtonOverride;var GridOverride=function(){function GridOverride(){Ext.override(Ext.grid.CellContext,{setRow:function(t){try{var e=this,n=e.view.dataSource;return t&&("number"==typeof t?(e.rowIdx=Math.max(Math.min(t,n.getCount()-1),0),e.record=n.getAt(t)):t.isModel?(e.record=t,e.rowIdx=n.indexOf(t)):(t.tagName||t.isElement)&&(e.record=e.view.getRecord(t),e.rowIdx=n.indexOf(e.record))),e}catch(t){console.error(t)}return this}}),Ext.override(Ext.grid.column.Column,{afterRender:Ext.Function.createSequence(Ext.grid.column.Column.prototype.afterRender,function(){try{var me=this;me.code=FastExt.Power.getPowerCode(me),me.renderer||(me.renderer=FastExt.Renders.normal()),me.rendererFunction&&(me.renderer=eval(me.rendererFunction)),FastExt.Grid.configColumnProperty(me),FastExt.Grid.configColumnListener(me)}catch(e){console.error(e)}})}),Ext.override(Ext.grid.selection.SpreadsheetModel,{handleMouseDown:function(t,e,n,i,o,a,r){try{this.callParent(arguments)}catch(r){console.error(r)}finally{this.lastPagePosition={pageX:r.pageX,pageY:r.pageY}}},onMouseMove:function(t,e,n){try{this.lastPagePosition||(this.lastPagePosition={pageX:0,pageY:0});var i=Math.abs(this.lastPagePosition.pageX-t.pageX),o=Math.abs(this.lastPagePosition.pageY-t.pageY);if(i<=0||o<=0)return;this.callParent(arguments)}catch(t){console.error(t)}}})}return GridOverride}();FastOverrider.GridOverride=GridOverride;var LayoutOverride=function(){Ext.override(Ext.layout.container.Accordion,{nextCmp:function(t){t=t.next();return t&&t.isHidden()?this.nextCmp(t):t},prevCmp:function(t){t=t.prev();return t&&t.isHidden()?this.prevCmp(t):t},onBeforeComponentCollapse:function(t){try{var e,n=this,i=n.owner,o=void 0;if(1===n.owner.items.getCount())return!1;if(!n.processing){if(n.processing=!0,e=i.deferLayouts,i.deferLayouts=!0,(o=n.nextCmp(t)||n.prevCmp(t)).isHidden())return i.deferLayouts=e,n.processing=!1,void n.onBeforeComponentCollapse(o);if(n.multi)return i.deferLayouts=e,void(n.processing=!1);o&&o.expand(),i.deferLayouts=e,n.processing=!1}}catch(t){console.error(t)}}})};FastOverrider.LayoutOverride=LayoutOverride;var DomOverride=function(){Ext.override(Ext.dom.Element,{syncContent:function(t){try{this.callParent(arguments)}catch(t){console.error(t)}}}),Ext.override(Ext.dom.Element,{show:function(t){return this.stopAnimation(),this.dom.className.startWith("x-css-shadow")||this.dom.className.startWith("x-menu")||this.dom.className.startWith("x-boundlist")?this.setVisible(!0,this.anim({duration:15})):this.callParent(arguments),this},hide:function(t){return this.stopAnimation(),"string"==typeof t?this.setVisible(!1,t):this.setVisible(!1,this.anim(t)),this}})};FastOverrider.DomOverride=DomOverride;var ToolbarOverride=function(){Ext.override(Ext.toolbar.Paging,{updateInfo:function(){var t=this,e=t.child("#displayItem"),n=t.store,i=t.getPageData();e&&(i=0===n.getCount()?t.emptyMsg:Ext.String.format(t.displayMsg,i.fromRecord,i.toRecord,i.total),e.setText(i))},initComponent:function(){this.callParent(arguments),this.on("beforechange",function(t,e,n){return t.checkStoreUpdate(function(){t.store.loadPage(e)})})},checkStoreUpdate:function(n){var i=this;return!i.store.entity||(!(0<i.store.getUpdatedRecords().length)||(Ext.Msg.confirm("系统提醒","当前页有未提交修改的数据，是否提交修改？",function(t,e){"yes"==t?FastExt.Store.commitStoreUpdate(i.store).then(function(){n()}):n()}),!1))}})};FastOverrider.ToolbarOverride=ToolbarOverride;var UtilOverride=function(){Ext.override(Ext.util.Grouper,{sortFn:function(t,e){return 0}})};FastOverrider.UtilOverride=UtilOverride;var ResizerOverride=function(){Ext.override(Ext.resizer.Splitter,{onRender:function(){this.collapseOnDblClick=!1,this.callParent(arguments)}})};FastOverrider.ResizerOverride=ResizerOverride;var DDOverride=function(){Ext.override(Ext.dd.DragTracker,{onMouseDown:function(t){if(this.callParent(arguments),!(this.disabled||t.target&&0<=t.target.className.toString().indexOf("x-tool")))for(var e=Ext.ComponentQuery.query("[iframePanel=true]"),n=0;n<e.length;n++)e[n].oldDisabled=e[n].disabled,e[n].setDisabled(!0)},onMouseUp:function(t){this.callParent(arguments);for(var e=Ext.ComponentQuery.query("[iframePanel=true]"),n=0;n<e.length;n++)e[n].setDisabled(e[n].oldDisabled)},endDrag:function(t){this.callParent(arguments);for(var e=Ext.ComponentQuery.query("[iframePanel=true]"),n=0;n<e.length;n++)e[n].setDisabled(e[n].oldDisabled)}})};FastOverrider.DDOverride=DDOverride;var FormOverride=function(){Ext.override(Ext.form.Basic,{submit:function(t){var e;return(t=t||{}).submitEmptyText=!1,t.timeout=180,e=t.standardSubmit||this.standardSubmit?"standardsubmit":this.api?"directsubmit":"submit",this.doAction(e,t)},isValid:function(){try{Ext.suspendLayouts();var n="",i=0,o="请正确填写数据！",t=this.getFields().filterBy(function(t){var e=!t.validate();return e&&0===i&&(n=t.getFieldLabel(),o=FastExt.Form.getFieldError(t)[0],i++),e});Ext.resumeLayouts(!0);var e=t.length<1;return e||(Ext.isEmpty(n)?FastExt.Dialog.toast("请将数据填写完整！"):Ext.isEmpty(o)?FastExt.Dialog.toast("【"+n+"】错误！"):FastExt.Dialog.toast("【"+n+"】错误："+o),FastExt.Component.shakeComment(this.owner.ownerCt)),e}catch(t){FastExt.Dialog.showException(t)}}}),Ext.override(Ext.form.field.Date,{parseDate:function(t){if(!t||Ext.isDate(t))return t;var e=FastExt.Base.guessDateFormat(t);e&&(this.format=e);var n,i=this,o=i.safeParse(t,i.format),e=i.altFormats,a=i.altFormatsArray,r=0;if(!o&&e)for(n=(a=a||e.split("|")).length;r<n&&!o;++r)o=i.safeParse(t,a[r]);return o},initComponent:Ext.Function.createSequence(Ext.form.field.Date.prototype.initComponent,function(){FastExt.System.isInitSystem()&&(this.format||(this.format=FastExt.System.dateFormat),"y-m-d"===this.format&&(this.format=FastExt.System.dateFormat),this.pickerAlign="tl-tr?")})}),Ext.override(Ext.form.field.File,{onRender:Ext.Function.createSequence(Ext.form.field.File.prototype.onRender,function(){this.multiple&&this.fileInputEl.dom.setAttribute("multiple","multiple")})}),Ext.override(Ext.form.field.Time,{initComponent:Ext.Function.createSequence(Ext.form.field.Time.prototype.initComponent,function(){this.invalidText="无效的时间格式!"})}),Ext.override(Ext.form.field.Text,{validate:function(){var t,e,n=this.callParent(arguments);return n&&"textfield"===this.xtype&&!this.disabled&&!this.readOnly&&this.useHistory&&(t=this.getValue(),(e=(e=FastExt.Cache.getCache(this.code))||[]).exists(t)||(e.push(t),FastExt.Cache.setCache(this.code,e))),n},initComponent:Ext.Function.createSequence(Ext.form.field.Text.prototype.initComponent,function(){var i=this;"password"===i.inputType?i.setTriggers({eayOpen:{cls:"extIcon extEye editColor",hidden:!0,handler:function(){i.up("menu")&&(i.up("menu").holdShow=!0),this.getTrigger("eayOpen").hide(),this.getTrigger("eayClose").show();var t=document.getElementById(this.getInputId());t.blur(),t.setAttribute("type","password"),setTimeout(function(){FastExt.Base.inputFocusEnd(t),i.up("menu")&&(i.up("menu").holdShow=!1)},100)}},eayClose:{cls:"extIcon extNoSee",handler:function(){i.up("menu")&&(i.up("menu").holdShow=!0),this.getTrigger("eayOpen").show(),this.getTrigger("eayClose").hide();var t=document.getElementById(this.getInputId());t.blur(),t.setAttribute("type","text"),setTimeout(function(){FastExt.Base.inputFocusEnd(t),i.up("menu")&&(i.up("menu").holdShow=!1)},100)}}}):"textfield"!==i.xtype||i.disabled||i.readOnly||!this.useHistory||(i.checkHistory=function(){this.code||(this.code=FastExt.Power.getPowerCode(this));var t=FastExt.Cache.getCache(this.code);return t&&0<t.length?(this.getTrigger("history").show(),!0):(this.getTrigger("history").hide(),!1)},i.clearHistory=function(){this.code||(this.code=FastExt.Power.getPowerCode(this)),FastExt.Cache.setCache(this.code,[]),FastExt.Dialog.toast("已清空历史记录！"),i.checkHistory()},i.showHistory=function(){this.code||(this.code=FastExt.Power.getPowerCode(this)),this.historyMenu=new Ext.menu.Menu({padding:"0 0 0 0",power:!1,showSeparator:!1,maxHeight:300,style:{background:"#ffffff"}}),this.historyMenuHandler=function(){i.setValue(this.text)};var t=FastExt.Cache.getCache(this.code);if(t){this.historyMenu.add({text:"清空历史记录",iconCls:"extIcon extClear",handler:function(){i.clearHistory()}});for(var e=0;e<t.length;e++){var n=t[e];this.historyMenu.add({text:n,iconCls:"extIcon extHistory",handler:this.historyMenuHandler})}this.historyMenu.setWidth(Math.max(this.bodyEl.getWidth(),200)),this.historyMenu.showBy(this.bodyEl,"tl-bl?")}},i.hideHistory=function(){this.historyMenu&&this.historyMenu.close()},i.on("change",function(t,e,n){t.checkHistory()}),i.on("afterrender",function(t,e,n){t.checkHistory()}),i.setTriggers({history:{cls:"extIcon extHistory",hidden:!0,handler:function(){i.up("menu")&&(i.up("menu").holdShow=!0),i.showHistory()}}}))})}),Ext.override(Ext.form.field.ComboBox,{initComponent:Ext.Function.createSequence(Ext.form.field.ComboBox.prototype.initComponent,function(){var t=this;t.searchable&&(t.editable=!0,t.queryMode="local",t.validator=function(t){if(this.allowBlank)return!0;if(this.searchable&&!this.getStore().findRecord(this.valueField,this.getValue(),0,!1,!1,!0))return"数据【"+t+"】无效，请选择下拉框里的选项！";return!0},t.on("beforequery",function(t){if(t.cancel)return!1;var n=t.combo,i=t.query;return n.store.clearFilter(),n.store.filterBy(function(t,e){return 0<=t.get(n.displayField).indexOf(i)}),n.expand(),!1}))})})};FastOverrider.FormOverride=FormOverride;var MenuOverride=function(){Ext.override(Ext.menu.Menu,{hide:function(){if(FastExt.System.isInitSystem()){var t=this;if((t.powerMenu||!FastExt.Power.menuShowing)&&!t.holdShow)return t.pendingShow&&(t.pendingShow=!1),t.rendered&&!t.isVisible()||t.hasListeners.beforehide&&!1===t.fireEvent("beforehide",t)&&!t.hierarchicallyHidden||(t.getInherited().hidden=t.hidden=!0,t.fireHierarchyEvent("beforehide"),t.rendered&&t.onHide.apply(t,arguments)),t}}})};FastOverrider.MenuOverride=MenuOverride;var WindowOverride=function(){function WindowOverride(){Ext.override(Ext.Window,{setIcon:function(t){this.callParent(arguments);var e=/([^/]*.svg)/;t&&e.test(t)&&(this.icon=FastExt.Server.getIcon(e.exec(t)[1].trim(),"#ffffff"))},afterRender:function(){var t;this.callParent(arguments),this.modal||(t=Ext.WindowManager.getActive(),FastExt.Base.toBool(t.modal,!1)||t&&"window"===t.xtype&&t.id!=this.id&&FastExt.Component.isSameByContainer(this,t)&&(this.x=t.x+20,this.y=t.y+20))},initComponent:function(){try{this.callParent(arguments),this.animateTarget==window&&(this.animateTarget=null),this.animateTarget||(this.animateTarget=FastExt.Base.getTargetElement(FastExt.System.currClickTarget)),eval(FastExt.System.getExt("window-anim").value)||(this.animateTarget=null),"toast"===FastExt.Base.toString(this.xtype,"")&&(this.animateTarget=null);var regStr=/([^/]*.svg)/;this.icon&&regStr.test(this.icon)&&(this.icon=FastExt.Server.getIcon(regStr.exec(this.icon)[1].trim(),"#ffffff")),this.liveDrag=!0,this.on("show",function(t){t.toFront(!0),t.focus()})}catch(e){console.error(e)}}}),Ext.override(Ext.window.MessageBox,{show:function(cfg){var me=this;return cfg=cfg||{},FastExt.Base.toBool(cfg.progress,!1)||FastExt.Base.toBool(cfg.wait,!1)?cfg.animateTarget=null:(Ext.isEmpty(cfg.animateTarget)&&(cfg.animateTarget=FastExt.Base.getTargetElement(FastExt.System.currClickTarget)),eval(FastExt.System.getExt("window-anim").value)||(cfg.animateTarget=null),cfg.animateTarget&&Ext.isElement(cfg.animateTarget)&&!FastExt.Base.isElementInViewport(cfg.animateTarget)&&(cfg.animateTarget=null),me.on("show",function(t){t.toFront(!0),t.focus()},this,{single:!0})),me.callParent(arguments),me}})}return WindowOverride}();FastOverrider.WindowOverride=WindowOverride;var ScrollerOverride=function(){Ext.override(Ext.scroll.Scroller,{fireScrollStart:function(){if(this.callParent(arguments),this.component&&"tableview"==this.component.xtype)for(var t=Ext.ComponentQuery.query("menu[scrollToHidden=true]"),e=0;e<t.length;e++)t[e].hide()}})};FastOverrider.ScrollerOverride=ScrollerOverride;var TooltipOverride=function(){Ext.override(Ext.tip.ToolTip,{onDocMouseDown:function(t){try{this.callParent(arguments)}catch(t){}}})},subClass;for(subClass in FastOverrider.TooltipOverride=TooltipOverride,FastOverrider)FastOverrider[subClass]()}(FastOverrider=FastOverrider||{}),function(r){r.PowerSet=function(){this.show=!0,this.edit=!0};var t=(e.isPower=function(){return window.isPower()},e.hasPower=function(t,e){return!t.managerPower||!t.managerPower.hasOwnProperty(e)||t.managerPower[e]},e.checkPower=function(t){var e=this;e.powers[t]||(e.powers[t]=r.Base.copy(e.defaultPower));var n=e.powers[t];if(!Ext.isEmpty(n))for(var i in e.defaultPower)n.hasOwnProperty(i)||(n[i]=e.defaultPower[i]);return n},e.checkManagerPower=function(t){if(!r.System.manager)return null;if(!r.System.managerPowers&&(Ext.isEmpty(r.System.manager.managerExtPower)||0===r.System.manager.role.roleType))return null;r.System.managerPowers||(r.System.managerPowers=r.Json.jsonToObject(r.System.manager.managerExtPower)),r.System.managerPowers||(r.System.managerPowers={});var e,n=(n=r.System.managerPowers[t.code])||r.Base.copy(r.Power.defaultPower);for(e in r.Power.defaultPower)n.hasOwnProperty(e)||(n[e]=r.Power.defaultPower[e]);return n},e.pushPower=function(t,e){this.powers[t]=e},e.setPower=function(t,e){this.powers[t]||(this.powers[t]=e)},e.getSavePowerData=function(){var t=this.powers;return Ext.encode(t)},e.getPowerCode=function(t){if(null!=t){var e,n=null;if(!Ext.isFunction(t.up)||(e=t.up("window"))&&(n=e.getTitle()),t.name&&(n+=t.name),t.title&&(n+=t.title),t.text&&(n+=t.text),t.subtext&&(n+=t.subtext),t.dataIndex&&(n+=t.dataIndex),Ext.isFunction(t.getFieldLabel)&&Ext.isEmpty(t.getFieldLabel())&&(n+=t.getFieldLabel()),n)return $.md5(n)}return null},e.setPowerStyle=function(i){var t=Ext.all("[code="+i.code+"]");Ext.each(t,function(t,e){var n=r.Power.checkPower(i.code);n&&(n.show?(t.removeCls("no-show-power"),n.edit?t.removeCls("no-edit-power"):t.addCls("no-edit-power")):t.addCls("no-show-power"))})},e.showPowerConfig=function(o,t){var a,e;r.System.isInitSystem()&&(a=r.Power.checkPower(o.code),r.Power.menuShowing=!0,e=Ext.create("Ext.panel.Panel",{layout:{type:"vbox",pack:"center"},border:0,defaults:{height:20,power:!1},items:[{xtype:"checkbox",name:"updateAlert",checked:!0,boxLabel:"允许显示",value:a.show,listeners:{change:function(t,e,n,i){a.show=e,r.Power.setPowerStyle(o)}}},{xtype:"checkbox",name:"updateAlert",checked:!0,boxLabel:"允许编辑",hidden:!r.Grid.isColumnType(o),value:a.edit,listeners:{change:function(t,e,n,i){a.edit=e,r.Power.setPowerStyle(o)}}}]}),new Ext.menu.Menu({padding:"0 0 0 10",powerMenu:!0,style:{background:"#ffffff"},items:[e],listeners:{beforehide:function(t,e){r.Power.menuShowing=!1,r.Power.pushPower(o.code,a)}}}).showAt(t.getXY()))},e.types=[FastEnum.PowerType.gridcolumn,FastEnum.PowerType.menuitem,FastEnum.PowerType.button],e.config=!1,e.menuShowing=!1,e.powers=[],e.defaultPower=new r.PowerSet,e);function e(){}r.Power=t}(FastExt=FastExt||{}),function(h){var t=(e.saveRenderFun=function(t,e,n){try{var i,o;Ext.isFunction(t.getHeaderContainer)&&(!(i=t.getHeaderContainer())||(o=i.getHeaderAtIndex(e))&&h.Cache.setCache(o.getRenderCacheKey(),n))}catch(t){console.error(t)}},e.normal=function(l,d){var c="FastExt.Renders.normal("+h.Base.toPlanParams(arguments)+")";return function(t,e,n,i,o,a,r,s){return h.Renders.saveRenderFun(this,o,c),Ext.isEmpty(t)?"<span style='color: #ccc;'>无</span>":(l=l||"",Ext.isEmpty(d)?t+=l:("left"!==d&&"l"!==d&&!h.Base.toBool(d,!1)||(t=l+t),"right"!==d&&"r"!==d||(t+=l)),s?t.replace(new RegExp("\n","g"),"<br/>").replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;").replace(new RegExp(" ","g"),"&nbsp;").replace(/<\/?.+?>/g,""):t)}},e.money=function(){var a="FastExt.Renders.money("+h.Base.toPlanParams(arguments)+")";return function(t,e,n,i,o){return h.Renders.saveRenderFun(this,o,a),Ext.isEmpty(t)?"<span style='color: #ccc;'>无</span>":"￥"+t}},e.text=function(){var l="FastExt.Renders.text("+h.Base.toPlanParams(arguments)+")";return function(t,e,n,i,o,a,r,s){return h.Renders.saveRenderFun(this,o,l),Ext.isEmpty(t)?"<span style='color: #ccc;'>无</span>":(t=t.replace(/<\/?.+?>/g,""),s?t.replace(new RegExp("\n","g"),"<br/>").replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;").replace(new RegExp(" ","g"),"&nbsp;").replace(/<\/?.+?>/g,""):"<span style='white-space: pre;'>"+t+"</span>")}},e.bigText=function(){var a="FastExt.Renders.bigText("+h.Base.toPlanParams(arguments)+")";return function(t,e,n,i,o){if(h.Renders.saveRenderFun(this,o,a),Ext.isEmpty(t)||"null"===t)return"<span style='color: #ccc;'>无</span>";o=$.md5(t);return h.Cache.memory[o]=t,'&nbsp;<a href="javascript:'+("FastExt.Dialog.showText(null,null,'查看内容',MemoryCache['"+o+"'])")+';">查看内容</a>&nbsp;'}},e.image=function(c,u){var x="FastExt.Renders.image("+h.Base.toPlanParams(arguments)+")";return function(t,e,n,i,o){try{h.Renders.saveRenderFun(this,o,x);var a="14px",r="auto";if(Ext.isEmpty(t)||"null"===t)return"<img style='object-fit: cover; border:1px solid #cccccc;height:"+a+";' src='images/default_img.png'   alt='' />";t.startWith("//")&&(t="http:"+t);try{c&&(a=c+"px"),u&&(r=u+"px")}catch(t){}var s=t.split("@")[0],l=s.substring(s.lastIndexOf("/")+1);if(h.FileModule.json().match(l))return"&nbsp;<a href=\"javascript:FastExt.Dialog.showLottie(this,'"+h.System.formatUrlVersion(s)+"');\" >查看动效</a>&nbsp;";var d=$.md5(s);return window[d]="<img  alt='' style='object-fit: cover;border:1px solid #cccccc;width: 100px; min-height:14px;  '  width='100'  class='lazyload' onerror=\"javascript:this.src = 'images/default_img.png';\" src='"+s+"' />","<img class='lazyload'  alt='' details-id='"+d+"'  style='object-fit: cover;border:1px solid #cccccc;height:"+a+";width: "+r+"; min-width:14px; min-height:14px; ' width='"+r.replace("px","")+"' height='"+a.replace("px","")+"'  onclick=\"FastExt.Dialog.showImage(this,'"+s+"')\"   onerror=\"javascript:this.src = 'images/default_img.png';\" src='"+h.Image.smallOSSImgUrl(s)+"'  />"}catch(t){return console.error(t),"<span style='color: #ccc;'>暂无图片</span>"}}},e.mp4=function(){var r="FastExt.Renders.mp4("+h.Base.toPlanParams(arguments)+")";return function(t,e,n,i,o){if(h.Renders.saveRenderFun(this,o,r),Ext.isEmpty(t)||"null"===t)return"<span style='color: #ccc;'>暂无文件</span>";var a=t.split("@"),o=a[0],t=o.substring(o.lastIndexOf("/")+1);return 1<a.length&&(t=a[1]),"&nbsp;<a href=\"javascript:showVideo(this,'"+h.System.formatUrlVersion(o)+"');\" ><span style='margin-right: 5px;'>"+h.Base.getSVGIcon("extFileMP4")+"</span>"+t+"</a>&nbsp;"}},e.mp3=function(){var r="FastExt.Renders.mp3("+h.Base.toPlanParams(arguments)+")";return function(t,e,n,i,o){if(h.Renders.saveRenderFun(this,o,r),Ext.isEmpty(t)||"null"===t)return"<span style='color: #ccc;'>暂无文件</span>";var a=t.split("@"),o=a[0],t=o.substring(o.lastIndexOf("/")+1);return 1<a.length&&(t=a[1]),"&nbsp;<a href=\"javascript:FastExt.Dialog.showMusic(this,'"+h.System.formatUrlVersion(o)+"');\" ><span style='margin-right: 5px;'>"+h.Base.getSVGIcon("extFileMP3")+"</span>"+t+"</a>&nbsp;"}},e.office=function(){var s="FastExt.Renders.office("+h.Base.toPlanParams(arguments)+")";return function(t,e,n,i,o){if(h.Renders.saveRenderFun(this,o,s),Ext.isEmpty(t)||"null"===t)return"<span style='color: #ccc;'>暂无文件</span>";var a=t.split("@"),r=a[0],o=r.split("?")[0],t=o.substring(o.lastIndexOf("/")+1);1<a.length&&(t=a[1]);o=h.Base.getSVGClassName(o);return'&nbsp;<a href="javascript:'+("FastExt.File.officeViewer('"+h.System.formatUrlVersion(r)+"')")+';" >在线预览</a>&nbsp;'+'&nbsp;<a href="'+h.System.formatUrlVersion(r)+"\" target='_blank' ><span style='margin-right: 5px;'>"+h.Base.getSVGIcon(o)+"</span>"+t+"</a>&nbsp;"}},e.file=function(l){var d="FastExt.Renders.file("+h.Base.toPlanParams(arguments)+")";return function(t,e,n,i,o){if(h.Renders.saveRenderFun(this,o,d),Ext.isEmpty(t)||"null"===t)return"<span style='color: #ccc;'>暂无文件</span>";var a=t.split("@"),r=a[0],s=r.split("?")[0],o=s.substring(s.lastIndexOf("/")+1);if(1<a.length&&(o=a[1]),Ext.isEmpty(l)||(o=n.get(l)),h.FileModule.image().match(s))return h.Renders.image()(t);if(h.FileModule.mp4().match(s))return h.Renders.mp4()(t);if(h.FileModule.pdf().match(s)||h.FileModule.word().match(s)||h.FileModule.excel().match(s)||h.FileModule.ppt().match(s))return h.Renders.office()(t);s=h.Base.getSVGClassName(s);return'&nbsp;<a href="'+h.System.formatUrlVersion(r)+"\" target='_blank' ><span style='margin-right: 5px;'>"+h.Base.getSVGIcon(s)+"</span>"+o+"</a>&nbsp;"}},e.files=function(){var g="FastExt.Renders.files("+h.Base.toPlanParams(arguments)+")";return function(t,e,n,i,o,a,r,s){h.Renders.saveRenderFun(this,o,g);try{if(Ext.isEmpty(t)||"null"===t)return"<span style='color: #ccc;'>暂无文件</span>";var l=t;if(Ext.isString(t)&&!Ext.isEmpty(t))try{l=Ext.decode(t)}catch(t){console.error(t)}if(0===l.length)return"<span style='color: #ccc;'>暂无文件</span>";for(var d=$.md5(JSON.stringify(l)),c="",u=0;u<l.length;u++)c+="<div style='margin: 5px;'>"+h.Renders.file()(l[u])+"</div>";if(s)return c;h.Cache.memory[d]="<div style='overflow: scroll;max-height: 300px;'>"+c+"</div>";var x='&nbsp;<a href="javascript:'+("FastExt.Dialog.showAlert('查看文件',MemoryCache['"+d+"'],null,false)")+';">共有'+l.length+"个文件！</a>&nbsp;",m=$.md5(x);return window[m]=c,x}catch(t){return console.error(t),"<span style='color: #ccc;'>暂无文件</span>"}}},e.images=function(){var g="FastExt.Renders.images("+h.Base.toPlanParams(arguments)+")";return function(t,e,n,i,o,a,r,s){try{if(h.Renders.saveRenderFun(this,o,g),Ext.isEmpty(t)||"null"===t)return"<span style='color: #ccc;'>暂无图片</span>";var l=t;if(Ext.isString(t)&&!Ext.isEmpty(t))try{l=Ext.decode(t)}catch(t){console.error(t)}if(0===l.length)return"<span style='color: #ccc;'>暂无图片</span>";for(var d=$.md5(JSON.stringify(l)),c="",u=[],x=0;x<l.length;x++)c+=h.Renders.image(24)(l[x])+"&nbsp;&nbsp;",u.push({url:l[x]});if(s)return c;h.Cache.memory[d]=u;var m='<a href="javascript:'+("FastExt.Dialog.showImage(null,MemoryCache['"+d+"'])")+";\" details-id='"+d+"' style='color: #4279fa;'>共有"+l.length+"张图片！</a>";return window[d]=c,m}catch(t){return console.error(t),"<span style='color: #ccc;'>暂无图片</span>"}}},e.html=function(){var a="FastExt.Renders.html("+h.Base.toPlanParams(arguments)+")";return function(t,e,n,i,o){if(h.Renders.saveRenderFun(this,o,a),Ext.isEmpty(t)||"null"===t)return"<span style='color: #ccc;'>无</span>";o=$.md5(t);return h.Cache.memory[o]=t,'&nbsp;<a href="javascript:'+("FastExt.Dialog.showEditorHtml(this,'查看内容',MemoryCache['"+o+"'])")+';">查看内容</a>&nbsp;'}},e.html2=function(){var l="FastExt.Renders.html2("+h.Base.toPlanParams(arguments)+")";return function(t,e,n,i,o,a,r,s){return h.Renders.saveRenderFun(this,o,l),Ext.isEmpty(t)||"null"===t?"<span style='color: #ccc;'>无</span>":s?t:t=t.replace(/[&\|\\\*^%$'"#@\-]/g,"").replace(new RegExp("\n","g"),"").replace(new RegExp("\t","g"),"").replace(new RegExp(" ","g"),"").replace(/<\/?.+?>/g,"")}},e.json=function(){var a="FastExt.Renders.json("+h.Base.toPlanParams(arguments)+")";return function(t,e,n,i,o){if(h.Renders.saveRenderFun(this,o,a),Ext.isEmpty(t)||"null"===t)return"<span style='color: #ccc;'>无</span>";o=$.md5(t);return'&nbsp;<a href="javascript:'+("FastExt.Dialog.showJson(null,'查看JSON内容',MemoryCache['"+o+"'])")+';">'+(h.Cache.memory[o]=t)+"</a>&nbsp;"}},e.json2=function(){var a="FastExt.Renders.json2("+h.Base.toPlanParams(arguments)+")";return function(t,e,n,i,o){if(h.Renders.saveRenderFun(this,o,a),Ext.isEmpty(t)||"null"===t)return"<span style='color: #ccc;'>无</span>";o=$.md5(t);return h.Cache.memory[o]=t,'&nbsp;<a href="javascript:'+("FastExt.Dialog.showJson(null,'查看JSON内容',MemoryCache['"+o+"'])")+';">查看JSON内容</a>&nbsp;'}},e.link=function(r,s,l){var d="FastExt.Renders.link("+h.Base.toPlanParams(arguments)+")";return function(t,e,n,i,o){h.Renders.saveRenderFun(this,o,d);try{if(Ext.isEmpty(t)||"null"===t)return"<span style='color: #ccc;'>无</span>";var a=n.get(r);return'&nbsp;<a href="javascript:'+("new "+s+"().showDetails(null, {'t."+l+"':'"+a+"'})")+';" >'+t+"</a>&nbsp;"}catch(t){return console.error(t),"<span style='color: #ccc;'>无</span>"}}},e.target=function(l,d,c){var u="FastExt.Renders.target("+h.Base.toPlanParams(arguments)+")";return function(t,e,n,i,o){h.Renders.saveRenderFun(this,o,u);try{if(Ext.isEmpty(t)||"null"===t)return"<span style='color: #ccc;'>无</span>";if(c=c||"getTargetEntity",!Ext.isFunction(window[c]))return t;var a=n.get(d),r=n.get(l),s=window[c](a,d);return s?'&nbsp;<a href="javascript:'+("new "+s.entityCode+"().showDetails(null, {'t."+s.entityId+"':'"+r+"'})")+';" >'+t+"</a>&nbsp;":t}catch(t){return console.error(t),"<span style='color: #ccc;'>无</span>"}}},e.map=function(d,c,u){var x="FastExt.Renders.map("+h.Base.toPlanParams(arguments)+")";return function(t,e,n,i,o){h.Renders.saveRenderFun(this,o,x);try{if(Ext.isEmpty(t)||"null"===t)return"<span style='color: #ccc;'>无</span>";var a=n.get(d),r=n.get(c),s=n.get(u);if(a&&r){var l=a+","+r;return'&nbsp;<a href="javascript:'+(s?"FastExt.Map.showAddressInMap(null,'"+l+"','"+s+"','"+t+"')":"FastExt.Map.showAddressInMap(null,'"+l+"','','"+t+"')")+';" >'+t+"</a>&nbsp;"}return t}catch(t){return"<span style='color: #ccc;'>无</span>"}}},e.mapImgLayer=function(d,c,u,x){var m="FastExt.Renders.mapImgLayer("+h.Base.toPlanParams(arguments)+")";return function(t,e,n,i,o){h.Renders.saveRenderFun(this,o,m);try{if(Ext.isEmpty(t)||"null"===t)return"<span style='color: #ccc;'>无</span>";var a=n.get(d),r=n.get(c),s=n.get(u),l=n.get(x);return(a=l?h.Image.rotateOSSImgUrl(a,l):a)&&r&&s?'&nbsp;<a href="javascript:'+(" FastExt.Map.showImgLayerInMap(null,'"+a+"','"+r+"','"+s+"')")+';" >'+t+"</a>&nbsp;":t}catch(t){return"<span style='color: #ccc;'>无</span>"}}},e.password=function(){var a="FastExt.Renders.password("+h.Base.toPlanParams(arguments)+")";return function(t,e,n,i,o){return h.Renders.saveRenderFun(this,o,a),Ext.isEmpty(t)?"<span style='color: #ccc;'>无</span>":"<span>******</span>"}},e.href=function(){var a="FastExt.Renders.href("+h.Base.toPlanParams(arguments)+")";return function(t,e,n,i,o){return h.Renders.saveRenderFun(this,o,a),Ext.isEmpty(t)||"null"===t?"<span style='color: #ccc;'>无</span>":"&nbsp;<a href='"+t+"' target='_blank'>"+t+"</a>&nbsp;"}},e.fileSize=function(){var a="FastExt.Renders.fileSize("+h.Base.toPlanParams(arguments)+")";return function(t,e,n,i,o){h.Renders.saveRenderFun(this,o,a);try{return Ext.isEmpty(t)||"null"===t?"<span style='color: #ccc;'>无</span>":1048576<=t?(t/1024/1024).toFixed(2)+"M":1024<=t?(t/1024).toFixed(2)+"KB":t+"B"}catch(t){return console.error(t),"<span style='color: #ccc;'>无</span>"}}},e.duration=function(){var d="FastExt.Renders.duration("+h.Base.toPlanParams(arguments)+")";return function(t,e,n,i,o){h.Renders.saveRenderFun(this,o,d);try{if(Ext.isEmpty(t)||"null"===t)return"<span style='color: #ccc;'>无</span>";var a=parseInt(t)/1e3,r=parseInt((a/3600).toString()),s=parseInt((a/60%60).toString()),l=parseInt((a%60).toString());return 0<r?r+"时"+s+"分"+l+"秒":0<s?s+"分"+l+"秒":l+"秒"}catch(t){return console.error(t),"<span style='color: #ccc;'>无</span>"}}},e.dateFormat=function(r){var s="FastExt.Renders.dateFormat("+h.Base.toPlanParams(arguments)+")";return function(e,t,n,i,o){h.Renders.saveRenderFun(this,o,s);try{if(Ext.isEmpty(e)||"null"===e)return"<span style='color: #ccc;'>无</span>";Ext.isEmpty(r)&&(r="Y-m-d H:i:s");var a=h.Base.guessDateFormat(e);return Ext.Date.format(Ext.Date.parse(e,a),r)}catch(t){return console.error(t),e}}},e.timestamp=function(a){var r="FastExt.Renders.timestamp("+h.Base.toPlanParams(arguments)+")";return function(e,t,n,i,o){h.Renders.saveRenderFun(this,o,r);try{return Ext.isEmpty(e)||"null"===e?"<span style='color: #ccc;'>无</span>":(Ext.isEmpty(a)&&(a="Y-m-d H:i:s"),Ext.Date.format(new Date(parseInt(e)),a))}catch(t){return console.error(t),e}}},e.enum=function(l,d,c){var u="FastExt.Renders.enum("+h.Base.toPlanParams(arguments)+")";return function(e,t,n,i,o){h.Renders.saveRenderFun(this,o,u);try{if(Ext.isEmpty(e))return"<span style='color: #ccc;'>无</span>";Ext.isEmpty(c)&&(c="text");var a=h.Store.getEnumRecord(l,e,d);if(!a)return"<span style='color: #ccc;'>"+e+"</span>";var r=a.get(c),s=a.get("color");return Ext.isEmpty(r)?"<span style='color: #ccc;'>"+e+"</span>":"<span style='color: "+h.Color.toColor(s,"#000000")+";'>"+r+"</span>"}catch(t){return"<span style='color: #ccc;'>"+e+"</span>"}}},e.exception=function(){var r="FastExt.Renders.exception("+h.Base.toPlanParams(arguments)+")";return function(e,t,n,i,o){h.Renders.saveRenderFun(this,o,r);try{if(Ext.isEmpty(e))return"<span style='color: #ccc;'>无</span>";var a=$.md5(e);return h.Cache.memory[a]=e,'&nbsp;<a href="javascript:'+("FastExt.Dialog.showCode(null,MemoryCache['"+a+"'])")+';">查看异常内容</a>&nbsp;'}catch(t){return"<span style='color: #ccc;'>"+e+"</span>"}}},e.color=function(){var a="FastExt.Renders.color("+h.Base.toPlanParams(arguments)+")";return function(e,t,n,i,o){h.Renders.saveRenderFun(this,o,a);try{return Ext.isEmpty(e)?"<span style='color: #ccc;'>无</span>":"<div style='background: "+h.Color.toColor(e)+";padding: 0 25px;height: 14px;display: inline;'></div>"}catch(t){return"<span style='color: #ccc;'>"+e+"</span>"}}},e);function e(){}h.Renders=t}(FastExt=FastExt||{}),function(a){var t=(n.isSilenceRequest=function(){return a.Base.toBool(n.silence,!1)},n.setSilence=function(t){n.silence=t},n.loginUrl=function(){return"controller/login"},n.validOperateUrl=function(){return"controller/valid"},n.showConfigUrl=function(){return"showConfig"},n.importEntityExcelUrl=function(){return"entity/importData"},n.loadEntityDataUrl=function(){return"entity/loadData"},n.logout=function(){a.Dialog.showWait("正在退出登录中……"),$.post("controller/logout",function(){location.reload()})},n.updateEntity=function(t,e){a.Power.isPower()?e(!1,"当前正在进行界面权限配置，不可修改数据！"):$.post("entity/update",t,function(t){203!==t.code&&Ext.isFunction(e)&&(t.success?e(!0,t.message):e(!1,t.message))})},n.deleteAttach=function(t,e){a.Power.isPower()?e(!1,"当前正在进行界面权限配置，不可删除数据！"):$.post("deleteAttach",t,function(t){203!==t.code&&Ext.isFunction(e)&&(t.success?e(!0,t.message):e(!1,t.message))})},n.deleteEntity=function(t,e){a.Power.isPower()?e(!1,"当前正在进行界面权限配置，不可删除数据！"):$.post("entity/delete",t,function(t){203!==t.code&&Ext.isFunction(e)&&e(t.success,t.message)})},n.rebackEntity=function(t,e){a.Power.isPower()?e(!1,"当前正在进行界面权限配置，不可还原数据！"):$.post("entity/reback",t,function(t){203!==t.code&&Ext.isFunction(e)&&e(t.success,t.message)})},n.copyEntity=function(t,e){a.Power.isPower()?e(!1,"当前正在进行界面权限配置，不可复制数据！"):$.post("entity/copy",t,function(t){203!==t.code&&Ext.isFunction(e)&&(t.success?e(!0,t.message):e(!1,t.message))})},n.clearEntity=function(t,e){a.Power.isPower()?e(!1,"当前正在进行界面权限配置，不可复制数据！"):$.post("entity/clear",t,function(t){203!==t.code&&Ext.isFunction(e)&&(t.success?e(!0,t.message):e(!1,t.message))})},n.showExtConfig=function(t,e,n){a.Power.isPower()?n(!1):$.post("ext/config/showExtConfig",{configKey:t,configType:e},function(t){Ext.isFunction(n)&&(t.success?n(!0,t.data.configValue,t.message):n(!1,null,t.message))})},n.saveExtConfig=function(t,e,n,i,o){a.Power.isPower()?i(!1):(n={configKey:t,configType:e,configValue:n},Ext.isEmpty(o)||(n=a.Json.mergeJson(n,o)),$.post("ext/config/saveExtConfig",n,function(t){Ext.isFunction(i)&&(t.success?i(!0,t.message):i(!1,t.message))}))},n.deleteExtConfig=function(t,e,n){a.Power.isPower()?n(!1):$.post("ext/config/deleteExtConfig",{configKey:t,configType:e},function(t){Ext.isFunction(n)&&(t.success?n(!0,t.message):n(!1,t.message))})},n.exportExcel=function(t,e){a.Power.isPower()?e(!1,"当前正在进行界面权限配置，不可导出数据！"):$.post("entity/export",t,function(t){203!==t.code&&Ext.isFunction(e)&&(t.success?e(!0,t.data,t.message):e(!1,null,t.message))})},n.excelModule=function(t,e){a.Power.isPower()?e(!1,"当前正在进行界面权限配置，不可生成模板！"):$.post("entity/module",t,function(t){203!==t.code&&Ext.isFunction(e)&&(t.success?e(!0,t.data,t.message):e(!1,null,t.message))})},n.showColumns=function(t,e){$.post("ext/config/showEntityColumn?entityCode="+t,function(t){Ext.isFunction(e)&&(t.success?e(!0,t.data.configValue,t.message):e(!1,null,t.message))})},n.getIcon=function(t,e){t="icons/"+t;return Ext.isEmpty(e)?t:"icon?path="+t+"&color="+(e=e.startWith("#")?e.substring(1):e)},n.showSystemConfig=function(e){$.post("ext/config/showSystemConfig",function(t){Ext.isFunction(e)&&(t.success?e(!0,t.data,t.message):e(!1,null,t.message))})},n.deleteSystemConfig=function(e){$.post("ext/config/deleteSystemConfig",function(t){Ext.isFunction(e)&&e(t.success,t.message)})},n.loadMonitor=function(e){$.post("monitor",function(t){Ext.isFunction(e)&&e(t.success,t.data)})},n.countReport=function(e){$.post("countReport",function(t){Ext.isFunction(e)&&e(t.success,t.data)})},n.checkWaitNotice=function(t,e){n.setSilence(!0),$.post("controller/waitNotice",t,function(t){n.setSilence(!1),Ext.isFunction(e)&&e(t.success,t.data)})},n.doneWaitNotice=function(t,e){$.post("controller/doneNotice",{noticeId:t},function(t){Ext.isFunction(e)&&e(t.success,t.message,t.data)})},n.clearWaitNotice=function(e){$.post("controller/clearNotice",function(t){Ext.isFunction(e)&&e(t.success,t.message,t.data)})},n.downData=function(t,e){a.Power.isPower()?e(!1,"当前正在进行界面权限配置，不可下载数据！"):$.post("entity/downData",t,function(t){Ext.isFunction(e)&&e(t.success,t.message,t.data)})},n.updateAllLayer=function(e){a.Power.isPower()?e(!1,"当前正在进行界面权限配置，不可下载数据！"):$.post("updateAllLayer",function(t){Ext.isFunction(e)&&e(t.success,t.message)})},n.updateLayer=function(t,e){a.Power.isPower()?e(!1,"当前正在进行界面权限配置，不可下载数据！"):$.post("entity/updateLayer",t,function(t){Ext.isFunction(e)&&e(t.success,t.message)})},n.showEcharts=function(t,e){a.Power.isPower()?e(!1,"当前正在进行界面权限配置，不可下载数据！"):$.post("entity/echarts",t,function(t){Ext.isFunction(e)&&e(t.success,t.message,t.data)})},n);function n(){$.ajaxSetup({data:{fromOS:a.Base.getOS()}}),Ext.Ajax.on("beforerequest",function(t,e,n){try{t.setExtraParams({fromOS:a.Base.getOS()})}catch(t){}})}a.Server=t}(FastExt=FastExt||{}),function(FastExt){var Store=function(){function Store(){}return Store.getStoreMenuText=function(t,e,n){return Ext.isEmpty(n)&&(n=">"),e?FastExt.System.getPlainMenu(e,n):t&&t.entity?FastExt.System.getPlainMenu(t.entity.menu,n):null},Store.commitStoreUpdate=function(c){return new Ext.Promise(function(n,t){if(c&&c.entity&&!c.commiting){var e=c.getUpdatedRecords(),i=c.getNewRecords();if(0!==(e=e.concat(i)).length){c.commiting=!0;var o={entityCode:c.entity.entityCode};c.entity.menu&&(o.menu=FastExt.Store.getStoreMenuText(c));for(var a=0;a<e.length;a++){for(var r,s=e[a],l=0;l<c.entity.idProperty.length;l++){var d=c.entity.idProperty[l];o["data["+a+"]."+d]=s.get(d)}for(r in s.modified)o["data["+a+"]."+r]=s.get(r)}FastExt.Server.updateEntity(o,function(t,e){c.commiting=!1,n(t),t?(FastExt.Dialog.toast(e),c.commitChanges()):Ext.Msg.alert("系统提醒",e)})}else n(!0)}})},Store.commitStoreDelete=function(s,l){return new Ext.Promise(function(n,t){if(s.entity){var e={entityCode:s.entity.entityCode};s.entity.menu&&(e.menu=FastExt.Store.getStoreMenuText(s));for(var i=0;i<l.length;i++)for(var o=l[i],a=0;a<s.entity.idProperty.length;a++){var r=s.entity.idProperty[a];e["data["+i+"]."+r]=o.get(r)}FastExt.Server.deleteEntity(e,function(t,e){n(t),t?(FastExt.Dialog.toast(e),t=s.currentPage,s.count()-l.length<=0&&(t-=1),s.loadPage(Math.max(t,1))):Ext.Msg.alert("系统提醒",e)})}})},Store.commitStoreReback=function(s,l){return new Ext.Promise(function(n,t){if(s.entity){var e={entityCode:s.entity.entityCode};s.entity.menu&&(e.menu=FastExt.Store.getStoreMenuText(s));for(var i=0;i<l.length;i++)for(var o=l[i],a=0;a<s.entity.idProperty.length;a++){var r=s.entity.idProperty[a];e["data["+i+"]."+r]=o.get(r)}FastExt.Server.rebackEntity(e,function(t,e){n(t),t?(t=s.currentPage,s.count()-l.length<=0&&(t-=1),s.loadPage(Math.max(t,1))):Ext.Msg.alert("系统提醒",e)})}})},Store.commitStoreCopy=function(s,l){return new Ext.Promise(function(n,t){if(s.entity){var e={entityCode:s.entity.entityCode};s.entity.menu&&(e.menu=Store.getStoreMenuText(s));for(var i=0;i<l.length;i++)for(var o=l[i],a=0;a<s.entity.idProperty.length;a++){var r=s.entity.idProperty[a];e["data["+i+"]."+r]=o.get(r)}FastExt.Server.copyEntity(e,function(t,e){n(t),t?(FastExt.Dialog.toast(e),t=s.currentPage,s.count()-l.length<=0&&(t-=1),s.loadPage(Math.max(t,1))):Ext.Msg.alert("系统提醒",e)})}})},Store.isModified=function(t){for(var e in t.data)try{if(t.isModified(e))return!0}catch(t){}return!1},Store.getEntityDataStore=function(entity,where,tree){if(!Ext.isEmpty(entity)){var config={fields:[],pageSize:20,where:where,entity:entity,remoteSort:FastExt.Base.toBool(entity.remoteSort,!0),proxy:{type:"ajax",url:"entity/list",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},listeners:{exception:function(obj,request,operation,eOpts){try{var data=eval("("+request.responseText+")");data.success||Ext.Msg.alert("数据获取失败",data.message)}catch(e){Ext.Msg.alert("数据获取失败",request.responseText)}}},reader:{type:"json",root:"list",totalProperty:"totalRow"}},listeners:{beforeload:function(e,t,n){try{if(!e.entity||!e.entity.entityCode)return!1;var i,o,a=e.proxy.extraParams,r={entityCode:e.entity.entityCode,limit:e.pageSize};if(e.where)for(var s in e.where)r["where['"+s+"']"]=e.where[s];if(tree&&(Ext.isEmpty(tree.parentIdValue)&&(tree.parentIdValue=-1),r.page=-1,r.fromTree=!0,r.treeParentIdName=tree.parentIdName,i=t.node.data[tree.idName],o=FastExt.Base.toBool(t.node.isFirstInstance,!1),Ext.isEmpty(i)&&(i=tree.parentIdValue),r["where['^treeSearch']"]=!1,o&&-1!==tree.parentIdValue?(r["where['"+tree.idName+"']"]=i,r["where['"+tree.parentIdName+"']"]=null):(r["where['"+tree.idName+"']"]=null,e.grid&&FastExt.Grid.hasSearchColumn(e.grid)?(r["where['"+tree.parentIdName+"']"]=null,r["where['^treeSearch']"]=!0):r["where['"+tree.parentIdName+"']"]=i)),e.grid){if(r.power=FastExt.Base.toBool(e.grid.power,!0),0<e.grid.getSelection().length?e.grid.getSelectionModel().deselectAll():e.grid.fireEvent("selectionchange",e.grid),e.grid.where)for(var s in e.grid.where)r["where['"+s+"']"]=e.grid.where[s];if(e.getSorters().each(function(t){r["indexSort['"+t.getProperty()+"']"]=FastExt.Grid.getColumn(e.grid,t.getProperty()).getIndex()}),FastExt.Grid.checkColumnSearch(e.grid),Ext.isFunction(e.grid.onBeforeLoad)){var l=e.grid.onBeforeLoad(e.grid,e,r);if(!FastExt.Base.toBool(l,!0))return!1}}return e.getProxy().setExtraParams(FastExt.Json.mergeJson(a,r)),!0}catch(t){FastExt.Dialog.showException(t,"store:beforeload")}}},autoLoad:!1,autoLoad:!1},entityStore,entityStore=tree?(FastExt.System.silenceGlobalSave||(config.root={expanded:!0}),Ext.create("Ext.data.TreeStore",config)):Ext.create("Ext.data.Store",config);return entityStore.on("load",function(t){setTimeout(function(){try{t.grid&&t.grid.syncRowHeights()}catch(t){}},300)}),entityStore}FastExt.Dialog.showAlert("系统提醒","参数entity不可为空！")},Store.getEnumDataStore=function(t,e,n,i,o,a){i=i||{},Ext.isEmpty(o)&&(o=!0),Ext.isEmpty(a)&&(a=!1);var r=$.md5(t+Ext.JSON.encode(i));o&&FastExt.Cache.memory.hasOwnProperty(r)&&!a||Ext.Ajax.request({url:"showEnums?enumName="+t,async:!1,params:i,success:function(t,e){try{var n=Ext.decode(t.responseText);n.success?FastExt.Cache.memory[r]=n.data:Ext.Msg.alert("枚举获取失败",n.message)}catch(t){FastExt.Dialog.showException(t,"获取枚举数据源！[getEnumDataStore]")}}});i=Ext.clone(FastExt.Cache.memory[r]);return e&&(i=Ext.Array.insert(i,0,e)),n&&(i=Ext.Array.push(i,n)),Ext.create("Ext.data.Store",{autoLoad:!1,enumName:t,data:i})},Store.getEnumRecord=function(t,e,n){return n=n||"id",FastExt.Store.getEnumDataStore(t).findRecord(n,e,0,!1,!1,!0)},Store.getEnumText=function(t,e){e=FastExt.Store.getEnumRecord(t,e);return e?e.get("text"):null},Store.getPageDataStore=function(t,e){t&&0!==t.length||(t=FastExt.Store.maxPageSize),e&&0!==e.length||(e=10);for(var n=[],i=0;i<t/10;i++)n.push({text:(i+1)*e+"条",id:(i+1)*e});return Ext.create("Ext.data.Store",{id:"pageSizeDataStore",fields:["id","text"],data:n})},Store.getCompareDataStore=function(){return Ext.create("Ext.data.Store",{data:[{id:-1,text:"~",desc:"空值"},{id:-2,text:"!~",desc:"非空值"},{id:0,text:"=",desc:"等于"},{id:1,text:"!=",desc:"不等于"},{id:2,text:"?",desc:"包含"},{id:3,text:"!?",desc:"不包含"},{id:4,text:">",desc:"大于"},{id:6,text:">=",desc:"大等于"},{id:5,text:"<",desc:"小于"},{id:7,text:"<=",desc:"小等于"}]})},Store.getCompareLinkDataStore=function(){return Ext.create("Ext.data.Store",{data:[{id:0,text:"&",desc:"并且"},{id:1,text:"||",desc:"或者"}]})},Store.getGridColumnStore=function(t,e){for(var n=[],i=t.getColumns(),o=0;o<i.length;o++){var a=i[o];Ext.isEmpty(a.dataIndex)||FastExt.Base.toBool(e,!1)&&!FastExt.Grid.canColumnSearch(a)||n.push({text:a.configText,id:a.dataIndex,index:o})}return Ext.create("Ext.data.Store",{fields:["id","text","index"],data:n})},Store.getChartGridColumnStore=function(t){for(var e=[],n=t.getColumns(),i=0;i<n.length;i++){var o=n[i];Ext.isEmpty(o.dataIndex)||(FastExt.Grid.isNumberColumn(o)&&FastExt.Base.toBool(o.chart,!0)||FastExt.Grid.isIdPropertyColumn(o)||FastExt.Base.toBool(o.chart,!0))&&e.push({text:o.configText,id:o.dataIndex,index:i})}return Ext.create("Ext.data.Store",{fields:["id","text","index"],data:e})},Store.getYesOrNoDataStore=function(){return Ext.create("Ext.data.Store",{id:"yesOrNoDataStore",fields:["id","text"],data:[{text:"是",id:1},{text:"否",id:0}]})},Store.getThemeDataStore=function(){return Ext.create("Ext.data.Store",{id:"themeDataStore",fields:["id","text"],data:[{text:"圆润立体",id:"extjs/theme/fast-theme-wrap"},{text:"清爽扁平",id:"extjs/theme/fast-theme-flat"}]})},Store.getFontSizeDataStore=function(){return Ext.create("Ext.data.Store",{id:"fontSizeDataStore",fields:["id","text"],data:[{text:"14px",id:"14px"},{text:"16px",id:"16px"},{text:"18px",id:"18px"}]})},Store.setRecordValue=function(t,e,n){var i;n.dataIndex=e,Ext.isFunction(n.setRecordValue)?n.setRecordValue(t,!1):(i=n.getValue(),Ext.isDate(n.getValue())?t.set(e,Ext.Date.format(i,n.format)):t.set(e,i)),t.store&&FastExt.Base.toBool(n.autoUpdate,!1)&&FastExt.Store.commitStoreUpdate(t.store)},Store.maxPageSize=50,Store}();FastExt.Store=Store}(FastExt=FastExt||{}),function(FastExt){var System=function(){function System(){}return Object.defineProperty(System,"fontSize",{get:function(){return window.fontSize||this._fontSize},enumerable:!1,configurable:!0}),System.removeLoading=function(){window.removeLoading()},System.checkBrowserVersion=function(){return!(Ext.isIE&&Ext.ieVersion<11)||(Ext.create("Ext.window.Window",{title:"系统提醒",width:250,height:100,layout:"fit",icon:"icons/icon_error.svg",resizable:!1,closable:!1,html:"<div style='background:#eeeeee; padding:10px;'>您当前的IE版本太低，至少在11.0以上的IE才能使用本系统！</div>",modal:!0}).show(),!1)},System.getBodyContainer=function(){var t=Ext.getCmp("bodyContainer");return t||(Ext.getDoc().on("contextmenu",function(t){t.stopEvent()}),Ext.tip.QuickTipManager.init(),Ext.QuickTips.init(),t=Ext.create("Ext.container.Viewport",{id:"bodyContainer",layout:"card",border:0,renderTo:Ext.getBody()})),t},System.getValue=function(t){t=FastExt.System[t];return t||{value:""}},System.addScript=function(e,t){if(null!=e){var n=document.getElementsByTagName("head").item(0),i=document.createElement("script"),o=!1;if(i.type="text/javascript",null!=e.src&&0<e.src.length)i.src=FastExt.System.formatUrlVersion(e.src);else if(null!=e.href&&0<e.href.length)i.src=FastExt.System.formatUrlVersion(e.href);else{if(!e.text)return void(null!=t&&t());try{i.appendChild(document.createTextNode(e.text))}catch(t){i.text=e.text}o=!0}n.appendChild(i),o?null!=t&&t():(i.onload=i.readystatechange=function(){null!=t&&t()},i.onerror=function(){alert("脚本文件"+e.src+"加载失败，请您稍后重试！")})}},System.addStyle=function(t,e){var n=document.getElementsByTagName("head").item(0),i=document.createElement("style");return i.type="text/css",i.styleSheet?i.styleSheet.cssText=t:i.innerHTML=t,null!=e&&e(),n.appendChild(i),i},System.removeStyle=function(t){for(var e=document.getElementsByTagName("style"),n=0;n<e.length;n++){var i=e[n];i.code===t&&i.parentNode.removeChild(i)}},System.addStylesheet=function(t,e){var n,i;null!=t&&(n=document.getElementsByTagName("head").item(0),(i=document.createElement("link")).rel="stylesheet",i.href=FastExt.System.formatUrl(t.href),n.appendChild(i),i.onload=i.readystatechange=function(){null!=e&&e()},i.onerror=function(){alert("系统Link文件"+t.href+"加载失败，请您稍后重试！")})},System.getProgressLine=function(t){return Ext.isEmpty(t)&&(t="#f8c633"),FastExt.System.progressLine||(FastExt.System.progressLine=new ProgressBar.Line("#progress",{color:t,duration:1e3,easing:"easeInOut",from:{color:"#9c58b6"},to:{color:t},step:function(t,e,n){e.path.setAttribute("stroke",t.color)}})),FastExt.System.progressLine},System.initConfig=function(){FastExt.System.baseUrl=window.location.href,0<FastExt.System.baseUrl.indexOf("#")&&(FastExt.System.baseUrl=FastExt.System.baseUrl.split("#")[0]),FastExt.System.baseUrl.toString().endWith("/")||(FastExt.System.baseUrl=FastExt.System.baseUrl+"/");var t={};FastExt.Power.isPower()&&window.parent&&Ext.isFunction(window.parent.getMenuPower)&&(t={menuPower:window.parent.getMenuPower()}),Ext.Ajax.request({url:FastExt.Server.showConfigUrl(),params:t,success:function(t,e){var n,i=FastExt.Json.jsonToObject(t.responseText).data;for(n in i)i.hasOwnProperty(n)&&(FastExt.System[n]=i[n]);for(var o=FastExt.System.getAllExt(),a=0;a<o.length;a++){var r=o[a];FastExt.System[r.name]=r}FastExt.System.loadAppJs()},failure:function(t,e){FastExt.Dialog.showException(t.responseText,"获取系统配置！[system.initConfig]")}})},System.loadAppJs=function(t){if((t=t||0)>=FastExt.System.app.length)return Ext.MessageBox.updateProgress(1,"已加载成功，正在显示中"),void FastExt.System.addStyle(FastExt.System.menusCss,function(){FastExt.System.globalConfig()});Ext.MessageBox.updateProgress(parseFloat(String(t+1))/parseFloat(FastExt.System.app.length),"正在加载中，请耐心等待"),FastExt.System.addScript({src:FastExt.System.app[t]},function(){FastExt.System.loadAppJs(t+1)})},System.globalConfig=function(){for(var entities=FastExt.System.entities,i=0;i<entities.length;i++){var entity=entities[i],key;for(key in entity)if(entity.hasOwnProperty(key)){entity.js=!1;try{var pro=eval(entity.entityCode+".prototype");pro&&(pro[key]=entity[key],entity.js=!0)}catch(e){entity.js=!1;break}}}if(FastExt.Power.isPower()&&window.parent&&Ext.isFunction(window.parent.getExtPower)){if(FastExt.Power.config=!0,FastExt.Power.powers=FastExt.Json.jsonToObject(window.parent.getExtPower()),FastExt.Power.powers||(FastExt.Power.powers={}),FastExt.System.managerPowers=FastExt.Json.jsonToObject(window.parent.getParentExtPower()),FastExt.System.managerPowers)for(var code in FastExt.Power.powers)if(FastExt.System.managerPowers.hasOwnProperty(code)){var managerPower=FastExt.System.managerPowers[code],managerPowerKey;for(managerPowerKey in managerPower)managerPower[managerPowerKey]||(FastExt.Power.powers[code][managerPowerKey]=!1)}window.getExtPower=function(){return FastExt.Power.getSavePowerData()}}Ext.Ajax.on("beforerequest",function(t,e,n){try{if(FastExt.Server.isSilenceRequest())return;FastExt.System.getProgressLine(FastExt.Color.toColor(FastExt.System.getExt("front-color").value)).set(0),FastExt.System.getProgressLine(FastExt.Color.toColor(FastExt.System.getExt("front-color").value)).animate(.7)}catch(t){}}),Ext.Ajax.on("requestcomplete",function(conn,response,options){try{if(203===response.status)FastExt.System.sessionOut();else try{var jsonData=eval("("+response.responseText+")");203===jsonData.code&&FastExt.System.sessionOut()}catch(e){}}catch(e){}finally{FastExt.System.getProgressLine(FastExt.Color.toColor(FastExt.System.getExt("front-color").value)).animate(1)}}),Ext.Ajax.on("requestexception",function(t,e,n,i){try{if(FastExt.Server.isSilenceRequest())return;FastExt.Dialog.showException(e.responseText,"请求异常！")}catch(t){}finally{FastExt.System.getProgressLine(FastExt.Color.toColor(FastExt.System.getExt("front-color").value)).animate(1)}}),Ext.on("mousedown",function(t){FastExt.System.currClickTarget=t.target}),$(document).ajaxStart(function(t){try{if(FastExt.Server.isSilenceRequest())return;FastExt.System.getProgressLine(FastExt.Color.toColor(FastExt.System.getExt("front-color").value)).set(0),FastExt.System.getProgressLine(FastExt.Color.toColor(FastExt.System.getExt("front-color").value)).animate(.7)}catch(t){}}),$(document).ajaxComplete(function(event,xhr,options){try{if(203===xhr.status)FastExt.System.sessionOut();else try{var jsonData=eval("("+xhr.responseText+")");203===jsonData.code&&FastExt.System.sessionOut()}catch(e){}}catch(e){}finally{FastExt.System.getProgressLine(FastExt.Color.toColor(FastExt.System.getExt("front-color").value)).animate(1)}}),$(document).ajaxError(function(t,e,n){try{if(FastExt.Server.isSilenceRequest())return;FastExt.Dialog.showException(e.responseText,"请求异常")}catch(t){}finally{FastExt.System.getProgressLine(FastExt.Color.toColor(FastExt.System.getExt("front-color").value)).animate(1)}}),window.addEventListener("popstate",function(t){FastExt.System.selectTab(FastExt.System.selectTabFromHref())},!1),FastExt.System.init=!0,FastExt.System.initSystem()},System.initSystem=function(){FastExt.System.removeLoading();var n=this,t=FastExt.System.getBodyContainer();t.removeAll();var e=FastExt.Color.toColor(n["theme-color"].value),i=FastExt.Color.toColor(n["front-color"].value),o=n["system-logo"].value,a=n.version.desc,r=$("title").text()+a;Ext.isEmpty(o)&&(o="icons/icon_head_system.svg");a=Ext.create("Ext.toolbar.Toolbar",{height:60,padding:"0 0 0 0",border:0,flex:1,power:!1,cls:"headContainer",style:{background:e},items:[{xtype:"image",src:o,height:40,width:40,cls:"headLogo",margin:"10 5 5 5",style:{borderRadius:"10px"}},{xtype:"label",margin:"0 0 0 5",html:"<div class='headTitle' style='color: "+i+";' >"+r+"</div>"},"->",{xtype:"button",iconCls:"extIcon extRole",text:n.manager.managerName,minWidth:155,cls:"headButton",menu:[{text:"修改登录密码",iconCls:"extIcon extResetPassword",handler:function(){n.modifyPassword(this)}},{text:"初始化系统配置",iconCls:"extIcon extRefresh searchColor",handler:function(){Ext.Msg.confirm("系统提醒","确定初初始化系统配置吗？",function(t,e){"yes"==t&&FastExt.System.startSilenceSaveConfig()})}}]},{xtype:"button",iconCls:"extIcon extExits",text:"退出登录",cls:"headButton",handler:function(){n.logout()}}]}),o=Ext.create("Ext.toolbar.Toolbar",{border:0,padding:"0 0 0 0",flex:1,height:3,style:{background:e},html:'<div class="progress" id="progress"></div>'}),i=Ext.create("Ext.panel.Panel",{layout:"absolute",region:"north",height:60,border:0,hidden:FastExt.Power.config,items:[a,o],listeners:{afterlayout:function(){this.getEl().on("dblclick",function(){FastExt.System.fullscreen?FastExt.System.outFullscreen():FastExt.System.inFullScreen()})}}}),r=parseInt((.25*document.body.clientWidth).toFixed(0)),a=Ext.create("Ext.panel.Panel",{border:0,region:"center",cls:"treelist-with-nav",scrollable:"y",items:[{xtype:"treelist",id:"leftTreeList",reference:"treelist",expanderOnly:!1,singleExpand:!0,ui:"nav",scrollable:"y",expanderFirst:!1,selectOnExpander:!0,highlightPath:!0,store:{type:"tree",root:{expanded:!0,children:n.menus}},viewModel:{formulas:{selectionItem:function(t){try{var e=t("treelist.selection");return e&&e.data.leaf&&n.showTab(e.data.method,e.data.id,e.data.text,e.data.icon),e}catch(t){FastExt.Dialog.showException(t)}}}}}],listeners:{resize:function(t,e,n,i,o,a){var r=e<=128,s=Ext.getCmp("leftTreeList"),l=s.ownerCt.ownerCt;s.setMicro(r),r?l.setWidth(44):l.setWidth(e)}}});n.tabPanelContainer=Ext.create("Ext.tab.Panel",{region:"center",id:"tabs",plain:!0,style:{marginTop:"-8px"},items:[],recordTab:function(){FastExt.System.recordTab()},plugins:["tabreorderer",{ptype:"tabclosemenu"}]});var o=Ext.create("Ext.panel.Panel",{layout:"border",region:"center",border:0,style:{background:"#eeeeee"},items:[n.tabPanelContainer]}),s=Ext.create("Ext.panel.Panel",{layout:"border",region:"west",border:0,width:r,minWidth:44,maxWidth:500,subtitle:"左侧菜单",split:!0,style:{background:"#32404e"},items:[{xtype:"image",height:35,border:0,padding:"5 5 5 5",region:"south",src:FastExt.Server.getIcon("icon_v_menu.svg"),cls:"leftBottom",listeners:{el:{click:function(){s.getWidth()<=44?null!=s.oldWidth?s.setWidth(Math.max(200,s.oldWidth)):s.setWidth(200):(s.oldWidth=s.getWidth(),s.setWidth(44))}}}},a]});n.tabPanelContainer.add({title:"首页",xtype:"panel",id:"tabWelcome",reorderable:!1,closable:!1,layout:"fit",iconCls:"extIcon extIndex",justFixed:!0,items:[FastExt.System.getWelcomePanel()],listeners:{beforeactivate:function(t){if(!FastExt.System.silenceGlobalSave)try{n.selectMenu(n.lastTabId,!0)}catch(t){}},activate:function(t){var e;FastExt.System.clearAllTabTheme(),FastExt.System.silenceGlobalSave||n.restoredTab&&(e={title:t.title,url:n.baseUrl},window.history.pushState(e,t.title,n.baseUrl))}}});o=Ext.create("Ext.panel.Panel",{layout:"border",border:0,bodyStyle:{background:e},items:[i,s,o]});t.add(o);var l=n.selectTabFromHref(),d=n.existMenu(l);FastExt.Base.toBool(n["tab-record"].value,!0)?(Ext.MessageBox.updateProgress(1,"即将完成操作，请耐心等待","系统初始化成功！获取菜单中…"),n.restoreTab().then(function(t){Ext.MessageBox.isVisible()&&Ext.MessageBox.hide();t=FastExt.Json.jsonToObject(t);n.restoredTab=!0,t&&(Ext.each(t,function(t){l===t.id?t.active=!0:d&&(t.active=!1),n.showTab(t.method,t.id,t.title,t.icon,t.active,!0,t.where,t.closable,t.reorderable)}),d&&n.selectTab(l),0!==t.length&&n.tabPanelContainer.getActiveTab()||n.tabPanelContainer.setActiveTab(Ext.getCmp("tabWelcome")))})):(Ext.MessageBox.isVisible()&&Ext.MessageBox.hide(),n.tabPanelContainer.setActiveTab(Ext.getCmp("tabWelcome")))},System.sessionOut=function(){var t;this.sessionOutAlert||(Ext.MessageBox.hide(),this.sessionOutAlert=!0,(t=Ext.create("Ext.window.Window",{title:"系统提醒",height:150,width:250,layout:"fit",resizable:!1,maximizable:!1,sessionWin:!0,fixed:!0,draggable:!1,iconCls:"extIcon extSessionOut",html:"<div  style='padding:15px;background: #fff;'>会话失效，请您重新登录！</div>",modal:!0,alwaysOnTop:!0,toFrontOnShow:!0,buttons:[{text:"重新登录",iconCls:"extIcon extLogin",flex:1,handler:function(){t.close()}}],listeners:{destroy:function(t,e){FastExt.Power.isPower()?window.parent.close():location.reload()}}})).show())},System.logout=function(){Ext.Msg.confirm("系统提示","<br/>您是否确定退出登录吗？",function(t){"yes"===t&&FastExt.Server.logout()})},System.getExt=function(t){return window.getExt(t)},System.getAllExt=function(){return window.getAllExt()},System.isInitSystem=function(){try{if(FastExt.System.init)return!0}catch(t){}return!1},System.isSuperRole=function(){return!(!this.manager||!this.manager.role||0!==this.manager.role.roleType)},System.inFullScreen=function(){try{var t=document.documentElement;t.requestFullscreen?t.requestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen(),this.fullscreen=!0}catch(t){console.error(t)}},System.outFullscreen=function(){try{var t=t;t.exitFullscreen?t.exitFullscreen():t.msExitFullscreen?t.msExitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitExitFullscreen&&t.webkitExitFullscreen(),this.fullscreen=!1}catch(t){console.error(t)}},System.validOperate=function(n,i,o){var t,e,a,r,s,l;n&&(s=Cookies.get("ValidOperate"+$.md5(n)),o=o||86400,s?i():(t="normal"===FastExt.System.getExt("login-type").value,s=5*FastExt.Base.getNumberValue(FastExt.System.fontSize)+8,e=function(){var t,e=a.form;e.isValid()&&(t=a.form.findField("loginPassword").getValue(),e.submit({params:{loginPassword:$.md5(t),operate:n,timeout:o},waitMsg:"正在为您验证中……",success:function(t,e){l.close(),i()},failure:function(t,e){r(),Ext.Msg.alert("验证失败",e.result.message,function(){-3===e.result.code&&a.form.findField("validateCode").focus()})}}))},a=Ext.create("Ext.form.FormPanel",{url:FastExt.Server.validOperateUrl(),method:"POST",fileUpload:!0,border:0,width:"100%",layout:"anchor",region:"center",bodyStyle:{},padding:"10 10 0 10",items:[{xtype:"textfield",fieldLabel:"登录账号",labelAlign:"right",labelWidth:s,margin:"10 10 0 0",name:"loginName",allowBlank:!1,blankText:"请输入当前登录名",emptyText:"请输入当前登录名",anchor:"100%"},{xtype:"textfield",fieldLabel:"登录密码",labelAlign:"right",labelWidth:s,inputType:"password",margin:"10 10 0 0",allowBlank:!1,blankText:"请输入登录密码",emptyText:"请输入登录密码",submitValue:!1,name:"loginPassword",anchor:"100%"},{xtype:"fieldcontainer",labelWidth:0,anchor:"100%",layout:{type:"hbox",align:"stretch"},hidden:t,items:[{xtype:"textfield",fieldLabel:"验证码",labelAlign:"right",labelWidth:s,margin:"10 10 0 0",allowBlank:t,flex:1,name:"validateCode",emptyText:"请输入验证码",blankText:"请输入验证码"},{xtype:"image",margin:"10 10 0 0",width:70,id:"imgCode",height:32}]},{xtype:"fieldcontainer",labelWidth:0,anchor:"100%",layout:{type:"hbox",align:"stretch"},items:[{xtype:"button",text:"取消",iconCls:"extIcon extReset",flex:1,tipText:"取消验证",margin:"10 5 10 10",handler:function(){l.close()}},{xtype:"button",text:"确定",tipText:"确定验证",margin:"10 10 10 5",iconCls:"extIcon extOk",flex:1,handler:function(){e()}}]}],listeners:{render:function(t){try{new Ext.util.KeyMap({target:t.getEl(),key:13,fn:e,scope:Ext.getBody()})}catch(t){console.error(t)}}}}),r=function(){try{a.form.findField("validateCode").reset(),Ext.getCmp("imgCode").setSrc("showCaptcha?t="+Math.random())}catch(t){}},s=Ext.create("Ext.panel.Panel",{region:"south",layout:"fit",width:"100%",border:0,html:"<div align='center' style='font-size: small;color:red;text-decoration:none; padding-left: 40px;padding-right: 40px;padding-bottom: 10px;'><b>完成验证后将继续执行《"+n+"》操作</b></div>"}),(l=Ext.create("Ext.window.Window",{title:"当前操作需要安全验证",iconCls:"extIcon extPower",width:380,resizable:!1,layout:"vbox",toFrontOnShow:!0,modal:!0,constrain:!0,items:[a,s]})).show(null,function(){try{t||(r(),Ext.get("imgCode").on({click:function(){r()}}))}catch(t){}})))},System.formatUrlVersion=function(t,e){if(Ext.isEmpty(t))return t;var n=t;if(t.indexOf("v=")<0&&(n=0<t.indexOf("?")?t+"&v="+FastExt.System.getValue("version").value:t+"?v="+FastExt.System.getValue("version").value),e)for(var i in e)e.hasOwnProperty(i)&&(n=n+"&"+i+"="+e[i]);return n},System.formatUrl=function(t,e){return Ext.isEmpty(t)?t:!t.startWith("http://")&&!t.startWith("https://")&&this.http?this.formatUrlVersion(this.http+t,e):this.formatUrlVersion(t,e)},System.asyncMethod=function(method){return new Ext.Promise(function(resolve,reject){try{var itemValue=eval(method);resolve(itemValue)}catch(e){resolve(null),console.error(e)}})},System.getMenu=function(t){t=Ext.getCmp("leftTreeList").getStore().getNodeById(t);if(t){t=t.data;return t&&t.parentId&&"root"!==t.parentId&&(t.parent=this.getMenu(t.parentId)),t}return null},System.findLastTag=function(){for(var t=Ext.getCmp("tabs"),e=t.items.items.length-1;0<=e;e--){var n=t.items.items[e];if(n&&!FastExt.Base.toBool(n.tab.closable,!0)&&!FastExt.Base.toBool(n.tab.reorderable,!0))return n}return null},System.recordTab=function(){return new Ext.Promise(function(n,e){try{var i=[],o=Ext.getCmp("tabs");o.items.each(function(t,e){var n={};Ext.isEmpty(t.method)||(n.method=t.method,n.where=t.where,n.title=t.title,n.icon=t.icon,n.id=t.id,n.closable=t.closable,n.reorderable=t.reorderable,n.active=t===o.getActiveTab(),i.push(n))}),FastExt.Server.setSilence(!0),FastExt.Server.saveExtConfig($.md5("SystemTabs"),"TabRecord",FastExt.Json.objectToJson(i),function(t,e){n(t),FastExt.Server.setSilence(!1)})}catch(t){e(t)}})},System.restoreTab=function(){return new Ext.Promise(function(n,e){try{FastExt.Server.showExtConfig($.md5("SystemTabs"),"TabRecord",function(t,e){n(e)})}catch(t){e(t)}})},System.selectTab=function(t){var e=Ext.getCmp(t);return e?(this.tabPanelContainer.setActiveTab(e),e.focus(),!0):this.selectMenu(t,!1)},System.selectMenu=function(t,e){try{Ext.isEmpty(e)&&(e=!1);var n=Ext.getCmp("leftTreeList"),i=n.getStore().getNodeById(t);if(!i)return!1;var o=i.get("parentId");if(!Ext.isEmpty(o)){var a=n.getStore().getNodeById(o);if(e)return n.setSelection(a),void a.collapse();"root"!==o&&(a.expand(!1,!0),this.selectMenu(o,e))}return n.setSelection(i),!0}catch(t){FastExt.Dialog.showException(t,"选择菜单！[system.selectMenu]")}},System.existMenu=function(t){return!Ext.isEmpty(t)&&null!=Ext.getCmp("leftTreeList").getStore().getNodeById(t)},System.getPlainMenu=function(t,e){if(Ext.isEmpty(e)&&(e=">"),t){if(t.parent){var n=FastExt.System.getPlainMenu(t.parent,e);if(n)return n+e+t.text}return t.text}return null},System.getPathMenu=function(t){if(t){if(t.parent){var e=FastExt.System.getPathMenu(t.parent);if(e)return e.push(t),e}return[t]}return null},System.getPlainIconMenu=function(t,e){Ext.isEmpty(e)&&(e=">");for(var n=FastExt.System.getPathMenu(t),i='<div style="line-height: 20px;display: flex" >',o=0;o<n.length;o++){var a=n[o],a='<img src="'+a.icon+'" width="20px" height="20px" /><span style="margin-left: 5px;">'+a.text+"</span> ";i+=a=0!=o?"<b style='margin:0 5px;'>"+e+"</b>"+a:a}return i+="</div>"},System.searchMenuByEntityCode=function(i){var o=function(t){if(!t)return null;for(var e=0;e<t.length;e++){var n=t[e];if(n.method&&0<=n.method.indexOf(i))return n;if(n.children){n=o(n.children);if(n)return n}}return null};return o(this.menus)},System.getAllMethodMenu=function(o){Ext.isEmpty(o)&&(o="");var a=function(t,e){if(t)for(var n=0;n<t.length;n++){var i=t[n];i.method&&0<=i.method.indexOf(o)&&e.push(i),a(i.children,e)}},t=[];return a(FastExt.System.menus,t),t},System.showTab=function(a,t,e,n,i,o,r,s,l){var d,c,u,x,m=this,g=Ext.getCmp("tabs");g.getActiveTab()&&t===g.getActiveTab().getId()||(n&&0!==n.length||(n=FastExt.Server.getIcon("icon_function.svg")),Ext.isEmpty(o)&&(o=!0),Ext.isEmpty(i)&&(i=!0),d=function(t,e){var n,i;t&&(!(n=m.getMenu(t.getId()))||(i=Ext.get(t.tabBtnId+"-btnIconEl"))&&(t=n.color,e&&(t=FastExt.Color.toColor(m["theme-color"].value)),i.setStyle("background-image","url("+FastExt.Server.getIcon(n.iconName,t)+")")))},(c=Ext.getCmp(t))||(x=e,(u=m.getMenu(t))&&(x=FastExt.System.getPlainIconMenu(u," >> ")),c=g.add({xtype:"panel",id:t,code:t,icon:n,layout:"fit",title:e,border:0,tabContainer:!0,closable:FastExt.Base.toBool(s,!0),reorderable:FastExt.Base.toBool(l,!0),methodInvoked:!1,method:a,where:r,items:[],tabBtnId:null,tabConfig:{help:x,helpType:FastEnum.HelpEnumType.mouse_in_out,helpAnchor:FastEnum.TooltipAnchorType.top,helpShowDelay:700,listeners:{destroy:function(t){t.helpTip&&t.helpTip.close()}}},doFixed:function(){var t,e=this;e.tab.setClosable(!e.tab.closable),e.tab.closable?(e.reorderable=e.tab.reorderable=!0,(t=FastExt.System.findLastTag())&&g.moveAfter(e,t)):((t=FastExt.System.findLastTag())&&g.moveAfter(e,t),e.reorderable=e.tab.reorderable=!1),Ext.isFunction(g.recordTab)&&g.recordTab()},doCopyUrl:function(){FastExt.Base.copyToBoard(FastExt.System.baseUrl+"#/"+this.title+"/"+this.id),FastExt.Dialog.toast("复制成功！")},anchorLeftMenu:function(){FastExt.System.selectMenu(this.id)},openInWindow:function(){var i=this,t=parseInt((.8*document.body.clientWidth).toFixed(0)),e=parseInt((.9*document.body.clientHeight).toFixed(0));Ext.create("Ext.window.Window",{title:i.title,height:e,width:t,minHeight:500,minWidth:800,icon:i.icon,layout:"fit",resizable:!0,constrain:!0,maximizable:!0,listeners:{show:function(n){FastExt.System.asyncMethod(i.method).then(function(t){var e;null!=t&&((e=t.down("[entityList=true]"))&&(e.where=FastExt.Json.mergeJson(i.where,e.where),e.code=$.md5(i.id)),n.add(t))})}}}).show()},listeners:{deactivate:function(t){if(!FastExt.System.silenceGlobalSave)try{d(t,!1);var e=t.down("[entityList=true]");e&&e.onTabDeactivate&&e.onTabDeactivate(t)}catch(t){console.error(t)}},activate:function(o){o&&(m.lastTabId=o.id,FastExt.System.changeTabTheme(o.id,function(){var t;if(FastExt.System.silenceGlobalSave||(m.existMenu(o.id)&&m.selectMenu(o.id,!1),d(o,!0)),!o.methodInvoked||FastExt.System.silenceGlobalSave?m.asyncMethod(a).then(function(t){try{if(!t)return;o.methodInvoked=!0;var e=t.down("[entityList=true]");e&&(e.where=FastExt.Json.mergeJson(o.where,e.where),e.code=$.md5(o.id)),o.add(t)}catch(t){console.error(t)}}):(t=o.down("[entityList=true]"))&&t.onTabActivate&&t.onTabActivate(o),!FastExt.System.silenceGlobalSave){try{var e=window.location.href;if(0<e.indexOf("#")){var n=e.substring(e.lastIndexOf("/")+1);if(o.id===n)return}var i={title:o.title,url:m.baseUrl+"#/"+o.title+"/"+o.id};window.history.pushState(i,o.title,m.baseUrl+"#/"+o.title+"/"+o.id)}catch(t){console.error(t)}m.recordTab()}}))},afterlayout:function(t,e,n){if(!FastExt.System.silenceGlobalSave)try{Ext.get(this.tabBtnId).dom.ondblclick=function(){var n=t.getId();g.items.each(function(t,e){0!==e&&t.id===n&&t.closable&&t.close()})},g.getActiveTab()&&g.getActiveTab().getId()===t.getId()&&d(t,!0)}catch(t){}},destroy:function(t,e){FastExt.System.silenceGlobalSave||m.recordTab()}},initEvents:function(){this.tabBtnId=this.getEl().getAttribute("aria-labelledby")}})),i&&(FastExt.System.silenceGlobalSave?g.setActiveTab(c):g.getActiveTab()&&g.getActiveTab().getId()===c.getId()||(!o||(o=m.findLastTag())&&Ext.getCmp("tabs").moveAfter(c,o),g.setActiveTab(c))))},System.changeTabTheme=function(t,e){try{var n=FastExt.System.getMenu(t);if(n&&n.baseCls){if(FastExt.Base.toString(FastExt.System.currTabThemeCls,"")===n.baseCls)return;var i=FastExt.System.getExt("tab-theme").value;if(!FastExt.Base.toBool(i,!1))return;FastExt.System.clearAllTabTheme(),FastExt.System.getBodyContainer().setUserCls(n.baseCls),FastExt.System.currTabThemeCls=n.baseCls}else FastExt.System.clearAllTabTheme()}catch(t){console.error(t)}finally{e()}},System.clearAllTabTheme=function(){FastExt.System.currTabThemeCls=null,$("body").removeClass(function(t,e){for(var n=e.split(" "),i=[],o=0;o<n.length;o++){var a=n[o];a.startWith("baseTab")&&i.push(a)}return i.join(" ")})},System.closeAllTab=function(){Ext.getCmp("tabs").items.each(function(t,e){t.closable&&t.close()})},System.addTab=function(t,e,n,i){var o=(o=Ext.getCmp(e))||this.tabPanelContainer.add({title:n,xtype:"panel",id:e,code:e,icon:i,border:0,tabContainer:!0,closable:!0,reorderable:!0,layout:"fit",items:[t]});this.tabPanelContainer.setActiveTab(o)},System.selectTabFromHref=function(){var t=decodeURIComponent(window.location.href);return 0<t.indexOf("#")?t.substring(t.lastIndexOf("/")+1):null},System.modifyPassword=function(t){var e=Ext.create("Ext.form.FormPanel",{url:"controller/modifyPassword",method:"POST",fileUpload:!0,border:0,width:"100%",layout:"anchor",region:"center",bodyStyle:{},items:[{xtype:"textfield",fieldLabel:"当前密码",labelAlign:"right",labelWidth:60,margin:"10 10 10 10",name:"managerPassword",allowBlank:!1,inputType:"password",blankText:"请输入用户当前密码",anchor:"100%"},{xtype:"textfield",fieldLabel:"新密码",labelAlign:"right",labelWidth:60,margin:"10 10 10 10",name:"newPassword",allowBlank:!1,inputType:"password",blankText:"请输入用户新密码",anchor:"100%"},{xtype:"textfield",fieldLabel:"确认密码",labelAlign:"right",labelWidth:60,margin:"10 10 10 10",name:"reNewPassword",allowBlank:!1,inputType:"password",blankText:"请确认密码",anchor:"100%"},{xtype:"hiddenfield",name:"managerId",value:this.manager.managerId},{xtype:"fieldcontainer",labelWidth:0,layout:"column",items:[{xtype:"button",text:"立即修改",margin:"10 10 10 5",iconCls:"extIcon extOk",columnWidth:1,handler:function(){n()}}]}],listeners:{render:function(t){try{new Ext.util.KeyMap({target:t.getEl(),key:13,fn:n,scope:Ext.getBody()})}catch(t){console.error(t)}}}}),n=function(){var t=e.form;t.isValid()&&t.submit({waitMsg:"正在修改中……",success:function(t,e){FastExt.Dialog.toast(e.result.message),i.close(),e.result.success&&Ext.Msg.alert("系统提醒","您当前的密码已被修改，请您重新登录！",function(){FastExt.Server.logout()})},failure:function(t,e){Ext.Msg.alert("系统提醒",e.result.message)}})},i=Ext.create("Ext.window.Window",{title:"修改管理员登录密码",height:250,icon:t.icon,iconCls:t.iconCls,width:400,layout:"border",resizable:!1,maximizable:!1,animateTarget:t,constrain:!0,items:[e],modal:!0});i.show()},System.getEntity=function(t){for(var e=this.entities,n=0;n<e.length;n++){var i=e[n];if(i.entityCode===t)return i}return null},System.showMenuColumns=function(obj,checked){return new Ext.Promise(function(resolve,reject){var dataStore=Ext.create("Ext.data.TreeStore",{proxy:{type:"ajax",url:"showMenuColumn",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},listeners:{exception:function(obj,request,operation,eOpts){var data=eval("("+request.responseText+")");data.success||Ext.Msg.alert("数据获取失败",data.message)}},reader:{type:"json"}},root:{expanded:!0},listeners:{load:function(t,e,n){},beforeload:function(t,e){Ext.apply(t.proxy.extraParams,{checked:checked})}}}),treePanel=Ext.create("Ext.tree.Panel",{store:dataStore,rootVisible:!1,bufferedRenderer:!1,animate:!0,containerScroll:!0,autoScroll:!0,lastCheckNode:null,viewConfig:{loadMask:{msg:"加载功能菜单中，请稍后……"}},listeners:{checkchange:function(t,e,n,i){e?(t.bubble(function(t){t.set("checked",!0)}),t.cascadeBy(function(t){t.set("checked",!0)})):t.cascadeBy(function(t){t.set("checked",!1)})}}}),win=Ext.create("Ext.window.Window",{title:"搜索链配置",width:400,height:470,layout:"fit",iconCls:"extIcon extLink",resizable:!0,animateTarget:obj,maximizable:!0,constrain:!0,items:[treePanel],modal:!0,buttons:[{text:"重置",iconCls:"extIcon extReset",handler:function(){dataStore.reload()}},{text:"确定",iconCls:"extIcon extOk",handler:function(){for(var t,e,n,i=treePanel.getChecked(),o=[],a="",r=0;r<i.length;r++)i[r].isLeaf()&&((t={}).text=i[r].data.text,t.id=i[r].data.id,t.dataIndex=i[r].data.dataIndex,t.parentId=i[r].data.parentId,(e=treePanel.getStore().findNode("id",t.parentId,0,!1,!1,!0))&&(n=e.data,(e={}).text=n.text,e.id=n.id,e.method=n.method,e.icon=n.icon,t.parent=e,o.push(t))),a+=","+i[r].data.id;resolve({checked:a,columns:o}),win.close()}}]});win.show()})},System.showPowerMenus=function(obj,checked,parent){return new Ext.Promise(function(resolve,reject){var dataStore=Ext.create("Ext.data.TreeStore",{proxy:{type:"ajax",url:"showPowerMenus",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},listeners:{exception:function(obj,request,operation,eOpts){var data=eval("("+request.responseText+")");data.success||Ext.Msg.alert("数据获取失败",data.message)}},reader:{type:"json"}},root:{expanded:!0},listeners:{load:function(t,e,n){},beforeload:function(t,e){Ext.apply(t.proxy.extraParams,{checked:checked,parent:parent})}}}),treePanel=Ext.create("Ext.tree.Panel",{store:dataStore,rootVisible:!1,bufferedRenderer:!1,animate:!0,containerScroll:!0,autoScroll:!0,viewConfig:{loadMask:{msg:"加载功能菜单中，请稍后……"}},listeners:{checkchange:function(t,e,n,i){e?(t.bubble(function(t){t.set("checked",!0)}),t.cascadeBy(function(t){t.set("checked",!0)})):t.cascadeBy(function(t){t.set("checked",!1)})}}}),winWidth=parseInt((.4*document.body.clientWidth).toFixed(0)),winHeight=parseInt((.5*document.body.clientHeight).toFixed(0)),win=Ext.create("Ext.window.Window",{title:"权限配置（选择功能菜单）",height:winHeight,width:winWidth,minHeight:400,minWidth:470,layout:"fit",iconCls:"extIcon extSelect",resizable:!0,animateTarget:obj,maximizable:!0,constrain:!0,items:[treePanel],modal:!0,buttons:[{text:"重置",iconCls:"extIcon extReset",handler:function(){dataStore.reload()}},{text:"确定",iconCls:"extIcon extOk",handler:function(){for(var t=treePanel.getChecked(),e="",n=0;n<t.length;n++)e+=","+t[n].data.id;resolve(e),win.close()}}]});win.show()})},System.showPowerExt=function(t,i,o,a){return new Ext.Promise(function(t,e){window.getMenuPower=function(){return i},window.getExtPower=function(){return o},window.getParentExtPower=function(){return a},window.close=function(){Ext.getCmp("ExtPowerWindow").close()};var n=Ext.create("Ext.window.Window",{title:"配置界面权限（在组件上右击鼠标进行编辑权限）",id:"ExtPowerWindow",iconCls:"extIcon extPower",layout:"border",resizable:!1,maximized:!0,fixed:!0,draggable:!1,listeners:{show:function(t){t.update("<iframe name='extPowerFrame'  src='power?managerId=0' width='100%' height='100%' frameborder='0' scrolling='no' />")}},buttons:[{text:"保存权限配置",handler:function(){t(window.extPowerFrame.window.getExtPower()),n.close()}}]});n.show()})},System.showList=function(menuId,entityCode,where){if(!Ext.isString(menuId))throw"操作失败！参数menuId必须为String类型！请检查调用showList方法的相关功能！";if(!Ext.isString(entityCode))throw"操作失败！参数entityCode必须为String类型！请检查调用showList方法的相关功能！";if(!Ext.isEmpty(where)&&!Ext.isObject(where))throw"操作失败！参数where必须为Object对象类型！请检查调用showList方法的相关功能！";var entity=FastExt.System.getEntity(entityCode);if(!entity)throw"操作失败！未获取到 '"+entityCode+"' 实体类！请检查实体类关联的表格是否存在！";if(!entity.js)throw"操作失败！未获取到 '"+entityCode+"' JS对象！";where=where||{};var entityJsObj=eval("new "+entityCode+"()");return entityJsObj.menu=FastExt.System.getMenu(menuId),entityJsObj.getList(where)},System.getWelcomePanel=function(){FastExt.System.welcomeLeftPanels.push(FastExt.System.getSystemOperate()),FastExt.System.welcomeLeftPanels.push(FastExt.System.getSystemWaitNotice()),FastExt.System.isSuperRole()&&FastExt.System.welcomeLeftPanels.push(FastExt.System.getSystemBugReport());var t=Ext.create("Ext.panel.Panel",{layout:{type:"accordion"},region:"center",border:0,flex:.6,items:FastExt.System.welcomeLeftPanels});FastExt.System.isSuperRole()&&(FastExt.System.welcomeRightPanels.push(FastExt.System.getSystemVersion()),FastExt.System.welcomeRightPanels.push(FastExt.System.getSystemConfig()),FastExt.System.welcomeRightPanels.push(FastExt.System.getSystemMonitor()));var e=Ext.create("Ext.panel.Panel",{layout:"accordion",region:"east",border:0,flex:.4,collapsed:!1,split:!0,subtitle:"系统右侧面板",items:FastExt.System.welcomeRightPanels}),t=[t];return 0<FastExt.System.welcomeRightPanels.length&&t.push(e),window.initWelcomeItems&&window.initWelcomeItems(t),FastExt.Power.isPower()||FastExt.System.startCheckSystemWait(!0),Ext.create("Ext.panel.Panel",{layout:"border",region:"center",border:0,items:t})},System.getSystemOperate=function(){var i=Ext.create("Ext.data.Store",{autoLoad:!1,fields:[],id:"SystemLogStore",idProperty:"operateId",pageSize:50,proxy:{type:"ajax",url:"entity/list",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},reader:{type:"json",root:"list",totalProperty:"totalRow"}}}),t=Ext.create("Ext.toolbar.Paging",{store:i,dock:"bottom",border:0,overflowHandler:"scroller",displayInfo:!0}),o=Ext.create("Ext.grid.Panel",{region:"center",border:0,power:!0,multiColumnSort:!0,iconCls:"extIcon extLog",columnLines:!0,title:"系统操作日志",hideHeaders:!0,store:i,columns:[{header:"操作类型",dataIndex:"systemLogType",align:"center",width:120},{header:"操作介绍",dataIndex:"systemLogContent",align:"center",flex:1},{header:"操作时间",dataIndex:"systemLogDateTime",width:160,align:"center"},{header:"操作",dataIndex:"systemLogId",width:100,align:"center",renderer:function(t){return'<a href="javascript:FastExt.System.showSystemLogDetails('+t+');">查看详情</a>'}}],dockedItems:[t],viewConfig:{enableTextSelection:!0,loadMask:{msg:"正在为您在加载数据…"}}});return t.insert(t.items.getCount()-2,{xtype:"button",iconCls:"extIcon extSearch",tooltip:"搜索日志",handler:function(){o.add(FastExt.System.showSearchSysOperate(o,this))}}),t.insert(t.items.getCount()-3,"-"),i.on("beforeload",function(t,e){var n={};null!=o.searchForm&&(n=o.searchForm.getValues()),Ext.apply(t.proxy.extraParams,n),Ext.apply(t.proxy.extraParams,{entityCode:"ExtSystemLogEntity",limit:i.pageSize})}),i.loadPage(1),o},System.showSystemLogDetails=function(t){t=Ext.getStore("SystemLogStore").findRecord("systemLogId",t,0,!1,!1,!0),t=FastExt.Grid.createDetailsGrid(function(t){var e,n=[],i={a__managerName:"管理员",systemLogType:"操作类型",systemLogContent:"操作详情",systemLogIp:"来自IP",systemLogClient:"浏览器信息",systemSendData:"提交的数据",systemResultData:"返回的数据",systemLogDateTime:"操作时间"};for(e in i)n.push({name:i[e],key:e,value:t[e]});return n}(t.getData()),{region:"center",power:!1,hideHeaders:!0},{width:100,flex:0},{align:"left",renderer:function(t,e,n){return e.style="overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space:normal !important;line-height:20px;word-break:break-word; ","systemLogIp"===n.get("key")?"<a href='https://www.baidu.com/s?wd="+t+"' target='_blank'>"+t+"</a>":t},listeners:{dblclick:function(t,e,n,i,o,a,r){t=t.getStore().getAt(n),n=t.get("key");"systemSendData"!==n&&"systemResultData"!==n||FastExt.Dialog.showFormatJson(e,t.get("value"))}}});Ext.create("Ext.window.Window",{title:"日志详情",height:500,iconCls:"extIcon extDetails",width:500,layout:"border",resizable:!0,maximizable:!0,items:[t],modal:!0,constrain:!0}).show()},System.showSearchSysOperate=function(n,t){var e;return n.searchForm||(n.searchForm=Ext.create("Ext.form.FormPanel",{bodyPadding:5,region:"center",autoScroll:!0,layout:"column",defaults:{labelWidth:100,margin:"5 5 5 5",labelAlign:"right",emptyText:"可输入…"},listeners:{render:function(t,e){try{new Ext.util.KeyMap({target:t.getEl(),key:13,fn:function(){n.getStore().loadPage(1)},scope:this})}catch(t){console.error(t)}}},items:[{fieldLabel:"关键字",columnWidth:1,name:"where['^search']",xtype:"textfield"},{fieldLabel:"开始时间",columnWidth:.5,name:"where['systemLogDateTime>=']",xtype:"datefield",format:"Y-m-d"},{fieldLabel:"结束时间",columnWidth:.5,name:"where['systemLogDateTime<=']",xtype:"datefield",format:"Y-m-d"},{fieldLabel:"操作用户",columnWidth:.5,name:"where['a__managerName%?%']",xtype:"textfield"},{fieldLabel:"操作类型",columnWidth:.5,name:"where['systemLogType%?%']",xtype:"textfield"}]}),e=t.text,Ext.isEmpty(e)&&(e="搜索系统日志"),n.searchWin=Ext.create("Ext.window.Window",{title:e,closeAction:"hide",width:500,minWidth:500,minHeight:110,height:230,layout:"border",constrain:!0,iconCls:"extIcon extSearch",resizable:!0,collapsible:!0,animateTarget:t,items:[n.searchForm],buttons:[{text:"重置",iconCls:"extIcon extReset",handler:function(){n.searchForm.reset(),n.getStore().loadPage(1)}},{text:"搜索",iconCls:"extIcon extSearch",handler:function(){n.getStore().loadPage(1)}}]})),n.searchWin.show(),n.searchWin},System.getSystemWaitNotice=function(){var entity=eval("new ExtSystemNoticeEntity()");entity.menu={text:"系统问题上报"};var dataStoreNotice=Ext.create("Ext.data.Store",{autoLoad:!1,fields:[],id:"SystemWaitNoticeStore",entity:entity,pageSize:50,proxy:{type:"ajax",url:"entity/list",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},reader:{type:"json",root:"list",totalProperty:"totalRow"}}}),pagingtoolbar=Ext.create("Ext.toolbar.Paging",{store:dataStoreNotice,dock:"bottom",border:0,overflowHandler:"scroller",displayInfo:!0}),dataGridNotice=Ext.create("Ext.grid.Panel",{region:"center",border:0,power:!0,multiColumnSort:!0,iconCls:"extIcon extTip",columnLines:!0,title:"系统待办事项",hideHeaders:!0,store:dataStoreNotice,columns:[{header:"待办标题",dataIndex:"noticeTitle",align:"center",width:200},{header:"处理人",dataIndex:"a__managerName",align:"center",flex:1},{header:"待办内容",dataIndex:"noticeStateStr",align:"center",width:120},{header:"录入时间",dataIndex:"noticeDateTime",width:200,align:"center"}],plugins:[{ptype:"rowexpander",rowBodyTpl:new Ext.XTemplate("<p>【{noticeTitle}】{noticeContent}</p>","<p><tpl if='noticeState==0' ><a id='aNoticeAction{noticeId}' href='javascript:FastExt.System.setDoneSystemWait({noticeId});'>标记为已读</a>&nbsp;&nbsp;&nbsp;&nbsp;</tpl><tpl if='noticeAction' ><a href=\"javascript:{noticeAction};\">立即前往</a></tpl></p>")}],dockedItems:[pagingtoolbar],viewConfig:{enableTextSelection:!0,loadMask:{msg:"正在为您在加载数据…"}}});return dataStoreNotice.on("beforeload",function(t,e){var n={};null!=dataGridNotice.searchForm&&(n=dataGridNotice.searchForm.getValues()),Ext.apply(t.proxy.extraParams,n),Ext.apply(t.proxy.extraParams,{entityCode:"ExtSystemNoticeEntity",limit:dataStoreNotice.pageSize})}),dataStoreNotice.loadPage(1),dataGridNotice},System.getSystemBugReport=function(){var entity=eval("new ExtBugReportEntity()");entity.menu={text:"系统问题上报"};var dataStoreBugReport=Ext.create("Ext.data.Store",{autoLoad:!1,fields:[],id:"SystemBugReportStore",pageSize:50,entity:entity,proxy:{type:"ajax",url:"entity/list",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},reader:{type:"json",root:"list",totalProperty:"totalRow"}}}),pagingtoolbar=Ext.create("Ext.toolbar.Paging",{store:dataStoreBugReport,dock:"bottom",border:0,overflowHandler:"scroller",displayInfo:!0}),dataGridBugReport=Ext.create("Ext.grid.Panel",{region:"center",border:0,power:!0,multiColumnSort:!0,iconCls:"extIcon extBug",columnLines:!0,title:"系统问题上报",hideHeaders:!0,store:dataStoreBugReport,refreshCount:function(){var n=this;FastExt.Server.countReport(function(t,e){0<e?n.setTitle("系统问题上报 <span style='color: red;font-size: small;'>待处理（"+e+"）</span>"):n.setTitle("系统问题上报")})},columns:[{header:"功能类型",dataIndex:"funcTypeStr",align:"center",width:100},{header:"问题反馈",dataIndex:"bugContent",align:"center",flex:1,renderer:FastExt.Renders.text()},{header:"反馈状态",dataIndex:"reportStateStr",width:65,align:"center"},{header:"上报时间",dataIndex:"reportDateTime",width:120,align:"center"},{header:"操作",dataIndex:"reportId",width:100,align:"center",renderer:function(t){return'<a href="javascript:FastExt.System.showBugReportDetails('+t+');">查看详情</a>'}}],dockedItems:[pagingtoolbar],viewConfig:{enableTextSelection:!0,loadMask:{msg:"正在为您在加载数据…"}}}),beginIndex=2;return pagingtoolbar.insert(pagingtoolbar.items.getCount()-beginIndex,"-"),pagingtoolbar.insert(pagingtoolbar.items.getCount()-beginIndex,{xtype:"button",iconCls:"extIcon extSearch",tooltip:"搜索问题",handler:function(){dataGridBugReport.add(FastExt.System.showSearchBugReport(dataGridBugReport,this))}}),pagingtoolbar.insert(pagingtoolbar.items.getCount()-beginIndex,"-"),pagingtoolbar.insert(pagingtoolbar.items.getCount()-beginIndex,{xtype:"button",iconCls:"extIcon extAdd grayColor",tooltip:"添加问题",handler:function(){entity.showAdd(this).then(function(){dataStoreBugReport.loadPage(1)})}}),dataStoreBugReport.on("beforeload",function(t,e){var n={};null!=dataGridBugReport.searchForm&&(n=dataGridBugReport.searchForm.getValues()),Ext.apply(t.proxy.extraParams,n),Ext.apply(t.proxy.extraParams,{entityCode:"ExtBugReportEntity",limit:dataStoreBugReport.pageSize})}),dataStoreBugReport.on("load",function(t,e,n,i,o){dataGridBugReport.refreshCount()}),dataStoreBugReport.loadPage(1),dataGridBugReport},System.setDoneSystemWait=function(n){FastExt.Dialog.showWait("正在标记中，请稍后……"),FastExt.Server.doneWaitNotice(n,function(t,e){FastExt.Dialog.hideWait(),t?(FastExt.Dialog.toast(e),$("#aNoticeAction"+n).remove(),Ext.getCmp("bNoticeAction"+n)&&(Ext.getCmp("bNoticeAction"+n).destroy(),(t=Ext.getCmp("NoticeAlertWindow"))&&0===$("[type='bNoticeAction']").length&&t.close())):FastExt.Dialog.showAlert("系统提醒",e)})},System.startCheckSystemWait=function(l){window.clearTimeout(FastExt.Server.checkWaitNoticeTimer);var d={};if(!l)for(var t=$("[type='bNoticeAction']"),e=0;e<t.length;e++)d["noticeId_"+e]=$(t[e]).attr("data-id");FastExt.System.silenceGlobalSave?FastExt.Base.toBool(FastExt.System.noticeListener,!1)&&(FastExt.Server.checkWaitNoticeTimer=setTimeout(function(){FastExt.System.startCheckSystemWait()},3e3)):FastExt.Server.checkWaitNotice(d,function(t,e){try{if(t){var n=Ext.getCmp("NoticeAlertWindow");if(e.length<=0&&0===Object.keys(d).length)return void(n&&n.close());for(var i=[],o=!1,a=0;a<e.length;a++){var r=e[a],s={xtype:"fieldset",margin:"10",id:"bNoticeAction"+r.noticeId,style:{background:"#ffffff"},columnWidth:1,viewModel:{data:r},defaults:{anchor:"100%",height:"auto",margin:"0",labelAlign:"right",labelWidth:0,columnWidth:1,disabled:!0,disabledCls:".x-item-disabled-normal"},items:[{xtype:"displayfield",bind:"{noticeContent}",renderer:function(t,e){var n=e.ownerCt.viewModel.data,e="<b style='display: block;font-size: 16px;margin-bottom: 10px;'>"+n.noticeTitle+"</b>";return e+="<div>"+t+"</div>",e+="<div style='margin-top: 10px;display: flex;' ><a type='bNoticeAction' data-id='"+n.noticeId+"' href='javascript:FastExt.System.setDoneSystemWait("+n.noticeId+");'>标记为已读</a>",Ext.isEmpty(n.noticeAction)||(e+='&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:'+n.noticeAction+';">立即前往</a>'),e+="<span style='flex: 1;text-align: right;'>"+n.noticeDateTime+"</span></div>",e+="<div style='font-size: smaller;color: #a0a0a0;margin-top: 10px;'>注：如果已处理请标记为已读！</div>"}}]};i.push(s),0===$("#bNoticeAction"+r.noticeId).length&&(o=!0)}if(!o&&!l)return;n||(n=Ext.create("Ext.window.Window",{title:"系统待办事项",id:"NoticeAlertWindow",width:400,height:400,layout:"column",closable:!1,constrain:!0,iconCls:"extIcon extTip",resizable:!1,scrollable:!0,tools:[{type:"refresh",callback:function(){Ext.getStore("SystemWaitNoticeStore").loadPage(1),FastExt.System.startCheckSystemWait(!0)}},{type:"close",callback:function(){FastExt.Dialog.showWait("正在清除中，请稍后……"),FastExt.Server.clearWaitNotice(function(t,e){FastExt.Dialog.hideWait(),t?n.close():FastExt.Dialog.showAlert("系统提醒",e)})}}],collapsible:!0})).showAt(5*$(window).width(),5*$(window).width()),l?(n.removeAll(),n.add(i)):(n.insert(0,i),n.setScrollY(0,!0)),window.onSystemNoticeShow&&window.onSystemNoticeShow()}}finally{FastExt.Base.toBool(FastExt.System.noticeListener,!1)&&(FastExt.Server.checkWaitNoticeTimer=setTimeout(function(){FastExt.System.startCheckSystemWait()},3e3))}})},System.showBugReportDetails=function(t){function e(t){var e,n=[],i={a__managerName:"上报用户",funcTypeStr:"功能类型",funcName:"功能名称",bugContent:"问题描述",bugFlow:"操作步骤",bugImagesHtml:"问题截图",fixInfo:"修改意见",reportStateStr:"上报状态",reportDateTime:"上报时间"};for(e in i)n.push({name:i[e],value:t[e]});return n}var n=Ext.getStore("SystemBugReportStore"),i=n.findRecord("reportId",t,0,!1,!1,!0),o=FastExt.Grid.createDetailsGrid(e(i.getData()),{region:"center",power:!1,hideHeaders:!0},{width:100,flex:0},{align:"left"}),a=Ext.create("Ext.window.Window",{title:"问题详情",height:500,iconCls:"extIcon extDetails",width:500,layout:"border",resizable:!0,maximizable:!0,items:[o],modal:!0,constrain:!0,buttons:["->",{text:"删除问题",iconCls:"extIcon extDelete whiteColor",handler:function(){Ext.Msg.show({title:"系统提醒",icon:Ext.Msg.QUESTION,message:"您确定这条问题吗？",buttons:Ext.Msg.YESNO,defaultFocus:"no",callback:function(t,e){"yes"===t&&FastExt.Store.commitStoreDelete(n,[i]).then(function(){a.close()})}})}},{text:"反馈修改意见",iconCls:"extIcon extEdit",handler:function(){FastExt.Dialog.showEditor(this,"提交修改意见",function(t){i.set("fixInfo",t),i.set("reportState",1),i.set("reportStateStr","已处理"),FastExt.Store.commitStoreUpdate(n),o.updateData(e(i.getData()))})}}]});a.show()},System.showSearchBugReport=function(n,t){var e;return n.searchForm||(n.searchForm=Ext.create("Ext.form.FormPanel",{bodyPadding:5,region:"center",autoScroll:!0,layout:"column",defaults:{labelWidth:100,margin:"5 5 5 5",labelAlign:"right",emptyText:"可输入…"},listeners:{render:function(t,e){try{new Ext.util.KeyMap({target:t.getEl(),key:13,fn:function(){n.getStore().loadPage(1)},scope:this})}catch(t){console.error(t)}}},items:[{name:"where['funcType']",xtype:"enumcombo",fieldLabel:"功能类型",columnWidth:.5,enumName:"ExtBugFuncTypeEnum"},{name:"where['reportState']",xtype:"enumcombo",fieldLabel:"上报状态",columnWidth:.5,enumName:"ExtBugReportStateEnum"},{fieldLabel:"开始时间",columnWidth:.5,name:"where['reportDateTime>=']",xtype:"datefield",format:"Y-m-d"},{fieldLabel:"结束时间",columnWidth:.5,name:"where['reportDateTime<=']",xtype:"datefield",format:"Y-m-d"},{fieldLabel:"操作用户",columnWidth:.5,name:"where['a__managerName%?%']",xtype:"textfield"},{fieldLabel:"关键字",columnWidth:.5,name:"where['systemLogContent%?%']",xtype:"textfield"}]}),e=t.text,Ext.isEmpty(e)&&(e="搜索问题上报"),n.searchWin=Ext.create("Ext.window.Window",{title:e,closeAction:"hide",width:550,minWidth:500,minHeight:110,height:250,layout:"border",constrain:!0,iconCls:"extIcon extSearch",resizable:!0,collapsible:!0,animateTarget:t,items:[n.searchForm],buttons:[{text:"重置",iconCls:"extIcon extReset",handler:function(){n.searchForm.reset(),n.getStore().loadPage(1)}},{text:"搜索",iconCls:"extIcon extSearch",handler:function(){n.getStore().loadPage(1)}}]})),n.searchWin.show(),n.searchWin},System.getSystemVersion=function(){var t=[{name:"项目名称",value:FastExt.System.title.value},{name:"项目版本",value:FastExt.System.version.desc},{name:"项目位置",value:FastExt.System.root.value},{name:"操作文档",value:"<a href='"+FastExt.System["doc-extjs"].href+"' target='_blank' >"+FastExt.System["doc-extjs"].value+"</a>"},{name:"本机IP地址",value:FastExt.System.host.value},{name:"系统环境",value:FastExt.System.os.value},{name:"数据库",value:FastExt.System.db.value},{name:"运行服务器",value:FastExt.System.server.value},{name:"服务器位置",value:FastExt.System.catalina.value},{name:"核心框架",value:"<a href='http://www.fastchar.com' target='_blank' >"+FastExt.System.fastchar.value+"</a>"},{name:"开发语言",value:FastExt.System.java.value+"+ExtJs6.2.0+HTML5+CSS3"},{name:"开发服务商",value:"<a href='"+FastExt.System.developer.href+"' target='_blank'>"+FastExt.System.developer.value+"</a>"},{name:"版权归属",value:"<a href='"+FastExt.System.getExt("copyright").href+"' target='_blank'>"+FastExt.System.getExt("copyright").value+"</a>"}];return FastExt.Grid.createDetailsGrid(t,{title:"系统基本信息",iconCls:"extIcon extVersion",power:!1,hideHeaders:!0},{},{align:"center"})},System.getSystemConfig=function(){var n=Ext.create("Ext.form.FormPanel",{url:"ext/config/saveSystemConfig",bodyPadding:5,method:"POST",region:"center",power:!1,border:0,title:"系统全局设置",iconCls:"extIcon extSet",autoScroll:!0,defaults:{labelWidth:100,margin:"5 5 5 5",labelAlign:"right",emptyText:"请填写"},viewModel:{data:null},layout:"column",items:[{xtype:"fieldset",title:"基本设置",columnWidth:1,layout:"column",defaults:{anchor:"100%",margin:"5 5 5 5"},items:[{name:"theme-color",xtype:"colorfield",fieldLabel:"系统主题颜色",columnWidth:1,bind:"{theme-color}"},{name:"front-color",xtype:"colorfield",fieldLabel:"系统前景颜色",columnWidth:1,bind:"{front-color}"},{name:"theme",fieldLabel:"系统主题风格",columnWidth:1,xtype:"combo",displayField:"text",valueField:"id",editable:!1,value:1,bind:"{theme}",store:FastExt.Store.getThemeDataStore()},{name:"window-anim",fieldLabel:"系统窗体动画",columnWidth:1,xtype:"combo",displayField:"text",valueField:"id",editable:!1,value:1,bind:"{window-anim}",store:FastExt.Store.getYesOrNoDataStore()},{name:"tab-record",fieldLabel:"标签记忆功能",columnWidth:1,xtype:"combo",displayField:"text",valueField:"id",editable:!1,value:1,bind:"{tab-record}",store:FastExt.Store.getYesOrNoDataStore()},{name:"tab-theme",fieldLabel:"标签主题应用",columnWidth:1,xtype:"combo",displayField:"text",valueField:"id",editable:!1,value:1,bind:"{tab-theme}",store:FastExt.Store.getYesOrNoDataStore()},{name:"font-size",fieldLabel:"系统字体大小",columnWidth:1,xtype:"combo",displayField:"text",valueField:"id",editable:!1,value:1,bind:"{font-size}",store:FastExt.Store.getFontSizeDataStore()},{xtype:"button",text:"恢复默认",iconCls:"extIcon extReset whiteColor",columnWidth:.5,handler:function(){Ext.Msg.confirm("系统提醒","您确定恢复系统默认的配置吗？",function(t,e){"yes"===t&&(FastExt.Dialog.showWait("请稍后……"),n.getForm().reset(),FastExt.Server.deleteSystemConfig(function(t,e){FastExt.Dialog.hideWait(),t?location.reload():FastExt.Dialog.showAlert("系统提醒",e)}))})}},{xtype:"button",text:"保存配置",columnWidth:.5,iconCls:"extIcon extSave whiteColor",margin:"5 5 5 0 ",handler:function(){n.doSubmit()}}]},{xtype:"fieldset",title:"系统配置",columnWidth:1,layout:"column",defaults:{anchor:"100%",margin:"5 5 5 5"},items:[{xtype:"button",text:"初始化系统配置",columnWidth:1,iconCls:"extIcon extRefresh whiteColor",handler:function(){Ext.Msg.confirm("系统提醒","确定初初始化系统配置吗？",function(t,e){"yes"==t&&FastExt.System.startSilenceSaveConfig()})}},{xtype:"button",text:"下载系统配置",columnWidth:.5,iconCls:"extIcon extDownload whiteColor",handler:function(){FastExt.Dialog.showWait("正在获取系统配置文件中……"),$.post("downSystemConfig",function(t){FastExt.Dialog.hideWait(),t.success?(FastExt.Dialog.toast("获取成功！"),FastExt.Base.openUrl(t.data,FastEnum.Target._self)):FastExt.Dialog.showAlert("系统提醒",t.message)})}},{xtype:"button",text:"上传系统配置",columnWidth:.5,margin:"5 5 5 0 ",iconCls:"extIcon extUpload whiteColor",handler:function(){FastExt.System.uploadSystemConfigData(this)}},{xtype:"button",text:"更新系统数据权限",columnWidth:1,hidden:!FastExt.Base.toBool(FastExt.System.layer,!1),iconCls:"extIcon extPower whiteColor",handler:function(){Ext.Msg.confirm("系统提醒","确定更新系统所有表格的数据权限值吗？",function(t,e){"yes"==t&&FastExt.System.validOperate("更新所有表格的数据权限层级值",function(){FastExt.Dialog.showWait("正在更新中，请稍后……"),FastExt.Server.updateAllLayer(function(t,e){FastExt.Dialog.hideWait(),FastExt.Dialog.showAlert("系统提醒",e)})},30)})}}]}],doSubmit:function(){var t=n.form;t.isValid()&&t.submit({waitMsg:"正在保存配置中……",success:function(t,e){Ext.Msg.alert("系统设置","设置保存成功！",function(t){"ok"===t&&location.reload()})},failure:function(t,e){Ext.Msg.alert("保存失败",e.result.message)}})}});return FastExt.Server.showSystemConfig(function(t,e){t&&n.getViewModel().setData(e)}),n},System.getSystemMonitor=function(){var t=Ext.create("Ext.panel.Panel",{layout:"column",region:"north",power:!1,border:0,bodyPadding:5,title:"系统监控信息",iconCls:"extIcon extMonitor",closable:!1,autoScroll:!0}),m=function(x){FastExt.Server.loadMonitor(function(t,e){if(x.removeAll(),e){for(var n=e.desc,i=e.data,o=0,a=0;a<n.length;a++){var r,s,l=n[a],d=[];for(r in l)"title"!==r&&(s={xtype:"textfield",fieldLabel:l[r],bind:"{"+r+"}"},d.push(s));var c=i[a],u=l.title;c.alert&&(o++,u="<b style='color: #c21904;'>"+u+"【预警】</b>"),x.add({xtype:"fieldset",title:u,columnWidth:1,collapsible:!0,viewModel:{data:c},defaults:{anchor:"100%",labelAlign:"right",labelWidth:80,columnWidth:1,disabled:!0,disabledCls:".x-item-disabled-normal"},items:d})}x.add({xtype:"button",text:"刷新信息",columnWidth:1,margin:"5 5 5 5",handler:function(t){t.setText("正在刷新"),t.setDisabled(!0),m(x)}}),0<o&&x.setTitle("<b style='color: #c21904;' >系统监控信息（"+o+"个预警）</b>")}})};return m(t),t},System.showLogin=function(t){var e=$("title").text(),n=FastExt.System.getExt("login-background").value,i=FastExt.Color.toColor(FastExt.System.getExt("theme-color").value),o=FastExt.System.getExt("login-logo").value,a="normal"===FastExt.System.getExt("login-type").value,r=FastExt.System.getExt("copyright").value,s=FastExt.System.getExt("copyright").href,l=FastExt.System.getExt("indexUrl").value,d=FastExt.System.getExt("version").desc,c=(new Date).getFullYear(),n=FastExt.System.formatUrl(n,{bg:i,dot:i}),u=Ext.create("Ext.panel.Panel",{layout:"fit",border:0,iframePanel:!0,html:"<iframe name='loginFrame'  src='"+n+"' width='100%' height='100%' style='border: 0px; overflow-x: hidden;background-color: "+i+"'/>"}),x="<div align='center' class='headPanel' style='color:"+i+";'><img class='loginLogo'  width='50px' height='50px;' src='"+FastExt.System.formatUrlVersion(o)+"' /><h2>"+e+"</h2></div>";o&&0!==o.length||(x="<div align='center' class='headPanel' style='color:"+i+";'><h2>"+e+"</h2></div>");n=Ext.create("Ext.panel.Panel",{region:"north",layout:"fit",bodyCls:"bgNull",width:"100%",bodyStyle:{},border:0,height:"auto",html:x}),o=Cookies.get("loginNameValue"),i=Cookies.get("loginPasswordValue"),e=Cookies.get("loginMemberValue");Ext.isEmpty(e)&&(e="0");function m(){try{g.form.findField("validateCode").reset(),Ext.getCmp("imgCode").setSrc("showCaptcha?t="+Math.random())}catch(t){}}var x=3*FastExt.Base.getNumberValue(FastExt.System.fontSize)+8,g=Ext.create("Ext.form.FormPanel",{url:FastExt.Server.loginUrl(),method:"POST",fileUpload:!0,bodyCls:"bgNull",border:0,width:"100%",layout:"anchor",region:"center",bodyStyle:{},padding:"10 10 10 10",items:[{xtype:"fieldset",title:"",layout:"anchor",padding:"10 10 0 10",items:[{xtype:"textfield",fieldLabel:"登录名",labelAlign:"right",labelWidth:x,margin:"10 10 0 0",name:"loginName",allowBlank:!1,blankText:"请输入登录名",emptyText:"请输入登录名",value:o,anchor:"100%"},{xtype:"textfield",fieldLabel:"密码",labelAlign:"right",labelWidth:x,inputType:"password",margin:"10 10 0 0",allowBlank:!1,blankText:"请输入登录密码",emptyText:"请输入登录密码",value:i,submitValue:!1,name:"loginPassword",anchor:"100%"},{xtype:"fieldcontainer",labelWidth:0,anchor:"100%",layout:{type:"hbox",align:"stretch"},hidden:a,items:[{xtype:"textfield",fieldLabel:"验证码",labelAlign:"right",labelWidth:x,margin:"10 10 0 0",allowBlank:a,flex:1,name:"validateCode",emptyText:"请输入验证码",blankText:"请输入验证码"},{xtype:"image",margin:"10 10 0 0",width:70,cls:"validCodeImg",id:"imgCode",height:32}]},{name:"loginMember",fieldLabel:"记住",xtype:"combo",labelAlign:"right",labelWidth:x,margin:"10 10 0 0",displayField:"text",valueField:"id",editable:!1,anchor:"100%",value:e,submitValue:!1,allowBlank:!1,store:Ext.create("Ext.data.Store",{data:[{id:"0",text:"用户名"},{id:"1",text:"用户名和密码"}]})},{xtype:"fieldcontainer",labelWidth:0,anchor:"100%",layout:{type:"hbox",align:"stretch"},items:[{xtype:"button",text:"重置",iconCls:"extIcon extReset",flex:1,tipText:"重置数据",margin:"10 5 10 10",handler:function(){g.form.reset()}},{xtype:"button",text:"登录",id:"btnLogin",tipText:"登录系统",margin:"10 10 10 5",iconCls:"extIcon extOk",flex:1,handler:function(){h()}}]}]}],listeners:{render:function(t){try{new Ext.util.KeyMap({target:t.getEl(),key:13,fn:h,scope:Ext.getBody()})}catch(t){console.error(t)}}}}),h=function(){var t,e=g.form;e.isValid()&&((t=window.onBeforeLogin)?t(e.getValues(),function(){f()}):f())},f=function(){var t,e,n,i=g.form;i.isValid()&&(t=g.form.findField("loginPassword").getValue(),e=g.form.findField("loginName").getValue(),n=g.form.findField("loginMember").getValue(),Cookies.set("loginNameValue",e,{expires:30}),Cookies.set("loginMemberValue",n,{expires:30}),1===parseInt(n)?Cookies.set("loginPasswordValue",t,{expires:30}):Cookies.remove("loginPasswordValue"),i.submit({params:{loginPassword:$.md5(t)},waitMsg:"正在为您登录……",success:function(t,e){FastExt.System.addScript({src:l+"?v="+FastExt.System.getExt("version").value})},failure:function(t,e){m(),-2===e.result.code&&g.form.findField("loginPassword").reset(),Ext.Msg.alert("登录失败",e.result.message,function(){-3===e.result.code&&g.form.findField("validateCode").focus()})}}))},e="_blank";s.startWith("javascript:")&&(e="_self");d=Ext.create("Ext.panel.Panel",{region:"south",layout:"fit",width:"100%",height:50,bodyCls:"bgNull",border:0,html:"<div align='center'><a href='"+s+"' target='"+e+"' style='font-size: xx-small;color:#aaa;text-decoration:none;'>"+r+"</a></div><div align='center' style='font-size: xx-small;color:#aaa;margin-top: 5px;'>Copyright © "+c+" "+d+"</div>"}),d=Ext.create("Ext.window.Window",{title:"管理员登录",iconCls:"extIcon extLogin",width:420,resizable:!1,layout:"vbox",bodyCls:"bgImage",closable:!1,toFrontOnShow:!0,constrain:!0,items:[n,g,d]});d.show(null,function(){Ext.getCmp("btnLogin").focus();try{a||(m(),Ext.get("imgCode").on({click:function(){m()}}))}catch(t){}}),t.add(u),t.add(d)},System.showLogin2=function(t){var e=$("title").text(),n=FastExt.System.getExt("login-background").value,i=FastExt.System.getExt("login-lottie-json").value,o=FastExt.Color.toColor(FastExt.System.getExt("theme-color").value),a=FastExt.System.getExt("login-logo").value,r="normal"===FastExt.System.getExt("login-type").value,s=FastExt.System.getExt("copyright").value,l=FastExt.System.getExt("copyright").href,d=FastExt.System.getExt("indexUrl").value,c=FastExt.System.getExt("version").desc,u=(new Date).getFullYear(),n=FastExt.System.formatUrl(n,{bg:o,dot:o}),i=FastExt.System.formatUrl(i,{bg:o}),x=Ext.create("Ext.panel.Panel",{layout:"fit",border:0,iframePanel:!0,html:"<iframe name='loginFrame'  src='"+n+"' width='100%' height='100%' style='border: 0px; overflow-x: hidden;background-color: "+o+"'/>"}),m="<div align='center' class='headPanel' style='color:"+o+";'><img class='loginLogo'  width='80px' height='80px;' src='"+FastExt.System.formatUrlVersion(a)+"' /><h2>"+e+"</h2></div>";a&&0!==a.length||(m="<div align='center' class='headPanel' style='color:"+o+";'><h2>"+e+"</h2></div>");var g=Ext.create("Ext.panel.Panel",{region:"north",layout:"fit",bodyCls:"bgNull",width:"100%",bodyStyle:{},border:0,height:"auto",html:m}),n=Cookies.get("loginNameValue"),a=Cookies.get("loginPasswordValue"),e=Cookies.get("loginMemberValue");Ext.isEmpty(e)&&(e="0");function h(){try{f.form.findField("validateCode").reset(),Ext.getCmp("imgCode").setSrc("showCaptcha?t="+Math.random())}catch(t){}}var m=2*FastExt.Base.getNumberValue(FastExt.System.fontSize),f=Ext.create("Ext.form.FormPanel",{url:FastExt.Server.loginUrl(),method:"POST",bodyCls:"bgNull",border:0,width:"100%",layout:"anchor",region:"center",bodyStyle:{},padding:"10 10 10 10",items:[{xtype:"fieldset",title:"",layout:"anchor",padding:"10 10 0 10",defaults:{labelAlign:"right",labelWidth:m,labelSeparator:"",labelStyle:"font-size: 20px !important;color: #888888;"},items:[{xtype:"textfield",fieldLabel:'<svg class="svgIcon" aria-hidden="true"><use xlink:href="#extLogin"></use></svg>',margin:"10 10 0 0",name:"loginName",allowBlank:!1,blankText:"请输入登录名",emptyText:"请输入登录名",value:n,anchor:"100%"},{xtype:"textfield",fieldLabel:'<svg class="svgIcon" aria-hidden="true"><use xlink:href="#extLogPwd"></use></svg>',inputType:"password",margin:"10 10 0 0",allowBlank:!1,blankText:"请输入登录密码",emptyText:"请输入登录密码",value:a,submitValue:!1,name:"loginPassword",anchor:"100%"},{xtype:"fieldcontainer",labelWidth:0,anchor:"100%",layout:{type:"hbox",align:"stretch"},hidden:r,items:[{xtype:"textfield",fieldLabel:'<svg class="svgIcon" aria-hidden="true"><use xlink:href="#extLoginCode"></use></svg>',labelAlign:"right",labelWidth:m,labelSeparator:"",labelStyle:"font-size: 20px !important;color: #888888;",margin:"10 10 0 0",allowBlank:r,flex:1,name:"validateCode",emptyText:"请输入验证码",blankText:"请输入验证码"},{xtype:"image",margin:"10 10 0 0",width:70,cls:"validCodeImg",id:"imgCode",height:32}]},{name:"loginMember",xtype:"combo",fieldLabel:'<svg class="svgIcon" aria-hidden="true"><use xlink:href="#extLoginRemember2"></use></svg>',margin:"10 10 0 0",displayField:"text",valueField:"id",editable:!1,anchor:"100%",value:e,submitValue:!1,allowBlank:!1,store:Ext.create("Ext.data.Store",{data:[{id:"0",text:"用户名"},{id:"1",text:"用户名和密码"}]})},{xtype:"fieldcontainer",labelWidth:0,anchor:"100%",layout:{type:"hbox",align:"stretch"},items:[{xtype:"button",text:"重置",iconCls:"extIcon extReset",flex:1,tipText:"重置数据",margin:"10 5 10 10",handler:function(){f.form.reset()}},{xtype:"button",text:"登录",id:"btnLogin",tipText:"登录系统",margin:"10 10 10 5",iconCls:"extIcon extOk",flex:1,handler:function(){p()}}]}]}],listeners:{render:function(t){try{new Ext.util.KeyMap({target:t.getEl(),key:13,fn:p,scope:Ext.getBody()})}catch(t){console.error(t)}}}}),p=function(){var t,e=f.form;e.isValid()&&((t=window.onBeforeLogin)?t(e.getValues(),function(){E()}):E())},E=function(){var t,e,n,i=f.form;i.isValid()&&(t=f.form.findField("loginPassword").getValue(),e=f.form.findField("loginName").getValue(),n=f.form.findField("loginMember").getValue(),Cookies.set("loginNameValue",e,{expires:30}),Cookies.set("loginMemberValue",n,{expires:30}),1===parseInt(n)?Cookies.set("loginPasswordValue",t,{expires:30}):Cookies.remove("loginPasswordValue"),i.submit({params:{loginPassword:$.md5(t)},waitMsg:"正在为您登录……",success:function(t,e){FastExt.System.addScript({src:d+"?v="+FastExt.System.getExt("version").value})},failure:function(t,e){h(),-2===e.result.code&&f.form.findField("loginPassword").reset(),Ext.Msg.alert("登录失败",e.result.message,function(){-3===e.result.code&&f.form.findField("validateCode").focus()})}}))},e="_blank";l.startWith("javascript:")&&(e="_self");c=Ext.create("Ext.panel.Panel",{region:"south",width:"100%",height:50,bodyCls:"bgNull",border:0,html:"<div align='center'><a href='"+l+"' target='"+e+"' style='font-size: xx-small;color:#aaa;text-decoration:none;'>"+s+"</a></div><div align='center' style='font-size: xx-small;color:#aaa;margin-top: 5px;'>Copyright © "+u+" "+c+"</div>"}),c=Ext.create("Ext.panel.Panel",{region:"center",layout:{type:"vbox",align:"stretch",pack:"center"},items:[g,f,c]}),o=Ext.create("Ext.panel.Panel",{region:"west",layout:"fit",width:588,border:0,bodyStyle:{background:o},listeners:{render:function(t){FastExt.Lottie.loadJsonAnim(t,i)}}}),c=Ext.create("Ext.window.Window",{resizable:!1,header:!1,layout:"border",bodyCls:"bgNull",closable:!1,toFrontOnShow:!0,constrain:!0,width:988,height:500,items:[o,c]});c.show(null,function(){Ext.getCmp("btnLogin").focus();try{r||(h(),Ext.get("imgCode").on({click:function(){h()}}))}catch(t){}}),t.add(x),t.add(c)},System.startSilenceSaveConfig=function(t){Ext.isEmpty(FastExt.System.allShowListMethodMenu)&&(FastExt.System.allShowListMethodMenu=FastExt.System.getAllMethodMenu("showList")),FastExt.System.closeAllTab(),FastExt.System.silenceGlobalSave=!0,Ext.MessageBox.show({alwaysOnTop:!0,modal:!0,animateTarget:t,title:"系统提醒",msg:"初始化系统配置",progressText:"请耐心等待，即将完成操作",progress:!0,closable:!1}),FastExt.System.doNextSilenceMenu()},System.doNextSilenceMenu=function(){Ext.isEmpty(FastExt.System.doNextSilenceMenuIndex)&&(FastExt.System.doNextSilenceMenuIndex=0);var t=FastExt.System.allShowListMethodMenu,e=FastExt.System.doNextSilenceMenuIndex;if(e>=t.length)return FastExt.Dialog.showAlert("系统提醒","系统配置已初始化完毕！"),FastExt.System.silenceGlobalSave=!1,void(FastExt.System.doNextSilenceMenuIndex=0);Ext.MessageBox.updateProgress(parseFloat(String(e+1))/parseFloat(t.length),"正在读取配置中，请耐心等待");t=t[e];FastExt.System.showTab(t.method,t.id,t.text,t.icon),FastExt.System.doNextSilenceMenuIndex=e+1},System.uploadSystemConfigData=function(t){var i=Ext.create("Ext.form.FormPanel",{url:"loadSystemConfig",method:"POST",margin:"5",fileUpload:!0,width:400,callBacked:!1,border:0,layout:"column",items:[{xtype:"filefield",fieldLabel:"系统配置文件",labelWidth:120,labelAlign:"right",buttonText:"选择文件",allowBlank:!1,name:"systemConfigFile",columnWidth:1}],doSubmit:function(){var n,t=i.form;t.isValid()&&((n=new Ext.LoadMask({msg:"正在上传文件中…",target:o})).show(),t.submit({success:function(t,e){FastExt.Dialog.toast(e.result.message),o.close()},failure:function(t,e){n.destroy(),Ext.Msg.alert("系统提醒","上传失败！"+e.result.message)}}))},listeners:{render:function(t){try{new Ext.util.KeyMap({target:t.getEl(),key:13,fn:i.doSubmit,scope:Ext.getBody()})}catch(t){console.error(t)}}}}),n="btnSubmit"+(new Date).getTime(),o=Ext.create("Ext.window.Window",{title:"上传系统配置文件",layout:"fit",resizable:!1,scrollable:!1,width:500,items:i,modal:!0,iconCls:"extIcon extUpload",animateTarget:t,constrain:!0,buttons:[{text:"重置",width:88,iconCls:"extIcon extReset",handler:function(){i.form.reset()}},{text:"上传",width:88,id:n,iconCls:"extIcon extOk",handler:function(){i.doSubmit()}}],listeners:{show:function(t,e){i.getForm().findField("systemConfigFile").fileInputEl.dom.click(),Ext.getCmp(n).focus()}}});o.show()},System.addFilterByEntityCreate=function(t,e){Ext.isEmpty(FastExt.System.entityCreateFilter[t])&&(FastExt.System.entityCreateFilter[t]=[]),FastExt.System.entityCreateFilter[t].push(e)},System._fontSize="14px",System.lastTabId=-1,System.dateFormat="Y-m-d H:i:s",System.init=!1,System.menus=null,System.http=null,System.baseUrl=null,System.regByImage=/\.(jpg|png|gif|jpeg)$/i,System.regByMP4=/\.(mp4)$/i,System.regByExcel=/\.(xls|xlsx)$/i,System.regByWord=/\.(doc)$/i,System.regByText=/\.(txt)$/i,System.fullscreen=!1,System.sessionOutAlert=!1,System.restoredTab=!1,System.silenceGlobalSave=!1,System.welcomeRightPanels=[],System.welcomeLeftPanels=[],System.currClickTarget=null,System.currTabThemeCls=null,System.entityCreateFilter={},System}();FastExt.System=System;var SystemScript=(Object.defineProperty(n7.prototype,"src",{get:function(){return this._src},set:function(t){this._src=t},enumerable:!1,configurable:!0}),Object.defineProperty(n7.prototype,"href",{get:function(){return this._href},set:function(t){this._href=t},enumerable:!1,configurable:!0}),Object.defineProperty(n7.prototype,"text",{get:function(){return this._text},set:function(t){this._text=t},enumerable:!1,configurable:!0}),n7);function n7(){}FastExt.SystemScript=SystemScript;var SystemCompat=function(){window.getEntityDataStore=FastExt.Store.getEntityDataStore,window.commitStoreUpdate=FastExt.Store.commitStoreUpdate,window.getGridSelModel=FastExt.Grid.getGridSelModel,window.renders=FastExt.Renders,window.files=FastExt.FileModule,window.getPageToolBar=FastExt.Grid.getPageToolBar,window.getDetailsPanel=FastExt.Grid.getDetailsPanel,window.system=FastExt.System,window.toBool=FastExt.Base.toBool,window.deleteGridData=FastExt.Grid.deleteGridData,window.updateGridData=FastExt.Grid.updateGridData,window.runCallBack=FastExt.Base.runCallBack,window.showDetailsWindow=FastExt.Grid.showDetailsWindow,window.showWait=FastExt.Dialog.showWait,window.hideWait=FastExt.Dialog.hideWait,window.toast=FastExt.Dialog.toast,window.showAlert=FastExt.Dialog.showAlert,window.showLink=FastExt.Dialog.showLink,window.showCode=FastExt.Dialog.showCode,window.showEditorHtml=FastExt.Dialog.showEditorHtml,window.showException=FastExt.Dialog.showException,window.showJson=FastExt.Dialog.showJson,window.showVideo=FastExt.Dialog.showVideo,window.showImage=FastExt.Dialog.showImage,window.showText=FastExt.Dialog.showText,window.shakeComment=FastExt.Component.shakeComment,window.rotateOSSImgUrl=FastExt.Image.rotateOSSImgUrl,window.showRectangle=FastExt.Map.selRectangleInMap,window.MemoryCache=FastExt.Cache.memory,window.buildUUID8=FastExt.Base.buildUUID8,window.openUrl=FastExt.Base.openUrl,window.server=FastExt.Server};FastExt.SystemCompat=SystemCompat;var ComponentInvokeInfo=function(){},subClass;for(subClass in FastExt.ComponentInvokeInfo=ComponentInvokeInfo,FastExt)FastExt[subClass]()}(FastExt=FastExt||{});